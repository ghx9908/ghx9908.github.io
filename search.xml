<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>gité…ç½®ä¸ªäººä¿¡æ¯</title>
      <link href="/2025/07/25/git-pei-zhi-ge-ren-xin-xi/"/>
      <url>/2025/07/25/git-pei-zhi-ge-ren-xin-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸŒŸ-é…ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆé€‚ç”¨äºæ‰€æœ‰ä»“åº“ï¼‰"><a href="#ğŸŒŸ-é…ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆé€‚ç”¨äºæ‰€æœ‰ä»“åº“ï¼‰" class="headerlink" title="ğŸŒŸ é…ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆé€‚ç”¨äºæ‰€æœ‰ä»“åº“ï¼‰"></a>ğŸŒŸ é…ç½®å…¨å±€ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆé€‚ç”¨äºæ‰€æœ‰ä»“åº“ï¼‰</h2><h3 id="æ­¥éª¤-1ï¼šé…ç½®ç”¨æˆ·å"><a href="#æ­¥éª¤-1ï¼šé…ç½®ç”¨æˆ·å" class="headerlink" title="æ­¥éª¤ 1ï¼šé…ç½®ç”¨æˆ·å"></a>æ­¥éª¤ 1ï¼šé…ç½®ç”¨æˆ·å</h3><p>æ‰“å¼€ç»ˆç«¯å¹¶è¿è¡Œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">"Your Name"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ­¥éª¤-2ï¼šé…ç½®é‚®ç®±"><a href="#æ­¥éª¤-2ï¼šé…ç½®é‚®ç®±" class="headerlink" title="æ­¥éª¤ 2ï¼šé…ç½®é‚®ç®±"></a>æ­¥éª¤ 2ï¼šé…ç½®é‚®ç®±</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">"your-email@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>ğŸ” <strong>æ³¨æ„</strong>ï¼š<code>--global</code> è¡¨ç¤ºæ­¤é…ç½®å¯¹æ‰€æœ‰ä»“åº“æœ‰æ•ˆã€‚å¦‚æœä½ å¸Œæœ›ä¸ºæŸä¸ªç‰¹å®šä»“åº“è®¾ç½®ä¸åŒçš„ç”¨æˆ·åå’Œé‚®ç®±ï¼Œå¯ä»¥è·³è¿‡ <code>--global</code>ã€‚</p></blockquote><hr><h2 id="ğŸ”§-é…ç½®å±€éƒ¨ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆåªé’ˆå¯¹å½“å‰ä»“åº“ï¼‰"><a href="#ğŸ”§-é…ç½®å±€éƒ¨ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆåªé’ˆå¯¹å½“å‰ä»“åº“ï¼‰" class="headerlink" title="ğŸ”§ é…ç½®å±€éƒ¨ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆåªé’ˆå¯¹å½“å‰ä»“åº“ï¼‰"></a>ğŸ”§ é…ç½®å±€éƒ¨ç”¨æˆ·åå’Œé‚®ç®±ï¼ˆåªé’ˆå¯¹å½“å‰ä»“åº“ï¼‰</h2><p>å¦‚æœä½ éœ€è¦ä¸ºæŸä¸ªç‰¹å®šä»“åº“è®¾ç½®ä¸åŒçš„ç”¨æˆ·åæˆ–é‚®ç®±ï¼š</p><ol><li>è¿›å…¥è¯¥ä»“åº“ç›®å½•ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /path/to/your/repo<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol><li>è®¾ç½®ä»“åº“çš„ç”¨æˆ·åå’Œé‚®ç®±ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config user.name <span class="token string">"Your Name"</span><span class="token function">git</span> config user.email <span class="token string">"your-email@example.com"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="âœ…-éªŒè¯é…ç½®"><a href="#âœ…-éªŒè¯é…ç½®" class="headerlink" title="âœ… éªŒè¯é…ç½®"></a>âœ… éªŒè¯é…ç½®</h2><p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å½“å‰çš„ç”¨æˆ·åå’Œé‚®ç®±é…ç½®ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¦‚æœæƒ³æŸ¥çœ‹å½“å‰ä»“åº“çš„é…ç½®ä¿¡æ¯ï¼ˆå±€éƒ¨é…ç½®ï¼‰ï¼Œå¯ä»¥æ‰§è¡Œï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config user.name<span class="token function">git</span> config user.email<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="ğŸ§©-å…¶ä»–é…ç½®"><a href="#ğŸ§©-å…¶ä»–é…ç½®" class="headerlink" title="ğŸ§© å…¶ä»–é…ç½®"></a>ğŸ§© å…¶ä»–é…ç½®</h2><p>å¦‚æœéœ€è¦æŸ¥çœ‹æ‰€æœ‰ Git é…ç½®ï¼ˆåŒ…æ‹¬å…¨å±€å’Œå±€éƒ¨é…ç½®ï¼‰ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> config <span class="token parameter variable">--list</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™å°†æ˜¾ç¤ºæ‰€æœ‰é…ç½®é¡¹ï¼ˆåŒ…æ‹¬ç”¨æˆ·åã€é‚®ç®±ç­‰ä¿¡æ¯ï¼‰ã€‚</p><hr><p>é€šè¿‡è¿™äº›é…ç½®ï¼Œä½ å¯ä»¥ç¡®ä¿åœ¨æäº¤ä»£ç æ—¶ï¼ŒGit ä¼šä½¿ç”¨æ­£ç¡®çš„èº«ä»½ä¿¡æ¯ã€‚å¦‚æœéœ€è¦æ›´æ”¹é‚®ç®±æˆ–è€…ç”¨æˆ·åï¼Œåªéœ€è¦æ‰§è¡Œç›¸åº”çš„ <code>git config</code> å‘½ä»¤å³å¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>macé…ç½®</title>
      <link href="/2025/07/23/mac-pei-zhi/"/>
      <url>/2025/07/23/mac-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="âœ…-ä¸€ã€ç³»ç»Ÿçº§åŸºç¡€é…ç½®"><a href="#âœ…-ä¸€ã€ç³»ç»Ÿçº§åŸºç¡€é…ç½®" class="headerlink" title="âœ… ä¸€ã€ç³»ç»Ÿçº§åŸºç¡€é…ç½®"></a>âœ… ä¸€ã€ç³»ç»Ÿçº§åŸºç¡€é…ç½®</h2><h3 id="1-macOS-è®¾ç½®ï¼ˆå»ºè®®æ‰‹åŠ¨è®¾ç½®ï¼‰"><a href="#1-macOS-è®¾ç½®ï¼ˆå»ºè®®æ‰‹åŠ¨è®¾ç½®ï¼‰" class="headerlink" title="1. macOS è®¾ç½®ï¼ˆå»ºè®®æ‰‹åŠ¨è®¾ç½®ï¼‰"></a>1. macOS è®¾ç½®ï¼ˆå»ºè®®æ‰‹åŠ¨è®¾ç½®ï¼‰</h3><ul><li><p>æ‰“å¼€å¼€å‘è€…æ¨¡å¼ï¼ˆå¦‚ç»ˆç«¯æ‰§è¡Œå‘½ä»¤æ— è­¦å‘Šï¼‰</p></li><li><p>å¿«æ·é”®ã€è§¦æ§æ¿ã€Dockã€è®¿è¾¾åå¥½è®¾ç½®ä¼˜åŒ–</p></li><li><p>å®‰è£… Xcode Command Line Toolsï¼š</p><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘xcode-select --install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="2-å®‰è£…åŒ…ç®¡ç†å™¨-Homebrew"><a href="#2-å®‰è£…åŒ…ç®¡ç†å™¨-Homebrew" class="headerlink" title="2. å®‰è£…åŒ…ç®¡ç†å™¨ Homebrew"></a>2. å®‰è£…åŒ…ç®¡ç†å™¨ Homebrew</h3><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘&#x2F;bin&#x2F;bash -c &quot;$(curl -fsSL https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;Homebrew&#x2F;install&#x2F;HEAD&#x2F;install.sh)&quot;brew doctor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="âœ…-äºŒã€ç»ˆç«¯ç¯å¢ƒé…ç½®"><a href="#âœ…-äºŒã€ç»ˆç«¯ç¯å¢ƒé…ç½®" class="headerlink" title="âœ… äºŒã€ç»ˆç«¯ç¯å¢ƒé…ç½®"></a>âœ… äºŒã€ç»ˆç«¯ç¯å¢ƒé…ç½®</h2><h3 id="1-å®‰è£…å¹¶é…ç½®ç»ˆç«¯å·¥å…·"><a href="#1-å®‰è£…å¹¶é…ç½®ç»ˆç«¯å·¥å…·" class="headerlink" title="1. å®‰è£…å¹¶é…ç½®ç»ˆç«¯å·¥å…·"></a>1. å®‰è£…å¹¶é…ç½®ç»ˆç«¯å·¥å…·</h3><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘brew install zsh zsh-completionsbrew install starship<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å»ºè®®ä½¿ç”¨ <a href="https://iterm2.com/">iTerm2</a> æ›¿ä»£é»˜è®¤ç»ˆç«¯ï¼Œé…åˆ Starship æå‡ä½“éªŒï¼š</p><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘brew install --cask iterm2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-Zsh-æ’ä»¶å’Œä¸»é¢˜"><a href="#2-Zsh-æ’ä»¶å’Œä¸»é¢˜" class="headerlink" title="2. Zsh æ’ä»¶å’Œä¸»é¢˜"></a>2. Zsh æ’ä»¶å’Œä¸»é¢˜</h3><ul><li><p>ä½¿ç”¨ oh-my-zshï¼š</p><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘sh -c &quot;$(curl -fsSL https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;ohmyzsh&#x2F;ohmyzsh&#x2F;master&#x2F;tools&#x2F;install.sh)&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ¨èæ’ä»¶ï¼š</p><ul><li><code>zsh-autosuggestions</code></li><li><code>zsh-syntax-highlighting</code></li><li><code>z</code></li></ul></li><li><p>ä½¿ç”¨ Starship ç¾åŒ–ç»ˆç«¯æç¤ºç¬¦ï¼ˆ<code>.zshrc</code> æ·»åŠ ï¼‰</p><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘eval &quot;$(starship init zsh)&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><hr><h2 id="âœ…-ä¸‰ã€å¼€å‘é€šç”¨å·¥å…·å®‰è£…"><a href="#âœ…-ä¸‰ã€å¼€å‘é€šç”¨å·¥å…·å®‰è£…" class="headerlink" title="âœ… ä¸‰ã€å¼€å‘é€šç”¨å·¥å…·å®‰è£…"></a>âœ… ä¸‰ã€å¼€å‘é€šç”¨å·¥å…·å®‰è£…</h2><h3 id="1-Git-ä¸-SSH-é…ç½®"><a href="#1-Git-ä¸-SSH-é…ç½®" class="headerlink" title="1. Git ä¸ SSH é…ç½®"></a>1. Git ä¸ SSH é…ç½®</h3><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘brew install gitgit config --global user.name &quot;ä½ çš„åå­—&quot;git config --global user.email &quot;é‚®ç®±&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>ç”Ÿæˆ SSH keyï¼š</p><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘ssh-keygen -t ed25519 -C &quot;your_email@example.com&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>æ·»åŠ åˆ° GitHub / Gitee</p><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘pbcopy &lt; ~&#x2F;.ssh&#x2F;id_ed25519.pub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="2-Node-js-ç®¡ç†å™¨ï¼ˆnvm-æ¨èï¼‰"><a href="#2-Node-js-ç®¡ç†å™¨ï¼ˆnvm-æ¨èï¼‰" class="headerlink" title="2. Node.js ç®¡ç†å™¨ï¼ˆnvm æ¨èï¼‰"></a>2. Node.js ç®¡ç†å™¨ï¼ˆnvm æ¨èï¼‰</h3><pre class="line-numbers language-none"><code class="language-none">bashå¤åˆ¶ç¼–è¾‘brew install nvmmkdir ~&#x2F;.nvm<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ <code>~/.zshrc</code> æ·»åŠ ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">NVM_DIR</span><span class="token operator">=</span><span class="token string">"<span class="token environment constant">$HOME</span>/.nvm"</span><span class="token builtin class-name">source</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew <span class="token parameter variable">--prefix</span> nvm<span class="token variable">)</span></span>/nvm.sh"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å®‰è£… LTS Node.jsï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvm <span class="token function">install</span> <span class="token parameter variable">--lts</span>nvm use <span class="token parameter variable">--lts</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><hr><h2 id="âœ…-å››ã€å‰ç«¯å¼€å‘ç¯å¢ƒ"><a href="#âœ…-å››ã€å‰ç«¯å¼€å‘ç¯å¢ƒ" class="headerlink" title="âœ… å››ã€å‰ç«¯å¼€å‘ç¯å¢ƒ"></a>âœ… å››ã€å‰ç«¯å¼€å‘ç¯å¢ƒ</h2><h3 id="1-åŒ…ç®¡ç†å™¨"><a href="#1-åŒ…ç®¡ç†å™¨" class="headerlink" title="1. åŒ…ç®¡ç†å™¨"></a>1. åŒ…ç®¡ç†å™¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> <span class="token function">pnpm</span> <span class="token function">yarn</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-å¸¸ç”¨-CLI-å·¥å…·"><a href="#2-å¸¸ç”¨-CLI-å·¥å…·" class="headerlink" title="2. å¸¸ç”¨ CLI å·¥å…·"></a>2. å¸¸ç”¨ CLI å·¥å…·</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> eslint prettier vite create-react-app @vue/cli typescript<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-æµè§ˆå™¨ä¸æ‰©å±•"><a href="#3-æµè§ˆå™¨ä¸æ‰©å±•" class="headerlink" title="3. æµè§ˆå™¨ä¸æ‰©å±•"></a>3. æµè§ˆå™¨ä¸æ‰©å±•</h3><ul><li>Chrome / Edgeï¼ˆè°ƒè¯•å·¥å…·ä¸°å¯Œï¼‰</li><li>æ’ä»¶æ¨èï¼š<ul><li>Vue.js Devtools</li><li>React Developer Tools</li><li>Redux DevTools</li><li>JSON Viewer</li></ul></li></ul><hr><h2 id="âœ…-äº”ã€IDE-ä¸ç¼–è¾‘å™¨"><a href="#âœ…-äº”ã€IDE-ä¸ç¼–è¾‘å™¨" class="headerlink" title="âœ… äº”ã€IDE ä¸ç¼–è¾‘å™¨"></a>âœ… äº”ã€IDE ä¸ç¼–è¾‘å™¨</h2><h3 id="æ¨èå®‰è£…-VS-Codeï¼š"><a href="#æ¨èå®‰è£…-VS-Codeï¼š" class="headerlink" title="æ¨èå®‰è£… VS Codeï¼š"></a>æ¨èå®‰è£… VS Codeï¼š</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token parameter variable">--cask</span> visual-studio-code<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¨èæ’ä»¶ï¼š</p><ul><li>ESLint / Prettier / Vetur / VueDX / Volar</li><li>GitLens / Git Graph</li><li>Path Intellisense / Auto Import / IntelliCode</li><li>Bracket Pair Colorizer / TabNineï¼ˆAIï¼‰</li><li>REST Client</li></ul><hr><h2 id="âœ…-å…­ã€å…¶ä»–æ¨èå·¥å…·ï¼ˆè§†ä¸ªäººå–œå¥½ï¼‰"><a href="#âœ…-å…­ã€å…¶ä»–æ¨èå·¥å…·ï¼ˆè§†ä¸ªäººå–œå¥½ï¼‰" class="headerlink" title="âœ… å…­ã€å…¶ä»–æ¨èå·¥å…·ï¼ˆè§†ä¸ªäººå–œå¥½ï¼‰"></a>âœ… å…­ã€å…¶ä»–æ¨èå·¥å…·ï¼ˆè§†ä¸ªäººå–œå¥½ï¼‰</h2><h3 id="1-æ•°æ®åº“-æ¥å£è°ƒè¯•"><a href="#1-æ•°æ®åº“-æ¥å£è°ƒè¯•" class="headerlink" title="1. æ•°æ®åº“/æ¥å£è°ƒè¯•"></a>1. æ•°æ®åº“/æ¥å£è°ƒè¯•</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token parameter variable">--cask</span> postmanbrew <span class="token function">install</span> <span class="token parameter variable">--cask</span> insomnia<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-API-Mock-æœåŠ¡ä»£ç†"><a href="#2-API-Mock-æœåŠ¡ä»£ç†" class="headerlink" title="2. API Mock / æœåŠ¡ä»£ç†"></a>2. API Mock / æœåŠ¡ä»£ç†</h3><ul><li>mockoonã€apifoxã€proxymanã€whistle ç­‰</li></ul><h3 id="3-Docker"><a href="#3-Docker" class="headerlink" title="3. Docker"></a>3. Docker</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">brew <span class="token function">install</span> <span class="token parameter variable">--cask</span> <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="âœ…-ä¸ƒã€å‰ç«¯é¡¹ç›®æ¨¡æ¿æˆ–è„šæ‰‹æ¶é…ç½®"><a href="#âœ…-ä¸ƒã€å‰ç«¯é¡¹ç›®æ¨¡æ¿æˆ–è„šæ‰‹æ¶é…ç½®" class="headerlink" title="âœ… ä¸ƒã€å‰ç«¯é¡¹ç›®æ¨¡æ¿æˆ–è„šæ‰‹æ¶é…ç½®"></a>âœ… ä¸ƒã€å‰ç«¯é¡¹ç›®æ¨¡æ¿æˆ–è„šæ‰‹æ¶é…ç½®</h2><p>å¯æå‰å‡†å¤‡å¦‚ä¸‹å†…å®¹ï¼š</p><ul><li>å…¬å¸æˆ–ä¸ªäººå¸¸ç”¨é¡¹ç›®æ¨¡æ¿ï¼ˆReactã€Vue3 + Viteã€Nuxtã€Next.jsï¼‰</li><li>ESLint + Prettier + husky + lint-staged ç­‰è§„èŒƒç»Ÿä¸€æ–¹æ¡ˆ</li><li>Tailwind / Naive UI / Element Plus / Ant Design é…ç½®</li><li>å¸¸ç”¨ hooksã€ç»„ä»¶å°è£…åº“</li><li>vite.config.js / tsconfig.json æ¨¡æ¿</li></ul><hr><h2 id="âœ…-å…«ã€æ•ˆç‡ä¸è„šæœ¬å·¥å…·"><a href="#âœ…-å…«ã€æ•ˆç‡ä¸è„šæœ¬å·¥å…·" class="headerlink" title="âœ… å…«ã€æ•ˆç‡ä¸è„šæœ¬å·¥å…·"></a>âœ… å…«ã€æ•ˆç‡ä¸è„šæœ¬å·¥å…·</h2><ul><li>Alfredï¼ˆæ•ˆç‡ç¥å™¨ï¼‰</li><li>Raycastï¼ˆç°ä»£æ›¿ä»£å“ï¼‰</li><li>Rectangleï¼ˆçª—å£ç®¡ç†ï¼‰</li><li>Typora / Obsidianï¼ˆç¬”è®°ï¼‰</li><li>Hammerspoonï¼ˆè„šæœ¬è‡ªåŠ¨åŒ–ï¼‰</li></ul>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3ä¸­å®ç°å¯é‡ç½®çš„çŠ¶æ€ç®¡ç†ï¼šuseRestableRefä¸useRestableActive</title>
      <link href="/2025/06/24/vue3-zhong-shi-xian-ke-chong-zhi-de-zhuang-tai-guan-li-userestableref-yu-userestableactive/"/>
      <url>/2025/06/24/vue3-zhong-shi-xian-ke-chong-zhi-de-zhuang-tai-guan-li-userestableref-yu-userestableactive/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Vue 3 çš„ Composition API å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€ç§éœ€æ±‚ï¼š<strong>åœ¨æŸäº›æ“ä½œåï¼Œèƒ½å¤Ÿå°†ç»„ä»¶çŠ¶æ€ã€Œé‡ç½®ã€ä¸ºåˆå§‹å€¼</strong>ï¼Œæ¯”å¦‚è¡¨å•è¿˜åŸã€ç­›é€‰é¡¹å›é€€ç­‰ã€‚</p><p>æœ¬æ–‡å°†ä»‹ç»ä¸‰ä¸ªå®ç”¨çš„å¯é‡ç½®çŠ¶æ€å°è£…å‡½æ•°ï¼Œåˆ†åˆ«é€‚ç”¨äºä¸åŒåœºæ™¯ï¼š</p><ul><li><code>useRestableRefFn</code>ï¼šé€‚åˆæ¯æ¬¡åˆå§‹åŒ–éƒ½éœ€è¦æ–°è®¡ç®—åˆå§‹å€¼çš„æƒ…å†µï¼›</li><li><code>useRestableRef</code>ï¼šé€‚åˆå¤„ç†åŸºæœ¬ç±»å‹æˆ–éå“åº”å¼å¯¹è±¡ï¼›</li><li><code>useRestableActive</code>ï¼šé€‚åˆå¤„ç†å¤æ‚çš„å“åº”å¼å¯¹è±¡ï¼ˆå¦‚ reactive è¡¨å•å¯¹è±¡ï¼‰ã€‚</li></ul><h2 id="ä¸€ã€useRestableRefFnï¼šæ¯æ¬¡åˆå§‹åŒ–éƒ½æ‰§è¡Œå‡½æ•°"><a href="#ä¸€ã€useRestableRefFnï¼šæ¯æ¬¡åˆå§‹åŒ–éƒ½æ‰§è¡Œå‡½æ•°" class="headerlink" title="ä¸€ã€useRestableRefFnï¼šæ¯æ¬¡åˆå§‹åŒ–éƒ½æ‰§è¡Œå‡½æ•°"></a>ä¸€ã€useRestableRefFnï¼šæ¯æ¬¡åˆå§‹åŒ–éƒ½æ‰§è¡Œå‡½æ•°</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRestableRefFn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä½¿ç”¨åœºæ™¯ï¼š"><a href="#ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h3><p>å¦‚æœä½ çš„åˆå§‹å€¼æ˜¯é€šè¿‡å‡½æ•°è®¡ç®—å‡ºæ¥çš„ï¼ˆå¦‚å½“å‰æ—¶é—´ã€ç”Ÿæˆé»˜è®¤é…ç½®ç­‰ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå›ºå®šå€¼ï¼Œé‚£ä¹ˆæ¯æ¬¡ reset éƒ½åº”è¯¥é‡æ–°æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚</p><h3 id="ç¤ºä¾‹ï¼š"><a href="#ç¤ºä¾‹ï¼š" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRestableRefFn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¯æ¬¡è°ƒç”¨ <code>reset()</code>ï¼Œ<code>state.value</code> éƒ½ä¼šå˜æˆæ–°çš„æ—¶é—´å¯¹è±¡ã€‚</p><hr><h2 id="äºŒã€useRestableRefï¼šå¯é‡ç½®çš„-ref-çŠ¶æ€"><a href="#äºŒã€useRestableRefï¼šå¯é‡ç½®çš„-ref-çŠ¶æ€" class="headerlink" title="äºŒã€useRestableRefï¼šå¯é‡ç½®çš„ ref çŠ¶æ€"></a>äºŒã€useRestableRefï¼šå¯é‡ç½®çš„ ref çŠ¶æ€</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRestableRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> inintValue <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>inintValue<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h3><ul><li>åˆå§‹å€¼åªä¼šå­˜å‚¨ä¸€ä»½æ·±æ‹·è´ï¼›</li><li>æ¯æ¬¡é‡ç½®éƒ½ä¼šé‡æ–° clone ä¸€ä»½æ–°çš„ï¼Œé¿å…å¼•ç”¨é—®é¢˜ï¼›</li><li>é€‚åˆ ref ç®¡ç†çš„åŸºæœ¬æ•°æ®æˆ–ç®€å•å¯¹è±¡ã€‚</li></ul><h3 id="ç¤ºä¾‹ï¼š-1"><a href="#ç¤ºä¾‹ï¼š-1" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRestableRef</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Tom"</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è°ƒç”¨ <code>reset()</code> åï¼Œ<code>state.value</code> ä¼šæ¢å¤ä¸ºæœ€åˆçš„ <code>&#123; name: &#39;Tom&#39;, age: 18 &#125;</code>ã€‚</p><p>âš ï¸ æ³¨æ„ï¼šå¦‚æœä½ ä¼ çš„æ˜¯å¼•ç”¨ç±»å‹ï¼Œæœ€å¥½ä¿è¯è¯¥å€¼åœ¨åˆå§‹åŒ–æ—¶æ˜¯å…¨æ–°çš„å¯¹è±¡ï¼Œå¦åˆ™åç»­ reset ä¼šå‡ºç°æ•°æ®å…±äº«é—®é¢˜ã€‚</p><hr><h2 id="ä¸‰ã€useRestableActiveï¼šé€‚ç”¨äº-reactive-çš„å“åº”å¼å¯¹è±¡"><a href="#ä¸‰ã€useRestableActiveï¼šé€‚ç”¨äº-reactive-çš„å“åº”å¼å¯¹è±¡" class="headerlink" title="ä¸‰ã€useRestableActiveï¼šé€‚ç”¨äº reactive çš„å“åº”å¼å¯¹è±¡"></a>ä¸‰ã€useRestableActiveï¼šé€‚ç”¨äº reactive çš„å“åº”å¼å¯¹è±¡</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRestableActive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> clone <span class="token operator">=</span> cloneDeep<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> inintValue <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token constant">T</span>  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">delete</span> state<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token function">clone</span><span class="token punctuation">(</span>inintValue<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯´æ˜ï¼š"><a href="#è¯´æ˜ï¼š" class="headerlink" title="è¯´æ˜ï¼š"></a>è¯´æ˜ï¼š</h3><ul><li>ä½¿ç”¨ <code>reactive</code> åŒ…è£…æ•´ä¸ªå¯¹è±¡ï¼Œä½¿å¾—å“åº”å¼æ·±å±‚å¯ç”¨ï¼›</li><li><code>reset()</code> æ–¹æ³•é€šè¿‡å…ˆæ¸…ç©ºå¯¹è±¡ï¼Œå†ç”¨åˆå§‹å‰¯æœ¬èµ‹å€¼ï¼Œç¡®ä¿æ‰€æœ‰æ–°å­—æ®µä¹Ÿèƒ½è¢«ç§»é™¤ï¼›</li><li>æ¥å—ä¸€ä¸ªå¯é€‰çš„ <code>clone</code> æ–¹æ³•ï¼Œä»¥æ”¯æŒæ›´çµæ´»çš„æ•°æ®å¤åˆ¶ç­–ç•¥ã€‚</li></ul><h3 id="ç¤ºä¾‹ï¼š-2"><a href="#ç¤ºä¾‹ï¼š-2" class="headerlink" title="ç¤ºä¾‹ï¼š"></a>ç¤ºä¾‹ï¼š</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRestableActive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">"Alice"</span><span class="token punctuation">,</span> tags<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vue"</span><span class="token punctuation">,</span> <span class="token string">"ts"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// åç»­æ–°å¢å­—æ®µï¼š</span>state<span class="token punctuation">.</span>newField <span class="token operator">=</span> <span class="token string">"dynamic"</span><span class="token comment">// reset å newField ä¼šè¢«åˆ é™¤</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="ä½¿ç”¨å»ºè®®å’Œæ³¨æ„äº‹é¡¹"><a href="#ä½¿ç”¨å»ºè®®å’Œæ³¨æ„äº‹é¡¹" class="headerlink" title="ä½¿ç”¨å»ºè®®å’Œæ³¨æ„äº‹é¡¹"></a>ä½¿ç”¨å»ºè®®å’Œæ³¨æ„äº‹é¡¹</h2><ol><li>å¯¹äº ref å’Œ reactive ç®¡ç†çš„å¯¹è±¡ï¼Œä¸è¦ç›´æ¥å°†å¤–éƒ¨å¼•ç”¨ä¼ è¿›å»ï¼Œé¿å…å…±äº«é—®é¢˜ï¼›</li><li>æ¨èä½¿ç”¨ <code>cloneDeep</code>ï¼Œé¿å…å¼•ç”¨ç±»å‹é—´çš„å‰¯ä½œç”¨ï¼›</li><li>å¦‚æœä½ å¸Œæœ› reset çš„åˆå§‹å€¼æ˜¯åŠ¨æ€è®¡ç®—çš„ï¼Œä½¿ç”¨ <code>useRestableRefFn</code> æ›´åˆé€‚ï¼›</li><li><code>useRestableActive</code> çš„æ€§èƒ½æ¯” <code>useRestableRef</code> ç¨ä½ä¸€äº›ï¼Œé€‚åˆç»“æ„å¤æ‚çš„åœºæ™¯ï¼›</li><li>å¤šç”¨äº<strong>è¡¨å•æ•°æ®ç®¡ç†ã€ç­›é€‰æ¡ä»¶æ¢å¤ã€æ•°æ®ç¼–è¾‘æ’¤é”€</strong>ç­‰åœºæ™¯ã€‚</li></ol><hr><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>é€šè¿‡ <code>useRestableRefFn</code>ã€<code>useRestableRef</code> å’Œ <code>useRestableActive</code>ï¼Œä½ å¯ä»¥æ›´ä¼˜é›…åœ°ç®¡ç†ç»„ä»¶å†…éƒ¨çš„çŠ¶æ€é‡ç½®é€»è¾‘ã€‚è¿™ä¸ä»…æé«˜äº†ä»£ç çš„å¤ç”¨æ€§ï¼Œä¹Ÿè®©ç»„ä»¶è¡Œä¸ºæ›´åŠ å¯é¢„æµ‹ã€æ˜“ç»´æŠ¤ã€‚</p><p>å¦‚æœä½ åœ¨é¡¹ç›®ä¸­ç»å¸¸å¤„ç†ã€Œè¿˜åŸçŠ¶æ€ã€çš„éœ€æ±‚ï¼Œä¸å¦¨å°è¯•å°†è¿™äº›å·¥å…·å‡½æ•°åŠ å…¥åˆ°ä½ çš„å·¥å…·åº“ä¸­ã€‚</p><h2 id="useRestable-ts"><a href="#useRestable-ts" class="headerlink" title="useRestable.ts"></a>useRestable.ts</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref<span class="token punctuation">,</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> cloneDeep <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"lodash-es"</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRestableRefFn</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token function-variable function">cb</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRestableRef</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> inintValue <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™é‡Œä¹Ÿéœ€è¦cloneä¸‹ï¼Œè¦ä¸ç„¶resetåï¼Œç¬¬äºŒæ¬¡restä¼šæœ‰é—®é¢˜</span>    state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">cloneDeep</span><span class="token punctuation">(</span>inintValue<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">useRestableActive</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> object<span class="token operator">></span></span></span><span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> clone <span class="token operator">=</span> cloneDeep<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> inintValue <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token constant">T</span>  <span class="token keyword">const</span> <span class="token function-variable function">reset</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å…ˆåˆ é™¤æ—§çš„key,å› ä¸ºå¯èƒ½ä¼šæ–°åŠ å­—æ®µ</span>    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">delete</span> state<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// æ¢å¤æˆé»˜è®¤å€¼ï¼Œä¸èƒ½ç›´æ¥é‡æ–°èµ‹å€¼ï¼Œè¦ä¸ç„¶å°±æ˜¯æ–°çš„reactiveäº†</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token function">clone</span><span class="token punctuation">(</span>inintValue<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> reset <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>eslinté…ç½®æ¡ˆä¾‹</title>
      <link href="/2024/10/18/eslint-pei-zhi-an-li/"/>
      <url>/2024/10/18/eslint-pei-zhi-an-li/</url>
      
        <content type="html"><![CDATA[<h3 id="æ¡ˆä¾‹ä¸€"><a href="#æ¡ˆä¾‹ä¸€" class="headerlink" title="æ¡ˆä¾‹ä¸€"></a>æ¡ˆä¾‹ä¸€</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// @ts-check</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> defineConfig <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"eslint-define-config"</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">es6</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/setup-compiler-macros"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"vue-eslint-parser"</span><span class="token punctuation">,</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"simple-import-sort"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"@typescript-eslint/parser"</span><span class="token punctuation">,</span>    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>    <span class="token literal-property property">jsxPragma</span><span class="token operator">:</span> <span class="token string">"React"</span><span class="token punctuation">,</span>    <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"plugin:vue/vue3-recommended"</span><span class="token punctuation">,</span>    <span class="token string">"plugin:@typescript-eslint/recommended"</span><span class="token punctuation">,</span>    <span class="token string">"prettier"</span><span class="token punctuation">,</span>    <span class="token string">"plugin:prettier/recommended"</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"vue/script-setup-uses-vars"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/multi-word-component-names"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/comment-directive"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/ban-ts-ignore"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/explicit-function-return-type"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-explicit-any"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-var-requires"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-empty-function"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/custom-event-name-casing"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"no-use-before-define"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-use-before-define"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/ban-ts-comment"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/ban-types"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-non-null-assertion"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/explicit-module-boundary-types"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-unused-vars"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">varsIgnorePattern</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token string">"none"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"no-unused-vars"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token comment">// we are only using this rule to check for unused arguments since TS</span>      <span class="token comment">// catches unused variables but not args.</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">varsIgnorePattern</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span> <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token string">"none"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"space-before-function-paren"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/attributes-order"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">order</span><span class="token operator">:</span> <span class="token punctuation">[</span>          <span class="token string">"LIST_RENDERING"</span><span class="token punctuation">,</span>          <span class="token string">"CONDITIONALS"</span><span class="token punctuation">,</span>          <span class="token string">"RENDER_MODIFIERS"</span><span class="token punctuation">,</span>          <span class="token string">"GLOBAL"</span><span class="token punctuation">,</span>          <span class="token string">"UNIQUE"</span><span class="token punctuation">,</span>          <span class="token string">"TWO_WAY_BINDING"</span><span class="token punctuation">,</span>          <span class="token string">"OTHER_ATTR"</span><span class="token punctuation">,</span>          <span class="token string">"EVENTS"</span><span class="token punctuation">,</span>          <span class="token string">"CONTENT"</span><span class="token punctuation">,</span>          <span class="token string">"DEFINITION"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/one-component-per-file"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/html-closing-bracket-newline"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/max-attributes-per-line"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/multiline-html-element-content-newline"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/singleline-html-element-content-newline"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/attribute-hyphenation"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/require-default-prop"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/html-self-closing"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">void</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>          <span class="token literal-property property">normal</span><span class="token operator">:</span> <span class="token string">"never"</span><span class="token punctuation">,</span>          <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token literal-property property">svg</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>        <span class="token literal-property property">math</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"simple-import-sort/imports"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">groups</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">"^vue"</span><span class="token punctuation">,</span> <span class="token string">"^@?\\w"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"^"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"^\\."</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"^/#"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"simple-import-sort/exports"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-this-alias"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸ªä»£ç æ˜¯ä¸€ä¸ªç”¨äºé…ç½® ESLint çš„æ–‡ä»¶ï¼Œä½¿ç”¨äº† <code>eslint-define-config</code> ä»¥åŠå¤šä¸ª ESLint æ’ä»¶å’Œè§„åˆ™é›†æ¥æ£€æŸ¥å’Œæ ¼å¼åŒ– TypeScript å’Œ Vue 3 ä»£ç ä¸­çš„ä»£ç é£æ ¼ã€‚è¯¥é…ç½®æ–‡ä»¶ä¸»è¦ç›®çš„æ˜¯ä¿è¯ä»£ç ä¸€è‡´æ€§ã€æé«˜å¯è¯»æ€§ï¼Œå¹¶è‡ªåŠ¨æ’åºå¯¼å…¥ï¼ˆ<code>import</code>ï¼‰è¯­å¥ç­‰ã€‚</p><h3 id="ä¸»è¦å†…å®¹è§£æ"><a href="#ä¸»è¦å†…å®¹è§£æ" class="headerlink" title="ä¸»è¦å†…å®¹è§£æ"></a>ä¸»è¦å†…å®¹è§£æ</h3><h4 id="1-æ ¹çº§åˆ«é…ç½®-root-true"><a href="#1-æ ¹çº§åˆ«é…ç½®-root-true" class="headerlink" title="1. æ ¹çº§åˆ«é…ç½® (root: true)"></a>1. <strong>æ ¹çº§åˆ«é…ç½® (<code>root: true</code>)</strong></h4><p>é€šè¿‡è®¾ç½® <code>root: true</code>ï¼Œç¡®ä¿å½“å‰ç›®å½•ä¸º ESLint çš„æ ¹ç›®å½•ï¼Œé˜²æ­¢ ESLint æŸ¥æ‰¾æ›´é«˜å±‚çš„é…ç½®æ–‡ä»¶ã€‚</p><h4 id="2-ç¯å¢ƒè®¾ç½®-env"><a href="#2-ç¯å¢ƒè®¾ç½®-env" class="headerlink" title="2. ç¯å¢ƒè®¾ç½® (env)"></a>2. <strong>ç¯å¢ƒè®¾ç½® (<code>env</code>)</strong></h4><p>é…ç½®äº†ä»£ç è¿è¡Œç¯å¢ƒï¼ŒåŒ…æ‹¬æµè§ˆå™¨ã€Node.js å’Œ ES6 ç¯å¢ƒï¼Œè¿˜å¯ç”¨äº† Vue 3 çš„ <code>setup-compiler-macros</code> è¯­æ³•æ”¯æŒã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>   <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token literal-property property">es6</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token string-property property">'vue/setup-compiler-macros'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-è§£æå™¨-parser"><a href="#3-è§£æå™¨-parser" class="headerlink" title="3. è§£æå™¨ (parser)"></a>3. <strong>è§£æå™¨ (<code>parser</code>)</strong></h4><p>ä½¿ç”¨ <code>vue-eslint-parser</code> ä½œä¸ºè§£æå™¨æ¥æ”¯æŒ Vue æ–‡ä»¶ï¼ŒåŒæ—¶æŒ‡å®š <code>@typescript-eslint/parser</code> ä½œä¸ºå†…åµŒ TypeScript è§£æå™¨ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'vue-eslint-parser'</span><span class="token punctuation">,</span><span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>   <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span>   <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>   <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span>   <span class="token literal-property property">jsxPragma</span><span class="token operator">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>   <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™éƒ¨åˆ†é…ç½®ç”¨äºè§£æç°ä»£ JavaScript å’Œ TypeScript è¯­æ³•ï¼ŒåŒ…æ‹¬ JSX æ”¯æŒã€‚</p><h4 id="4-æ‰©å±•-extends"><a href="#4-æ‰©å±•-extends" class="headerlink" title="4. æ‰©å±• (extends)"></a>4. <strong>æ‰©å±• (<code>extends</code>)</strong></h4><p>ä½¿ç”¨äº†å¤šä¸ª ESLint æ‰©å±•è§„åˆ™é›†ï¼Œè¿™äº›æ‰©å±•é¢„è®¾äº†å¾ˆå¤šå¸¸ç”¨çš„ä»£ç æ£€æŸ¥è§„åˆ™ï¼š</p><ul><li><code>plugin:vue/vue3-recommended</code>ï¼šæ¨èçš„ Vue 3 é£æ ¼è§„åˆ™ã€‚</li><li><code>plugin:@typescript-eslint/recommended</code>ï¼šTypeScript æ¨èçš„è§„åˆ™ã€‚</li><li><code>prettier</code> å’Œ <code>plugin:prettier/recommended</code>ï¼šç¦ç”¨ä¸ Prettier å†²çªçš„ ESLint è§„åˆ™ï¼Œå¹¶ç¡®ä¿ Prettier æ ¼å¼åŒ–è§„åˆ™ä¼˜å…ˆã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>   <span class="token string">'plugin:vue/vue3-recommended'</span><span class="token punctuation">,</span>   <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span>   <span class="token string">'prettier'</span><span class="token punctuation">,</span>   <span class="token string">'plugin:prettier/recommended'</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-è§„åˆ™-rules"><a href="#5-è§„åˆ™-rules" class="headerlink" title="5. è§„åˆ™ (rules)"></a>5. <strong>è§„åˆ™ (<code>rules</code>)</strong></h4><p>å®šä¹‰äº†å…·ä½“çš„ ESLint è§„åˆ™æ¥å¾®è°ƒä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–çš„è¡Œä¸ºã€‚éƒ¨åˆ†è§„åˆ™å…³é—­äº†ä¸¥æ ¼æ£€æŸ¥ï¼Œå‡å°‘äº†å¯¹ä»£ç çš„ä¸€äº›å¹²æ‰°ï¼š</p><ul><li><p><strong>Vue ç›¸å…³è§„åˆ™</strong>ï¼š</p><ul><li><code>vue/script-setup-uses-vars</code>: é¿å… <code>setup</code> ä¸­çš„å˜é‡è¢«é”™è¯¯åœ°æ ‡è®°ä¸ºæœªä½¿ç”¨ã€‚</li><li><code>vue/multi-word-component-names</code>: å…è®¸å•è¯ç»„ä»¶åç§°ï¼Œä¸å¼ºåˆ¶å¤šå•è¯ç»„ä»¶åç§°ã€‚</li><li><code>vue/html-self-closing</code>: å¼ºåˆ¶ HTML æ ‡ç­¾çš„è‡ªé—­åˆï¼ˆä¾‹å¦‚ <code>&lt;br /&gt;</code>ï¼‰ã€‚</li></ul></li><li><p><strong>TypeScript ç›¸å…³è§„åˆ™</strong>ï¼š</p><ul><li><code>@typescript-eslint/no-explicit-any</code>: å…è®¸ä½¿ç”¨ <code>any</code> ç±»å‹ã€‚</li><li><code>@typescript-eslint/no-unused-vars</code>: å¤„ç†æœªä½¿ç”¨çš„å˜é‡è­¦å‘Šï¼Œå¿½ç•¥å‚æ•°ã€‚</li></ul></li><li><p><strong>å¯¼å…¥æ’åºè§„åˆ™</strong>ï¼ˆ<code>simple-import-sort</code> æ’ä»¶ï¼‰ï¼š</p><ul><li>é€šè¿‡ <code>simple-import-sort</code> æ’ä»¶ï¼Œè‡ªåŠ¨æ’åº <code>import</code> å’Œ <code>export</code> è¯­å¥ï¼ŒæŒ‰æ¨¡å—ç±»åˆ«å’Œè·¯å¾„è¿›è¡Œåˆ†ç»„ï¼š<pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string-property property">'simple-import-sort/imports'</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token string">'error'</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">groups</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'^vue'</span><span class="token punctuation">,</span> <span class="token string">'^@?\\w'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'^'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'^\\.'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'^/#'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string-property property">'simple-import-sort/exports'</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong>Prettier ç›¸å…³è§„åˆ™</strong>ï¼šç¦ç”¨äº† <code>space-before-function-paren</code> ç­‰è§„åˆ™ä»¥é¿å…å’Œ Prettier å†²çªã€‚</p></li></ul><h4 id="6-æ‰€ç”¨åˆ°çš„åŒ…"><a href="#6-æ‰€ç”¨åˆ°çš„åŒ…" class="headerlink" title="6. æ‰€ç”¨åˆ°çš„åŒ…"></a>6. <strong>æ‰€ç”¨åˆ°çš„åŒ…</strong></h4><ul><li>**<code>eslint-define-config</code>**ï¼šç®€åŒ– ESLint é…ç½®å®šä¹‰ã€‚</li><li>**<code>vue-eslint-parser</code>**ï¼šè§£æ <code>.vue</code> æ–‡ä»¶çš„ ESLint è§£æå™¨ã€‚</li><li>**<code>@typescript-eslint/parser</code>**ï¼šTypeScript ä»£ç çš„ ESLint è§£æå™¨ã€‚</li><li>**<code>@typescript-eslint/eslint-plugin</code>**ï¼šæä¾› TypeScript ç›¸å…³çš„ ESLint è§„åˆ™ã€‚</li><li>**<code>eslint-plugin-vue</code>**ï¼šé’ˆå¯¹ Vue.js çš„ ESLint æ’ä»¶ï¼Œæä¾› Vue ç‰¹æœ‰çš„è§„åˆ™ã€‚</li><li>**<code>eslint-plugin-simple-import-sort</code>**ï¼šç”¨äºå¯¹ <code>import</code> å’Œ <code>export</code> è¯­å¥è¿›è¡Œæ’åºã€‚</li><li>**<code>prettier</code>**ï¼šç”¨äºä»£ç æ ¼å¼åŒ–ï¼Œç¡®ä¿ä»£ç é£æ ¼ä¸€è‡´ã€‚</li><li>**<code>eslint-plugin-prettier</code>**ï¼šå°† Prettier ä¸ ESLint é›†æˆï¼Œåœ¨ ESLint è§„åˆ™ä¸­è¿è¡Œ Prettierã€‚</li><li>**<code>eslint-config-prettier</code>**ï¼šç¦ç”¨å¯èƒ½ä¸ Prettier å†²çªçš„ ESLint è§„åˆ™ã€‚</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸ªé…ç½®æ–‡ä»¶ç»“åˆäº† TypeScriptã€Vue 3 å’Œ Prettier çš„è§„åˆ™ï¼Œä½¿ç”¨ <code>simple-import-sort</code> æ¥è‡ªåŠ¨åŒ– <code>import</code> æ’åºï¼Œå¹¶å¯¹ Vue å’Œ TypeScript åšäº†ä¸€äº›ç‰¹å®šè§„åˆ™çš„è°ƒæ•´ã€‚è¿™ç§é…ç½®ç¡®ä¿ä»£ç é£æ ¼ä¸€è‡´ã€å¯è¯»æ€§é«˜ï¼Œé€‚ç”¨äº Vue 3 + TypeScript é¡¹ç›®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> eslint </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npmåŒ…è¯¦è§£</title>
      <link href="/2024/10/17/npm-bao-xiang-jie/"/>
      <url>/2024/10/17/npm-bao-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="simple-import-sort"><a href="#simple-import-sort" class="headerlink" title="simple-import-sort"></a><code>simple-import-sort</code></h2><p><code>simple-import-sort</code> æ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨æ’åº JavaScript å’Œ TypeScript æ–‡ä»¶ä¸­çš„ <code>import</code> è¯­å¥çš„ ESLint æ’ä»¶æˆ–å·¥å…·ï¼Œæ—¨åœ¨æé«˜ä»£ç çš„ä¸€è‡´æ€§ã€å¯è¯»æ€§å’Œç»´æŠ¤æ€§ã€‚å®ƒé€šè¿‡æŒ‰å­—æ¯é¡ºåºå’Œæ¨¡å—ç±»å‹ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ã€ç›¸å¯¹è·¯å¾„ç­‰ï¼‰æ’åºå¯¼å…¥å†…å®¹ï¼Œä½¿ä»£ç é£æ ¼æ›´åŠ ç»Ÿä¸€ï¼Œå‡å°‘ä»£ç å®¡æŸ¥ä¸­çš„æ— æ•ˆè®¨è®ºã€‚</p><h3 id="ä½œç”¨å’Œå¥½å¤„"><a href="#ä½œç”¨å’Œå¥½å¤„" class="headerlink" title="ä½œç”¨å’Œå¥½å¤„"></a>ä½œç”¨å’Œå¥½å¤„</h3><ol><li><p><strong>æé«˜ä»£ç å¯è¯»æ€§</strong>ï¼šå½“æ‰€æœ‰çš„ <code>import</code> è¯­å¥æŒ‰ç…§å›ºå®šè§„åˆ™æ’åˆ—æ—¶ï¼Œä»£ç ä¼šæ˜¾å¾—æ›´åŠ æ•´æ´å’Œä¸€è‡´ï¼Œå…¶ä»–å¼€å‘è€…åœ¨é˜…è¯»ä»£ç æ—¶ä¹Ÿèƒ½å¿«é€Ÿæ‰¾åˆ°æ‰€éœ€çš„ä¾èµ–ã€‚</p></li><li><p><strong>å‡å°‘äººä¸ºé”™è¯¯</strong>ï¼šæ‰‹åŠ¨è°ƒæ•´ <code>import</code> é¡ºåºå¯èƒ½å®¹æ˜“å‡ºé”™ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ã€‚<code>simple-import-sort</code> è‡ªåŠ¨åŒ–è¿™ä¸€è¿‡ç¨‹ï¼Œç¡®ä¿å¯¼å…¥é¡ºåºå§‹ç»ˆç¬¦åˆé¢„æœŸã€‚</p></li><li><p><strong>ä¸ ESLint é›†æˆ</strong>ï¼šé€šè¿‡ä¸ ESLint çš„é›†æˆï¼Œä½ å¯ä»¥åœ¨ä»£ç æ£€æŸ¥æˆ–æäº¤æ—¶è‡ªåŠ¨æ’åº <code>import</code> è¯­å¥ï¼Œä¿è¯å›¢é˜Ÿä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚</p></li><li><p><strong>æŒ‰æ¨¡å—ç±»åˆ«æ’åº</strong>ï¼š<code>simple-import-sort</code> ä¸ä»…æŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼Œè¿˜å¯ä»¥æ™ºèƒ½åœ°å°†ç¬¬ä¸‰æ–¹æ¨¡å—ã€æœ¬åœ°æ¨¡å—ã€ç›¸å¯¹è·¯å¾„ç­‰åˆ†ç»„ï¼Œä½¿å¯¼å…¥é¡ºåºæ›´åŠ æ¸…æ™°ã€‚</p></li></ol><h3 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h3><h4 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h4><p>ä½ å¯ä»¥é€šè¿‡ npm æˆ– yarn å®‰è£… <code>simple-import-sort</code> å’Œ ESLint æ’ä»¶ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev eslint-plugin-simple-import-sort<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">yarn</span> <span class="token function">add</span> eslint-plugin-simple-import-sort <span class="token parameter variable">--dev</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="2-é…ç½®-ESLint"><a href="#2-é…ç½®-ESLint" class="headerlink" title="2. é…ç½® ESLint"></a>2. é…ç½® ESLint</h4><p>å®‰è£…å®Œæˆåï¼Œä½ éœ€è¦åœ¨ ESLint çš„é…ç½®æ–‡ä»¶ä¸­å¯ç”¨ <code>simple-import-sort</code> æ’ä»¶ã€‚</p><p>åœ¨ <code>.eslintrc.js</code> æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"simple-import-sort"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¯ç”¨è‡ªåŠ¨æ’åºçš„è§„åˆ™</span>    <span class="token string-property property">"simple-import-sort/imports"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>    <span class="token string-property property">"simple-import-sort/exports"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>simple-import-sort/imports</code>ï¼šè‡ªåŠ¨å¯¹ <code>import</code> è¯­å¥è¿›è¡Œæ’åºã€‚</li><li><code>simple-import-sort/exports</code>ï¼šè‡ªåŠ¨å¯¹ <code>export</code> è¯­å¥è¿›è¡Œæ’åºï¼ˆå¯é€‰ï¼‰ã€‚</li></ul><h4 id="3-ä½¿ç”¨ç¤ºä¾‹"><a href="#3-ä½¿ç”¨ç¤ºä¾‹" class="headerlink" title="3. ä½¿ç”¨ç¤ºä¾‹"></a>3. ä½¿ç”¨ç¤ºä¾‹</h4><p>å‡è®¾ä½ æœ‰å¦‚ä¸‹æœªæ’åºçš„ <code>import</code> è¯­å¥ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">"lodash"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Button <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./components/Button"</span><span class="token keyword">import</span> <span class="token string">"./styles.css"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Link <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ç”¨ <code>simple-import-sort</code> è§„åˆ™åï¼Œ<code>import</code> è¯­å¥ä¼šè‡ªåŠ¨æŒ‰ç…§è§„åˆ™é‡æ–°æ’åºï¼Œå¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">"lodash"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Link <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Button <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./components/Button"</span><span class="token keyword">import</span> <span class="token string">"./styles.css"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>simple-import-sort</code> é»˜è®¤ä¼šæŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œåˆ†ç»„å’Œæ’åºï¼š</p><ul><li>ç¬¬ä¸‰æ–¹åº“ <code>import</code>ï¼ˆå¦‚ <code>react</code>, <code>lodash</code>ï¼‰</li><li>ç›¸å¯¹è·¯å¾„æˆ–æœ¬åœ°æ¨¡å— <code>import</code>ï¼ˆå¦‚ <code>./components/Button</code>ï¼‰</li><li>æ ·å¼æˆ–å…¶ä»–é JS èµ„æºçš„ <code>import</code>ï¼ˆå¦‚ <code>./styles.css</code>ï¼‰</li></ul><h4 id="4-å‘½ä»¤è¡Œæ’åºï¼ˆå¯é€‰ï¼‰"><a href="#4-å‘½ä»¤è¡Œæ’åºï¼ˆå¯é€‰ï¼‰" class="headerlink" title="4. å‘½ä»¤è¡Œæ’åºï¼ˆå¯é€‰ï¼‰"></a>4. å‘½ä»¤è¡Œæ’åºï¼ˆå¯é€‰ï¼‰</h4><p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œä½¿ç”¨ <code>simple-import-sort</code> æ¥å¯¹æ–‡ä»¶è¿›è¡Œæ’åºï¼Œè€Œä¸ä¾èµ– ESLintï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx simple-import-sort ./src/**/*.js<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™å°†åœ¨å‘½ä»¤è¡Œä¸­å¯¹æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶æ‰§è¡Œ <code>import</code> æ’åºã€‚</p><h3 id="é«˜çº§ç”¨æ³•"><a href="#é«˜çº§ç”¨æ³•" class="headerlink" title="é«˜çº§ç”¨æ³•"></a>é«˜çº§ç”¨æ³•</h3><h4 id="åˆ†ç»„æ’åº"><a href="#åˆ†ç»„æ’åº" class="headerlink" title="åˆ†ç»„æ’åº"></a>åˆ†ç»„æ’åº</h4><p>ä½ å¯ä»¥åœ¨ <code>eslint</code> é…ç½®ä¸­è‡ªå®šä¹‰åˆ†ç»„è§„åˆ™ã€‚ä¾‹å¦‚ï¼ŒæŒ‰ç…§åº“ç±»å‹æˆ–è·¯å¾„æ·±åº¦è¿›è¡Œåˆ†ç»„ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"simple-import-sort"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"simple-import-sort/imports"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">groups</span><span class="token operator">:</span> <span class="token punctuation">[</span>          <span class="token comment">// Node.js built-in modules</span>          <span class="token punctuation">[</span><span class="token string">"^node:"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// External libraries</span>          <span class="token punctuation">[</span><span class="token string">"^@?\\w"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// Internal modules</span>          <span class="token punctuation">[</span><span class="token string">"^(@|components)(/.*|$)"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// Parent imports (starting with ..)</span>          <span class="token punctuation">[</span><span class="token string">"^\\.\\.(?!/?$)"</span><span class="token punctuation">,</span> <span class="token string">"^\\.\\./?$"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// Relative imports (starting with .)</span>          <span class="token punctuation">[</span><span class="token string">"^\\./(?=.*/)(?!/?$)"</span><span class="token punctuation">,</span> <span class="token string">"^\\.(?!/?$)"</span><span class="token punctuation">,</span> <span class="token string">"^\\./?$"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">// Style imports</span>          <span class="token punctuation">[</span><span class="token string">"^.+\\.s?css$"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>è¿™æ®µé…ç½®å°†å¯¼å…¥è¯­å¥åˆ†ä¸ºå¤šä¸ªç»„ï¼šNode.js å†…ç½®æ¨¡å—ã€å¤–éƒ¨åº“ã€å†…éƒ¨æ¨¡å—ã€çˆ¶çº§ç›®å½•ã€ç›¸å¯¹è·¯å¾„å’Œæ ·å¼æ–‡ä»¶ã€‚</li></ul><h4 id="ä¸-Prettier-é›†æˆ"><a href="#ä¸-Prettier-é›†æˆ" class="headerlink" title="ä¸ Prettier é›†æˆ"></a>ä¸ Prettier é›†æˆ</h4><p><code>simple-import-sort</code> å¯ä»¥ä¸ Prettier ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡ Prettier æ ¼å¼åŒ–ä»£ç æ—¶ç¡®ä¿å¯¼å…¥é¡ºåºæ­£ç¡®ï¼š</p><ol><li>å®‰è£… Prettier å’Œ <code>eslint-config-prettier</code>ï¼š</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save-dev prettier eslint-config-prettier<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>é…ç½® <code>.eslintrc.js</code> æ–‡ä»¶ç¦ç”¨ ESLint ä¸­å¯èƒ½ä¸ Prettier å†²çªçš„è§„åˆ™ï¼š</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span> <span class="token string">"plugin:prettier/recommended"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"simple-import-sort"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"simple-import-sort/imports"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>    <span class="token string-property property">"simple-import-sort/exports"</span><span class="token operator">:</span> <span class="token string">"error"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>simple-import-sort</code> æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ’åºå’Œè§„èŒƒ <code>import</code> å’Œ <code>export</code> è¯­å¥ã€‚åœ¨å›¢é˜Ÿåˆä½œä¸­ï¼Œå®ƒæœ‰åŠ©äºä¿æŒä»£ç çš„ä¸€è‡´æ€§ï¼Œå‡å°‘æ— è°“çš„ä»£ç å®¡æŸ¥çº çº·ã€‚é€šè¿‡ ESLint é›†æˆï¼Œå¯ä»¥è½»æ¾åœ¨å¼€å‘æµç¨‹ä¸­å¼ºåˆ¶æ‰§è¡Œè¿™ä¸€è§„åˆ™ï¼Œæå‡ä»£ç è´¨é‡å’Œç»´æŠ¤æ€§ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PostCSS</title>
      <link href="/2024/10/17/posscss/"/>
      <url>/2024/10/17/posscss/</url>
      
        <content type="html"><![CDATA[<p><code>PostCSS</code> æ˜¯ä¸€ä¸ªç”¨äºè½¬æ¢ CSS çš„å·¥å…·ï¼Œå®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª JavaScript æ’ä»¶ç³»ç»Ÿï¼Œå…è®¸å¼€å‘è€…é€šè¿‡ç¼–å†™æˆ–ä½¿ç”¨å„ç§æ’ä»¶æ¥å¯¹ CSS è¿›è¡Œå¤„ç†å’Œä¼˜åŒ–ã€‚å®ƒä¸åƒ Sass æˆ– LESS é‚£æ ·æ˜¯ä¸€ä¸ªå®Œæ•´çš„ CSS é¢„å¤„ç†å™¨ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ç³»åˆ—æ’ä»¶æ¥å®ç°ä¸åŒçš„åŠŸèƒ½ã€‚è¿™ç§æ’ä»¶åŒ–çš„æ¶æ„ä½¿å¾— <code>PostCSS</code> éå¸¸çµæ´»å’Œå¼ºå¤§ã€‚</p><h3 id="æ ¸å¿ƒç‰¹ç‚¹"><a href="#æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="æ ¸å¿ƒç‰¹ç‚¹"></a>æ ¸å¿ƒç‰¹ç‚¹</h3><ol><li><p><strong>æ’ä»¶åŒ–æ¶æ„</strong>ï¼š</p><ul><li><code>PostCSS</code> çš„æ ¸å¿ƒå‡ ä¹ä¸åšä»»ä½•äº‹æƒ…ï¼Œå®ƒä¾èµ–æ’ä»¶æ¥å¤„ç† CSSã€‚è¿™äº›æ’ä»¶å¯ä»¥æ‰§è¡Œè¯¸å¦‚è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ã€ä¼˜åŒ–ä»£ç ã€æ”¯æŒæœªæ¥çš„ CSS è¯­æ³•ã€ç¼–è¯‘åµŒå¥—æ ·å¼ã€å˜é‡æ›¿æ¢ç­‰å„ç§ä»»åŠ¡ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œ<code>autoprefixer</code> æ’ä»¶ç”¨äºè‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ï¼Œ<code>cssnano</code> ç”¨äºå‹ç¼© CSSã€‚</p></li><li><p><strong>æ”¯æŒæœªæ¥çš„ CSS æ ‡å‡†</strong>ï¼š</p><ul><li><code>PostCSS</code> å¯ä»¥é€šè¿‡æ’ä»¶æ¥æ”¯æŒè¿˜æœªåœ¨æ‰€æœ‰æµè§ˆå™¨å®ç°çš„æœªæ¥ CSS æ ‡å‡†ï¼Œå¦‚ CSS å˜é‡ã€åµŒå¥—ç­‰ã€‚ä¾‹å¦‚ï¼Œ<code>postcss-preset-env</code> æ’ä»¶å¯ä»¥è®©å¼€å‘è€…ä½¿ç”¨æœªæ¥çš„ CSS ç‰¹æ€§ï¼Œç±»ä¼¼äº Babel è®©å¼€å‘è€…ä½¿ç”¨æœ€æ–°çš„ JavaScript ç‰¹æ€§ã€‚</li></ul></li><li><p><strong>æ˜“äºé›†æˆ</strong>ï¼š</p><ul><li><code>PostCSS</code> å¯ä»¥è½»æ¾é›†æˆåˆ°æ„å»ºå·¥å…·ä¸­ï¼Œå¦‚ Webpackã€Gulpã€Grunt ç­‰ã€‚å¤§å¤šæ•°ç°ä»£å‰ç«¯å·¥å…·é“¾å’Œæ¡†æ¶ï¼ˆå¦‚ Tailwind CSS å’Œ Next.jsï¼‰éƒ½å†…ç½®äº†å¯¹ <code>PostCSS</code> çš„æ”¯æŒã€‚</li></ul></li><li><p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p><ul><li>ç”±äº <code>PostCSS</code> æ’ä»¶é“¾æ˜¯çµæ´»ä¸”å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œä½ å¯ä»¥æ ¹æ®é¡¹ç›®éœ€æ±‚é€‰æ‹©åªåŠ è½½æ‰€éœ€çš„æ’ä»¶ï¼Œè¿™è®©å®ƒåœ¨æ€§èƒ½å’ŒåŠŸèƒ½ä¹‹é—´ä¿æŒè‰¯å¥½çš„å¹³è¡¡ã€‚æŸäº›æ’ä»¶å¦‚ <code>cssnano</code> ä¸“æ³¨äºä¼˜åŒ– CSS ä½“ç§¯ä»¥æé«˜åŠ è½½é€Ÿåº¦ã€‚</li></ul></li></ol><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p><code>PostCSS</code> çš„å·¥ä½œæµç¨‹åˆ†ä¸ºä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼š</p><ol><li><strong>è§£æ</strong>ï¼š<code>PostCSS</code> å°† CSS æºä»£ç è§£æä¸ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œè¿™ä¸ªè¿‡ç¨‹ä½¿ç”¨äº† <code>postcss-parser</code> è§£æå™¨ã€‚</li><li><strong>å¤„ç†</strong>ï¼šé€šè¿‡åŠ è½½æ’ä»¶ï¼Œ<code>PostCSS</code> å¯¹è¿™ä¸ª AST è¿›è¡Œéå†å’Œä¿®æ”¹ï¼Œæ’ä»¶å¯ä»¥è¯»å–æˆ–ä¿®æ”¹ CSS çš„è§„åˆ™ã€é€‰æ‹©å™¨ã€å£°æ˜ç­‰ã€‚</li><li><strong>ç”Ÿæˆ</strong>ï¼šä¿®æ”¹å®Œ AST åï¼Œ<code>PostCSS</code> ä¼šå°†å…¶è½¬æ¢å›æ™®é€šçš„ CSS æ–‡ä»¶ã€‚</li></ol><p>è¿™ä¸‰ä¸ªæ­¥éª¤å…è®¸å¼€å‘è€…çµæ´»åœ°å®šåˆ¶ CSS çš„å¤„ç†æµç¨‹ã€‚</p><h3 id="å¸¸ç”¨æ’ä»¶"><a href="#å¸¸ç”¨æ’ä»¶" class="headerlink" title="å¸¸ç”¨æ’ä»¶"></a>å¸¸ç”¨æ’ä»¶</h3><p><code>PostCSS</code> çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒæœ‰å¤§é‡çš„æ’ä»¶å¯ä¾›ä½¿ç”¨ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ’ä»¶ï¼š</p><ol><li><p><strong>Autoprefixer</strong>ï¼š</p><ul><li><p>è‡ªåŠ¨ä¸º CSS å±æ€§æ·»åŠ å‚å•†å‰ç¼€ï¼ˆå¦‚ <code>-webkit-</code>, <code>-moz-</code>ï¼‰ï¼Œè§£å†³æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">&#123;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>ä¼šè¢«å¤„ç†ä¸ºï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.example</span> <span class="token punctuation">&#123;</span>  <span class="token property">display</span><span class="token punctuation">:</span> -webkit-flex<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p><strong>cssnano</strong>ï¼š</p><ul><li>ç”¨äºå‹ç¼© CSS ä»£ç ï¼Œå‡å°‘æ–‡ä»¶ä½“ç§¯ï¼Œæé«˜åŠ è½½é€Ÿåº¦ã€‚</li></ul></li><li><p><strong>postcss-preset-env</strong>ï¼š</p><ul><li>å…è®¸å¼€å‘è€…ä½¿ç”¨æœªæ¥çš„ CSS ç‰¹æ€§ï¼Œå¹¶å°†å…¶è½¬è¯‘ä¸ºå½“å‰æµè§ˆå™¨å…¼å®¹çš„ CSSã€‚</li><li>ä¾‹å¦‚ï¼Œå®ƒæ”¯æŒ CSS è‡ªå®šä¹‰å±æ€§ã€åµŒå¥—è§„åˆ™ã€è‡ªåŠ¨è®¡ç®— <code>calc()</code> å‡½æ•°ç­‰ã€‚</li></ul></li><li><p><strong>postcss-import</strong>ï¼š</p><ul><li>å…è®¸åœ¨ CSS ä¸­ä½¿ç”¨ <code>@import</code> è¯­æ³•å¯¼å…¥å…¶ä»–æ–‡ä»¶ï¼Œç±»ä¼¼äº Sass çš„ <code>@import</code> åŠŸèƒ½ï¼Œæ–¹ä¾¿æ¨¡å—åŒ–å¼€å‘ã€‚</li></ul></li><li><p><strong>postcss-nested</strong>ï¼š</p><ul><li>å…è®¸åœ¨ CSS ä¸­ä½¿ç”¨åµŒå¥—è¯­æ³•ï¼Œç±»ä¼¼äº Sass çš„åµŒå¥—è§„åˆ™ã€‚</li></ul></li><li><p><strong>tailwindcss</strong>ï¼š</p><ul><li>ä¸ Tailwind CSS é›†æˆï¼Œç”Ÿæˆå®ç”¨ç±»ï¼ˆutility classesï¼‰çš„ CSS æ¡†æ¶ã€‚</li></ul></li><li><p><strong>tailwindcss/nesting</strong></p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.button</span> <span class="token punctuation">&#123;</span>  <span class="token atrule"><span class="token rule">@apply</span> bg-blue-500 text-white<span class="token punctuation">;</span></span>  <span class="token selector">&amp;:hover</span> <span class="token punctuation">&#123;</span>    <span class="token atrule"><span class="token rule">@apply</span> bg-blue-700<span class="token punctuation">;</span></span>  <span class="token punctuation">&#125;</span>  <span class="token selector">.icon</span> <span class="token punctuation">&#123;</span>    <span class="token atrule"><span class="token rule">@apply</span> w-6 h-6<span class="token punctuation">;</span></span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>postcss-flexbugs-fixes</strong>ï¼š</p><ul><li>ä¿®å¤ Flexbox åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„å…¼å®¹æ€§é—®é¢˜ã€‚</li></ul></li><li><p><strong>postcss-mixins</strong>ï¼š</p><ul><li>å…è®¸å®šä¹‰ CSS æ··å…¥ï¼ˆmixinsï¼‰ï¼Œå¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹é‡ç”¨ç›¸åŒçš„ CSS ä»£ç å—ã€‚</li></ul></li></ol><h3 id="ç¤ºä¾‹é…ç½®"><a href="#ç¤ºä¾‹é…ç½®" class="headerlink" title="ç¤ºä¾‹é…ç½®"></a>ç¤ºä¾‹é…ç½®</h3><h4 id="åŸºæœ¬çš„-PostCSS-é…ç½®ï¼š"><a href="#åŸºæœ¬çš„-PostCSS-é…ç½®ï¼š" class="headerlink" title="åŸºæœ¬çš„ PostCSS é…ç½®ï¼š"></a>åŸºæœ¬çš„ PostCSS é…ç½®ï¼š</h4><p>åœ¨ <code>postcss.config.js</code> ä¸­é…ç½® PostCSS æ’ä»¶ï¼š</p><ol><li>tailwindcss é¡¹ç›®</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"postcss-import"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token string-property property">"tailwindcss/nesting"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">tailwindcss</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">autoprefixer</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>PostCSS</code> æ˜¯ä¸€ä¸ªçµæ´»ä¸”å¼ºå¤§çš„ CSS å¤„ç†å·¥å…·ï¼Œä¾é å…¶æ’ä»¶ç³»ç»Ÿï¼Œå¼€å‘è€…å¯ä»¥å®ç°ä»ç®€å•çš„æ ·å¼è½¬æ¢åˆ°å¤æ‚çš„ CSS é¢„å¤„ç†ã€ä¼˜åŒ–ç­‰å„ç§åŠŸèƒ½ã€‚ç”±äºå®ƒå¯ä»¥æŒ‰éœ€é…ç½®å’ŒåŠ è½½æ’ä»¶ï¼Œ<code>PostCSS</code> éå¸¸é€‚åˆç°ä»£å‰ç«¯å¼€å‘ï¼Œå°¤å…¶æ˜¯éœ€è¦é«˜åº¦å®šåˆ¶åŒ–çš„é¡¹ç›®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ç‚¹ç™»å½•</title>
      <link href="/2024/10/09/dan-dian-deng-lu/"/>
      <url>/2024/10/09/dan-dian-deng-lu/</url>
      
        <content type="html"><![CDATA[<h3 id="å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰"><a href="#å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰" class="headerlink" title="å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰"></a>å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰</h3><p>å‚è€ƒæ–‡æ¡£ï¼š<a href="https://juejin.cn/post/7044328327762411534?searchId=20240918172034A3B355DF0CFBF66410FA">https://juejin.cn/post/7044328327762411534?searchId=20240918172034A3B355DF0CFBF66410FA</a></p><h3 id="1-ç™»å½•"><a href="#1-ç™»å½•" class="headerlink" title="1 ç™»å½•"></a>1 ç™»å½•</h3><ol><li><p>ç”¨æˆ·è®¿é—®ç³»ç»Ÿ 1 çš„å—ä¿æŠ¤èµ„æºï¼Œç³»ç»Ÿ 1 å‘ç°ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬è‡³ sso è®¤è¯ä¸­å¿ƒï¼Œå¹¶å°†è‡ªå·±çš„åœ°å€ä½œä¸ºå‚æ•°</p></li><li><p>sso è®¤è¯ä¸­å¿ƒå‘ç°ç”¨æˆ·æœªç™»å½•ï¼Œå°†ç”¨æˆ·å¼•å¯¼è‡³ç™»å½•é¡µé¢ï¼ˆå¸¦ç³»ç»Ÿ 1 åœ°å€ï¼‰</p></li><li><p>ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå¯†ç æäº¤ç™»å½•ç”³è¯·</p></li><li><p><code>ssoè®¤è¯ä¸­å¿ƒæ ¡éªŒç”¨æˆ·ä¿¡æ¯ï¼Œåˆ›å»ºç”¨æˆ·ä¸ssoè®¤è¯ä¸­å¿ƒä¹‹é—´çš„ä¼šè¯ï¼Œç§°ä¸ºå…¨å±€ä¼šè¯ï¼ˆè¿™æ—¶è¯¥ä¼šè¯ä¿¡æ¯ä¿å­˜åˆ°cookieä¸­ï¼‰ï¼ŒåŒæ—¶åˆ›å»ºæˆæƒä»¤ç‰Œ</code> è®¾ç½® PToken</p></li><li><p>sso è®¤è¯ä¸­å¿ƒå¸¦ç€ä»¤ç‰Œ(sTokenBackendValidate)è·³è½¬åˆ°æœ€åˆçš„è¯·æ±‚åœ°å€ï¼ˆç³»ç»Ÿ 1ï¼‰ 302 è·³è½¬</p></li><li><p>ç³»ç»Ÿ 1 æ‹¿åˆ°ä»¤ç‰Œï¼Œæ‰å–åç«¯æœåŠ¡ï¼Œåç«¯æœåŠ¡ï¼Œ å» sso è®¤è¯ä¸­å¿ƒæ ¡éªŒä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆï¼ˆç½®æ¢ STokenï¼‰</p></li><li><p>sso è®¤è¯ä¸­å¿ƒæ ¡éªŒä»¤ç‰Œï¼Œè¿”å›æœ‰æ•ˆï¼Œæ³¨å†Œç³»ç»Ÿ 1ï¼Œå¹¶ç»™å½“å‰åŸŸåä¸‹å†™å…¥ stoken</p></li><li><p><code>ç³»ç»Ÿ1ä½¿ç”¨è¯¥ä»¤ç‰Œåˆ›å»ºä¸ç”¨æˆ·çš„ä¼šè¯ï¼Œç§°ä¸ºå±€éƒ¨ä¼šè¯(seesion)ï¼Œè¿”å›å—ä¿æŠ¤èµ„æº</code></p></li><li><p>é‡æ–°è·å–ç”¨æˆ·ä¿¡æ¯æºå¸¦ tokenï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯</p></li><li><p>ç”¨æˆ·è®¿é—®ç³»ç»Ÿ 2 çš„å—ä¿æŠ¤èµ„æº</p></li><li><p>ç³»ç»Ÿ 2 å‘ç°ç”¨æˆ·æœªç™»å½•ï¼Œè·³è½¬è‡³ sso è®¤è¯ä¸­å¿ƒï¼Œå¹¶å°†è‡ªå·±çš„<code>åœ°å€</code>å’Œä¹‹å‰å’Œ<code>ssoè®¤è¯ä¸­å¿ƒçš„ä¼šè¯cookieä¿¡</code>æ¯ä½œä¸ºå‚æ•°</p></li><li><p>sso è®¤è¯ä¸­å¿ƒå‘ç°ç”¨æˆ·å·²ç™»å½•ï¼Œè·³è½¬å›ç³»ç»Ÿ 2 çš„åœ°å€ï¼Œå¹¶é™„ä¸Šä»¤ç‰Œ</p></li><li><p>ç³»ç»Ÿ 2 æ‹¿åˆ°ä»¤ç‰Œï¼Œå» sso è®¤è¯ä¸­å¿ƒæ ¡éªŒä»¤ç‰Œæ˜¯å¦æœ‰æ•ˆï¼Œå¹¶ç»™å½“å‰ç³»ç»ŸäºŒåŸŸåä¸‹å†™å…¥ stoken</p></li><li><p>ç³»ç»Ÿ 2 ä½¿ç”¨è¯¥ä»¤ç‰Œåˆ›å»ºä¸ç”¨æˆ·çš„å±€éƒ¨ä¼šè¯ï¼Œè¿”å›å—ä¿æŠ¤èµ„æº</p></li></ol><blockquote><p>ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œä¼šä¸ sso è®¤è¯ä¸­å¿ƒåŠè®¿é—®çš„å­ç³»ç»Ÿå»ºç«‹ä¼šè¯ï¼Œç”¨æˆ·ä¸ sso è®¤è¯ä¸­å¿ƒå»ºç«‹çš„ä¼šè¯ç§°ä¸ºå…¨å±€ä¼šè¯ï¼Œç”¨æˆ·ä¸å„ä¸ªå­ç³»ç»Ÿå»ºç«‹çš„ä¼šè¯ç§°ä¸ºå±€éƒ¨ä¼šè¯ï¼Œå±€éƒ¨ä¼šè¯å»ºç«‹ä¹‹åï¼Œç”¨æˆ·è®¿é—®å­ç³»ç»Ÿå—ä¿æŠ¤èµ„æºå°†ä¸å†é€šè¿‡ sso è®¤è¯ä¸­å¿ƒï¼Œå…¨å±€ä¼šè¯ä¸å±€éƒ¨ä¼šè¯æœ‰å¦‚ä¸‹çº¦æŸå…³ç³»</p></blockquote><h3 id="2-æ³¨é”€"><a href="#2-æ³¨é”€" class="headerlink" title="2. æ³¨é”€"></a>2. æ³¨é”€</h3><ol><li><p>ç”¨æˆ·å‘ç³»ç»Ÿ 1 å‘èµ·æ³¨é”€è¯·æ±‚</p></li><li><p>ç³»ç»Ÿ 1 æ ¹æ®ç”¨æˆ·ä¸ç³»ç»Ÿ 1 å»ºç«‹çš„ä¼šè¯ id æ‹¿åˆ°ä»¤ç‰Œï¼Œå‘ sso è®¤è¯ä¸­å¿ƒå‘èµ·æ³¨é”€è¯·æ±‚</p></li><li><p>sso è®¤è¯ä¸­å¿ƒæ ¡éªŒä»¤ç‰Œæœ‰æ•ˆï¼Œé”€æ¯å…¨å±€ä¼šè¯ï¼ŒåŒæ—¶å–å‡ºæ‰€æœ‰ç”¨æ­¤ä»¤ç‰Œæ³¨å†Œçš„ç³»ç»Ÿåœ°å€</p></li><li><p>sso è®¤è¯ä¸­å¿ƒå‘æ‰€æœ‰æ³¨å†Œç³»ç»Ÿå‘èµ·æ³¨é”€è¯·æ±‚</p></li><li><p>å„æ³¨å†Œç³»ç»Ÿæ¥æ”¶ sso è®¤è¯ä¸­å¿ƒçš„æ³¨é”€è¯·æ±‚ï¼Œé”€æ¯å±€éƒ¨ä¼šè¯</p></li><li><p>sso è®¤è¯ä¸­å¿ƒå¼•å¯¼ç”¨æˆ·è‡³ç™»å½•é¡µé¢</p></li></ol>]]></content>
      
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>express</title>
      <link href="/2024/10/08/express/"/>
      <url>/2024/10/08/express/</url>
      
        <content type="html"><![CDATA[<h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">"express"</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"middlware 1"</span><span class="token punctuation">)</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"middlware 2"</span><span class="token punctuation">)</span>    <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"middlware 3"</span><span class="token punctuation">)</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// console.log(1, req.a)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"222=>"</span><span class="token punctuation">,</span> <span class="token number">222</span><span class="token punctuation">)</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ ¸å¿ƒå®ç°"><a href="#æ ¸å¿ƒå®ç°" class="headerlink" title="æ ¸å¿ƒå®ç°"></a>æ ¸å¿ƒå®ç°</h3><h4 id="application-js"><a href="#application-js" class="headerlink" title="application.js"></a>application.js</h4><blockquote><p>application.js æ˜¯æ¡†æ¶çš„ä¸»å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨ HTTP æœåŠ¡å™¨å¹¶å¤„ç†è¯·æ±‚ã€‚</p></blockquote><ul><li><p><strong>æ‡’åŠ è½½è·¯ç”±ç³»ç»Ÿ</strong>ï¼š<code>lazy_route</code> æ–¹æ³•ç¡®ä¿åœ¨éœ€è¦æ—¶æ‰åŠ è½½è·¯ç”±ç³»ç»Ÿã€‚</p></li><li><p><strong>use æ–¹æ³•</strong>ï¼šç”¨äºæ³¨å†Œå…¨å±€ä¸­é—´ä»¶ã€‚</p></li><li><p><strong>listen æ–¹æ³•</strong>ï¼šåˆ›å»º HTTP æœåŠ¡å™¨ï¼Œé€šè¿‡è°ƒç”¨ <code>this.router.handle</code> å¤„ç†æ¯ä¸ªè¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„è·¯ç”±ï¼Œåˆ™è°ƒç”¨ <code>done</code> æ–¹æ³•ç»“æŸè¯·æ±‚ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">"http"</span><span class="token keyword">import</span> methods <span class="token keyword">from</span> <span class="token string">"methods"</span><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">"./router/index.js"</span><span class="token keyword">function</span> <span class="token function">Application</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token class-name">Application</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">lazy_route</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å°†è·¯ç”±ç³»ç»Ÿè¿›è¡Œäº†æ‡’åŠ è½½å¤„ç†ï¼ˆä¸€èˆ¬éƒ½æ˜¯è¦åŠ è½½çš„ï¼‰</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">Application</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lazy_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token operator">...</span>arguments<span class="token punctuation">)</span> <span class="token comment">//  äº¤ç»™è·¯ç”±ç³»ç»Ÿæ¥å¤„ç†</span><span class="token punctuation">&#125;</span><span class="token class-name">Application</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">listen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¦‚æœè·¯ç”±ç³»ç»Ÿä¸­çš„å±‚ä¸å­˜åœ¨åˆ™è°ƒç”¨æ­¤æ–¹æ³•æ¥ç»“æŸå“åº”</span>      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// äº¤ç»™è·¯ç”±ç³»ç»Ÿæ¥åšåŒ¹é…ï¼Œå¦‚æœåŒ¹é…ä¸åˆ°å°±è°ƒç”¨done</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> done<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Application</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> <span class="token operator">...</span>handlers</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è®©è·¯ç”±ç³»ç»Ÿå¤„ç†é€»è¾‘</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">lazy_route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>router<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> handlers<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> Application<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Router-js"><a href="#Router-js" class="headerlink" title="Router.js"></a>Router.js</h4><blockquote><p>router.js æ˜¯è·¯ç”±ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œç®¡ç†è·¯ç”±æ ˆï¼ˆstackï¼‰å¹¶å®ç°è·¯ç”±åŒ¹é…é€»è¾‘ã€‚</p></blockquote><ul><li><strong>è·¯ç”±æ³¨å†Œ</strong>ï¼šä¸ºæ¯ä¸ª HTTP æ–¹æ³•åˆ›å»ºç›¸åº”çš„è·¯ç”±ï¼Œä½¿ç”¨ <code>Layer</code> ç±»ç®¡ç†è·¯å¾„ï¼Œå¹¶é€šè¿‡ <code>dispatch</code> æ–¹æ³•æ‰§è¡Œç›¸åº”çš„è·¯ç”±å¤„ç†å‡½æ•°ã€‚</li><li><strong>ä¸­é—´ä»¶æ³¨å†Œ</strong>ï¼š<code>use</code> æ–¹æ³•ç”¨äºæ³¨å†Œå…¨å±€æˆ–ç‰¹å®šè·¯å¾„çš„ä¸­é—´ä»¶ã€‚</li><li><strong>è¯·æ±‚å¤„ç†</strong>ï¼š<code>handle</code> æ–¹æ³•ç”¨äºåŒ¹é…è¯·æ±‚è·¯å¾„å’Œæ–¹æ³•ï¼Œé€å±‚æ‰§è¡Œä¸­é—´ä»¶å’Œè·¯ç”±å¤„ç†å‡½æ•°ã€‚å¦‚æœå­˜åœ¨é”™è¯¯ï¼Œåˆ™è°ƒç”¨é”™è¯¯å¤„ç†ä¸­é—´ä»¶ã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> url <span class="token keyword">from</span> <span class="token string">"url"</span><span class="token keyword">import</span> methods <span class="token keyword">from</span> <span class="token string">"methods"</span><span class="token keyword">import</span> Layer <span class="token keyword">from</span> <span class="token string">"./Layer.js"</span><span class="token keyword">import</span> Route <span class="token keyword">from</span> <span class="token string">"./route.js"</span><span class="token keyword">function</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> handlers</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è°ƒç”¨ç±»æ¥ç®¡ç†è·¯å¾„</span>    <span class="token keyword">let</span> route <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    handlers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      route<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> layer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> route<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// æ¯ä¸ªè·¯ç”±çš„å±‚éƒ½æœ‰ä¸€ä¸ªrouteå±æ€§ï¼Œå¯¹åº”å­˜æ”¾è‡ªå·±çš„çœŸå®è·¯åŸºçš„</span>    layer<span class="token punctuation">.</span>route <span class="token operator">=</span> route    <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> <span class="token operator">...</span>handlers</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> path <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    handlers <span class="token operator">=</span> <span class="token punctuation">[</span>path<span class="token punctuation">,</span> <span class="token operator">...</span>handlers<span class="token punctuation">]</span> <span class="token comment">// pathå°±æ˜¯å¤„ç†å‡½æ•°</span>    path <span class="token operator">=</span> <span class="token string">"/"</span> <span class="token comment">// å¦‚æœæ²¡å†™è·¯å¾„å°±æ˜¯ / åŒ¹é…æ‰€æœ‰çš„è·¯å¾„</span>  <span class="token punctuation">&#125;</span>  handlers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> layer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>    layer<span class="token punctuation">.</span>route <span class="token operator">=</span> <span class="token keyword">undefined</span> <span class="token comment">// ä¸­é—´ä»¶æ²¡æœ‰è·¯ç”±è¿™ä¸ªå¯¹è±¡</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">handle</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> out</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> pathname<span class="token punctuation">,</span> query <span class="token punctuation">&#125;</span> <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> method <span class="token operator">=</span> req<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> idx <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span>length <span class="token operator">==</span> idx<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> layer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token comment">// æ‹¿å‡ºç¬¬ä¸€ä¸ªå±‚</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>layer<span class="token punctuation">.</span>route<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æœ‰é”™è¯¯æ‰¾ä¸­é—´ä»¶ï¼Œè€Œä¸” è¦æ‰¾å‚æ•°æ˜¯4ä¸ªçš„ä¸­é—´ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          layer<span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token comment">// æ™®é€šä¸­é—´ä»¶ç»§ç»­å¸¦ç€é”™è¯¯å‘ä¸‹èµ°</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æœ‰é”™è¯¯ä½†æ˜¯æ˜¯è·¯ç”±ï¼Œè¦å¸¦ç€ é”™è¯¯ç»§ç»­å¾€ä¸‹èµ°</span>        <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å› ä¸ºé”™è¯¯å¤„ç†ä¸­é—´ä»¶å®šä¹‰åœ¨äº† router.stackä¸­ ,å¦‚æœæœ‰errå°±å»è¿™ä¸ªstackä¸­æŸ¥æ‰¾é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>pathname<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>route<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// è·¯ç”±</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>route<span class="token punctuation">.</span>methods<span class="token punctuation">[</span>req<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// éœ€è¦åŒ¹é…æ–¹æ³•</span>            layer<span class="token punctuation">.</span><span class="token function">handle_request</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token comment">//  route.dispatch</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ–¹æ³•ä¸ä¸€è‡´ç›´æ¥å‘ä¸‹èµ°</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// ä¸­é—´ä»¶æ— éœ€åŒ¹é…æ–¹æ³•, æ²¡æœ‰é”™è¯¯ä¸èƒ½æ‰§è¡Œé”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            layer<span class="token punctuation">.</span><span class="token function">handle_request</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span> <span class="token comment">//  route.dispatch</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// é»˜è®¤åœ¨è·¯ç”±ä¸­ç­›æŸ¥</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Router<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Layer-js"><a href="#Layer-js" class="headerlink" title="Layer.js"></a>Layer.js</h4><blockquote><p>layer.js å®šä¹‰äº†è·¯ç”±å’Œä¸­é—´ä»¶çš„æŠ½è±¡å±‚ã€‚æ¯ä¸ªè·¯ç”±æˆ–ä¸­é—´ä»¶å¯¹åº”ä¸€ä¸ª Layer å®ä¾‹ã€‚</p></blockquote><ul><li><p><strong>åŒ¹é…è·¯å¾„</strong>ï¼š<code>match</code> æ–¹æ³•ç”¨äºæ£€æŸ¥å½“å‰ <code>Layer</code> æ˜¯å¦åŒ¹é…è¯·æ±‚è·¯å¾„ã€‚</p></li><li><p><strong>è¯·æ±‚å¤„ç†</strong>ï¼š<code>handle_request</code> æ–¹æ³•è°ƒç”¨å…·ä½“çš„å¤„ç†å‡½æ•°ã€‚</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// è·¯ç”±ä¸­å¯¹åº”çš„å±‚</span><span class="token keyword">function</span> <span class="token function">Layer</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">=</span> path  <span class="token keyword">this</span><span class="token punctuation">.</span>handler <span class="token operator">=</span> handler<span class="token punctuation">&#125;</span><span class="token class-name">Layer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">match</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">===</span> path<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>route<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä¸­é—´ä»¶</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ä¸­é—´ä»¶æ˜¯/éƒ½èƒ½åŒ¹é…</span>      <span class="token keyword">return</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">"/"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token class-name">Layer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">handle_request</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handler</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Layer<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Route-js"><a href="#Route-js" class="headerlink" title="Route.js"></a>Route.js</h4><blockquote><p>route.js è´Ÿè´£ç®¡ç†æ¯ä¸ªç‰¹å®šè·¯ç”±çš„å¤„ç†å‡½æ•°ï¼Œå¹¶è°ƒåº¦ï¼ˆdispatchï¼‰å¤„ç†ã€‚</p></blockquote><ul><li><p><strong>æ–¹æ³•æ³¨å†Œ</strong>ï¼šä¸ºæ¯ä¸ªè·¯ç”±ç»‘å®šç‰¹å®š HTTP æ–¹æ³•ï¼ˆå¦‚ <code>get</code>ã€<code>post</code>ï¼‰ï¼Œå¹¶å°†å¤„ç†å‡½æ•°å­˜å‚¨åœ¨ <code>stack</code> ä¸­ã€‚</p></li><li><p><strong>è°ƒåº¦å¤„ç†</strong>ï¼š<code>dispatch</code> æ–¹æ³•æ ¹æ®è¯·æ±‚æ–¹æ³•ä¾æ¬¡æ‰§è¡Œå¯¹åº”çš„å¤„ç†å‡½æ•°ã€‚</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> methods <span class="token keyword">from</span> <span class="token string">"methods"</span><span class="token keyword">import</span> Layer <span class="token keyword">from</span> <span class="token string">"./Layer.js"</span><span class="token keyword">function</span> <span class="token function">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>methods <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// ç”¨æ¥æè¿°è¿™ä¸ªrouteä¸­æœ‰ä»€ä¹ˆæ–¹æ³•</span><span class="token punctuation">&#125;</span>methods<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Route</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">handler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> layer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Layer</span><span class="token punctuation">(</span><span class="token string">"é‡Œå±‚çš„ç”¨æˆ·çš„é€»è¾‘ä¸éœ€è¦è¿™ä¸ªpath"</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>    layer<span class="token punctuation">.</span>method <span class="token operator">=</span> method    <span class="token keyword">this</span><span class="token punctuation">.</span>methods<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// &#123;get:true&#125;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>layer<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token class-name">Route</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> out</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> idx <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">const</span> <span class="token function-variable function">next</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"run"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">out</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> layer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> layer<span class="token punctuation">.</span>method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ç”¨æˆ·ç»‘å®šçš„æ–¹æ³•</span>      layer<span class="token punctuation">.</span><span class="token function">handle_request</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Route<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>jwt</title>
      <link href="/2024/10/08/jwt/"/>
      <url>/2024/10/08/jwt/</url>
      
        <content type="html"><![CDATA[<h2 id="1-JWT"><a href="#1-JWT" class="headerlink" title="1.JWT"></a>1.JWT</h2><ul><li>JWT(json web token)æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäº JSON çš„å¼€æ”¾æ ‡å‡†ã€‚</li><li>JWT çš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºã€‚æ¯”å¦‚ç”¨åœ¨ç”¨æˆ·ç™»å½•ä¸Šã€‚</li><li>å› ä¸ºæ•°å­—ç­¾åçš„å­˜åœ¨ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å¯ä¿¡çš„ï¼ŒJWT å¯ä»¥ä½¿ç”¨ HMAC ç®—æ³•æˆ–è€…æ˜¯ RSA çš„å…¬ç§ç§˜é’¥å¯¹è¿›è¡Œç­¾å</li></ul><h2 id="2-ä¸»è¦åº”ç”¨åœºæ™¯"><a href="#2-ä¸»è¦åº”ç”¨åœºæ™¯" class="headerlink" title="2.ä¸»è¦åº”ç”¨åœºæ™¯"></a>2.ä¸»è¦åº”ç”¨åœºæ™¯</h2><ul><li>èº«ä»½è®¤è¯åœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸€æ—¦ç”¨æˆ·å®Œæˆäº†ç™»é™†ï¼Œåœ¨æ¥ä¸‹æ¥çš„æ¯ä¸ªè¯·æ±‚ä¸­åŒ…å« JWTï¼Œå¯ä»¥ç”¨æ¥éªŒè¯ç”¨æˆ·èº«ä»½ä»¥åŠå¯¹è·¯ç”±ï¼ŒæœåŠ¡å’Œèµ„æºçš„è®¿é—®æƒé™è¿›è¡ŒéªŒè¯ã€‚</li><li>ä¿¡æ¯äº¤æ¢åœ¨é€šä¿¡çš„åŒæ–¹ä¹‹é—´ä½¿ç”¨ JWT å¯¹æ•°æ®è¿›è¡Œç¼–ç æ˜¯ä¸€ç§éå¸¸å®‰å…¨çš„æ–¹å¼ï¼Œç”±äºå®ƒçš„ä¿¡æ¯æ˜¯ç»è¿‡ç­¾åçš„ï¼Œå¯ä»¥ç¡®ä¿å‘é€è€…å‘é€çš„ä¿¡æ¯æ˜¯æ²¡æœ‰ç»è¿‡ä¼ªé€ çš„</li></ul><h2 id="3-JWT-çš„ç»“æ„"><a href="#3-JWT-çš„ç»“æ„" class="headerlink" title="3.JWT çš„ç»“æ„"></a>3.JWT çš„ç»“æ„</h2><p>JWT åŒ…å«äº†ä½¿ç”¨<code>.</code>åˆ†éš”çš„ä¸‰éƒ¨åˆ†</p><ul><li>Header å¤´éƒ¨</li><li>Payload è´Ÿè½½</li><li>Signature ç­¾å</li></ul><h3 id="3-1-Header"><a href="#3-1-Header" class="headerlink" title="3.1 Header"></a>3.1 Header</h3><p>åœ¨ header ä¸­é€šå¸¸åŒ…å«äº†ä¸¤éƒ¨åˆ†ï¼štoken ç±»å‹å’Œé‡‡ç”¨çš„åŠ å¯†ç®—æ³•ã€‚</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span> <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"HS256"</span><span class="token punctuation">,</span> <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¥ä¸‹æ¥å¯¹è¿™éƒ¨åˆ†å†…å®¹ä½¿ç”¨<code>Base64Url</code>ç¼–ç ç»„æˆäº†<code>JWT</code>ç»“æ„çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><h3 id="3-2-Payload"><a href="#3-2-Payload" class="headerlink" title="3.2 Payload"></a>3.2 Payload</h3><p>è´Ÿè½½å°±æ˜¯å­˜æ”¾æœ‰æ•ˆä¿¡æ¯çš„åœ°æ–¹ã€‚è¿™ä¸ªåå­—åƒæ˜¯æŒ‡è´§è½¦ä¸Šæ‰¿è½½çš„è´§ç‰©ï¼Œè¿™äº›æœ‰æ•ˆä¿¡æ¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†</p><ul><li>æ ‡å‡†ä¸­æ³¨å†Œçš„å£°æ˜</li><li>å…¬å…±çš„å£°æ˜</li><li>ç§æœ‰çš„å£°æ˜</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span> <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"zhangsan"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¸Šè¿°çš„è´Ÿè½½éœ€è¦ç»è¿‡<code>Base64Url</code>ç¼–ç åä½œä¸º JWT ç»“æ„çš„ç¬¬äºŒéƒ¨åˆ†</p><h3 id="3-3-Signature"><a href="#3-3-Signature" class="headerlink" title="3.3 Signature"></a>3.3 Signature</h3><ul><li><p>åˆ›å»ºç­¾åéœ€è¦ä½¿ç”¨ç¼–ç åçš„ header å’Œ payload ä»¥åŠä¸€ä¸ªç§˜é’¥</p></li><li><p>ä½¿ç”¨ header ä¸­æŒ‡å®šç­¾åç®—æ³•è¿›è¡Œç­¾å</p></li><li><p>ä¾‹å¦‚å¦‚æœå¸Œæœ›ä½¿ç”¨ HMAC SHA256 ç®—æ³•ï¼Œé‚£ä¹ˆç­¾ååº”è¯¥ä½¿ç”¨ä¸‹åˆ—æ–¹å¼åˆ›å»º</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">HMACSHA256</span><span class="token punctuation">(</span><span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> <span class="token function">base64UrlEncode</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>ç­¾åç”¨äºéªŒè¯æ¶ˆæ¯çš„å‘é€è€…ä»¥åŠæ¶ˆæ¯æ˜¯æ²¡æœ‰ç»è¿‡ç¯¡æ”¹çš„</p></li><li><p>å®Œæ•´çš„ JWT å®Œæ•´çš„ JWT æ ¼å¼çš„è¾“å‡ºæ˜¯ä»¥. åˆ†éš”çš„ä¸‰æ®µ Base64 ç¼–ç </p></li><li><p>å¯†é’¥ secret æ˜¯ä¿å­˜åœ¨æœåŠ¡ç«¯çš„ï¼ŒæœåŠ¡ç«¯ä¼šæ ¹æ®è¿™ä¸ªå¯†é’¥è¿›è¡Œç”Ÿæˆ token å’ŒéªŒè¯ï¼Œæ‰€ä»¥éœ€è¦ä¿æŠ¤å¥½ã€‚</p></li></ul><h2 id="4-å¦‚ä½•ä½¿ç”¨-JWT"><a href="#4-å¦‚ä½•ä½¿ç”¨-JWT" class="headerlink" title="4.å¦‚ä½•ä½¿ç”¨ JWT"></a>4.å¦‚ä½•ä½¿ç”¨ JWT</h2><ol><li><p>å½“ç”¨æˆ·ä½¿ç”¨å®ƒçš„è®¤è¯ä¿¡æ¯ç™»é™†ç³»ç»Ÿä¹‹åï¼Œä¼šè¿”å›ç»™ç”¨æˆ·ä¸€ä¸ª JWT</p></li><li><p>ç”¨æˆ·åªéœ€è¦æœ¬åœ°ä¿å­˜è¯¥ tokenï¼ˆé€šå¸¸ä½¿ç”¨ local storageï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ cookieï¼‰å³å¯</p></li><li><p>å½“ç”¨æˆ·å¸Œæœ›è®¿é—®ä¸€ä¸ªå—ä¿æŠ¤çš„è·¯ç”±æˆ–è€…èµ„æºçš„æ—¶å€™ï¼Œé€šå¸¸åº”è¯¥åœ¨ Authorization å¤´éƒ¨ä½¿ç”¨ Bearer æ¨¡å¼æ·»åŠ  JWTï¼Œå…¶å†…å®¹çœ‹èµ·æ¥æ˜¯ä¸‹é¢è¿™æ ·</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">Authorization</span><span class="token operator">:</span> Bearer <span class="token operator">&lt;</span>token<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>å› ä¸ºç”¨æˆ·çš„çŠ¶æ€åœ¨æœåŠ¡ç«¯çš„å†…å­˜ä¸­æ˜¯ä¸å­˜å‚¨çš„ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ç§æ— çŠ¶æ€çš„è®¤è¯æœºåˆ¶</p></li><li><p>æœåŠ¡ç«¯çš„ä¿æŠ¤è·¯ç”±å°†ä¼šæ£€æŸ¥è¯·æ±‚å¤´ Authorization ä¸­çš„ JWT ä¿¡æ¯ï¼Œå¦‚æœåˆæ³•ï¼Œåˆ™å…è®¸ç”¨æˆ·çš„è¡Œä¸ºã€‚</p></li><li><p>ç”±äº JWT æ˜¯è‡ªåŒ…å«çš„ï¼Œå› æ­¤å‡å°‘äº†éœ€è¦æŸ¥è¯¢æ•°æ®åº“çš„éœ€è¦</p></li><li><p>JWT çš„è¿™äº›ç‰¹æ€§ä½¿å¾—æˆ‘ä»¬å¯ä»¥å®Œå…¨ä¾èµ–å…¶æ— çŠ¶æ€çš„ç‰¹æ€§æä¾›æ•°æ® API æœåŠ¡ï¼Œç”šè‡³æ˜¯åˆ›å»ºä¸€ä¸ªä¸‹è½½æµæœåŠ¡ã€‚</p></li><li><p>å› ä¸º JWT å¹¶ä¸ä½¿ç”¨ Cookie çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•åŸŸåæä¾›ä½ çš„ API æœåŠ¡è€Œä¸éœ€è¦æ‹…å¿ƒè·¨åŸŸèµ„æºå…±äº«é—®é¢˜ï¼ˆCORSï¼‰</p></li></ol><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img202410081139879.png"></p><h2 id="5-JWT-å®æˆ˜"><a href="#5-JWT-å®æˆ˜" class="headerlink" title="5. JWT å®æˆ˜"></a>5. JWT å®æˆ˜</h2><h3 id="5-1-server-js"><a href="#5-1-server-js" class="headerlink" title="5.1 server.js"></a>5.1 server.js</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-router'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./jwt-simple'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> secretKey <span class="token operator">=</span> <span class="token string">'jwt-secret'</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">    &lt;form action="/login" method="post">      &lt;input type="text" name="username" />      &lt;input type="submit" value="æäº¤" />    &lt;/form>  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> expirationTime <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">;</span> <span class="token comment">// è¿‡æœŸæ—¶é—´ä¸º1å¤©ï¼ˆå•ä½ä¸ºç§’ï¼‰</span><span class="token keyword">const</span> expirationDate <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token operator">+</span> expirationTime<span class="token punctuation">;</span> <span class="token comment">// è®¡ç®—è¿‡æœŸæ—¶é—´æˆ³</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> username <span class="token punctuation">&#125;</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>  <span class="token keyword">const</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> username<span class="token punctuation">,</span><span class="token literal-property property">exp</span><span class="token operator">:</span> expirationDate <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> token <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> authorizationHeader <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>authorizationHeader <span class="token operator">&amp;&amp;</span> authorizationHeader<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'Bearer '</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> token <span class="token operator">=</span> authorizationHeader<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> decoded <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> secretKey<span class="token punctuation">)</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> decoded<span class="token punctuation">.</span>username<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Invalid token'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'Missing token'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Server is running at http://localhost:3000'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>curl <span class="token operator">-</span><span class="token constant">H</span> <span class="token string">"Authorization: Bearer token"</span> <span class="token literal-property property">http</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>localhost<span class="token operator">:</span><span class="token number">3000</span><span class="token operator">/</span>user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-2-jwt-simple-js"><a href="#5-2-jwt-simple-js" class="headerlink" title="5.2 jwt-simple.js"></a>5.2 jwt-simple.js</h3><p>jwt-simple.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token comment">/** * ç¼–ç JWTä»¤ç‰Œ * @param &#123;Object&#125; payload è´Ÿè½½æ•°æ® * @param &#123;string&#125; key å¯†é’¥ * @returns &#123;string&#125; ç¼–ç åçš„JWTä»¤ç‰Œ */</span><span class="token keyword">function</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> header <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"JWT"</span><span class="token punctuation">,</span> <span class="token literal-property property">alg</span><span class="token operator">:</span> <span class="token string">"sha256"</span> <span class="token punctuation">&#125;</span> <span class="token comment">// å£°æ˜ç±»å‹å’Œç®—æ³•</span>  <span class="token keyword">var</span> segments <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// å£°æ˜ä¸€ä¸ªæ•°ç»„</span>  segments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">base64urlEncode</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å¯¹headerè¿›è¡Œbase64ç¼–ç </span>  segments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">base64urlEncode</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// å¯¹è´Ÿè½½è¿›è¡Œbase64ç¼–ç </span>  segments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">sign</span><span class="token punctuation">(</span>segments<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// åŠ å…¥ç­¾å</span>  <span class="token keyword">return</span> segments<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** * ç”Ÿæˆç­¾å * @param &#123;string&#125; input è¾“å…¥æ•°æ® * @param &#123;string&#125; key å¯†é’¥ * @returns &#123;string&#125; ç­¾å */</span><span class="token keyword">function</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token parameter">input<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">createHmac</span><span class="token punctuation">(</span><span class="token string">"sha256"</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">"base64"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** * è§£ç JWTä»¤ç‰Œ * @param &#123;string&#125; token JWTä»¤ç‰Œ * @param &#123;string&#125; key å¯†é’¥ * @returns &#123;Object&#125; è§£ç åçš„è´Ÿè½½æ•°æ® * @throws &#123;Error&#125; å¦‚æœéªŒè¯å¤±è´¥æˆ–ä»¤ç‰Œè¿‡æœŸï¼Œåˆ™æŠ›å‡ºé”™è¯¯ */</span><span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token parameter">token<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> segments <span class="token operator">=</span> token<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>  <span class="token keyword">var</span> headerSeg <span class="token operator">=</span> segments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">var</span> payloadSeg <span class="token operator">=</span> segments<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token keyword">var</span> signatureSeg <span class="token operator">=</span> segments<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token keyword">var</span> payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">base64urlDecode</span><span class="token punctuation">(</span>payloadSeg<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>signatureSeg <span class="token operator">!=</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">[</span>headerSeg<span class="token punctuation">,</span> payloadSeg<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"verify failed"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>payload<span class="token punctuation">.</span>exp <span class="token operator">&amp;&amp;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> payload<span class="token punctuation">.</span>exp <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Token expired"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> payload<span class="token punctuation">&#125;</span><span class="token comment">/** * Base64 URLç¼–ç  * @param &#123;string&#125; str è¾“å…¥å­—ç¬¦ä¸² * @returns &#123;string&#125; ç¼–ç åçš„å­—ç¬¦ä¸² */</span><span class="token keyword">function</span> <span class="token function">base64urlEncode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">"base64"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** * Base64 URLè§£ç  * @param &#123;string&#125; str ç¼–ç çš„å­—ç¬¦ä¸² * @returns &#123;string&#125; è§£ç åçš„å­—ç¬¦ä¸² */</span><span class="token keyword">function</span> <span class="token function">base64urlDecode</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> <span class="token string">"base64"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  encode<span class="token punctuation">,</span>  decode<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>cookieå’ŒsessionåŸç†</title>
      <link href="/2024/09/27/cookie-he-session-yuan-li/"/>
      <url>/2024/09/27/cookie-he-session-yuan-li/</url>
      
        <content type="html"><![CDATA[<h3 id="Cookie-ä¸-Session-çš„åŒºåˆ«ä¸ç†è§£"><a href="#Cookie-ä¸-Session-çš„åŒºåˆ«ä¸ç†è§£" class="headerlink" title="Cookie ä¸ Session çš„åŒºåˆ«ä¸ç†è§£"></a><strong>Cookie ä¸ Session çš„åŒºåˆ«ä¸ç†è§£</strong></h3><h4 id="1-Cookieï¼š"><a href="#1-Cookieï¼š" class="headerlink" title="1. Cookieï¼š"></a><strong>1. Cookieï¼š</strong></h4><p><strong>Cookie</strong> æ˜¯å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¸Šçš„å°æ•°æ®æ–‡ä»¶ï¼Œç”¨æ¥ä¿æŒç”¨æˆ·çš„çŠ¶æ€å’Œä¿¡æ¯ã€‚å®ƒç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œå¹¶é€šè¿‡ HTTP å“åº”å¤´å‘é€åˆ°å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚éƒ½ä¼šå°†è¯¥ Cookie å‘é€ç»™æœåŠ¡å™¨ã€‚</p><ul><li><strong>ç”¨é€”</strong>ï¼šä¸»è¦ç”¨äºè¯†åˆ«ç”¨æˆ·ã€ä¿å­˜ç™»å½•çŠ¶æ€ã€è®°å½•ç”¨æˆ·åå¥½ã€è·Ÿè¸ªç”¨æˆ·è¡Œä¸ºç­‰ã€‚</li><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šä¿å­˜åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­ã€‚</li><li><strong>å¤§å°é™åˆ¶</strong>ï¼šæ¯ä¸ª Cookie çš„å¤§å°ä¸€èˆ¬ä¸è¶…è¿‡ 4KBã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šå¯ä»¥è®¾ç½® <code>expires</code> æˆ– <code>max-age</code> æ¥å®šä¹‰ Cookie çš„æœ‰æ•ˆæœŸã€‚çŸ­æœŸçš„ Cookie å¯èƒ½ä¼šåœ¨å…³é—­æµè§ˆå™¨æ—¶åˆ é™¤ï¼Œé•¿æœŸçš„ Cookie åˆ™ä¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯ç›´åˆ°è¿‡æœŸæˆ–è¢«æ‰‹åŠ¨åˆ é™¤ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šç”±äºä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œå®‰å…¨æ€§è¾ƒä½ï¼Œå®¹æ˜“è¢«ç¯¡æ”¹æˆ–æ‹¦æˆªï¼Œå› æ­¤æ•æ„Ÿä¿¡æ¯ä¸åº”è¯¥ç›´æ¥å­˜å‚¨åœ¨ Cookie ä¸­ã€‚å¯ä»¥é€šè¿‡è®¾ç½® <code>HttpOnly</code> å’Œ <code>Secure</code> å±æ€§å¢å¼ºå®‰å…¨æ€§ã€‚</li><li><strong>è·¨åŸŸé—®é¢˜</strong>ï¼šæµè§ˆå™¨åŒæºç­–ç•¥é™åˆ¶äº† Cookie çš„è·¨åŸŸä½¿ç”¨ï¼Œä¸€èˆ¬åªæœ‰ç›¸åŒåŸŸåçš„æœåŠ¡å™¨æ‰èƒ½è¯»å–è¯¥åŸŸåä¸‹çš„ Cookieã€‚</li></ul><h4 id="2-Sessionï¼š"><a href="#2-Sessionï¼š" class="headerlink" title="2. Sessionï¼š"></a><strong>2. Sessionï¼š</strong></h4><p><strong>Session</strong> æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ç”¨æˆ·ä¼šè¯æ•°æ®ï¼Œç”¨äºåœ¨å¤šä¸ªè¯·æ±‚ä¸­ä¿æŒç”¨æˆ·çš„çŠ¶æ€ã€‚ä¸ Cookie é…åˆä½¿ç”¨ï¼Œé€šå¸¸ä¼šå°†ä¸€ä¸ªå”¯ä¸€çš„ Session ID å­˜å‚¨åœ¨ Cookie ä¸­ï¼ŒæœåŠ¡å™¨é€šè¿‡è¯¥ ID è¯†åˆ«å®¢æˆ·ç«¯çš„ Session æ•°æ®ã€‚</p><ul><li><strong>ç”¨é€”</strong>ï¼šç”¨äºå­˜å‚¨ç”¨æˆ·çš„ç™»å½•ä¿¡æ¯ã€è´­ç‰©è½¦çŠ¶æ€ç­‰éœ€è¦ä¿ç•™åœ¨æœåŠ¡å™¨ä¸Šçš„æ•°æ®ã€‚</li><li><strong>å­˜å‚¨ä½ç½®</strong>ï¼šä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ¯ä¸ªç”¨æˆ·çš„ Session éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ IDã€‚</li><li><strong>å¤§å°é™åˆ¶</strong>ï¼šSession çš„å¤§å°æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œå…·ä½“å–å†³äºæœåŠ¡å™¨çš„å­˜å‚¨èƒ½åŠ›ã€‚</li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šSession ä¸€èˆ¬æ˜¯çŸ­æœŸçš„ï¼Œå½“ç”¨æˆ·å…³é—­æµè§ˆå™¨æˆ–ä¼šè¯è¶…æ—¶ï¼ŒSession ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚æœåŠ¡ç«¯ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ¥è®¾ç½® Session çš„è¿‡æœŸæ—¶é—´ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šç”±äºæ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®‰å…¨æ€§æ¯” Cookie æ›´é«˜ï¼Œä½†å¦‚æœ Session ID æ³„éœ²ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</li><li><strong>è·¨åŸŸé—®é¢˜</strong>ï¼šSession é€šå¸¸ä¸æ¶‰åŠè·¨åŸŸé—®é¢˜ï¼ŒSession æ•°æ®ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡åŒä¸€åŸŸä¸‹çš„ Cookie ä¸­çš„ Session ID æ¥ä¿æŒä¼šè¯ã€‚</li></ul><h4 id="Cookie-ä¸-Session-çš„å¯¹æ¯”ï¼š"><a href="#Cookie-ä¸-Session-çš„å¯¹æ¯”ï¼š" class="headerlink" title="Cookie ä¸ Session çš„å¯¹æ¯”ï¼š"></a><strong>Cookie ä¸ Session çš„å¯¹æ¯”</strong>ï¼š</h4><table><thead><tr><th>ç‰¹æ€§</th><th>Cookie</th><th>Session</th></tr></thead><tbody><tr><td>å­˜å‚¨ä½ç½®</td><td>å®¢æˆ·ç«¯æµè§ˆå™¨</td><td>æœåŠ¡å™¨ç«¯</td></tr><tr><td>æ•°æ®å¤§å°</td><td>ä¸€èˆ¬ä¸è¶…è¿‡ 4KB</td><td>æ²¡æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œä¾èµ–æœåŠ¡å™¨å­˜å‚¨</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>å¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼Œé•¿æœŸæˆ–çŸ­æœŸ</td><td>ä¸€èˆ¬åœ¨å…³é—­æµè§ˆå™¨æˆ–è¶…æ—¶åå¤±æ•ˆ</td></tr><tr><td>å®‰å…¨æ€§</td><td>è¾ƒä½ï¼Œå®¹æ˜“è¢«ç¯¡æ”¹</td><td>è¾ƒé«˜ï¼Œæ•°æ®å­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯</td></tr><tr><td>æ€§èƒ½å½±å“</td><td>å ç”¨å®¢æˆ·ç«¯å­˜å‚¨ç©ºé—´ï¼Œå½±å“è¾ƒå°</td><td>å ç”¨æœåŠ¡å™¨èµ„æºï¼Œç”¨æˆ·é‡å¤§æ—¶éœ€ä¼˜åŒ–</td></tr><tr><td>è·¨åŸŸè®¿é—®</td><td>å—é™äºæµè§ˆå™¨åŒæºç­–ç•¥</td><td>ä¸ Cookie é…åˆä½¿ç”¨ï¼Œä¸ç›´æ¥å—é™</td></tr></tbody></table><h4 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</h4><ul><li><strong>Cookie</strong> æ›´é€‚åˆä¿å­˜ä¸€äº›ä¸å¤ªæ•æ„Ÿçš„ç”¨æˆ·åå¥½ã€ç½‘ç«™è®¾ç½®ã€éæ•æ„Ÿçš„æ ‡è¯†ç¬¦ç­‰ä¿¡æ¯ã€‚</li><li><strong>Session</strong> æ›´é€‚åˆä¿å­˜ç”¨æˆ·ç™»å½•çŠ¶æ€ã€è´­ç‰©è½¦ä¿¡æ¯ç­‰éœ€è¦è¾ƒé«˜å®‰å…¨æ€§çš„å†…å®¹ã€‚</li></ul><h4 id="Cookie-ä¸-Session-çš„ç»“åˆï¼š"><a href="#Cookie-ä¸-Session-çš„ç»“åˆï¼š" class="headerlink" title="Cookie ä¸ Session çš„ç»“åˆï¼š"></a><strong>Cookie ä¸ Session çš„ç»“åˆ</strong>ï¼š</h4><p>é€šå¸¸ä¼šä½¿ç”¨ <strong>Session + Cookie</strong> çš„æ–¹å¼æ¥å®ç°ç™»å½•ç­‰åŠŸèƒ½ã€‚æœåŠ¡å™¨åˆ›å»º Session å¹¶å°† Session ID å­˜æ”¾åœ¨å®¢æˆ·ç«¯çš„ Cookie ä¸­ï¼Œå®¢æˆ·ç«¯æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šæºå¸¦è¯¥ Cookieï¼ŒæœåŠ¡å™¨é€šè¿‡ Session ID è¯†åˆ«ç”¨æˆ·èº«ä»½ã€‚</p><h3 id="cookie-ç­¾å-æ ¸å¿ƒä»£ç "><a href="#cookie-ç­¾å-æ ¸å¿ƒä»£ç " class="headerlink" title="cookie ç­¾å æ ¸å¿ƒä»£ç "></a>cookie ç­¾å æ ¸å¿ƒä»£ç </h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Cookies</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Cookies</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Cookies</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> options<span class="token punctuation">)</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>secure <span class="token operator">=</span> <span class="token keyword">undefined</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>request <span class="token operator">=</span> request  <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> response  <span class="token comment">// åˆ›å»ºKeygripå®ä¾‹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// array of key strings</span>      <span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token string">'"keys" argument; provide using options &#123;"keys": [...]&#125;'</span><span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Keygrip</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>constructor <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">"Keygrip"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// any keygrip constructor to allow different versions</span>      <span class="token function">deprecate</span><span class="token punctuation">(</span><span class="token string">'"keys" argument; provide using options &#123;"keys": keygrip&#125;'</span><span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> options    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">Keygrip</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token operator">:</span> options<span class="token punctuation">.</span>keys      <span class="token keyword">this</span><span class="token punctuation">.</span>secure <span class="token operator">=</span> options<span class="token punctuation">.</span>secure    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">Cookies</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">,</span>    req <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">,</span>    headers <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Set-Cookie"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">,</span>    signed <span class="token operator">=</span> opts <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>signed <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> opts<span class="token punctuation">.</span>signed <span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>keys  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> headers <span class="token operator">==</span> <span class="token string">"string"</span><span class="token punctuation">)</span> headers <span class="token operator">=</span> <span class="token punctuation">[</span>headers<span class="token punctuation">]</span>  <span class="token function">pushCookie</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span> <span class="token comment">// ä¿å­˜å½“å‰ cookie</span>  <span class="token comment">//ç­¾å</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts <span class="token operator">&amp;&amp;</span> signed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">".keys required for signed cookies"</span><span class="token punctuation">)</span>    cookie<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// é’“é±¼ sign æ–¹æ³•ç­¾å</span>    cookie<span class="token punctuation">.</span>name <span class="token operator">+=</span> <span class="token string">".sig"</span>    <span class="token function">pushCookie</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> setHeader <span class="token operator">=</span> res<span class="token punctuation">.</span>set <span class="token operator">?</span> http<span class="token punctuation">.</span><span class="token class-name">OutgoingMessage</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>setHeader <span class="token operator">:</span> res<span class="token punctuation">.</span>setHeader  <span class="token function">setHeader</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">"Set-Cookie"</span><span class="token punctuation">,</span> headers<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getPattern</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"(?:^|;) *"</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[-[\]&#123;&#125;()*+?.,\\^$|#\s]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"\\$&amp;"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"=([^;]*)"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token class-name">Cookies</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> sigName <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">".sig"</span><span class="token punctuation">,</span>    header<span class="token punctuation">,</span>    match<span class="token punctuation">,</span>    value<span class="token punctuation">,</span>    remote<span class="token punctuation">,</span>    data<span class="token punctuation">,</span>    index<span class="token punctuation">,</span>    signed <span class="token operator">=</span> opts <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>signed <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> opts<span class="token punctuation">.</span>signed <span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>keys  header <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"cookie"</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>header<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token comment">//åŒ¹é…å¯¹åº”çš„value</span>  match <span class="token operator">=</span> header<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token function">getPattern</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">)</span> <span class="token keyword">return</span>  value <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment">// åˆ¤æ–­æ˜¯å¦éœ€è¦ç­¾å</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>opts <span class="token operator">||</span> <span class="token operator">!</span>signed<span class="token punctuation">)</span> <span class="token keyword">return</span> value  <span class="token comment">//è·å–ç­¾ååçš„ cookie</span>  remote <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>sigName<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>remote<span class="token punctuation">)</span> <span class="token keyword">return</span>  data <span class="token operator">=</span> name <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> value  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">".keys required for signed cookies"</span><span class="token punctuation">)</span>  <span class="token comment">// å¯¹æ•°æ®è¿›è¡Œå†æ¬¡ç­¾åæ¯”è¾ƒ è¿”å›ç´¢å¼•</span>  index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> remote<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç­¾åä¸åŒ¹é…çš„è¯å°±æŠŠç­¾åcoolie ç½®ä¸º null</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>sigName<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æˆåŠŸçš„è¯å†æ¬¡ç­¾å</span>    index <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>sigName<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> value  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">Cookie</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token class-name">Cookie</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toHeader</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> header <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxAge<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expires <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxAge<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token string">"; path="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>path  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expires<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token string">"; expires="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expires<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>domain<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token string">"; domain="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>domain  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sameSite<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token string">"; samesite="</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sameSite <span class="token operator">===</span> <span class="token boolean">true</span> <span class="token operator">?</span> <span class="token string">"strict"</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sameSite<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>secure<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token string">"; secure"</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>httpOnly<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token string">"; httponly"</span>  <span class="token keyword">return</span> header<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">pushCookie</span><span class="token punctuation">(</span><span class="token parameter">headers<span class="token punctuation">,</span> cookie</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>cookie<span class="token punctuation">.</span>overwrite<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> headers<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>headers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"="</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        headers<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  headers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">toHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Keygrip"><a href="#Keygrip" class="headerlink" title="Keygrip"></a>Keygrip</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/*! * keygrip * Copyright(c) 2011-2014 Jed Schmidt * MIT Licensed */</span><span class="token string">"use strict"</span><span class="token comment">// å¼•å…¥ç”¨äºå®‰å…¨å­—ç¬¦ä¸²æ¯”è¾ƒçš„tsscmpåº“</span><span class="token keyword">var</span> compare <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"tsscmp"</span><span class="token punctuation">)</span><span class="token comment">// å¼•å…¥Node.jsçš„cryptoæ¨¡å—ï¼Œç”¨äºåŠ å¯†æ“ä½œ</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"crypto"</span><span class="token punctuation">)</span><span class="token comment">// Keygripç±»ç”¨äºåˆ›å»ºåŸºäºHMACçš„ç­¾åå’ŒéªŒè¯å·¥å…·</span><span class="token comment">// keysæ˜¯ç”¨äºç­¾åçš„å¯†é’¥æ•°ç»„ï¼Œalgorithmæ˜¯åŠ å¯†ç®—æ³•ï¼Œencodingæ˜¯ç¼–ç æ–¹å¼</span><span class="token keyword">function</span> <span class="token function">Keygrip</span><span class="token punctuation">(</span><span class="token parameter">keys<span class="token punctuation">,</span> algorithm<span class="token punctuation">,</span> encoding</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šç®—æ³•ï¼Œåˆ™é»˜è®¤ä¸º"sha1"</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>algorithm<span class="token punctuation">)</span> algorithm <span class="token operator">=</span> <span class="token string">"sha1"</span>  <span class="token comment">// å¦‚æœæ²¡æœ‰æŒ‡å®šç¼–ç æ–¹å¼ï¼Œåˆ™é»˜è®¤ä¸º"base64"</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>encoding<span class="token punctuation">)</span> encoding <span class="token operator">=</span> <span class="token string">"base64"</span>  <span class="token comment">// å¦‚æœè°ƒç”¨æ—¶æ²¡æœ‰ä½¿ç”¨newå…³é”®å­—ï¼Œè‡ªåŠ¨è¿”å›æ–°å®ä¾‹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Keygrip</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Keygrip</span><span class="token punctuation">(</span>keys<span class="token punctuation">,</span> algorithm<span class="token punctuation">,</span> encoding<span class="token punctuation">)</span>  <span class="token comment">// ç¡®ä¿ä¼ å…¥çš„keysæ•°ç»„ä¸ä¸ºç©ºï¼Œå¹¶ä¸”æœ‰è‡³å°‘ä¸€ä¸ªå¯†é’¥</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>keys <span class="token operator">||</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">in</span> keys<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Keys must be provided."</span><span class="token punctuation">)</span> <span class="token comment">// å¦‚æœæœªæä¾›keysåˆ™æŠ›å‡ºé”™è¯¯</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å†…éƒ¨çš„signå‡½æ•°ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡ŒHMACç­¾å</span>  <span class="token comment">// dataæ˜¯è¦ç­¾åçš„æ•°æ®ï¼Œkeyæ˜¯ç”¨äºç­¾åçš„å¯†é’¥</span>  <span class="token keyword">function</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> crypto      <span class="token punctuation">.</span><span class="token function">createHmac</span><span class="token punctuation">(</span>algorithm<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨æŒ‡å®šçš„ç®—æ³•å’Œå¯†é’¥åˆ›å»ºHMACå¯¹è±¡</span>      <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">// ç”¨æ•°æ®æ›´æ–°HMACå¯¹è±¡</span>      <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span>encoding<span class="token punctuation">)</span> <span class="token comment">// ç”ŸæˆHMACçš„æ‘˜è¦ï¼ŒæŒ‰æŒ‡å®šç¼–ç è¿”å›</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/|\+|=</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å°†ç”Ÿæˆçš„ç­¾åä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæ›¿æ¢</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">"/"</span><span class="token operator">:</span> <span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string-property property">"+"</span><span class="token operator">:</span> <span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string-property property">"="</span><span class="token operator">:</span> <span class="token string">""</span> <span class="token punctuation">&#125;</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token comment">// "/"æ›¿æ¢ä¸º"_"ï¼Œ"+"æ›¿æ¢ä¸º"-"ï¼Œ"="å»æ‰</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å¯¹å¤–æš´éœ²çš„ç­¾åæ–¹æ³•ï¼Œé»˜è®¤ä½¿ç”¨keysæ•°ç»„çš„ç¬¬ä¸€ä¸ªå¯†é’¥</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sign</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">sign</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> keys<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨ç¬¬ä¸€ä¸ªå¯†é’¥å¯¹æ•°æ®ç­¾å</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// verifyæ–¹æ³•ï¼Œç”¨äºéªŒè¯æ•°æ®å’Œå…¶ç­¾åæ˜¯å¦åŒ¹é…</span>  <span class="token comment">// dataæ˜¯åŸå§‹æ•°æ®ï¼Œdigestæ˜¯å¾…éªŒè¯çš„ç­¾å</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">verify</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> digest</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> digest<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">// å¦‚æœæ•°æ®çš„ç­¾ååŒ¹é…keysæ•°ç»„ä¸­çš„ä»»ä¸€å¯†é’¥ï¼Œåˆ™è¿”å›true</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// indexæ–¹æ³•ï¼Œç”¨äºæŸ¥æ‰¾åŒ¹é…çš„æ•°æ®ç­¾åçš„å¯†é’¥ç´¢å¼•</span>  <span class="token comment">// è¿”å›åŒ¹é…å¯†é’¥çš„ç´¢å¼•ï¼Œè‹¥æ‰¾ä¸åˆ°åˆ™è¿”å›-1</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">index</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> digest</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// éå†æ‰€æœ‰keysï¼Œç”¨æ¯ä¸€ä¸ªkeyè¿›è¡Œç­¾åï¼Œç„¶åå’Œä¼ å…¥çš„digestè¿›è¡Œæ¯”è¾ƒ</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ä½¿ç”¨tsscmpåº“è¿›è¡Œå®‰å…¨æ¯”è¾ƒï¼Œé˜²æ­¢æ—¶é—´æ”»å‡»</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">compare</span><span class="token punctuation">(</span>digest<span class="token punctuation">,</span> <span class="token function">sign</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> i <span class="token comment">// å¦‚æœæ‰¾åˆ°åŒ¹é…çš„ç­¾åï¼Œè¿”å›è¯¥å¯†é’¥çš„ç´¢å¼•</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å¯†é’¥ï¼Œè¿”å›-1</span>    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// é˜²æ­¢ç”¨æˆ·ç›´æ¥è°ƒç”¨Keygripçš„ç±»æ–¹æ³•ï¼ˆsignã€verifyã€indexï¼‰ï¼Œæç¤ºæ­£ç¡®ç”¨æ³•</span>Keygrip<span class="token punctuation">.</span>sign <span class="token operator">=</span>  Keygrip<span class="token punctuation">.</span>verify <span class="token operator">=</span>  Keygrip<span class="token punctuation">.</span><span class="token function-variable function">index</span> <span class="token operator">=</span>    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Usage: require('keygrip')(&lt;array-of-keys>)"</span><span class="token punctuation">)</span> <span class="token comment">// æŠ›å‡ºé”™è¯¯ï¼Œæç¤ºæ­£ç¡®ç”¨æ³•</span>    <span class="token punctuation">&#125;</span><span class="token comment">// å¯¼å‡ºKeygripæ¨¡å—ï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Keygrip<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Cookie-ç­¾åçš„æ ¸å¿ƒè¿‡ç¨‹æ€»ç»“"><a href="#Cookie-ç­¾åçš„æ ¸å¿ƒè¿‡ç¨‹æ€»ç»“" class="headerlink" title="Cookie ç­¾åçš„æ ¸å¿ƒè¿‡ç¨‹æ€»ç»“"></a>Cookie ç­¾åçš„æ ¸å¿ƒè¿‡ç¨‹æ€»ç»“</h4><ol><li><strong>åˆå§‹åŒ–<code>Keygrip</code>å®ä¾‹</strong>ï¼š<ul><li><code>Cookies</code>ç±»åœ¨åˆå§‹åŒ–æ—¶ï¼Œä¼šæ ¹æ®ä¼ å…¥çš„<code>options</code>åˆ›å»ºä¸€ä¸ª<code>Keygrip</code>å®ä¾‹ï¼Œç”¨äºå¯¹ cookie è¿›è¡Œç­¾åå’ŒéªŒè¯ã€‚å¦‚æœ<code>options</code>ä¸­åŒ…å«<code>keys</code>æ•°ç»„ï¼Œåˆ™ä½¿ç”¨è¯¥æ•°ç»„åˆå§‹åŒ–<code>Keygrip</code>ï¼›å¦‚æœ<code>options</code>å·²ç»æ˜¯<code>Keygrip</code>å®ä¾‹ï¼Œç›´æ¥ä½¿ç”¨è¯¥å®ä¾‹ã€‚</li></ul></li><li>**è®¾ç½® Cookie æ—¶çš„ç­¾åæµç¨‹ (<code>set</code>æ–¹æ³•)**ï¼š<ul><li>å½“é€šè¿‡<code>set</code>æ–¹æ³•è®¾ç½® Cookie æ—¶ï¼Œå…ˆå°† Cookie æ·»åŠ åˆ°<code>Set-Cookie</code>å“åº”å¤´ä¸­ã€‚</li><li>å¦‚æœ<code>signed</code>é€‰é¡¹è¢«å¯ç”¨ï¼Œç³»ç»Ÿä¼šå¯¹ Cookie çš„å€¼è¿›è¡Œç­¾åã€‚ç­¾åè¿‡ç¨‹é€šè¿‡è°ƒç”¨<code>Keygrip</code>å®ä¾‹çš„<code>sign</code>æ–¹æ³•å®ç°ï¼Œå°†ç”Ÿæˆçš„ç­¾åæ·»åŠ åˆ°æ–°çš„ Cookie é¡¹ä¸­ï¼ˆåç§°ä¸º<code>cookieName.sig</code>ï¼‰ã€‚</li><li>ç­¾åçš„åŸç†æ˜¯ä½¿ç”¨ HMAC åŠ å¯†ç®—æ³•ï¼ˆé»˜è®¤æ˜¯<code>SHA1</code>ï¼‰å¯¹ Cookie æ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç†ï¼Œç”Ÿæˆç­¾åã€‚æ­¤ç­¾åç¡®ä¿ Cookie å€¼æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚</li></ul></li><li>**è·å– Cookie æ—¶çš„ç­¾åéªŒè¯ (<code>get</code>æ–¹æ³•)**ï¼š<ul><li>é€šè¿‡<code>get</code>æ–¹æ³•è·å– Cookie æ—¶ï¼Œé¦–å…ˆåŒ¹é…è¯·æ±‚å¤´ä¸­çš„<code>cookie</code>å­—æ®µï¼ŒæŸ¥æ‰¾ç‰¹å®š Cookie çš„å€¼ã€‚</li><li>å¦‚æœè¯¥ Cookie æ˜¯ç­¾åçš„ï¼Œç³»ç»Ÿä¼šæŸ¥æ‰¾å¯¹åº”çš„ç­¾å Cookieï¼ˆåç§°ä¸º<code>cookieName.sig</code>ï¼‰ï¼Œå¹¶ä½¿ç”¨<code>Keygrip</code>å®ä¾‹çš„<code>index</code>æ–¹æ³•éªŒè¯è¯¥ç­¾åæ˜¯å¦åˆæ³•ã€‚</li><li>éªŒè¯æ—¶ï¼Œä¼šé‡æ–°å¯¹ Cookie çš„æ•°æ®è¿›è¡Œç­¾åï¼Œå¹¶ä¸å®¢æˆ·ç«¯ä¼ å›çš„ç­¾åè¿›è¡Œæ¯”è¾ƒã€‚è‹¥åŒ¹é…æˆåŠŸï¼Œåˆ™è¡¨ç¤ºè¯¥ Cookie æ²¡æœ‰è¢«ç¯¡æ”¹ï¼Œè¿”å› Cookie å€¼ï¼›å¦åˆ™å°†ç­¾åçš„ Cookie å€¼ç½®ä¸º<code>null</code>ã€‚</li></ul></li><li>**ç­¾åä¸éªŒè¯çš„å…·ä½“å®ç° (<code>Keygrip</code> ç±»)**ï¼š<ul><li><code>Keygrip</code>ä½¿ç”¨ HMAC ç®—æ³•å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œå¹¶é€šè¿‡<code>compare</code>åº“æ¥è¿›è¡Œå®‰å…¨æ¯”è¾ƒï¼Œé˜²æ­¢æ—¶é—´æ”»å‡»ã€‚</li><li><code>sign</code>æ–¹æ³•ç”¨äºå¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œå¹¶å°†ç”Ÿæˆçš„æ‘˜è¦è¿›è¡Œç¼–ç å¤„ç†ã€‚</li><li><code>verify</code>æ–¹æ³•ç”¨äºéªŒè¯ç­¾åï¼Œé€šè¿‡éå†å¯†é’¥æ•°ç»„å¯¹æ•°æ®è¿›è¡Œç­¾åï¼Œæ£€æŸ¥æ˜¯å¦æœ‰åŒ¹é…çš„å¯†é’¥ã€‚</li><li><code>index</code>æ–¹æ³•ç”¨äºè¿”å›åŒ¹é…çš„å¯†é’¥ç´¢å¼•ï¼Œè‹¥æ‰¾åˆ°åŒ¹é…çš„ç­¾ååˆ™è¿”å›å¯†é’¥çš„ä½ç½®ï¼Œå¦åˆ™è¿”å›<code>-1</code>ã€‚</li></ul></li></ol><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æ•´ä¸ªè¿‡ç¨‹çš„æ ¸å¿ƒæ˜¯é€šè¿‡ HMAC ç­¾åå’ŒéªŒè¯æœºåˆ¶ä¿è¯ Cookie çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚åœ¨è®¾ç½® Cookie æ—¶ä¼šç”Ÿæˆä¸€ä¸ªåŸºäºå¯†é’¥çš„ç­¾åï¼Œå¹¶å°†å…¶é™„åŠ åˆ° Cookie å“åº”ä¸­ã€‚åœ¨å®¢æˆ·ç«¯è¿”å› Cookie æ—¶ï¼Œé€šè¿‡éªŒè¯ç­¾åï¼Œç¡®ä¿ Cookie çš„å€¼æœªè¢«ç¯¡æ”¹ã€‚å¦‚æœç­¾åä¸åŒ¹é…ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ é™¤è¯¥ç­¾åçš„ Cookie</p>]]></content>
      
      
      
        <tags>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>koaåº•å±‚å®ç°</title>
      <link href="/2024/09/26/koa-di-ceng-shi-xian/"/>
      <url>/2024/09/26/koa-di-ceng-shi-xian/</url>
      
        <content type="html"><![CDATA[<h2 id="1-Koa"><a href="#1-Koa" class="headerlink" title="1.Koa"></a>1.Koa</h2><ul><li><a href="https://koajs.com/">Koa</a>æ˜¯ä¸€ä¸ªç”± Express åŸç­äººé©¬æ‰“é€ çš„ï¼Œå°è¯•åœ¨ Web åº”ç”¨å¼€å‘ä¸­æ‘†è„±å›è°ƒåœ°ç‹±ï¼Œå¹¶å¢å¼ºé”™è¯¯å¤„ç†çš„è½»é‡åŒ–çš„ Node.js æ¡†æ¶ã€‚</li><li><a href="https://koa.bootcss.com/">Koa</a>çš„ç›®æ ‡æ˜¯æˆä¸ºä¸€ä¸ªæ›´å°ã€æ›´å¯Œè¡¨ç°åŠ›ã€æ›´å¥å£®çš„ Web æ¡†æ¶ã€‚</li></ul><h2 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2.å®‰è£…"></a>2.å®‰è£…</h2><p>Koa éœ€è¦ Node v12 æˆ–æ›´é«˜ç‰ˆæœ¬ä»¥æ”¯æŒ ES2015 å’Œå¼‚æ­¥å‡½æ•°ã€‚ æ‚¨å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„ç‰ˆæœ¬ç®¡ç†å™¨å¿«é€Ÿå®‰è£…ä¸€ä¸ªæ”¯æŒçš„ Node ç‰ˆæœ¬ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nvm <span class="token function">install</span> <span class="token number">12</span><span class="token function">npm</span> <span class="token function">install</span> koa<span class="token function">node</span> my-koa-app.js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="3-åŸºæœ¬ä½¿ç”¨"><a href="#3-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="3.åŸºæœ¬ä½¿ç”¨"></a>3.åŸºæœ¬ä½¿ç”¨</h2><p>Koa åº”ç”¨æ˜¯ä¸€ä¸ªåŒ…å«ä¸­é—´ä»¶å‡½æ•°æ•°ç»„çš„å¯¹è±¡ï¼Œè¿™äº›å‡½æ•°åœ¨è¯·æ±‚æ—¶ä»¥ç±»ä¼¼å †æ ˆçš„æ–¹å¼ç»„åˆå¹¶æ‰§è¡Œ</p><p>åœ¨ Koa æ¡†æ¶ä¸­ï¼Œ<code>ctx</code> æ˜¯ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œå®ƒå°è£…äº†åŸç”Ÿçš„ Node.js è¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼Œå¹¶ä¸”æä¾›äº†è®¸å¤šæ–¹ä¾¿çš„æ–¹æ³•å’Œå±æ€§æ¥å¤„ç† HTTP è¯·æ±‚å’Œå“åº”</p><p><code>ctx.req</code> å’Œ <code>ctx.res</code> æ˜¯ Node.js çš„åŸç”Ÿè¯·æ±‚å’Œå“åº”å¯¹è±¡ã€‚è¿™äº›å¯¹è±¡æä¾›äº†ä½çº§åˆ«çš„è¯·æ±‚å’Œå“åº”å¤„ç†æ–¹æ³•</p><p><code>ctx.res.end(&#39;ok&#39;)</code> æ˜¯ç›´æ¥è°ƒç”¨ Node.js åŸç”Ÿå“åº”å¯¹è±¡çš„ <code>end</code> æ–¹æ³•æ¥ç»“æŸå“åº”å¹¶å‘é€å­—ç¬¦ä¸² <code>ok</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">"koa"</span><span class="token comment">// åˆ›å»ºä¸€ä¸ªKoaåº”ç”¨å®ä¾‹</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¤„ç†è¯·æ±‚ï¼Œè¿”å›'hello'</span>  ctx<span class="token punctuation">.</span>res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// ç›‘å¬3000ç«¯å£ï¼Œå¹¶åœ¨æ§åˆ¶å°æ‰“å°æœåŠ¡å™¨è¿è¡Œä¿¡æ¯</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://localhost:3000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-request-amp-response"><a href="#4-request-amp-response" class="headerlink" title="4.request&amp;response"></a>4.request&amp;response</h2><p>åœ¨ Koa ä¸­ï¼Œ<code>ctx.request</code> å’Œ <code>ctx.response</code> æ˜¯å°è£…äº† Node.js åŸç”Ÿè¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼ˆ<code>ctx.req</code> å’Œ <code>ctx.res</code>ï¼‰çš„å¯¹è±¡ã€‚ç›¸æ¯”äº Node.js çš„åŸç”Ÿè¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼Œ<code>ctx.request</code> å’Œ <code>ctx.response</code> æä¾›äº†æ›´å¤šçš„æ–¹æ³•å’Œå±æ€§ï¼Œä½¿å¾—å¤„ç† HTTP è¯·æ±‚å’Œå“åº”æ›´åŠ æ–¹ä¾¿å’Œç®€å•ã€‚</p><ul><li><p><code>ctx.request</code>:</p><ul><li><code>ctx.request.query</code>: ä¸€ä¸ªåŒ…å«è§£æè¿‡çš„æŸ¥è¯¢å­—ç¬¦ä¸²çš„å¯¹è±¡</li><li><code>ctx.request.method</code>: è¯·æ±‚æ–¹æ³•ï¼Œä¾‹å¦‚ â€˜GETâ€™, â€˜POSTâ€™ ç­‰</li><li><code>ctx.request.url</code>: è¯·æ±‚çš„ URL</li><li><code>ctx.request.header</code>: è¯·æ±‚å¤´å¯¹è±¡</li><li><code>ctx.request.body</code>: è¯·æ±‚ä½“ï¼ˆéœ€è¦é¢å¤–çš„ä¸­é—´ä»¶å¦‚ koa-bodyparser æ¥è§£æè¯·æ±‚ä½“ï¼‰</li></ul></li><li><p><code>ctx.response</code> :</p><ul><li><code>ctx.response.body</code>: å¯ä»¥è®¾ç½®å“åº”ä½“çš„å†…å®¹ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€å¯¹è±¡æˆ–è€…æµ</li><li><code>ctx.response.status</code>: å¯ä»¥è®¾ç½®å“åº”çš„ HTTP çŠ¶æ€ç </li><li><code>ctx.response.message</code>: HTTP çŠ¶æ€æ¶ˆæ¯</li><li><code>ctx.response.header</code>: å“åº”å¤´å¯¹è±¡</li></ul></li></ul><p><strong>1.server</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">"koa"</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ‰“å°è¯·æ±‚æ–¹æ³•</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>method<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°è¯·æ±‚URL</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°è¯·æ±‚è·¯å¾„</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>query<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°è¯·æ±‚å¤´</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>header<span class="token punctuation">)</span>  <span class="token comment">// è®¾ç½®å“åº”çŠ¶æ€ç </span>  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>  <span class="token comment">// è®¾ç½®å“åº”æ¶ˆæ¯</span>  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">"OK"</span>  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span>  <span class="token comment">// è®¾ç½®å“åº”ä½“</span>  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"hello"</span>  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"world"</span>  ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"third"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"app runing http://localhost:3000"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>2.server.js</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa"</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ‰“å°è¯·æ±‚æ–¹æ³•</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°è¯·æ±‚URL</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°è¯·æ±‚è·¯å¾„</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°æŸ¥è¯¢å­—ç¬¦ä¸²å‚æ•°</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">)</span>  <span class="token comment">// æ‰“å°è¯·æ±‚å¤´</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>header<span class="token punctuation">)</span>  <span class="token comment">// è®¾ç½®å“åº”çŠ¶æ€ç </span>  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span>  <span class="token comment">// è®¾ç½®å“åº”æ¶ˆæ¯</span>  ctx<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">"OK"</span>  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/html;charset=utf-8"</span><span class="token punctuation">)</span>  <span class="token comment">// è®¾ç½®å“åº”ä½“</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"hello"</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"world"</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"third"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3001</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"app runing http://localhost:3001"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-ä¸­é—´ä»¶çº§è”"><a href="#5-ä¸­é—´ä»¶çº§è”" class="headerlink" title="5.ä¸­é—´ä»¶çº§è”"></a>5.ä¸­é—´ä»¶çº§è”</h2><h3 id="5-1-åŒæ­¥ä¸­é—´ä»¶"><a href="#5-1-åŒæ­¥ä¸­é—´ä»¶" class="headerlink" title="5.1 åŒæ­¥ä¸­é—´ä»¶"></a>5.1 åŒæ­¥ä¸­é—´ä»¶</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa"</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">middleware1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">middleware2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">middleware3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware1<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware2<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware3<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://localhost:3000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-2-å¼‚æ­¥ä¸­é—´ä»¶"><a href="#5-2-å¼‚æ­¥ä¸­é—´ä»¶" class="headerlink" title="5.2 å¼‚æ­¥ä¸­é—´ä»¶"></a>5.2 å¼‚æ­¥ä¸­é—´ä»¶</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa"</span><span class="token punctuation">)</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">middleware1</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"cost"</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"cost"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">middleware2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"middleware2 sleep 1s"</span><span class="token punctuation">)</span>      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">middleware3</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"middleware3 sleep 1s"</span><span class="token punctuation">)</span>      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"hello"</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware1<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware2<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware3<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server is running at http://localhost:3000"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-æ ¸å¿ƒå®ç°"><a href="#6-æ ¸å¿ƒå®ç°" class="headerlink" title="6. æ ¸å¿ƒå®ç°"></a>6. æ ¸å¿ƒå®ç°</h2><h3 id="6-1application"><a href="#6-1application" class="headerlink" title="6.1application"></a>6.1application</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">"events"</span><span class="token keyword">import</span> http <span class="token keyword">from</span> <span class="token string">"http"</span><span class="token keyword">import</span> context <span class="token keyword">from</span> <span class="token string">"./context.js"</span><span class="token comment">// å¯¼å…¥è‡ªå®šä¹‰çš„requestæ¨¡å—</span><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">"./request.js"</span><span class="token comment">// å¯¼å…¥è‡ªå®šä¹‰çš„responseæ¨¡å—</span><span class="token keyword">import</span> response <span class="token keyword">from</span> <span class="token string">"./response.js"</span><span class="token keyword">import</span> compose <span class="token keyword">from</span> <span class="token string">"./koa-compose.js"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>request <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>middleware <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//å­˜å‚¨ä¸­é—´ä»¶</span>  <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token keyword">this</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆ›å»ºæœåŠ¡</span>  <span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//è¯·æ±‚åˆ°æ¥æ—¶å€™çš„å›è°ƒå‡½æ•°</span>  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç»„åˆä¸­é—´ä»¶</span>    <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>middleware<span class="token punctuation">)</span>    <span class="token keyword">const</span> <span class="token function-variable function">handleRequest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">//åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡</span>      <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> fn<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> handleRequest  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¯·æ±‚å›è°ƒ</span>  <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> fnMiddleware</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token function-variable function">handleResponse</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">respond</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>    <span class="token keyword">const</span> <span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> ctx<span class="token punctuation">.</span><span class="token function">onerror</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    <span class="token comment">// æ‰§è¡Œä¸­é—´ä»¶ åŒ…è£…ä¸º Promise æ‰§è¡Œå®Œæˆåå“åº” body</span>    <span class="token keyword">return</span> <span class="token function">fnMiddleware</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleResponse<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>onerror<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡</span>    <span class="token keyword">const</span> context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">)</span>    <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„requestå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªthis.requestï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡èµ‹å€¼ç»™context.request</span>    <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>request <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„responseå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ç»§æ‰¿è‡ªthis.responseï¼Œå¹¶å°†è¿™ä¸ªå¯¹è±¡èµ‹å€¼ç»™context.response</span>    <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>response <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span>    context<span class="token punctuation">.</span>req <span class="token operator">=</span> request<span class="token punctuation">.</span>req <span class="token operator">=</span> req    context<span class="token punctuation">.</span>res <span class="token operator">=</span> response<span class="token punctuation">.</span>res <span class="token operator">=</span> res    <span class="token comment">//è¿”å›ä¸Šä¸‹æ–‡å¯¹è±¡</span>    <span class="token keyword">return</span> context  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å“åº” body</span><span class="token keyword">function</span> <span class="token function">respond</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> res<span class="token punctuation">,</span> body <span class="token punctuation">&#125;</span> <span class="token operator">=</span> ctx  <span class="token keyword">if</span> <span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> body <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">Stream</span><span class="token punctuation">)</span> <span class="token keyword">return</span> body<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> EventEmitter <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-request"><a href="#6-2-request" class="headerlink" title="6.2 request"></a>6.2 request</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> parse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"parseurl"</span><span class="token punctuation">)</span><span class="token keyword">const</span> qs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"querystring"</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">get</span> <span class="token function">url</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">.</span>url  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">path</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æŠŠurlè·¯å¾„è½¬æˆå¯¹è±¡ï¼Œpathnameæ˜¯å®ƒçš„è·¯å¾„å /a/b å‚æ•°req: IncomingMessage</span>    <span class="token keyword">return</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span>pathname  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">.</span>method  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">//æŸ¥è¯¢å­—ç¬¦ä¸²ï¼Œå®ƒçš„æ ¼å¼æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² ?a=1&amp;b=2</span>  <span class="token keyword">get</span> <span class="token function">querystring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">)</span><span class="token punctuation">.</span>query  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">//å®ƒä¼šè°ƒç”¨qs.parseæ–¹æ³•æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²ä»å­—ç¬¦ä¸²è½¬æˆå¯¹è±¡</span>  <span class="token keyword">get</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> qs<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>querystring<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">header</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">.</span>headers  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>header  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-3response"><a href="#6-3response" class="headerlink" title="6.3response"></a>6.3response</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//è®¾ç½®çŠ¶æ€ç    response.status = 200;</span>  <span class="token keyword">set</span> <span class="token function">status</span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æŠŠçŠ¶æ€ç codeé€ä¼ ç»™åŸç”Ÿçš„reså“åº”å¯¹è±¡</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> code  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">set</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç»™å“åº”çŠ¶æ€ç çš„åŸå› çŸ­è¯­èµ‹å€¼</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>res<span class="token punctuation">.</span>statusMessage <span class="token operator">=</span> msg  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">set</span> <span class="token function">body</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å½“è°ƒç”¨response.body = xxxçš„æ—¶å€™ï¼Œä¼šæŠŠxxxæš‚å­˜åˆ°response._bodyä¸Š</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_body <span class="token operator">=</span> value    <span class="token comment">//ä¸€æ—¦è°ƒç”¨äº†res.endæ–¹æ³•ï¼Œåˆ™ä¸èƒ½å†æ¬¡å†™å…¥å“åº”äº†</span>    <span class="token comment">//this.res.end(value);</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_body  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">//setç”¨æ¥è®¾ç½®å“åº”å¤´</span>  <span class="token function">set</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è°ƒç”¨åŸç”Ÿçš„å“åº”å¯¹è±¡çš„setHeaderæ–¹æ³•ï¼Œè®¾ç½®å­—ç¬¦å’Œå€¼</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> value<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-4-context"><a href="#6-4-context" class="headerlink" title="6.4 context"></a>6.4 context</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> delegate <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./delegates"</span><span class="token punctuation">)</span><span class="token comment">//åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡å¹¶å°†å…¶å¯¼å‡º</span><span class="token keyword">const</span> proto <span class="token operator">=</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">onerror</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> res <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">500</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>message<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">//ä½¿ç”¨ä»£ç†æ¨¡å—å°†protoå¯¹è±¡çš„ä¸€äº›å±æ€§ä»£ç†åˆ°requestå¯¹è±¡ä¸Š  proto.url=>proto.request.url</span><span class="token function">delegate</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> <span class="token string">"request"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">)</span> <span class="token comment">//å°†requestå¯¹è±¡ä¸Šmethodå±æ€§ä»£ç†åˆ°protoå¯¹è±¡ä¸Š accessèƒ½è¯»åˆèƒ½å†™</span>  <span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"query"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">(</span><span class="token string">"header"</span><span class="token punctuation">)</span> <span class="token comment">//åªèƒ½è¯»ä¸èƒ½å†™</span><span class="token comment">//ä½¿ç”¨ä»£ç†æ¨¡å—å°†protoå¯¹è±¡çš„ä¸€äº›å±æ€§ä»£ç†åˆ°responseå¯¹è±¡ä¸Š  proto.body=>proto.response.body</span><span class="token function">delegate</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> <span class="token string">"response"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"status"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span> <span class="token comment">//å°†responseå¯¹è±¡ä¸Šçš„setæ–¹æ³•ä»£ç†åˆ°protoå¯¹è±¡ä¸Š</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-5delegates"><a href="#6-5delegates" class="headerlink" title="6.5delegates"></a>6.5delegates</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Delegator</span><span class="token punctuation">(</span><span class="token parameter">proto<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Delegator</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Delegator</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>proto <span class="token operator">=</span> proto  <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">&#125;</span><span class="token class-name">Delegator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> proto<span class="token punctuation">,</span> target <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span class="token class-name">Delegator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> proto<span class="token punctuation">,</span> target <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>proto<span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token function">set</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> val    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span class="token class-name">Delegator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">access</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token class-name">Delegator</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">method</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> proto<span class="token punctuation">,</span> target <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span>  proto<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span>target<span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Delegator<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-6-Koa-compose"><a href="#6-6-Koa-compose" class="headerlink" title="6.6 Koa-compose"></a>6.6 Koa-compose</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * ç»„åˆä¸­é—´ä»¶å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯ä»¥å¤„ç†ä¸Šä¸‹æ–‡çš„å‡½æ•° * * @param &#123;Array&#125; middleware - ä¸­é—´ä»¶å‡½æ•°æ•°ç»„ * @returns &#123;Function&#125; å¤„ç†ä¸Šä¸‹æ–‡çš„å‡½æ•° */</span><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter">middleware</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªcontextå‚æ•°</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token comment">// å®šä¹‰ä¸€ä¸ªdispatchå‡½æ•°ï¼Œç”¨äºæ§åˆ¶ä¸­é—´ä»¶çš„æ‰§è¡Œé¡ºåº</span>    <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¦‚æœå·²ç»æ‰§è¡Œè¿‡dispatch(i)ï¼Œåˆ™è¿”å›ä¸€ä¸ªé”™è¯¯</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"next() called multiple times"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token comment">// æ›´æ–°indexçš„å€¼</span>      index <span class="token operator">=</span> i      <span class="token comment">// è·å–å½“å‰ä¸­é—´ä»¶å‡½æ•°</span>      <span class="token keyword">let</span> fn <span class="token operator">=</span> middleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token comment">// å¦‚æœä¸­é—´ä»¶å‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ä¸€ä¸ªå·²è§£å†³çš„Promise</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ‰§è¡Œä¸­é—´ä»¶å‡½æ•°ï¼Œå¹¶ä¼ å…¥contextå’Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶å‡½æ•°</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¼€å§‹æ‰§è¡Œä¸­é—´ä»¶å‡½æ•°</span>    <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> compose<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-7-cookie-çš„è®¾ç½®å’Œè·å–"><a href="#6-7-cookie-çš„è®¾ç½®å’Œè·å–" class="headerlink" title="6.7 cookie çš„è®¾ç½®å’Œè·å–"></a>6.7 cookie çš„è®¾ç½®å’Œè·å–</h3><p>context.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Cookies <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"cookies"</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token constant">COOKIES</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"context#cookies"</span><span class="token punctuation">)</span><span class="token keyword">const</span> proto <span class="token operator">=</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ........</span>  <span class="token keyword">get</span> <span class="token function">cookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token constant">COOKIES</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token constant">COOKIES</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookies</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>res<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">keys</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>keys<span class="token punctuation">,</span>        <span class="token literal-property property">secure</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>request<span class="token punctuation">.</span>secure<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token constant">COOKIES</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">set</span> <span class="token function">cookies</span><span class="token punctuation">(</span><span class="token parameter">_cookies</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token constant">COOKIES</span><span class="token punctuation">]</span> <span class="token operator">=</span> _cookies  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">//........</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>cookies.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Cookies</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>req <span class="token operator">=</span> req  <span class="token keyword">this</span><span class="token punctuation">.</span>res <span class="token operator">=</span> res<span class="token punctuation">&#125;</span><span class="token comment">//ç”¨æ¥å†™cookie,é€šè¿‡å“åº”å¤´çš„Set-Cookie</span><span class="token comment">//Set-Cookie:name=name_value; path=/; httponly æ¯ä¸ªset-cookieåªèƒ½å†™å…¥ä¸€ä¸ªcookie</span><span class="token class-name">Cookies</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">set</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//è·å–å“åº”å¤´ä¸­çš„Set-Cookieçš„å€¼</span>  <span class="token keyword">const</span> headers <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>res<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"Set-Cookie"</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">//æ ¹æ®nameå’Œvalueåˆ›å»ºä¸€ä¸ªæ–°çš„cookie</span>  <span class="token keyword">let</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span>  <span class="token comment">//æŠŠæ–°çš„cookieåŠ å…¥åˆ°æ•°ç»„ä¸­</span>  headers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cookie<span class="token punctuation">.</span><span class="token function">toHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//å†™å›å“åº”å¤´</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Set-Cookie"</span><span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//ç”¨æ¥è¯»cookie,é€šè¿‡è¯·æ±‚å¤´ä¸­cookie</span><span class="token comment">//è¯·æ±‚å¤´ Cookie:name=zhufeng; age=18</span><span class="token class-name">Cookies</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//name=name_domain</span>  <span class="token comment">//è·å–å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„cookie</span>  <span class="token keyword">let</span> cookie <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>cookie <span class="token operator">||</span> <span class="token string">""</span>  <span class="token keyword">return</span> <span class="token function">getValueFromHeader</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> cookie<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getValueFromHeader</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> cookie</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//å¦‚æœå®¢æˆ·ç«¯æ ¹æœ¬æ²¡æœ‰ä¼ cookieè¿‡æ¥ï¼Œä¸ç”¨æ‰¾äº†ï¼Œç›´æ¥è¿”å›</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cookie<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token comment">//name=name_value; name_domain=; name_path=name_path_value</span>  <span class="token keyword">let</span> regexp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"(?:^|;) *"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"=([^;]*)"</span><span class="token punctuation">)</span> <span class="token comment">//name_domain=([^;]*)</span>  <span class="token keyword">let</span> match <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regexp<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> match<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Cookie</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> attrs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value  <span class="token comment">//æŠŠç”¨æˆ·ä¼ è¿‡æ¥çš„cookieé€‰é¡¹å­˜æ”¾åˆ°cookieç±»çš„å®ä¾‹ä¸Šç­‰å¾…è¢«ä½¿ç”¨ path httpOnly</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> attrs<span class="token punctuation">[</span>name<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">Cookie</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">&#125;</span><span class="token class-name">Cookie</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toHeader</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> header <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>path<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">; path=</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>path  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>maxAge<span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expires <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>maxAge<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>expires<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">; expires=</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>expires<span class="token punctuation">.</span><span class="token function">toUTCString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>domain<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">; domain=</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>domain  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>httpOnly<span class="token punctuation">)</span> header <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">; httpOnly</span><span class="token template-punctuation string">`</span></span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span>  <span class="token keyword">return</span> header<span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Cookies<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„ ï¼š</strong> å¯ä»¥å¯¹ cookie è¿›è¡Œç­¾å</p><p>æºç è¯·çœ‹ï¼š<a href="https://www.npmjs.com/package/cookies?activeTab=code">https://www.npmjs.com/package/cookies?activeTab=code</a></p><h2 id="7-å¸¸è§ä¸­é—´ä»¶çš„ä½¿ç”¨"><a href="#7-å¸¸è§ä¸­é—´ä»¶çš„ä½¿ç”¨" class="headerlink" title="7. å¸¸è§ä¸­é—´ä»¶çš„ä½¿ç”¨"></a>7. å¸¸è§ä¸­é—´ä»¶çš„ä½¿ç”¨</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> fileURLToPath <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"url"</span><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">"koa-static"</span><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">"koa-router"</span><span class="token keyword">import</span> bodyParser <span class="token keyword">from</span> <span class="token string">"koa-bodyparser"</span><span class="token keyword">import</span> views <span class="token keyword">from</span> <span class="token string">"koa-views"</span><span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">"koa"</span><span class="token keyword">import</span> multer <span class="token keyword">from</span> <span class="token string">"@koa/multer"</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// æ¨¡æ‹Ÿ __dirname</span><span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token keyword">const</span> __dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span><span class="token comment">// é…ç½® multerï¼Œç”¨äºå¤„ç† multipart/form-dataï¼ˆæ–‡ä»¶ä¸Šä¼ ï¼‰</span><span class="token keyword">const</span> upload <span class="token operator">=</span> <span class="token function">multer</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">dest</span><span class="token operator">:</span> <span class="token string">"uploads/"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// 1. æä¾›é™æ€èµ„æºæœåŠ¡</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"public"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 2. ä½¿ç”¨ bodyparser è§£æè¯·æ±‚ä½“</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ctx.request.body = è¯·æ±‚ä½“</span><span class="token comment">// 3. è®°å½•è®¿é—®çš„æ—¶é—´</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span>  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">timeEnd</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// 4. é”™è¯¯æ•è·</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>    ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span>    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"Internal Server Error"</span> <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// 5. è®¾ç½®æ¨¡æ¿å¼•æ“</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>  <span class="token function">views</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"views"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">extension</span><span class="token operator">:</span> <span class="token string">"ejs"</span><span class="token punctuation">,</span> <span class="token comment">// ç¡®ä¿æ¸²æŸ“å¼•æ“ä¸º ejs</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// 6. ä½¿ç”¨è·¯ç”±ç³»ç»Ÿ</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// æ¨èï¼šå…è®¸ HTTP æ–¹æ³•æ§åˆ¶</span><span class="token comment">// ä¸Šä¼ æ–‡ä»¶çš„è·¯ç”±ï¼ŒåŒæ—¶ä¼ é€’å‚æ•°</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> upload<span class="token punctuation">.</span><span class="token function">array</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> files <span class="token operator">=</span> ctx<span class="token punctuation">.</span>files <span class="token comment">// è·å–ä¸Šä¼ çš„æ–‡ä»¶</span>  <span class="token keyword">const</span> params <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body <span class="token comment">// è·å–è¡¨å•å‚æ•°</span>  <span class="token comment">// console.dir("file=>", file.filename)</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">"File uploaded successfully"</span><span class="token punctuation">,</span>    <span class="token literal-property property">fileDetails</span><span class="token operator">:</span> files<span class="token punctuation">,</span>    <span class="token literal-property property">formData</span><span class="token operator">:</span> params<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"zs"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// å¯åŠ¨æœåŠ¡å™¨</span>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Server started on http://localhost:3000"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-koa-router"><a href="#1-koa-router" class="headerlink" title="1. koa-router"></a>1. <strong><code>koa-router</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºå¤„ç†è·¯ç”±ã€‚å…è®¸å®šä¹‰è·¯å¾„å’Œå¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼Œå¦‚ GETã€POST ç­‰ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šåˆ›å»º API æ—¶è¿›è¡Œè·¯ç”±æ§åˆ¶ã€‚</li></ul><h3 id="2-koa-bodyparser"><a href="#2-koa-bodyparser" class="headerlink" title="2. koa-bodyparser"></a>2. <strong><code>koa-bodyparser</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šè§£æè¯·æ±‚ä½“ï¼Œç”¨äºå¤„ç† POST è¯·æ±‚ä¸­çš„ JSONã€è¡¨å•ç­‰æ•°æ®ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šè§£æ<code>POST</code>è¯·æ±‚çš„è¯·æ±‚ä½“å†…å®¹ï¼Œå°¤å…¶æ˜¯ JSON æ ¼å¼çš„æ•°æ®ã€‚</li></ul><h3 id="3-koa-static"><a href="#3-koa-static" class="headerlink" title="3. koa-static"></a>3. <strong><code>koa-static</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šæä¾›é™æ€æ–‡ä»¶æœåŠ¡ï¼Œç”¨äºæä¾›è¯¸å¦‚ HTMLã€CSSã€JSã€å›¾ç‰‡ç­‰æ–‡ä»¶ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“ä½ éœ€è¦ä¸ºå‰ç«¯åº”ç”¨æä¾›é™æ€èµ„æºæ—¶ï¼Œå¦‚å›¾ç‰‡æˆ–é™æ€ç½‘é¡µã€‚</li></ul><h3 id="4-koa-multer"><a href="#4-koa-multer" class="headerlink" title="4. koa-multer"></a>4. <strong><code>koa-multer</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºå¤„ç†æ–‡ä»¶ä¸Šä¼ ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šå½“åº”ç”¨éœ€è¦å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶æ—¶ã€‚</li></ul><h3 id="5-koa-session"><a href="#5-koa-session" class="headerlink" title="5. koa-session"></a>5. <strong><code>koa-session</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºä¼šè¯ç®¡ç†ï¼Œå­˜å‚¨å’Œç®¡ç†ç”¨æˆ·ä¼šè¯ä¿¡æ¯ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šéœ€è¦å¯¹ç”¨æˆ·ç™»å½•çŠ¶æ€è¿›è¡Œç®¡ç†ã€‚</li></ul><h3 id="6-koa-jwt"><a href="#6-koa-jwt" class="headerlink" title="6. koa-jwt"></a>6. <strong><code>koa-jwt</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºåŸºäº JWT çš„èº«ä»½éªŒè¯ï¼Œè§£æè¯·æ±‚ä¸­çš„ JWT tokenã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šç”¨äºä¿æŠ¤è·¯ç”±ï¼Œéœ€è¦å¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œè®¤è¯ã€‚</li></ul><h3 id="7-koa-view"><a href="#7-koa-view" class="headerlink" title="7 koa-view"></a>7 <strong><code>koa-view</code></strong></h3><ul><li><strong>åŠŸèƒ½</strong>ï¼šç”¨äºåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ HTML æ¨¡æ¿ï¼Œå¯ä»¥åŠ¨æ€ç”Ÿæˆé¡µé¢</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šéœ€è¦æœåŠ¡ç«¯æ¸²æŸ“åŠ¨æ€å†…å®¹çš„åœºæ™¯ï¼Œæ¯”å¦‚æ¸²æŸ“ç”¨æˆ·æ•°æ®ã€ç”Ÿæˆ HTML ç”µå­é‚®ä»¶ç­‰<ul><li><strong>EJS</strong>ï¼šç®€å•ã€æ˜“ç”¨ï¼Œé€‚åˆå°é¡¹ç›®ã€‚</li><li><strong>Pug</strong>ï¼šç®€æ´çš„ç¼©è¿›å¼è¯­æ³•ï¼Œé€‚åˆä¸­å¤§å‹é¡¹ç›®ã€‚</li><li><strong>Nunjucks</strong>ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒé«˜çº§ç‰¹æ€§ï¼Œé€‚åˆå¤æ‚åº”ç”¨ã€‚</li><li><strong>Handlebars</strong>ï¼šè½»é‡åŒ–ï¼Œé€‚åˆç”Ÿæˆé™æ€é¡µé¢ã€‚</li></ul></li></ul><h2 id="8-ä¸­é—´ä»¶å®ç°"><a href="#8-ä¸­é—´ä»¶å®ç°" class="headerlink" title="8. ä¸­é—´ä»¶å®ç°"></a>8. ä¸­é—´ä»¶å®ç°</h2><h3 id="1-koa-router-1"><a href="#1-koa-router-1" class="headerlink" title="1.koa-router"></a>1.koa-router</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> methods <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"head"</span><span class="token punctuation">,</span> <span class="token string">"options"</span><span class="token punctuation">,</span> <span class="token string">"put"</span><span class="token punctuation">,</span> <span class="token string">"patch"</span><span class="token punctuation">,</span> <span class="token string">"post"</span><span class="token punctuation">,</span> <span class="token string">"delete"</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//stacké‡Œå­˜æ”¾è·¯ç”±è§„åˆ™</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> method <span class="token keyword">of</span> methods<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> middleware</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æŠŠè¯·æ±‚çš„æ–¹æ³•ï¼Œè¯·æ±‚çš„è·¯å¾„ä»¥åŠå¯¹åº”çš„è¯·æ±‚å¤„ç†ä¸­é—´ä»¶å‡½æ•°åŒ…è£…æˆä¸€ä¸ªå¯¹è±¡å¹¶æ”¾å…¥stackæ•°ç»„</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> path<span class="token punctuation">,</span> method<span class="token punctuation">,</span> middleware <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">Router</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">routes</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//è¿™ä¸ªæ‰æ˜¯çœŸæ­£ç”¨æ¥å¤„ç†è¯·æ±‚çš„ä¸­é—´ä»¶å‡½æ•°</span>  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åœ¨stackæ•°ç»„ä¸­æ‰¾åˆ°ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¸ªå…ƒç´ pathå’Œå½“å‰çš„è¯·æ±‚çš„è·¯å¾„ç›¸åŒï¼Œå®ƒçš„methodå’Œè¯·æ±‚çš„æ–¹æ³•åç›¸åŒ</span>    <span class="token keyword">const</span> matchedLayer <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">layer</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> layer<span class="token punctuation">.</span>path <span class="token operator">===</span> ctx<span class="token punctuation">.</span>path <span class="token operator">&amp;&amp;</span> layer<span class="token punctuation">.</span>method <span class="token operator">===</span> ctx<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>matchedLayer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">await</span> matchedLayer<span class="token punctuation">.</span><span class="token function">middleware</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> next<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Router<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-koa-bodyparser-1"><a href="#2-koa-bodyparser-1" class="headerlink" title="2.koa-bodyparser"></a>2.koa-bodyparser</h3><ul><li>åŒ…å«è§£æ<code>application/x-www-form-urlencoded</code>å’Œ<code>application/json</code>å’Œæ–‡ä»¶ä¸Šä¼ <code>multipart/form-data</code>åŸç†</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> querystring <span class="token keyword">from</span> <span class="token string">"querystring"</span><span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">"fs/promises"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> v4 <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"uuid"</span><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token keyword">const</span> starts <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> querystring<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token string">"application/json"</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token class-name">Buffer</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">split</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">sep</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> headerLines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  sep <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">isBuffer</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span> <span class="token operator">?</span> sep <span class="token operator">:</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span>  <span class="token keyword">let</span> offset <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">!==</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>sep<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    headerLines<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">)</span>    offset <span class="token operator">=</span> index <span class="token operator">+</span> sep<span class="token punctuation">.</span>length  <span class="token punctuation">&#125;</span> <span class="token comment">// str.indexOf(åˆ†éš”ç¬¦,æŸ¥æ‰¾çš„ä½ç½®)</span>  headerLines<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// åˆ†å‰²åçš„æœ€åä¸€éƒ¨åˆ†ä¹Ÿæ”¾åˆ°æ•°ç»„é‡Œ</span>  <span class="token keyword">return</span> headerLines<span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">formData</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> boundary<span class="token punctuation">,</span> uploadDir</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> headerLines <span class="token operator">=</span> content<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"--"</span> <span class="token operator">+</span> boundary<span class="token punctuation">)</span>  headerLines <span class="token operator">=</span> headerLines<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>    headerLines<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">line</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> <span class="token punctuation">[</span>head<span class="token punctuation">,</span> <span class="token operator">...</span>content<span class="token punctuation">]</span> <span class="token operator">=</span> line<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"\r\n\r\n"</span><span class="token punctuation">)</span> <span class="token comment">// type å’Œ å†…å®¹ä¹‹é—´æ˜¯ä¸¤ä¸ªæ¢è¡Œ</span>      <span class="token keyword">let</span> contentType <span class="token operator">=</span> head<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> name <span class="token operator">=</span> contentType<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">name="(.+?)"</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>contentType<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        content <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token function">v4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">await</span> fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>uploadDir<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span>        <span class="token keyword">let</span> file <span class="token operator">=</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">originalFilename</span><span class="token operator">:</span> contentType<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">filename="(.+?)"</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token literal-property property">type</span><span class="token operator">:</span> contentType<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Content-Type: ([^\r\n]+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token literal-property property">size</span><span class="token operator">:</span> content<span class="token punctuation">.</span>length<span class="token punctuation">,</span>          filename<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        result<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        result<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        result<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> uploadDir <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è§£æè¯·æ±‚ä½“ï¼Œå°†ç»“æœ ç»™ èµ‹å€¼åˆ°ctx.request.body</span>    <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> type <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">)</span>        <span class="token comment">// ç»™ä¸Šä¸‹æ–‡ä¸­çš„requestè‡ªå®šä¸€ä¸ªbodyå±æ€§</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">const</span> content <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"multipart/form-data"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// è¡¨å•å†…å®¹ï¼Œ è¡¨å•çš„åˆ†å‰²ç¬¦å·</span>            <span class="token function">formData</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> type<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> uploadDir<span class="token punctuation">)</span> <span class="token comment">// å°†æ–‡ä»¶ä¸Šä¼ åˆ°æŸä¸ªç›®å½•ä¸­</span>            <span class="token comment">// ä¿¡æ¯ä¿å­˜åˆ° ctx.request.body</span>            ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body <span class="token operator">=</span> starts<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> bodyParser<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-koa-static-1"><a href="#3-koa-static-1" class="headerlink" title="3.koa-static"></a>3.koa-static</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> stat <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"fs/promises"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createReadStream <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"fs"</span><span class="token keyword">import</span> mime <span class="token keyword">from</span> <span class="token string">"mime"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">serve</span><span class="token punctuation">(</span><span class="token parameter">dirname</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å…ˆå‘åæ‰§è¡Œ</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>dirname<span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>path<span class="token punctuation">)</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> statObj <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">stat</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>statObj<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"Content-Type"</span><span class="token punctuation">,</span> mime<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"text/plain"</span> <span class="token operator">+</span> <span class="token string">";charset=utf-8"</span><span class="token punctuation">)</span>        ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">createReadStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-koa-session"><a href="#4-koa-session" class="headerlink" title="4. koa-session"></a>4. koa-session</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">generateKoaSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//æœåŠ¡ç«¯ä¼šæœ‰ä¸€æ®µå†…å­˜ç”¨æ¥ä¿å­˜æ¯ä¸ªç”¨æˆ·çš„æ•°æ®</span>  <span class="token comment">//ç”¨æˆ·å¯¹å°±åœ¨çš„ä¼šè¯æ•°æ®å°±æ”¾åœ¨è¿™ä¸ªå¯¹è±¡é‡Œ</span>  <span class="token keyword">const</span> sessionStorage <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è·å–ç”¨æˆ·ä¼ é€’è¿‡æ¥çš„koa.sess</span>    <span class="token keyword">let</span> koasess <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"koa.sess"</span><span class="token punctuation">)</span>    <span class="token comment">//å¦‚æœæ²¡æœ‰ä¼ é€’,è¯´æ˜ä¸€ä¸ªæ–°çš„</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>koasess<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//ç”Ÿæˆä¸€ä¸ªæ–°çš„koasess</span>      koasess <span class="token operator">=</span> <span class="token function">generateKoaSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      sessionStorage<span class="token punctuation">[</span>koasess<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>      <span class="token comment">//é€šè¿‡cookieæŠŠè¿™ä¸ªæ–°çš„å¡å·å‘ç»™æˆ–è€…è¯´ç§æ¤åˆ°å®¢æˆ·ç«¯</span>      ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"koa.sess"</span><span class="token punctuation">,</span> koasess<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    ctx<span class="token punctuation">.</span>session <span class="token operator">=</span> sessionStorage<span class="token punctuation">[</span>koasess<span class="token punctuation">]</span>    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> session<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue ä¸­çš„diffç®—æ³•ï¼Ÿ</title>
      <link href="/2024/07/15/vue-zhong-de-diff-suan-fa/"/>
      <url>/2024/07/15/vue-zhong-de-diff-suan-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰åå…ƒç´ ä¸ä¸€è‡´"><a href="#å‰åå…ƒç´ ä¸ä¸€è‡´" class="headerlink" title="å‰åå…ƒç´ ä¸ä¸€è‡´"></a>å‰åå…ƒç´ ä¸ä¸€è‡´</h2><blockquote><p>ä¸¤ä¸ªä¸åŒè™šæ‹ŸèŠ‚ç‚¹ä¸éœ€è¦è¿›è¡Œæ¯”è¾ƒï¼Œç›´æ¥ç§»é™¤è€èŠ‚ç‚¹ï¼Œå°†æ–°çš„è™šæ‹ŸèŠ‚ç‚¹æ¸²æŸ“æˆçœŸå® DOM è¿›è¡ŒæŒ‚è½½å³å¯</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">isSameVNodeType</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> n1<span class="token punctuation">.</span>type <span class="token operator">===</span> n2<span class="token punctuation">.</span>type <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>key <span class="token operator">===</span> n2<span class="token punctuation">.</span>key<span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">patch</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–å’Œdiffç®—æ³•éƒ½åœ¨è¿™é‡Œå–²</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">==</span> n2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æœ‰n1 æ˜¯n1å’Œn2ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹</span>    <span class="token function">unmount</span><span class="token punctuation">(</span>n1<span class="token punctuation">)</span>    n1 <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆå§‹åŒ–çš„æƒ…å†µ</span>    <span class="token function">mountElement</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// diffç®—æ³•</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">patch</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ....</span>  <span class="token function">processElement</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token comment">// å°è£…å¯¹å…ƒç´ çš„å¤„ç†é€»è¾‘</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‰åå…ƒç´ ä¸€è‡´"><a href="#å‰åå…ƒç´ ä¸€è‡´" class="headerlink" title="å‰åå…ƒç´ ä¸€è‡´"></a>å‰åå…ƒç´ ä¸€è‡´</h2><blockquote><p>å‰åå…ƒç´ ä¸€è‡´åˆ™æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ çš„å±æ€§å’Œå­©å­èŠ‚ç‚¹</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">patchProps</span> <span class="token operator">=</span> <span class="token punctuation">(</span>oldProps<span class="token punctuation">,</span> newProps<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> newProps<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç”¨æ–°çš„ç”Ÿæ•ˆ</span>    <span class="token function">hostPatchProp</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> oldProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> newProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è€çš„é‡Œé¢æœ‰æ–°çš„æ²¡æœ‰åˆ™åˆ é™¤</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> oldProps<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> newProps<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">hostPatchProp</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> key<span class="token punctuation">,</span> oldProps<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">patchElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token punctuation">(</span>n2<span class="token punctuation">.</span>el <span class="token operator">=</span> n1<span class="token punctuation">.</span>el<span class="token punctuation">)</span>  <span class="token keyword">const</span> oldProps <span class="token operator">=</span> n1<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> newProps <span class="token operator">=</span> n2<span class="token punctuation">.</span>props <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token function">patchProps</span><span class="token punctuation">(</span>oldProps<span class="token punctuation">,</span> newProps<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token comment">// æ¯”å¯¹æ–°è€å±æ€§</span>  <span class="token function">patchChildren</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token comment">// æ¯”è¾ƒå…ƒç´ çš„å­©å­èŠ‚ç‚¹</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">processElement</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">mountElement</span><span class="token punctuation">(</span>n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">patchElement</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span> <span class="token comment">// æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ </span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å­å…ƒç´ æ¯”è¾ƒæƒ…å†µ"><a href="#å­å…ƒç´ æ¯”è¾ƒæƒ…å†µ" class="headerlink" title="å­å…ƒç´ æ¯”è¾ƒæƒ…å†µ"></a>å­å…ƒç´ æ¯”è¾ƒæƒ…å†µ</h2><table><thead><tr><th align="left">æ–°å„¿å­</th><th align="left">æ—§å„¿å­</th><th align="left">æ“ä½œæ–¹å¼</th></tr></thead><tbody><tr><td align="left">æ–‡æœ¬</td><td align="left">æ•°ç»„</td><td align="left">ï¼ˆåˆ é™¤è€å„¿å­ï¼Œè®¾ç½®æ–‡æœ¬å†…å®¹ï¼‰</td></tr><tr><td align="left">æ–‡æœ¬</td><td align="left">æ–‡æœ¬</td><td align="left">ï¼ˆæ›´æ–°æ–‡æœ¬å³å¯ï¼‰</td></tr><tr><td align="left">æ–‡æœ¬</td><td align="left">ç©º</td><td align="left">ï¼ˆæ›´æ–°æ–‡æœ¬å³å¯) ä¸ä¸Šé¢çš„ç±»ä¼¼</td></tr><tr><td align="left">æ•°ç»„</td><td align="left">æ•°ç»„</td><td align="left">ï¼ˆdiff ç®—æ³•ï¼‰</td></tr><tr><td align="left">æ•°ç»„</td><td align="left">æ–‡æœ¬</td><td align="left">ï¼ˆæ¸…ç©ºæ–‡æœ¬ï¼Œè¿›è¡ŒæŒ‚è½½ï¼‰</td></tr><tr><td align="left">æ•°ç»„</td><td align="left">ç©º</td><td align="left">ï¼ˆè¿›è¡ŒæŒ‚è½½ï¼‰ ä¸ä¸Šé¢çš„ç±»ä¼¼</td></tr><tr><td align="left">ç©º</td><td align="left">æ•°ç»„</td><td align="left">ï¼ˆåˆ é™¤æ‰€æœ‰å„¿å­ï¼‰</td></tr><tr><td align="left">ç©º</td><td align="left">æ–‡æœ¬</td><td align="left">ï¼ˆæ¸…ç©ºæ–‡æœ¬ï¼‰</td></tr><tr><td align="left">ç©º</td><td align="left">ç©º</td><td align="left">ï¼ˆæ— éœ€å¤„ç†ï¼‰</td></tr></tbody></table><h3 id="å­èŠ‚ç‚¹æœ‰ä¸‰ç§æƒ…å†µï¼š-æ–‡æœ¬ã€æ•°ç»„ã€æ²¡æœ‰å„¿å­"><a href="#å­èŠ‚ç‚¹æœ‰ä¸‰ç§æƒ…å†µï¼š-æ–‡æœ¬ã€æ•°ç»„ã€æ²¡æœ‰å„¿å­" class="headerlink" title="å­èŠ‚ç‚¹æœ‰ä¸‰ç§æƒ…å†µï¼š æ–‡æœ¬ã€æ•°ç»„ã€æ²¡æœ‰å„¿å­"></a>å­èŠ‚ç‚¹æœ‰ä¸‰ç§æƒ…å†µï¼š æ–‡æœ¬ã€æ•°ç»„ã€æ²¡æœ‰å„¿å­</h3><ul><li>1.æ–°çš„æ˜¯æ–‡æœ¬ï¼Œè€çš„æ˜¯æ•°ç»„ç§»é™¤è€çš„ï¼›</li><li>2.æ–°çš„æ˜¯æ–‡æœ¬ï¼Œè€çš„ä¹Ÿæ˜¯æ–‡æœ¬ï¼Œå†…å®¹ä¸ç›¸åŒæ›¿æ¢</li><li>3.è€çš„æ˜¯æ•°ç»„ï¼Œæ–°çš„æ˜¯æ•°ç»„ï¼Œå…¨é‡ diff ç®—æ³•</li><li>4.è€çš„æ˜¯æ•°ç»„ï¼Œæ–°çš„ä¸æ˜¯æ•°ç»„ï¼Œç§»é™¤è€çš„å­èŠ‚ç‚¹</li><li>5.è€çš„æ˜¯æ–‡æœ¬ï¼Œæ–°çš„æ˜¯ç©º</li><li>6.è€çš„æ˜¯æ–‡æœ¬ï¼Œæ–°çš„æ˜¯æ•°ç»„</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">unmountChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span>children<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">unmount</span><span class="token punctuation">(</span>children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">patchChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> c1 <span class="token operator">=</span> n1 <span class="token operator">&amp;&amp;</span> n1<span class="token punctuation">.</span>children  <span class="token keyword">const</span> c2 <span class="token operator">=</span> n2<span class="token punctuation">.</span>children  <span class="token keyword">const</span> prevShapeFlag <span class="token operator">=</span> n1<span class="token punctuation">.</span>shapeFlag  <span class="token keyword">const</span> shapeFlag <span class="token operator">=</span> n2<span class="token punctuation">.</span>shapeFlag  <span class="token keyword">if</span> <span class="token punctuation">(</span>shapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevShapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">unmountChildren</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>c1 <span class="token operator">!==</span> c2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">hostSetElementText</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> c2<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>prevShapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>shapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">unmountChildren</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>prevShapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">TEXT_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">hostSetElementText</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>shapeFlag <span class="token operator">&amp;</span> ShapeFlags<span class="token punctuation">.</span><span class="token constant">ARRAY_CHILDREN</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">mountChildren</span><span class="token punctuation">(</span>c2<span class="token punctuation">,</span> el<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ ¸å¿ƒDiffç®—æ³•"><a href="#æ ¸å¿ƒDiffç®—æ³•" class="headerlink" title="æ ¸å¿ƒDiffç®—æ³•[#]"></a>æ ¸å¿ƒ<code>Diff</code>ç®—æ³•[#]</h2><h3 id="sync-from-start"><a href="#sync-from-start" class="headerlink" title="sync from start[#]"></a>sync from start[#]</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'a'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'b'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'c'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">:</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span><span class="token punctuation">[</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'a'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'b'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'d'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> key<span class="token operator">:</span> <span class="token string">'e'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">patchKeydChildren</span> <span class="token operator">=</span> <span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">,</span> container<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">const</span> l2 <span class="token operator">=</span> c2<span class="token punctuation">.</span>length  <span class="token keyword">let</span> e1 <span class="token operator">=</span> c1<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>  <span class="token keyword">let</span> e2 <span class="token operator">=</span> l2 <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment">// 1. sync from start</span>  <span class="token comment">// (a b) c</span>  <span class="token comment">// (a b) d e</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> n1 <span class="token operator">=</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">const</span> n2 <span class="token operator">=</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">patch</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">break</span>    <span class="token punctuation">&#125;</span>    i<span class="token operator">++</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="sync-from-end"><a href="#sync-from-end" class="headerlink" title="sync from end"></a>sync from end</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 2. sync from end</span><span class="token comment">// a (b c)</span><span class="token comment">// d e (b c)</span><span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1 <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> n1 <span class="token operator">=</span> c1<span class="token punctuation">[</span>e1<span class="token punctuation">]</span>  <span class="token keyword">const</span> n2 <span class="token operator">=</span> c2<span class="token punctuation">[</span>e2<span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isSameVNodeType</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">patch</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> container<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">break</span>  <span class="token punctuation">&#125;</span>  e1<span class="token operator">--</span>  e2<span class="token operator">--</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="common-sequence-mount"><a href="#common-sequence-mount" class="headerlink" title="common sequence + mount"></a>common sequence + mount</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 3. common sequence + mount</span><span class="token comment">// (a b)</span><span class="token comment">// (a b) c</span><span class="token comment">// i = 2, e1 = 1, e2 = 2</span><span class="token comment">// (a b)</span><span class="token comment">// c (a b)</span><span class="token comment">// i = 0, e1 = -1, e2 = 0</span><span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> e1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¯´æ˜æœ‰æ–°å¢</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¡¨ç¤ºæœ‰æ–°å¢çš„éƒ¨åˆ†</span>    <span class="token comment">// å…ˆæ ¹æ®e2 å–ä»–çš„ä¸‹ä¸€ä¸ªå…ƒç´   å’Œ æ•°ç»„é•¿åº¦è¿›è¡Œæ¯”è¾ƒ</span>    <span class="token keyword">const</span> nextPos <span class="token operator">=</span> e2 <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">const</span> anchor <span class="token operator">=</span> nextPos <span class="token operator">&lt;</span> c2<span class="token punctuation">.</span>length <span class="token operator">?</span> c2<span class="token punctuation">[</span>nextPos<span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="common-sequence-unmount"><a href="#common-sequence-unmount" class="headerlink" title="common sequence + unmount"></a>common sequence + unmount</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 4. common sequence + unmount</span><span class="token comment">// (a b) c</span><span class="token comment">// (a b)</span><span class="token comment">// i = 2, e1 = 2, e2 = 1</span><span class="token comment">// a (b c)</span><span class="token comment">// (b c)</span><span class="token comment">// i = 0, e1 = 0, e2 = -1</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> e2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> e1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">unmount</span><span class="token punctuation">(</span>c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="unknown-sequence"><a href="#unknown-sequence" class="headerlink" title="unknown sequence"></a>unknown sequence</h3><h4 id="build-key-index-map-for-newChildren"><a href="#build-key-index-map-for-newChildren" class="headerlink" title="build key:index map for newChildren"></a><code>build key:index map for newChildren</code></h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 5. unknown sequence</span><span class="token comment">// a b [c d e] f g</span><span class="token comment">// a b [e c d h] f g</span><span class="token comment">// i = 2, e1 = 4, e2 = 5</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> s1 <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">const</span> s2 <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">const</span> keyToNewIndexMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> s2<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> e2<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> nextChild <span class="token operator">=</span> c2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        keyToNewIndexMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>nextChild<span class="token punctuation">.</span>key<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="loop-through-old-children-left-to-be-patched-and-try-to-patch"><a href="#loop-through-old-children-left-to-be-patched-and-try-to-patch" class="headerlink" title="loop through old children left to be patched and try to patch"></a><code>loop through old children left to be patched and try to patch</code></h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// æ ‡è®°æ–°å…ƒç´ çš„ï¼Œå¯¹åº”è€å…ƒç´ çš„ç´¢å¼•ä½ç½®</span><span class="token keyword">const</span> toBePatched <span class="token operator">=</span> e2 <span class="token operator">-</span> s2 <span class="token operator">+</span> <span class="token number">1</span><span class="token keyword">const</span> newIndexToOldMapIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token builtin">Array</span></span><span class="token punctuation">(</span>toBePatched<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> s1<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> e1<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> prevChild <span class="token operator">=</span> c1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token keyword">let</span> newIndex <span class="token operator">=</span> keyToNewIndexMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">.</span>key<span class="token punctuation">)</span> <span class="token comment">// è·å–æ–°çš„ç´¢å¼•</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>newIndex <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">unmount</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">)</span> <span class="token comment">// è€çš„æœ‰ æ–°çš„æ²¡æœ‰ç›´æ¥åˆ é™¤</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    newIndexToOldMapIndex<span class="token punctuation">[</span>newIndex <span class="token operator">-</span> s2<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token function">patch</span><span class="token punctuation">(</span>prevChild<span class="token punctuation">,</span> c2<span class="token punctuation">[</span>newIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> container<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="move-and-mount"><a href="#move-and-mount" class="headerlink" title="move and mount"></a>move and mount</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newIndexToOldMapIndex<span class="token punctuation">)</span> <span class="token comment">// -> å°†ç»“æœæ˜ å°„æˆ  [1,2]  å€’åºçš„æ—¶å€™é‡åˆ°ç´¢å¼•ä¸º2å’Œ1çš„è·³è¿‡æ“ä½œ</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> toBePatched <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> nextIndex <span class="token operator">=</span> s2 <span class="token operator">+</span> i <span class="token comment">// [ecdh]   æ‰¾åˆ°hçš„ç´¢å¼•</span>  <span class="token keyword">const</span> nextChild <span class="token operator">=</span> c2<span class="token punctuation">[</span>nextIndex<span class="token punctuation">]</span> <span class="token comment">// æ‰¾åˆ° h</span>  <span class="token keyword">let</span> anchor <span class="token operator">=</span> nextIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> c2<span class="token punctuation">.</span>length <span class="token operator">?</span> c2<span class="token punctuation">[</span>nextIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// æ‰¾åˆ°å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå…ƒç´ </span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>newIndexToOldMapIndex<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™æ˜¯ä¸€ä¸ªæ–°å…ƒç´  ç›´æ¥åˆ›å»ºæ’å…¥åˆ° å½“å‰å…ƒç´ çš„ä¸‹ä¸€ä¸ªå³å¯</span>    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> nextChild<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ ¹æ®å‚ç…§ç‰© å°†èŠ‚ç‚¹ç›´æ¥ç§»åŠ¨è¿‡å»  æ‰€æœ‰èŠ‚ç‚¹éƒ½è¦ç§»åŠ¨ ï¼ˆä½†æ˜¯æœ‰äº›èŠ‚ç‚¹å¯ä»¥ä¸åŠ¨ï¼‰</span>    <span class="token function">hostInsert</span><span class="token punctuation">(</span>nextChild<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æœ€é•¿é€’å¢å­åºåˆ—"><a href="#æœ€é•¿é€’å¢å­åºåˆ—" class="headerlink" title="æœ€é•¿é€’å¢å­åºåˆ—"></a>æœ€é•¿é€’å¢å­åºåˆ—</h2><h3 id="æœ€ä¼˜æƒ…å†µ"><a href="#æœ€ä¼˜æƒ…å†µ" class="headerlink" title="æœ€ä¼˜æƒ…å†µ"></a>æœ€ä¼˜æƒ…å†µ</h3><blockquote><p>Vue3 é‡‡ç”¨æœ€é•¿é€’å¢å­åºåˆ—ï¼Œæ±‚è§£ä¸éœ€è¦ç§»åŠ¨çš„å…ƒç´ æœ‰å“ªäº›</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">getSequence</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// ä¿å­˜æœ€é•¿é€’å¢å­åºåˆ—çš„ç´¢å¼•</span>  <span class="token keyword">let</span> resultLastIndex  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> arrI <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// è·å–æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ï¼Œä½†æ˜¯0 æ²¡æœ‰æ„ä¹‰æˆ‘ä»¬éœ€è¦å¿½ç•¥æ‰</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arrI <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      resultLastIndex <span class="token operator">=</span> result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>resultLastIndex<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arrI<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// è®°å½•ç´¢å¼•</span>        <span class="token keyword">continue</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token comment">// é’ˆå¯¹é»˜è®¤é€’å¢çš„åºåˆ—è¿›è¡Œä¼˜åŒ–</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSequence</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="äºŒåˆ†æŸ¥æ‰¾æŸ¥æ‰¾æœ€é•¿é€’å¢ä¸ª"><a href="#äºŒåˆ†æŸ¥æ‰¾æŸ¥æ‰¾æœ€é•¿é€’å¢ä¸ª" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾æŸ¥æ‰¾æœ€é•¿é€’å¢ä¸ª"></a>äºŒåˆ†æŸ¥æ‰¾æŸ¥æ‰¾æœ€é•¿é€’å¢ä¸ª</h3><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">getSequence1</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// ä¿å­˜æœ€é•¿é€’å¢å­åºåˆ—çš„ç´¢å¼•</span>  <span class="token keyword">let</span> resultLastIndex  <span class="token keyword">let</span> start  <span class="token keyword">let</span> end  <span class="token keyword">let</span> middle <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> arrI <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// è·å–æ•°ç»„ä¸­çš„æ¯ä¸€é¡¹ï¼Œä½†æ˜¯0 æ²¡æœ‰æ„ä¹‰æˆ‘ä»¬éœ€è¦å¿½ç•¥æ‰</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arrI <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      resultLastIndex <span class="token operator">=</span> result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>resultLastIndex<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arrI<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// è®°å½•ç´¢å¼•</span>        <span class="token keyword">continue</span>      <span class="token punctuation">&#125;</span>      start <span class="token operator">=</span> <span class="token number">0</span>      end <span class="token operator">=</span> result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// äºŒåˆ†æŸ¥æ‰¾ å‰åç´¢å¼•</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æœ€ç»ˆstart = end</span>        middle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token comment">// å‘ä¸‹å–æ•´</span>        <span class="token comment">// æ‹¿resultä¸­é—´å€¼å’Œæœ€åä¸€é¡¹æ¯”è¾ƒ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>result<span class="token punctuation">[</span>middle<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> arrI<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// æ‰¾æ¯”arrIå¤§çš„å€¼ æˆ–è€…ç­‰äºarrI</span>          start <span class="token operator">=</span> middle <span class="token operator">+</span> <span class="token number">1</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          end <span class="token operator">=</span> middle        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arrI <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>result<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å½“å‰è¿™ä¸ªå°å°±æ›¿æ¢æ‰</span>        result<span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">=</span> i      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‰é©±èŠ‚ç‚¹è¿½æº¯"><a href="#å‰é©±èŠ‚ç‚¹è¿½æº¯" class="headerlink" title="å‰é©±èŠ‚ç‚¹è¿½æº¯"></a>å‰é©±èŠ‚ç‚¹è¿½æº¯</h3><p>å‡è®¾æœ‰ï¼š[2,3,1,5,6,8,7,9,4] ä¸ºæœ€æ–°åºåˆ— -&gt; æŒ‰ç…§ä¸Šè¿°ç»“æœå¾—å‡ºçš„ç»“è®ºä¸ºï¼š[ 2, 1, 8, 4, 6, 7 ]</p><p><img src="http://zhufengpeixun.com/vue-lesson/assets/sequence.957e5a54.png" alt="img"></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">getSequence</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æœ€ç»ˆçš„ç»“æœæ˜¯ç´¢å¼•</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// ç´¢å¼•  é€’å¢çš„åºåˆ— ç”¨äºŒåˆ†æŸ¥æ‰¾æ€§èƒ½é«˜</span>  <span class="token keyword">const</span> p <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">// é‡Œé¢å†…å®¹æ— æ‰€è°“ å’Œ åŸæœ¬çš„æ•°ç»„ç›¸åŒ ç”¨æ¥å­˜æ”¾ç´¢å¼•</span>  <span class="token keyword">let</span> start  <span class="token keyword">let</span> end  <span class="token keyword">let</span> middle  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// O(n)</span>    <span class="token keyword">const</span> arrI <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arrI <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> resultLastIndex <span class="token operator">=</span> result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>      <span class="token comment">// å–åˆ°ç´¢å¼•å¯¹åº”çš„å€¼</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>resultLastIndex<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arrI<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> resultLastIndex <span class="token comment">// æ ‡è®°å½“å‰å‰ä¸€ä¸ªå¯¹åº”çš„ç´¢å¼•</span>        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token comment">// å½“å‰çš„å€¼ æ¯”ä¸Šä¸€ä¸ªäººå¤§ ï¼Œç›´æ¥push ï¼Œå¹¶ä¸”è®©è¿™ä¸ªäººå¾—è®°å½•ä»–çš„å‰ä¸€ä¸ª</span>        <span class="token keyword">continue</span>      <span class="token punctuation">&#125;</span>      <span class="token comment">// äºŒåˆ†æŸ¥æ‰¾ æ‰¾åˆ°æ¯”å½“å‰å€¼å¤§çš„é‚£ä¸€ä¸ª</span>      start <span class="token operator">=</span> <span class="token number">0</span>      end <span class="token operator">=</span> result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>start <span class="token operator">&lt;</span> end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// é‡åˆå°±è¯´æ˜æ‰¾åˆ°äº† å¯¹åº”çš„å€¼  // O(logn)</span>        middle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>start <span class="token operator">+</span> end<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span> <span class="token comment">// æ‰¾åˆ°ä¸­é—´ä½ç½®çš„å‰ä¸€ä¸ª</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>result<span class="token punctuation">[</span>middle<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> arrI<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          start <span class="token operator">=</span> middle <span class="token operator">+</span> <span class="token number">1</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          end <span class="token operator">=</span> middle        <span class="token punctuation">&#125;</span> <span class="token comment">// æ‰¾åˆ°ç»“æœé›†ä¸­ï¼Œæ¯”å½“å‰è¿™ä¸€é¡¹å¤§çš„æ•°</span>      <span class="token punctuation">&#125;</span>      <span class="token comment">// start / end å°±æ˜¯æ‰¾åˆ°çš„ä½ç½®</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arrI <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>result<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¦‚æœç›¸åŒ æˆ–è€… æ¯”å½“å‰çš„è¿˜å¤§å°±ä¸æ¢äº†</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>start <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// æ‰éœ€è¦æ›¿æ¢</span>          p<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> result<span class="token punctuation">[</span>start <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// è¦å°†ä»–æ›¿æ¢çš„å‰ä¸€ä¸ªè®°ä½</span>        <span class="token punctuation">&#125;</span>        result<span class="token punctuation">[</span>start<span class="token punctuation">]</span> <span class="token operator">=</span> i      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> result<span class="token punctuation">.</span>length <span class="token comment">// æ€»é•¿åº¦</span>  <span class="token keyword">let</span> last <span class="token operator">=</span> result<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// æ‰¾åˆ°äº†æœ€åä¸€é¡¹</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">--</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ ¹æ®å‰é©±èŠ‚ç‚¹ä¸€ä¸ªä¸ªå‘å‰æŸ¥æ‰¾</span>    result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> last <span class="token comment">// æœ€åä¸€é¡¹è‚¯å®šæ˜¯æ­£ç¡®çš„</span>    last <span class="token operator">=</span> p<span class="token punctuation">[</span>last<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getSequence</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜åŒ–Diffç®—æ³•"><a href="#ä¼˜åŒ–Diffç®—æ³•" class="headerlink" title="ä¼˜åŒ–Diffç®—æ³•"></a>ä¼˜åŒ–<code>Diff</code>ç®—æ³•</h3><p>åˆ©ç”¨æœ€é•¿é€’å¢å­åºåˆ—ï¼Œä¼˜åŒ–<code>Diff</code>ç®—æ³•</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// [5,3,4,0] => [1,2]</span><span class="token keyword">let</span> increasingNewIndexSequence <span class="token operator">=</span> <span class="token function">getSequence</span><span class="token punctuation">(</span>newIndexToOldMapIndex<span class="token punctuation">)</span><span class="token keyword">let</span> j <span class="token operator">=</span> increasingNewIndexSequence<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// å–å‡ºæœ€åä¸€ä¸ªäººçš„ç´¢å¼•</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> toBePatched <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> i <span class="token operator">+</span> s2 <span class="token comment">// æ‰¾åˆ°hçš„ç´¢å¼•</span>  <span class="token keyword">let</span> child <span class="token operator">=</span> c2<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token comment">// æ‰¾åˆ°hå¯¹åº”çš„èŠ‚ç‚¹</span>  <span class="token keyword">let</span> anchor <span class="token operator">=</span> currentIndex <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">&lt;</span> c2<span class="token punctuation">.</span>length <span class="token operator">?</span> c2<span class="token punctuation">[</span>currentIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el <span class="token operator">:</span> <span class="token keyword">null</span> <span class="token comment">// ç¬¬ä¸€æ¬¡æ’å…¥h å hæ˜¯ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ŒåŒæ—¶æ’å…¥å è™šæ‹ŸèŠ‚ç‚¹ä¼š</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>newIndexToOldMapIndex<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœè‡ªå·±æ˜¯0è¯´æ˜æ²¡æœ‰è¢«patchè¿‡</span>    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> child<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> increasingNewIndexSequence<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">hostInsert</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span>el<span class="token punctuation">,</span> container<span class="token punctuation">,</span> anchor<span class="token punctuation">)</span> <span class="token comment">// æ“ä½œå½“å‰çš„d ä»¥dä¸‹ä¸€ä¸ªä½œä¸ºå‚ç…§ç‰©æ’å…¥</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      j<span class="token operator">--</span> <span class="token comment">// è·³è¿‡ä¸éœ€è¦ç§»åŠ¨çš„å…ƒç´ ï¼Œ ä¸ºäº†å‡å°‘ç§»åŠ¨æ“ä½œ éœ€è¦è¿™ä¸ªæœ€é•¿é€’å¢å­åºåˆ—ç®—æ³•</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V8å†…å­˜ç®¡ç†</title>
      <link href="/2024/06/27/v8-nei-cun-guan-li/"/>
      <url>/2024/06/27/v8-nei-cun-guan-li/</url>
      
        <content type="html"><![CDATA[<blockquote><p>V8 ä¹Ÿä¼šç”³è¯·å†…å­˜ï¼Œç”³è¯·çš„å†…å­˜åˆä¼šåˆ†ä¸º<strong>å †å†…å­˜å’Œæ ˆå†…å­˜</strong></p></blockquote><h2 id="ä¸€ã€æ ˆ"><a href="#ä¸€ã€æ ˆ" class="headerlink" title="ä¸€ã€æ ˆ"></a>ä¸€ã€æ ˆ</h2><ul><li>æ ˆç”¨äºå­˜æ”¾ JS ä¸­çš„<strong>åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹æŒ‡é’ˆ</strong></li><li>æ ˆçš„<strong>ç©ºé—´æ˜¯è¿ç»­</strong>çš„ï¼Œå¢åŠ åˆ é™¤åªéœ€è¦ç§»åŠ¨æŒ‡é’ˆï¼Œæ“ä½œé€Ÿåº¦éå¸¸å¿«</li><li>æ ˆçš„<strong>ç©ºé—´æ˜¯æœ‰é™</strong>çš„ï¼Œå½“æ ˆæ»¡äº†ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯</li><li>æ ˆä¸€èˆ¬æ˜¯åœ¨<strong>æ‰§è¡Œå‡½æ•°æ—¶åˆ›å»º</strong>çš„ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆå°±ä¼šè¢«é”€æ¯</li></ul><h2 id="äºŒã€å †"><a href="#äºŒã€å †" class="headerlink" title="äºŒã€å †"></a>äºŒã€å †</h2><ul><li>å †ä¸»è¦ç”¨äºå­˜å‚¨ JS ä¸­çš„<strong>å¼•ç”¨ç±»å‹</strong></li></ul><p><img src="https://static.zhufengpeixun.com/dui_de_nei_cun_fen_pei_1639157736483.jpg" alt="new_large_object_space"></p><h3 id="å †ç©ºé—´åˆ†ç±»"><a href="#å †ç©ºé—´åˆ†ç±»" class="headerlink" title="å †ç©ºé—´åˆ†ç±»"></a>å †ç©ºé—´åˆ†ç±»</h3><h4 id="æ–°ç”Ÿä»£-new-space"><a href="#æ–°ç”Ÿä»£-new-space" class="headerlink" title="æ–°ç”Ÿä»£(new space)"></a>æ–°ç”Ÿä»£(new space)</h4><ul><li>æ–°ç”Ÿä»£å†…å­˜ç”¨äºå­˜æ”¾ä¸€äº›<strong>ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­çš„å¯¹è±¡æ•°æ®</strong></li></ul><h4 id="è€ç”Ÿä»£-old-space"><a href="#è€ç”Ÿä»£-old-space" class="headerlink" title="è€ç”Ÿä»£(old space)"></a>è€ç”Ÿä»£(old space)</h4><ul><li>è€ç”Ÿä»£å†…å­˜ç”¨äºå­˜æ”¾ä¸€äº›<strong>ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿çš„å¯¹è±¡æ•°æ®</strong></li><li>å½“<code>new space</code>çš„å¯¹è±¡è¿›è¡Œ<strong>ä¸¤ä¸ªå‘¨æœŸçš„</strong>åƒåœ¾å›æ”¶åï¼Œå¦‚æœæ•°æ®è¿˜å­˜åœ¨<code>new space</code>ä¸­ï¼Œåˆ™å°†ä»–ä»¬å­˜æ”¾åˆ°<code>old space</code>ä¸­</li><li>Old Space ä½¿<strong>ç”¨æ ‡è®°æ¸…é™¤</strong>å’Œ<strong>æ ‡è®°æ•´ç†</strong>çš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶</li></ul><h3 id="ä»€ä¹ˆæ˜¯åƒåœ¾"><a href="#ä»€ä¹ˆæ˜¯åƒåœ¾" class="headerlink" title="ä»€ä¹ˆæ˜¯åƒåœ¾"></a>ä»€ä¹ˆæ˜¯åƒåœ¾</h3><ul><li>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°ä¸€äº›æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šæ”¾åœ¨å †æ ˆä¸­ï¼Œä½†æ˜¯åœ¨ç¨‹åºè¿è¡Œç»“æŸåï¼Œè¿™äº›æ•°æ®å°±ä¸ä¼šå†è¢«ä½¿ç”¨äº†ï¼Œé‚£äº›ä¸å†ä½¿ç”¨çš„æ•°æ®å°±æ˜¯åƒåœ¾</li></ul><h3 id="æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶"><a href="#æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶" class="headerlink" title="æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶"></a>æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶</h3><ul><li>æ–°ç”Ÿä»£å†…å­˜æœ‰<strong>ä¸¤ä¸ªåŒºåŸŸ</strong>ï¼Œåˆ†åˆ«æ˜¯<strong>å¯¹è±¡åŒºåŸŸ(from) å’Œ ç©ºé—²åŒºåŸŸ(to)</strong></li><li>æ–°ç”Ÿä»£å†…å­˜ä½¿ç”¨<strong>Scavenger ç®—æ³•</strong>æ¥ç®¡ç†å†…å­˜,åƒåœ¾å›æ”¶çš„å…¥å£<ul><li><strong>å¹¿åº¦ä¼˜å…ˆéå†</strong> From-Space ä¸­çš„å¯¹è±¡ï¼Œä»æ ¹å¯¹è±¡å‡ºå‘ï¼Œå¹¿åº¦ä¼˜å…ˆéå†æ‰€æœ‰èƒ½åˆ°è¾¾çš„å¯¹è±¡,æŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ° To-Space</li><li>éå†å®Œæˆåï¼Œ<strong>æ¸…ç©º</strong> From-Space</li><li>From-Space å’Œ To-Space <strong>è§’è‰²äº’æ¢</strong></li></ul></li><li>å¤åˆ¶åçš„å¯¹è±¡åœ¨ To-Space ä¸­å ç”¨çš„<strong>å†…å­˜ç©ºé—´æ˜¯è¿ç»­çš„</strong>ï¼Œ<strong>ä¸ä¼šå‡ºç°ç¢ç‰‡é—®é¢˜</strong></li><li>è¿™ç§åƒåœ¾å›æ”¶æ–¹å¼<strong>å¿«é€Ÿ</strong>è€Œåˆ<strong>é«˜æ•ˆ</strong>ï¼Œä½†æ˜¯<strong>ä¼šé€ æˆç©ºé—´æµªè´¹</strong>ï¼ˆæœ‰ To-Space ç©ºé—²åŒºåŸŸï¼‰</li><li>æ–°ç”Ÿä»£çš„ <strong>GC æ¯”è¾ƒé¢‘ç¹</strong></li><li><strong>æ–°ç”Ÿä»£çš„å¯¹è±¡è½¬ç§»åˆ°è€ç”Ÿ</strong>ä»£ç§°ä¸º<strong>æ™‹å‡ Promote</strong>,åˆ¤æ–­æ™‹å‡çš„æƒ…å†µæœ‰ä¸¤ç§<ul><li>ç»è¿‡<strong>ä¸€æ¬¡ GC</strong> è¿˜å­˜æ´»çš„å¯¹è±¡</li><li>å¯¹è±¡å¤åˆ¶åˆ° To-Space æ—¶ï¼ŒTo-Space çš„<strong>ç©ºé—´è¾¾åˆ°ä¸€å®šçš„é™åˆ¶</strong>ï¼ˆè¶…è¿‡ 25%ï¼‰</li></ul></li></ul><h3 id="è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶"><a href="#è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶" class="headerlink" title="è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶"></a>è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶</h3><blockquote><p>V8 åœ¨è€ç”Ÿä»£ä¸­çš„åƒåœ¾å›æ”¶ç­–ç•¥é‡‡ç”¨<a style="color:red"><strong>Mark-Sweep(æ ‡è®°æ¸…é™¤)å’Œ Mark-Compact(æ ‡è®°æ•´ç†)ç›¸ç»“åˆ</strong></a></p></blockquote><h4 id="Mark-Sweep-æ ‡è®°æ¸…é™¤"><a href="#Mark-Sweep-æ ‡è®°æ¸…é™¤" class="headerlink" title="Mark-Sweep(æ ‡è®°æ¸…é™¤)"></a>Mark-Sweep(æ ‡è®°æ¸…é™¤)</h4><ul><li>æ ‡è®°æ¸…é™¤åˆ†ä¸º<strong>æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µ</strong></li><li>åœ¨æ ‡è®°é˜¶æ®µéœ€è¦éå†**(æ·±åº¦ä¼˜å…ˆéå†**)å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶<strong>æ ‡è®°</strong>é‚£äº›<strong>æ´»ç€çš„å¯¹è±¡</strong>ï¼Œç„¶åè¿›å…¥æ¸…é™¤é˜¶æ®µã€‚åœ¨æ¸…é™¤é˜¶æ®µæ€»ï¼Œåª<strong>æ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</strong></li><li>V8 é‡‡å–çš„æ˜¯<strong>é»‘è‰²å’Œç™½è‰²æ¥æ ‡è®°æ•°æ®</strong>ï¼Œåƒåœ¾æ”¶é›†ä¹‹å‰ï¼Œä¼šæŠŠæ‰€æœ‰çš„æ•°æ®è®¾ç½®ä¸º<strong>ç™½è‰²</strong>ï¼Œç”¨æ¥æ ‡è®°æ‰€æœ‰çš„<strong>å°šæœªæ ‡è®°çš„å¯¹è±¡</strong>ï¼Œç„¶åä¼šä» GC æ ¹å‡ºå‘ï¼Œä»¥<strong>æ·±åº¦ä¼˜å…ˆçš„æ–¹å¼æŠŠæ‰€æœ‰çš„èƒ½è®¿é—®åˆ°çš„æ•°æ®éƒ½æ ‡è®°ä¸ºé»‘è‰²</strong>ï¼Œéå†ç»“æŸåé»‘è‰²çš„å°±æ˜¯æ´»çš„æ•°æ®ï¼Œç™½è‰²çš„å°±æ˜¯å¯ä»¥æ¸…ç†çš„åƒåœ¾æ•°æ®</li><li>ç”±äºæ ‡è®°æ¸…é™¤åªæ¸…é™¤æ­»äº¡å¯¹è±¡ï¼Œè€Œæ­»äº¡å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­å ç”¨çš„æ¯”ä¾‹å¾ˆå°ï¼Œæ‰€ä»¥<strong>æ•ˆç‡è¾ƒé«˜</strong></li><li>æ ‡è®°æ¸…é™¤æœ‰ä¸€ä¸ª<strong>é—®é¢˜</strong>å°±æ˜¯è¿›è¡Œä¸€æ¬¡æ ‡è®°æ¸…æ¥šå <strong>ï¼Œå†…å­˜ç©ºé—´å¾€å¾€æ˜¯ä¸è¿ç»­</strong>çš„ï¼Œä¼šå‡ºç°å¾ˆå¤šçš„<strong>å†…å­˜ç¢ç‰‡</strong>ã€‚å¦‚æœåç»­éœ€è¦åˆ†é…ä¸€ä¸ªéœ€è¦å†…å­˜ç©ºé—´è¾ƒå¤šçš„å¯¹è±¡æ—¶ï¼Œå¦‚æœæ‰€æœ‰çš„å†…å­˜ç¢ç‰‡éƒ½ä¸å¤Ÿç”¨ï¼Œå°±ä¼šå‡ºç°å†…å­˜æº¢å‡ºçš„é—®é¢˜</li></ul><h4 id="Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰"><a href="#Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰" class="headerlink" title="Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰"></a>Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰</h4><ul><li>æ ‡è®°æ•´ç†æ­£æ˜¯ä¸ºäº†<strong>è§£å†³æ ‡è®°æ¸…é™¤æ‰€å¸¦æ¥çš„å†…å­˜ç¢ç‰‡çš„é—®é¢˜</strong></li><li>æ ‡è®°æ•´ç†åœ¨æ ‡è®°æ¸…é™¤çš„åŸºç¡€è¿›è¡Œä¿®æ”¹ï¼Œå°†å…¶çš„<strong>æ¸…é™¤é˜¶æ®µå˜ä¸ºç´§ç¼©æç«¯</strong></li><li>åœ¨æ•´ç†çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ´»ç€çš„å¯¹è±¡å‘å†…å­˜åŒºçš„ä¸€æ®µç§»åŠ¨ï¼Œç§»åŠ¨å®Œæˆåç›´æ¥æ¸…ç†æ‰è¾¹ç•Œå¤–çš„å†…å­˜</li><li>ç´§ç¼©è¿‡ç¨‹æ¶‰åŠå¯¹è±¡çš„ç§»åŠ¨ï¼Œæ‰€ä»¥<strong>æ•ˆç‡å¹¶ä¸æ˜¯å¤ªå¥½ï¼Œ</strong>ä½†æ˜¯èƒ½ä¿è¯ä¸ä¼šç”Ÿæˆå†…å­˜ç¢ç‰‡ï¼Œ<strong>ä¸€èˆ¬ 10 æ¬¡æ ‡è®°æ¸…ç†ä¼šä¼´éšä¸€æ¬¡æ ‡è®°æ•´ç†</strong></li></ul><h3 id="ä¼˜åŒ–"><a href="#ä¼˜åŒ–" class="headerlink" title="ä¼˜åŒ–"></a>ä¼˜åŒ–</h3><ul><li>åœ¨æ‰§è¡Œåƒåœ¾å›æ”¶ç®—æ³•æœŸé—´ï¼ŒJS è„šæœ¬éœ€è¦æš‚åœï¼Œè¿™ç§å« Stop the world(å…¨åœé¡¿)</li><li>å¦‚æœå›æ”¶æ—¶é—´è¿‡é•¿ï¼Œä¼šå¼•èµ·å¡é¡¿</li><li>æ€§èƒ½ä¼˜åŒ–<ul><li>æŠŠå¤§ä»»åŠ¡æ‹†åˆ†å°ä»»åŠ¡ï¼Œåˆ†æ­¥æ‰§è¡Œï¼Œç±»ä¼¼ fiber</li><li>å°†ä¸€äº›ä»»åŠ¡æ”¾åœ¨åå°æ‰§è¡Œï¼Œä¸å ç”¨ä¸»çº¿ç¨‹</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JavaScriptæ‰§è¡Œ åƒåœ¾æ ‡è®°ã€åƒåœ¾æ¸…ç†ã€åƒåœ¾æ•´ç† JavaScriptæ‰§è¡Œ<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                          <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Parallel-å¹¶è¡Œæ‰§è¡Œ"><a href="#Parallel-å¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="Parallel(å¹¶è¡Œæ‰§è¡Œ)"></a>Parallel(å¹¶è¡Œæ‰§è¡Œ)</h4><ul><li><strong>æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶</strong>é‡‡å–å¹¶è¡Œç­–ç•¥æå‡åƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œå®ƒä¼š<strong>å¼€å¯å¤šä¸ªè¾…åŠ©çº¿</strong>ç¨‹æ¥æ‰§è¡Œæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶å·¥ä½œ</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾…åŠ©çº¿ç¨‹<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾…åŠ©çº¿ç¨‹<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾…åŠ©çº¿ç¨‹<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¢é‡æ ‡è®°"><a href="#å¢é‡æ ‡è®°" class="headerlink" title="å¢é‡æ ‡è®°"></a>å¢é‡æ ‡è®°</h4><ul><li>è€ç”Ÿä»£å› ä¸ºå¯¹è±¡åˆå¤§åˆå¤šï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶çš„æ—¶é—´æ›´é•¿ï¼Œé‡‡ç”¨å¢é‡æ ‡è®°çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–</li><li>å¢é‡æ ‡è®°å°±æ˜¯æŠŠæ ‡è®°<strong>å·¥ä½œåˆ†æˆå¤šä¸ªé˜¶æ®µ</strong>ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½åªæ ‡è®°ä¸€éƒ¨åˆ†å¯¹è±¡ï¼Œå’Œä¸»çº¿ç¨‹çš„æ‰§è¡Œç©¿æ’è¿›è¡Œ</li><li>ä¸ºäº†æ”¯æŒå¢é‡æ ‡è®°ï¼ŒV8 å¿…é¡»å¯ä»¥æ”¯æŒåƒåœ¾å›æ”¶çš„<strong>æš‚åœå’Œæ¢å¤</strong>ï¼Œæ‰€ä»¥é‡‡ç”¨äº†<code>é»‘ç™½ç°</code>ä¸‰è‰²æ ‡è®°æ³•<ul><li>é»‘è‰²è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹è¢« GC æ ¹å¼•ç”¨åˆ°äº†ï¼Œè€Œä¸”è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½å·²ç»æ ‡è®°å®Œæˆäº†</li><li>ç°è‰²è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹è¢« GC æ ¹å¼•ç”¨åˆ°äº†ï¼Œä½†å­èŠ‚ç‚¹è¿˜æ²¡è¢«åƒåœ¾å›æ”¶å™¨æ ‡è®°å¤„ç†ï¼Œä¹Ÿè¡¨æ˜ç›®å‰æ­£åœ¨å¤„ç†è¿™ä¸ªèŠ‚ç‚¹</li><li>ç™½è‰²è¡¨ç¤ºæ­¤èŠ‚ç‚¹è¿˜æ²¡æœªè¢«åƒåœ¾å›æ”¶å™¨å‘ç°ï¼Œå¦‚æœåœ¨æœ¬è½®éå†ç»“æŸæ—¶è¿˜æ˜¯ç™½è‰²ï¼Œé‚£ä¹ˆè¿™å—æ•°æ®å°±ä¼šè¢«æ”¶å›</li></ul></li><li>å¼•å…¥äº†ç°è‰²æ ‡è®°åï¼Œå°±å¯ä»¥é€šè¿‡åˆ¤æ–­æœ‰æ²¡æœ‰ç°è‰²èŠ‚ç‚¹æ¥åˆ¤æ–­æ ‡è®°æ˜¯å¦å®Œæˆäº†ï¼Œå¦‚æœæœ‰ç°è‰²èŠ‚ç‚¹ï¼Œä¸‹æ¬¡æ¢å¤çš„åº”è¯¥ä»ç°è‰²èŠ‚ç‚¹ç»§ç»­æ‰§è¡Œ</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>å¼€å§‹æ ‡è®°<span class="token operator">--</span><span class="token operator">-</span>å¢é‡æ ‡è®°<span class="token operator">--</span><span class="token operator">-</span>å¢é‡æ ‡è®°<span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†<span class="token operator">--</span><span class="token operator">-</span>æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Write-barrier-å†™å±éšœ"><a href="#Write-barrier-å†™å±éšœ" class="headerlink" title="Write-barrier(å†™å±éšœ)"></a>Write-barrier(å†™å±éšœ)</h4><ul><li>å½“é»‘è‰²æŒ‡å‘ç™½è‰²èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘å†™å±éšœï¼Œè¿™ä¸ªå†™å±éšœä¼šæŠŠç™½è‰²èŠ‚ç‚¹è®¾ç½®ä¸ºç°è‰²</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">global<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"a"</span> <span class="token punctuation">&#125;</span>global<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"b1"</span> <span class="token punctuation">&#125;</span><span class="token comment">//æ‰§è¡Œæ ‡è®°å·¥ä½œ</span>global<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"b2"</span> <span class="token punctuation">&#125;</span><span class="token comment">//ç»§ç»­æ‰§è¡Œæ ‡è®°å·¥ä½œ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Lazy-Sweeping-æƒ°æ€§æ¸…ç†"><a href="#Lazy-Sweeping-æƒ°æ€§æ¸…ç†" class="headerlink" title="Lazy Sweeping(æƒ°æ€§æ¸…ç†)"></a>Lazy Sweeping(æƒ°æ€§æ¸…ç†)</h4><ul><li>å½“å¢é‡æ ‡è®°å®Œæˆåï¼Œå¦‚æœå†…å­˜å¤Ÿç”¨ï¼Œå…ˆä¸æ¸…ç†ï¼Œç­‰ JS ä»£ç æ‰§è¡Œå®Œæ…¢æ…¢æ¸…ç†</li></ul><h4 id="concurrent-å¹¶å‘å›æ”¶"><a href="#concurrent-å¹¶å‘å›æ”¶" class="headerlink" title="concurrent(å¹¶å‘å›æ”¶)"></a>concurrent(å¹¶å‘å›æ”¶)</h4><ul><li>å…¶å®å¢é‡æ ‡è®°å’Œæƒ°æ€§æ¸…ç†å¹¶æ²¡æœ‰å‡å°‘æš‚åœçš„æ€»æ—¶é—´</li><li>å¹¶å‘å›æ”¶å°±æ˜¯ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¾…åŠ©çº¿ç¨‹å¯ä»¥åœ¨åå°å®Œæˆåƒåœ¾å›æ”¶å·¥ä½œ</li><li>æ ‡è®°æ“ä½œå…¨éƒ½ç”±è¾…åŠ©çº¿ç¨‹å®Œï¼Œæ¸…ç†æ“ä½œç”±ä¸»çº¿ç¨‹å’Œè¾…åŠ©çº¿ç¨‹é…åˆå®Œæˆ</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">         <span class="token operator">--</span><span class="token operator">--</span>è¾…åŠ©çº¿ç¨‹æ ‡è®°<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span>è¾…åŠ©çº¿ç¨‹æ ‡è®°<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span>è¾…åŠ©çº¿ç¨‹æ ‡è®°<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ‰§è¡Œ<span class="token constant">JS</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> ç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•é¡µåº”ç”¨é¦–å±åŠ è½½é€Ÿåº¦æ…¢çš„æ€ä¹ˆè§£å†³ï¼Ÿ</title>
      <link href="/2024/05/11/dan-ye-ying-yong-shou-ping-jia-zai-su-du-man-de-zen-me-jie-jue/"/>
      <url>/2024/05/11/dan-ye-ying-yong-shou-ping-jia-zai-su-du-man-de-zen-me-jie-jue/</url>
      
        <content type="html"><![CDATA[<ul><li>ä½¿ç”¨è·¯ç”±æ‡’åŠ è½½ã€å¼‚æ­¥ç»„ä»¶ï¼Œå®ç°ç»„ä»¶æ‹†åˆ†ï¼Œå‡å°‘å…¥å£æ–‡ä»¶ä½“ç§¯å¤§å°,ä¼˜åŒ–ä½“éªŒéª¨æ¶å±</li><li>æŠ½ç¦»å…¬å…±ä»£ç ï¼Œé‡‡ç”¨ splitChunks è¿›è¡Œä»£ç åˆ†å‰²ã€‚</li><li>ç»„ä»¶åŠ è½½é‡‡ç”¨æŒ‰éœ€åŠ è½½çš„æ–¹å¼ã€‚</li><li>é™æ€èµ„æºç¼“å­˜ï¼Œé‡‡ç”¨ HTTP ç¼“å­˜ ï¼ˆå¼ºåˆ¶ç¼“å­˜ã€å¯¹æ¯”ç¼“å­˜ï¼‰ã€ä½¿ç”¨ localStorage å®ç°ç¼“å­˜èµ„æºã€‚</li><li>å›¾ç‰‡èµ„æºçš„å‹ç¼©ï¼Œé›ªç¢§å›¾ã€å¯¹å°å›¾ç‰‡è¿›è¡Œ base64 å‡å°‘ http è¯·æ±‚ã€‚</li><li>æ‰“åŒ…æ—¶å¼€å¯ gzip å‹ç¼©å¤„ç† compression-webpack-plugin æ’ä»¶</li><li>é™æ€èµ„æºé‡‡ç”¨ CDN æé€Ÿã€‚ç»ˆæçš„æ‰‹æ®µ</li><li>ä½¿ç”¨ SSR å¯¹é¦–å±åšæœåŠ¡ç«¯æ¸²æŸ“ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Reactä¸­çš„diffç®—æ³•ï¼Ÿ</title>
      <link href="/2024/05/11/react-zhong-de-diff-suan-fa/"/>
      <url>/2024/05/11/react-zhong-de-diff-suan-fa/</url>
      
        <content type="html"><![CDATA[<p>React çš„ diff ç®—æ³•æ˜¯ React åœ¨æ›´æ–° DOM æ—¶ä½¿ç”¨çš„ç®—æ³•ã€‚å®ƒçš„ç›®çš„æ˜¯æœ€å°åŒ–é¡µé¢çš„é‡æ–°æ¸²æŸ“ï¼Œä»¥ä¾¿æé«˜æ€§èƒ½ã€‚</p><p>å½“ React æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œå®ƒä¼šåœ¨å†…å­˜ä¸­ç”Ÿæˆè™šæ‹Ÿ DOM æ ‘ã€‚ç„¶åï¼Œå®ƒä¼šå¯¹æ¯”æ–°çš„è™šæ‹Ÿ DOM æ ‘å’Œä¹‹å‰çš„æ ‘çš„å·®å¼‚ï¼Œæ‰¾å‡ºæœ€å°çš„å˜åŒ–é›†åˆã€‚è¿™äº›å˜åŒ–ä¼šè¢«æ‰“åŒ…æˆä¸€ç»„æ“ä½œï¼Œç”¨æ¥æ›´æ–°çœŸæ­£çš„ DOMã€‚</p><p>React çš„ diff ç®—æ³•éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li><p>åŒçº§æ¯”è¾ƒï¼šReact ä¼šæŠŠæ–°çš„è™šæ‹Ÿ DOM æ ‘ä¸­çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸ä¹‹å‰çš„æ ‘ä¸­çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœèŠ‚ç‚¹ç±»å‹ä¸åŒæˆ–è€…å±æ€§ä¸åŒï¼ŒReact ä¼šç›´æ¥æ›¿æ¢æ‰åŸæ¥çš„èŠ‚ç‚¹ã€‚å¦‚æœèŠ‚ç‚¹ç±»å‹ç›¸åŒï¼ŒReact ä¼šç»§ç»­é€’å½’æ¯”è¾ƒè¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ã€‚</p></li><li><p>å…ˆåºæ·±åº¦ä¼˜å…ˆæœç´¢ï¼šReact ä¼šæŒ‰ç…§èŠ‚ç‚¹çš„å…ˆåºæ·±åº¦ä¼˜å…ˆæœç´¢çš„é¡ºåºï¼Œå¯¹æ¯”æ–°æ—§ä¸¤æ£µè™šæ‹Ÿ DOM æ ‘ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœèŠ‚ç‚¹ A åœ¨è™šæ‹Ÿ DOM ä¸­å‡ºç°åœ¨èŠ‚ç‚¹ B ä¹‹å‰ï¼Œé‚£ä¹ˆåœ¨æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼ŒA ä¹Ÿä¼šå…ˆäº B è¢«æ¯”è¾ƒã€‚</p><p>åœ¨æ¯”è¾ƒåŒçº§èŠ‚ç‚¹æ—¶ï¼ŒReact ä¼šå°½å¯èƒ½å¤šåœ°ä¿ç•™åŸæ¥çš„èŠ‚ç‚¹ã€‚å¦‚æœæ–°çš„è™šæ‹Ÿ DOM ä¸­æœ‰å¤šä½™çš„èŠ‚ç‚¹ï¼Œå®ƒä¼šæŠŠå¤šä½™çš„èŠ‚ç‚¹æ’å…¥åˆ°ç›¸åº”çš„ä½ç½®ï¼›å¦‚æœæ–°çš„è™šæ‹Ÿ DOM ä¸­å°‘äº†æŸäº›èŠ‚ç‚¹ï¼Œå®ƒä¼šæŠŠå¤šä½™çš„èŠ‚ç‚¹åˆ é™¤ã€‚</p><p>åœ¨æ¯”è¾ƒè¿‡ç¨‹ä¸­ï¼ŒReact ä¼šæŠŠèŠ‚ç‚¹åˆ†æˆå››ç±»ï¼šæ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹ã€ç§»åŠ¨ã€‚å¯¹äºæ–°å¢ã€åˆ é™¤ã€ä¿®æ”¹çš„èŠ‚ç‚¹ï¼ŒReact ä¼šç›´æ¥åœ¨ DOM ä¸­è¿›è¡Œå¯¹åº”çš„æ“ä½œã€‚å¯¹äºç§»åŠ¨çš„èŠ‚ç‚¹ï¼ŒReact ä¼šå…ˆå°†èŠ‚ç‚¹ä»åŸæ¥çš„ä½ç½®åˆ é™¤ï¼Œç„¶åå†å°†èŠ‚ç‚¹æ’å…¥åˆ°æ–°çš„ä½ç½®ã€‚</p><p>é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼ŒReact çš„ diff ç®—æ³•å¯ä»¥æœ€å°åŒ–é¡µé¢çš„é‡æ–°æ¸²æŸ“ï¼Œæé«˜æ€§èƒ½ã€‚</p></li></ul><h2 id="å•èŠ‚ç‚¹çš„-diff"><a href="#å•èŠ‚ç‚¹çš„-diff" class="headerlink" title="å•èŠ‚ç‚¹çš„ diff"></a>å•èŠ‚ç‚¹çš„ diff</h2><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img/20230220164823.png"></p><h3 id="1ã€å•èŠ‚ç‚¹-key-å’Œç±»å‹ç›¸åŒ"><a href="#1ã€å•èŠ‚ç‚¹-key-å’Œç±»å‹ç›¸åŒ" class="headerlink" title="1ã€å•èŠ‚ç‚¹ key å’Œç±»å‹ç›¸åŒ"></a>1ã€å•èŠ‚ç‚¹ key å’Œç±»å‹ç›¸åŒ</h3><p><strong>æ ¸å¿ƒå¤ç”¨è€ Fiber å¹¶è¿”å›</strong></p><ul><li>åœ¨ begin é˜¶æ®µè°ƒç”¨ useFiber ä¼ å…¥è€ fiber å’Œæ–°çš„è™šæ‹Ÿ dom çš„ props åˆ›å»º WorkInProgress çš„æ–° fiber</li></ul><p>main.jsx</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> key<span class="token operator">=</span><span class="token string">"title1"</span> id<span class="token operator">=</span><span class="token string">"title"</span><span class="token operator">></span>      title    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> key<span class="token operator">=</span><span class="token string">"title"</span> id<span class="token operator">=</span><span class="token string">"title2"</span><span class="token operator">></span>      title2    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\react-reconciler\src\ReactChildFiber.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * * @param &#123;*&#125; returnFiber æ ¹fiber div#rootå¯¹åº”çš„fiber * @param &#123;*&#125; currentFirstChild è€çš„FunctionComponentå¯¹åº”çš„fiber * @param &#123;*&#125; element æ–°çš„è™šæ‹ŸDOMå¯¹è±¡ * @returns è¿”å›æ–°çš„ç¬¬ä¸€ä¸ªå­fiber */</span><span class="token keyword">function</span> <span class="token function">reconcileSingleElement</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> currentFirstChild<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> key <span class="token operator">=</span> element<span class="token punctuation">.</span>key  <span class="token keyword">let</span> child <span class="token operator">=</span> currentFirstChild  <span class="token keyword">while</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>key <span class="token operator">===</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>type <span class="token operator">===</span> element<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å¦‚æœkeyä¸€æ ·ï¼Œç±»å‹ä¹Ÿä¸€æ ·ï¼Œåˆ™è®¤ä¸ºæ­¤èŠ‚ç‚¹å¯ä»¥å¤ç”¨</span>        <span class="token keyword">const</span> existing <span class="token operator">=</span> <span class="token function">useFiber</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> element<span class="token punctuation">.</span>props<span class="token punctuation">)</span>        existing<span class="token punctuation">.</span>return <span class="token operator">=</span> returnFiber        <span class="token keyword">return</span> existing      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">useFiber</span><span class="token punctuation">(</span><span class="token parameter">fiber<span class="token punctuation">,</span> pendingProps</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> clone <span class="token operator">=</span> <span class="token function">createWorkInProgress</span><span class="token punctuation">(</span>fiber<span class="token punctuation">,</span> pendingProps<span class="token punctuation">)</span>  clone<span class="token punctuation">.</span>index <span class="token operator">=</span> <span class="token number">0</span>  clone<span class="token punctuation">.</span>sibling <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token keyword">return</span> clone<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€å•èŠ‚ç‚¹-key-ä¸åŒ-ç±»å‹ç›¸åŒï¼Œ"><a href="#2ã€å•èŠ‚ç‚¹-key-ä¸åŒ-ç±»å‹ç›¸åŒï¼Œ" class="headerlink" title="2ã€å•èŠ‚ç‚¹ key ä¸åŒ,ç±»å‹ç›¸åŒï¼Œ"></a>2ã€<strong>å•èŠ‚ç‚¹ key ä¸åŒ,ç±»å‹ç›¸åŒï¼Œ</strong></h3><p><strong>æ ¸å¿ƒåˆ é™¤è€èŠ‚ç‚¹ï¼Œæ·»åŠ æ–°èŠ‚ç‚¹</strong></p><ul><li>begin work é˜¶æ®µ å½“æ£€æµ‹åˆ° key ä¸åŒçš„æ—¶å€™ï¼Œç»™çˆ¶ fiber çš„ deletions=[deletedFiber]èµ‹å€¼å’Œ flags åšä¸Šåˆ é™¤çš„æ ‡è®°ï¼›</li><li>åœ¨ commit é˜¶æ®µ ä»æ ¹èŠ‚ç‚¹é€’å½’éå†å¤„ç†å˜æ›´çš„æ—¶å€™ï¼Œå…ˆé€šè¿‡çˆ¶ fiberï¼Œæ‰¾åˆ°æœ€è¿‘çœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œç„¶åé€’å½’ä»é‡Œå‘å¤–åˆ é™¤å®ƒçš„çœŸå® domï¼Œç›®çš„æ˜¯ä¸ºäº†å¤„ç†ä¸€äº›ç»„ä»¶é”€æ¯æ—¶å€™å¦‚ uesEffect çš„å‰¯ä½œç”¨ã€‚</li></ul><p>main.jsx</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title1<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">      title    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title2<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">      title2    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\react-reconciler\src\ReactChildFiber.js</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">/**   *   * @param &#123;*&#125; returnFiber æ ¹fiber div#rootå¯¹åº”çš„fiber   * @param &#123;*&#125; currentFirstChild è€çš„FunctionComponentå¯¹åº”çš„fiber   * @param &#123;*&#125; element æ–°çš„è™šæ‹ŸDOMå¯¹è±¡   * @returns è¿”å›æ–°çš„ç¬¬ä¸€ä¸ªå­fiber   */</span>  <span class="token keyword">function</span> <span class="token function">reconcileSingleElement</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> currentFirstChild<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> key <span class="token operator">=</span> element<span class="token punctuation">.</span>key<span class="token punctuation">;</span>    <span class="token keyword">let</span> child <span class="token operator">=</span> currentFirstChild<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>key <span class="token operator">===</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//...</span>        <span class="token punctuation">&#125;</span>     <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>       <span class="token function">deleteChild</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»™fiberä¸Šåšæ ‡è®°</span>     <span class="token punctuation">&#125;</span>      child <span class="token operator">=</span> child<span class="token punctuation">.</span>sibling<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   <span class="token comment">/**   *ç»™çˆ¶fiberçš„deletionså’Œflagsèµ‹å€¼   * @param &#123;*&#125; returnFiber çˆ¶fiber   * @param &#123;*&#125; childToDelete å°†è¦åˆ é™¤çš„è€èŠ‚ç‚¹   * @returns   */</span>  <span class="token keyword">function</span> <span class="token function">deleteChild</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> childToDelete</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldTrackSideEffects<span class="token punctuation">)</span> <span class="token keyword">return</span>    <span class="token keyword">const</span> deletions <span class="token operator">=</span> returnFiber<span class="token punctuation">.</span>deletions    <span class="token keyword">if</span> <span class="token punctuation">(</span>deletions <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      returnFiber<span class="token punctuation">.</span>deletions <span class="token operator">=</span> <span class="token punctuation">[</span>childToDelete<span class="token punctuation">]</span>      returnFiber<span class="token punctuation">.</span>flags <span class="token operator">|=</span> ChildDeletion    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      returnFiber<span class="token punctuation">.</span>deletions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>childToDelete<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\react-reconciler\src\ReactFiberCommitWork.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * é€’å½’éå†å¤„ç†å˜æ›´çš„ä½œç”¨ * @param &#123;*&#125; root æ ¹èŠ‚ç‚¹ * @param &#123;*&#125; parentFiber  çˆ¶fiber */</span><span class="token keyword">function</span> <span class="token function">recursivelyTraverseMutationEffects</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> parentFiber</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//å…ˆæŠŠçˆ¶fiberä¸Šè¯¥åˆ é™¤çš„èŠ‚ç‚¹éƒ½åˆ é™¤</span>  <span class="token keyword">const</span> deletions <span class="token operator">=</span> parentFiber<span class="token punctuation">.</span>deletions  <span class="token keyword">if</span> <span class="token punctuation">(</span>deletions <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> deletions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> childToDelete <span class="token operator">=</span> deletions<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token comment">//æäº¤åˆ é™¤å‰¯ä½œç”¨</span>      <span class="token function">commitDeletionEffects</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> parentFiber<span class="token punctuation">,</span> childToDelete<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//å†å»å¤„ç†å‰©ä¸‹çš„å­èŠ‚ç‚¹</span>  <span class="token comment">//åˆ¤æ–­æ˜¯å¦æœ‰å‰¯ä½œç”¨...</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> hostParent <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// çœŸå®çš„çˆ¶fiberå¯¹åº”çš„DOM</span><span class="token comment">/** * æäº¤åˆ é™¤å‰¯ä½œç”¨ * @param &#123;*&#125; root æ ¹èŠ‚ç‚¹ * @param &#123;*&#125; returnFiber çˆ¶fiber * @param &#123;*&#125; deletedFiber åˆ é™¤çš„fiber */</span><span class="token keyword">function</span> <span class="token function">commitDeletionEffects</span><span class="token punctuation">(</span><span class="token parameter">root<span class="token punctuation">,</span> returnFiber<span class="token punctuation">,</span> deletedFiber</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> parent <span class="token operator">=</span> returnFiber  <span class="token comment">//ä¸€ç›´å‘ä¸Šæ‰¾ï¼Œæ‰¾åˆ°çœŸå®çš„DOMèŠ‚ç‚¹ä¸ºæ­¤</span>  <span class="token literal-property property">findParent</span><span class="token operator">:</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        hostParent <span class="token operator">=</span> parent<span class="token punctuation">.</span>stateNode        <span class="token keyword">break</span> findParent      <span class="token punctuation">&#125;</span>      <span class="token keyword">case</span> <span class="token literal-property property">HostRoot</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        hostParent <span class="token operator">=</span> parent<span class="token punctuation">.</span>stateNode<span class="token punctuation">.</span>containerInfo        <span class="token keyword">break</span> findParent      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>return  <span class="token punctuation">&#125;</span>  <span class="token function">commitDeletionEffectsOnFiber</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> returnFiber<span class="token punctuation">,</span> deletedFiber<span class="token punctuation">)</span>  hostParent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span><span class="token comment">/** * åˆ é™¤çœŸå®Dom * @param &#123;*&#125; finishedRoot è·Ÿbiber * @param &#123;*&#125; nearestMountedAncestor æœ€è¿‘çš„çˆ¶fiber * @param &#123;*&#125; deletedFiber è¦åˆ é™¤çš„fiber */</span><span class="token keyword">function</span> <span class="token function">commitDeletionEffectsOnFiber</span><span class="token punctuation">(</span><span class="token parameter">finishedRoot<span class="token punctuation">,</span> nearestMountedAncestor<span class="token punctuation">,</span> deletedFiber</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>deletedFiber<span class="token punctuation">.</span>tag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token literal-property property">HostComponent</span><span class="token operator">:</span>    <span class="token keyword">case</span> <span class="token literal-property property">HostText</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//å½“è¦åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œè¦å…ˆåˆ é™¤å®ƒçš„å­èŠ‚ç‚¹</span>      <span class="token function">recursivelyTraverseDeletionEffects</span><span class="token punctuation">(</span>finishedRoot<span class="token punctuation">,</span> nearestMountedAncestor<span class="token punctuation">,</span> deletedFiber<span class="token punctuation">)</span>      <span class="token comment">//å†æŠŠè‡ªå·±åˆ é™¤</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>hostParent <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">removeChild</span><span class="token punctuation">(</span>hostParent<span class="token punctuation">,</span> deletedFiber<span class="token punctuation">.</span>stateNode<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">break</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">break</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//é€’å½’éå†</span><span class="token keyword">function</span> <span class="token function">recursivelyTraverseDeletionEffects</span><span class="token punctuation">(</span><span class="token parameter">finishedRoot<span class="token punctuation">,</span> nearestMountedAncestor<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> child <span class="token operator">=</span> parent<span class="token punctuation">.</span>child  <span class="token keyword">while</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">commitDeletionEffectsOnFiber</span><span class="token punctuation">(</span>finishedRoot<span class="token punctuation">,</span> nearestMountedAncestor<span class="token punctuation">,</span> child<span class="token punctuation">)</span>    child <span class="token operator">=</span> child<span class="token punctuation">.</span>sibling  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\react-dom-bindings\src\client\ReactDOMHostConfig.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token parameter">parentInstance<span class="token punctuation">,</span> child</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  parentInstance<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3ã€å•èŠ‚ç‚¹-key-ç›¸åŒ-ç±»å‹ä¸åŒ"><a href="#3ã€å•èŠ‚ç‚¹-key-ç›¸åŒ-ç±»å‹ä¸åŒ" class="headerlink" title="3ã€å•èŠ‚ç‚¹ key ç›¸åŒ,ç±»å‹ä¸åŒ"></a>3ã€å•èŠ‚ç‚¹ key ç›¸åŒ,ç±»å‹ä¸åŒ</h3><p><strong>æ ¸å¿ƒåˆ é™¤åŒ…æ‹¬å½“å‰ fiber åœ¨å†…çš„æ‰€æœ‰çš„è€ fiber</strong></p><p>main.jsx</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> key<span class="token operator">=</span><span class="token string">"title1"</span> id<span class="token operator">=</span><span class="token string">"title1"</span><span class="token operator">></span>      title1    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>p onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> key<span class="token operator">=</span><span class="token string">"title1"</span> id<span class="token operator">=</span><span class="token string">"title1"</span><span class="token operator">></span>      title1    <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\react-reconciler\src\ReactChildFiber.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * * @param &#123;*&#125; returnFiber æ ¹fiber div#rootå¯¹åº”çš„fiber * @param &#123;*&#125; currentFirstChild è€çš„FunctionComponentå¯¹åº”çš„fiber * @param &#123;*&#125; element æ–°çš„è™šæ‹ŸDOMå¯¹è±¡ * @returns è¿”å›æ–°çš„ç¬¬ä¸€ä¸ªå­fiber */</span><span class="token keyword">function</span> <span class="token function">reconcileSingleElement</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> currentFirstChild<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> key <span class="token operator">=</span> element<span class="token punctuation">.</span>key  <span class="token keyword">let</span> child <span class="token operator">=</span> currentFirstChild  <span class="token keyword">while</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>key <span class="token operator">===</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>type <span class="token operator">===</span> element<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//...</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">deleteRemaiÂ·ningChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> child<span class="token punctuation">)</span>        <span class="token keyword">break</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//åˆ é™¤ä»currentFirstChildä¹‹åæ‰€æœ‰çš„fiberèŠ‚ç‚¹</span><span class="token keyword">function</span> <span class="token function">deleteRemainingChildren</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> currentFirstChild</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldTrackSideEffects<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token keyword">let</span> childToDelete <span class="token operator">=</span> currentFirstChild  <span class="token keyword">while</span> <span class="token punctuation">(</span>childToDelete <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">deleteChild</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> childToDelete<span class="token punctuation">)</span>    childToDelete <span class="token operator">=</span> childToDelete<span class="token punctuation">.</span>sibling  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">deleteChild</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> childToDelete</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>shouldTrackSideEffects<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token keyword">const</span> deletions <span class="token operator">=</span> returnFiber<span class="token punctuation">.</span>deletions  <span class="token keyword">if</span> <span class="token punctuation">(</span>deletions <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    returnFiber<span class="token punctuation">.</span>deletions <span class="token operator">=</span> <span class="token punctuation">[</span>childToDelete<span class="token punctuation">]</span>    returnFiber<span class="token punctuation">.</span>flags <span class="token operator">|=</span> ChildDeletion  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    returnFiber<span class="token punctuation">.</span>deletions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>childToDelete<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4ã€åŸæ¥å¤šä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹"><a href="#4ã€åŸæ¥å¤šä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹" class="headerlink" title="4ã€åŸæ¥å¤šä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹"></a>4ã€åŸæ¥å¤šä¸ªèŠ‚ç‚¹ï¼Œç°åœ¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹</h3><p><strong>æ ¸å¿ƒåˆ é™¤å¤šä½™èŠ‚ç‚¹</strong></p><ul><li>æ²¡æœ‰è€ fiber ç›´æ¥è¿”å›å…¨æ–°çš„ fiber,å¦‚æœæœ‰è€ fiberï¼Œçœ‹ key æ˜¯å¦ç›¸åŒï¼Œkey ä¸åŒåˆ é™¤å½“å‰ fiber å¹¶æŸ¥æ‰¾ä¸‹ä¸€ä¸ª fiberï¼Œkey ç›¸åŒç±»å‹ä¸åŒ,åˆ é™¤å½“å‰ fiber åœ¨å†…çš„æ‰€æœ‰è€ fiebr å¹¶è¿”å›æ–°çš„ fiberï¼Œå¦‚æœç±»å‹ç›¸åŒå¤åˆ é™¤å‰©ä¸‹çš„å…¶ä»–è€ fiber å¹¶å¤ç”¨è€ fiber è¿”å›</li></ul><p>main.jsx</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B"</span><span class="token operator">></span>        <span class="token constant">B</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span><span class="token operator">></span><span class="token constant">C</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B2"</span><span class="token operator">></span>        <span class="token constant">B2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\react-reconciler\src\ReactChildFiber.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * * @param &#123;*&#125; returnFiber æ ¹fiber div#rootå¯¹åº”çš„fiber * @param &#123;*&#125; currentFirstChild è€çš„FunctionComponentå¯¹åº”çš„fiber * @param &#123;*&#125; element æ–°çš„è™šæ‹ŸDOMå¯¹è±¡ * @returns è¿”å›æ–°çš„ç¬¬ä¸€ä¸ªå­fiber */</span><span class="token keyword">function</span> <span class="token function">reconcileSingleElement</span><span class="token punctuation">(</span><span class="token parameter">returnFiber<span class="token punctuation">,</span> currentFirstChild<span class="token punctuation">,</span> element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//æ–°çš„è™šæ‹ŸDOMçš„key,ä¹Ÿå°±æ˜¯å”¯ä¸€æ ‡å‡†</span>  <span class="token keyword">debugger</span>  <span class="token keyword">const</span> key <span class="token operator">=</span> element<span class="token punctuation">.</span>key <span class="token comment">// null</span>  <span class="token keyword">let</span> child <span class="token operator">=</span> currentFirstChild <span class="token comment">//è€çš„FunctionComponentå¯¹åº”çš„fiber</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>child <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æœ‰è€fiber</span>    <span class="token comment">//åˆ¤æ–­æ­¤è€fiberå¯¹åº”çš„keyå’Œæ–°çš„è™šæ‹ŸDOMå¯¹è±¡çš„keyæ˜¯å¦ä¸€æ · null===null</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>key <span class="token operator">===</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//åˆ¤æ–­è€fiberå¯¹åº”çš„ç±»å‹å’Œæ–°è™šæ‹ŸDOMå…ƒç´ å¯¹åº”çš„ç±»å‹æ˜¯å¦ç›¸åŒ</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>type <span class="token operator">===</span> element<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// p div</span>        <span class="token function">deleteRemainingChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> child<span class="token punctuation">.</span>sibling<span class="token punctuation">)</span>        <span class="token comment">//å¦‚æœkeyä¸€æ ·ï¼Œç±»å‹ä¹Ÿä¸€æ ·ï¼Œåˆ™è®¤ä¸ºæ­¤èŠ‚ç‚¹å¯ä»¥å¤ç”¨</span>        <span class="token keyword">const</span> existing <span class="token operator">=</span> <span class="token function">useFiber</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> element<span class="token punctuation">.</span>props<span class="token punctuation">)</span>        existing<span class="token punctuation">.</span>return <span class="token operator">=</span> returnFiber        <span class="token keyword">return</span> existing      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å¦‚æœæ‰¾åˆ°ä¸€keyä¸€æ ·è€fiber,ä½†æ˜¯ç±»å‹ä¸ä¸€æ ·ï¼Œä¸èƒ½æ­¤è€fiber,æŠŠå‰©ä¸‹çš„å…¨éƒ¨åˆ é™¤</span>        <span class="token function">deleteRemainingChildren</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> child<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token function">deleteChild</span><span class="token punctuation">(</span>returnFiber<span class="token punctuation">,</span> child<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    child <span class="token operator">=</span> child<span class="token punctuation">.</span>sibling  <span class="token punctuation">&#125;</span>  <span class="token comment">//å› ä¸ºæˆ‘ä»¬ç°å®çš„åˆæ¬¡æŒ‚è½½ï¼Œè€èŠ‚ç‚¹currentFirstChildè‚¯å®šæ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ ¹æ®è™šæ‹ŸDOMåˆ›å»ºæ–°çš„FiberèŠ‚ç‚¹</span>  <span class="token keyword">const</span> created <span class="token operator">=</span> <span class="token function">createFiberFromElement</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>  created<span class="token punctuation">.</span>return <span class="token operator">=</span> returnFiber  <span class="token keyword">return</span> created<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šèŠ‚ç‚¹çš„-diff"><a href="#å¤šèŠ‚ç‚¹çš„-diff" class="headerlink" title="å¤šèŠ‚ç‚¹çš„ diff"></a>å¤šèŠ‚ç‚¹çš„ diff</h2><ul><li>DOM DIFF çš„ä¸‰ä¸ªè§„åˆ™<ul><li>åªå¯¹åŒçº§å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä¸åŒå±‚çº§ä¸å¯¹æ¯”</li><li>ä¸åŒçš„ç±»å‹å¯¹åº”ä¸åŒçš„å…ƒç´ </li><li>å¯ä»¥é€šè¿‡ key æ¥æ ‡è¯†åŒä¸€ä¸ªèŠ‚ç‚¹</li></ul></li><li>ç¬¬ 1 è½®éå†<ul><li>å¦‚æœ key ä¸åŒåˆ™ç›´æ¥ç»“æŸæœ¬è½®å¾ªç¯</li><li>newChildren æˆ– oldFiber éå†å®Œï¼Œç»“æŸæœ¬è½®å¾ªç¯</li><li>key ç›¸åŒè€Œ type ä¸åŒï¼Œæ ‡è®°è€çš„ oldFiber ä¸ºåˆ é™¤ï¼Œç»§ç»­å¾ªç¯</li><li>key ç›¸åŒè€Œ type ä¹Ÿç›¸åŒï¼Œåˆ™å¯ä»¥å¤ç”¨è€èŠ‚ oldFiber èŠ‚ç‚¹ï¼Œç»§ç»­å¾ªç¯</li></ul></li><li>ç¬¬ 2 è½®éå†<ul><li>newChildren éå†å®Œè€Œ oldFiber è¿˜æœ‰ï¼Œéå†å‰©ä¸‹æ‰€æœ‰çš„ oldFiber æ ‡è®°ä¸ºåˆ é™¤ï¼ŒDIFF ç»“æŸ</li><li>oldFiber éå†å®Œäº†ï¼Œè€Œ newChildren è¿˜æœ‰ï¼Œå°†å‰©ä¸‹çš„ newChildren æ ‡è®°ä¸ºæ’å…¥ï¼ŒDIFF ç»“æŸ</li><li>newChildren å’Œ oldFiber éƒ½åŒæ—¶éå†å®Œæˆï¼Œdiff ç»“æŸ</li><li>newChildren å’Œ oldFiber éƒ½æ²¡æœ‰å®Œæˆï¼Œåˆ™è¿›è¡Œ<code>èŠ‚ç‚¹ç§»åŠ¨</code>çš„é€»è¾‘</li></ul></li><li>ç¬¬ 3 è½®éå†<ul><li>å¤„ç†èŠ‚ç‚¹ç§»åŠ¨çš„æƒ…å†µ</li></ul></li></ul><h3 id="1ã€å¤šä¸ªèŠ‚ç‚¹çš„æ•°é‡å’Œ-key-ç›¸åŒï¼Œæœ‰çš„-type-ä¸åŒ"><a href="#1ã€å¤šä¸ªèŠ‚ç‚¹çš„æ•°é‡å’Œ-key-ç›¸åŒï¼Œæœ‰çš„-type-ä¸åŒ" class="headerlink" title="1ã€å¤šä¸ªèŠ‚ç‚¹çš„æ•°é‡å’Œ key ç›¸åŒï¼Œæœ‰çš„ type ä¸åŒ"></a>1ã€å¤šä¸ªèŠ‚ç‚¹çš„æ•°é‡å’Œ key ç›¸åŒï¼Œæœ‰çš„ type ä¸åŒ</h3><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img/20230220164902.png"></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B"</span><span class="token operator">></span>        <span class="token constant">B</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span> id<span class="token operator">=</span><span class="token string">"C"</span><span class="token operator">></span>        <span class="token constant">C</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>p key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B2"</span><span class="token operator">></span>        <span class="token constant">B2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span> id<span class="token operator">=</span><span class="token string">"C2"</span><span class="token operator">></span>        <span class="token constant">C2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2ã€å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ-key-å…¨éƒ¨ç›¸åŒï¼Œæœ‰æ–°å¢å…ƒç´ "><a href="#2ã€å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ-key-å…¨éƒ¨ç›¸åŒï¼Œæœ‰æ–°å¢å…ƒç´ " class="headerlink" title="2ã€å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ key å…¨éƒ¨ç›¸åŒï¼Œæœ‰æ–°å¢å…ƒç´ "></a>2ã€å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ key å…¨éƒ¨ç›¸åŒï¼Œæœ‰æ–°å¢å…ƒç´ </h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B"</span><span class="token operator">></span>        <span class="token constant">B</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span> id<span class="token operator">=</span><span class="token string">"C"</span><span class="token operator">></span>        <span class="token constant">C</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>p key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B2"</span><span class="token operator">></span>        <span class="token constant">B2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span> id<span class="token operator">=</span><span class="token string">"C2"</span><span class="token operator">></span>        <span class="token constant">C2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"D"</span><span class="token operator">></span><span class="token constant">D</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ-key-å…¨éƒ¨ç›¸åŒï¼Œæœ‰åˆ é™¤è€å…ƒç´ "><a href="#3-å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ-key-å…¨éƒ¨ç›¸åŒï¼Œæœ‰åˆ é™¤è€å…ƒç´ " class="headerlink" title="3.å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ key å…¨éƒ¨ç›¸åŒï¼Œæœ‰åˆ é™¤è€å…ƒç´ "></a>3.å¤šä¸ªèŠ‚ç‚¹çš„ç±»å‹å’Œ key å…¨éƒ¨ç›¸åŒï¼Œæœ‰åˆ é™¤è€å…ƒç´ </h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B"</span><span class="token operator">></span>        <span class="token constant">B</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span> id<span class="token operator">=</span><span class="token string">"C"</span><span class="token operator">></span>        <span class="token constant">C</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>p key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"B2"</span><span class="token operator">></span>        <span class="token constant">B2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-å¤šä¸ªèŠ‚ç‚¹æ•°é‡ä¸åŒã€key-ä¸åŒ"><a href="#4-å¤šä¸ªèŠ‚ç‚¹æ•°é‡ä¸åŒã€key-ä¸åŒ" class="headerlink" title="4.å¤šä¸ªèŠ‚ç‚¹æ•°é‡ä¸åŒã€key ä¸åŒ"></a>4.å¤šä¸ªèŠ‚ç‚¹æ•°é‡ä¸åŒã€key ä¸åŒ</h3><ul><li>å¤šä¸ªèŠ‚ç‚¹æ•°é‡ä¸åŒã€key ä¸åŒ</li><li>ç¬¬ä¸€è½®æ¯”è¾ƒ A å’Œ Aï¼Œç›¸åŒå¯ä»¥å¤ç”¨ï¼Œæ›´æ–°ï¼Œç„¶åæ¯”è¾ƒ B å’Œ Cï¼Œkey ä¸åŒç›´æ¥è·³å‡ºç¬¬ä¸€ä¸ªå¾ªç¯</li><li>æŠŠå‰©ä¸‹ oldFiber çš„æ”¾å…¥ existingChildren è¿™ä¸ª map ä¸­</li><li>ç„¶åå£°æ˜ä¸€ä¸ª<code>lastPlacedIndex</code>å˜é‡ï¼Œè¡¨ç¤ºä¸éœ€è¦ç§»åŠ¨çš„è€èŠ‚ç‚¹çš„ç´¢å¼•</li><li>ç»§ç»­å¾ªç¯å‰©ä¸‹çš„è™šæ‹Ÿ DOM èŠ‚ç‚¹</li><li>å¦‚æœèƒ½åœ¨ map ä¸­æ‰¾åˆ°ç›¸åŒ key ç›¸åŒ type çš„èŠ‚ç‚¹åˆ™å¯ä»¥å¤ç”¨è€ fiber,å¹¶æŠŠæ­¤è€ fiber ä» map ä¸­åˆ é™¤</li><li>å¦‚æœèƒ½åœ¨ map ä¸­æ‰¾ä¸åˆ°ç›¸åŒ key ç›¸åŒ type çš„èŠ‚ç‚¹åˆ™åˆ›å»ºæ–°çš„ fiber</li><li>å¦‚æœæ˜¯å¤ç”¨è€çš„ fiber,åˆ™åˆ¤æ–­è€ fiber çš„ç´¢å¼•æ˜¯å¦å°äº lastPlacedIndexï¼Œå¦‚æœæ˜¯è¦ç§»åŠ¨è€ fiberï¼Œä¸å˜</li><li>å¦‚æœæ˜¯å¤ç”¨è€çš„ fiber,åˆ™åˆ¤æ–­è€ fiber çš„ç´¢å¼•æ˜¯å¦å°äº lastPlacedIndexï¼Œå¦‚æœå¦åˆ™æ›´æ–° lastPlacedIndex ä¸ºè€ fiber çš„ index</li><li>æŠŠæ‰€æœ‰çš„ map ä¸­å‰©ä¸‹çš„ fiber å…¨éƒ¨æ ‡è®°ä¸ºåˆ é™¤</li><li>(åˆ é™¤#li#F)=&gt;(æ·»åŠ #li#B)=&gt;(æ·»åŠ #li#G)=&gt;(æ·»åŠ #li#D)=&gt;null</li></ul><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img/20230220164329.png"></p><p><img src="C:\Users\å“—å•¦å•¦\AppData\Roaming\Typora\typora-user-images\image-20230220164410416.png" alt="image-20230220164410416"></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">FunctionComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> number <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"b"</span><span class="token operator">></span>        <span class="token constant">B</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span><span class="token operator">></span><span class="token constant">C</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"D"</span><span class="token operator">></span><span class="token constant">D</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"E"</span><span class="token operator">></span><span class="token constant">E</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"F"</span> id<span class="token operator">=</span><span class="token string">"F"</span><span class="token operator">></span>        <span class="token constant">F</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>ul key<span class="token operator">=</span><span class="token string">"container"</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"A"</span><span class="token operator">></span><span class="token constant">A2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"C"</span><span class="token operator">></span><span class="token constant">C2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"E"</span><span class="token operator">></span><span class="token constant">E2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"B"</span> id<span class="token operator">=</span><span class="token string">"b2"</span><span class="token operator">></span>        <span class="token constant">B2</span>      <span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"G"</span><span class="token operator">></span><span class="token constant">G</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>      <span class="token operator">&lt;</span>li key<span class="token operator">=</span><span class="token string">"D"</span><span class="token operator">></span><span class="token constant">D2</span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>ul<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueä¸­çš„æ€§èƒ½ä¼˜åŒ–æœ‰å“ªäº›</title>
      <link href="/2024/05/11/vue-zhong-de-xing-neng-you-hua-you-na-xie/"/>
      <url>/2024/05/11/vue-zhong-de-xing-neng-you-hua-you-na-xie/</url>
      
        <content type="html"><![CDATA[<ul><li>Vue2 ä¸­æ•°æ®å±‚çº§ä¸æ˜“è¿‡æ·±ï¼Œï¼ˆä¼šæ•°æ®åŠ«æŒæ¯ä¸€å±‚éƒ½å¢åŠ getterå’Œsetterï¼‰.åˆç†è®¾ç½®å“åº”å¼æ•°æ®ï¼›</li><li>Vue2 éå“åº”å¼æ•°æ®å¯ä»¥é€šè¿‡ Object.freeze()æ–¹æ³•å†»ç»“å±æ€§ï¼›</li><li>Vue2 ä¸­é‡‡ç”¨å‡½æ•°å¼ç»„ä»¶ -&gt; å‡½æ•°å¼ç»„ä»¶å¼€é”€ä½ï¼›</li><li>ä½¿ç”¨æ•°æ®æ—¶ç¼“å­˜å€¼çš„ç»“æœï¼Œä¸é¢‘ç¹å–å€¼ï¼›</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">b</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token number">0</span><span class="token operator">&lt;=</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  a<span class="token punctuation">.</span>b<span class="token operator">+=</span>i<span class="token punctuation">&#125;</span><span class="token comment">//æ¯æ¬¡éƒ½è§¦å‘å–å€¼getteræ“ä½œ ä¾èµ–æ”¶é›†ç­‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åˆç†è®¾ç½® Key å±æ€§ï¼›</li><li><code>v-show</code> å’Œ <code>v-if</code> çš„é€‰å–ï¼›</li><li>æ§åˆ¶ç»„ä»¶ç²’åº¦ -&gt; Vue é‡‡ç”¨ç»„ä»¶çº§æ›´æ–°ï¼›ä¸ç„¶æ•°æ®ä¸€å˜ çœŸä¸ªç»„ä»¶æ›´æ–°</li><li>é‡‡ç”¨å¼‚æ­¥ç»„ä»¶ -&gt; å€ŸåŠ©æ„å»ºå·¥å…·çš„åˆ†åŒ…çš„èƒ½åŠ›ï¼›</li><li>åˆç†ä½¿ç”¨<code>keep-alive</code> ã€<code>v-once</code>ã€<code>v-memo</code> è¿›è¡Œé€»è¾‘ä¼˜åŒ–ï¼›</li><li>åˆ†é¡µã€è™šæ‹Ÿæ»šåŠ¨ã€æ—¶é—´åˆ†ç‰‡ç­‰ç­–ç•¥â€¦</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‡½æ•°ç»„ä»¶çš„ä¼˜åŠ¿</title>
      <link href="/2024/05/11/han-shu-zu-jian-de-you-shi/"/>
      <url>/2024/05/11/han-shu-zu-jian-de-you-shi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å‡½æ•°å¼ç»„ä»¶æ˜¯ä¸€ç§å®šä¹‰<strong>è‡ªèº«æ²¡æœ‰ä»»ä½•çŠ¶æ€çš„ç»„ä»¶çš„æ–¹å¼ã€‚å®ƒä»¬å¾ˆåƒçº¯å‡½æ•°ï¼šæ¥æ”¶ propsï¼Œè¿”å› vnodes</strong>ã€‚å‡½æ•°å¼ç»„ä»¶åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­ä¸ä¼šåˆ›å»ºç»„ä»¶å®ä¾‹ (ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰ this)ï¼Œä¹Ÿä¸ä¼šè§¦å‘å¸¸è§„çš„ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚</p></blockquote><p>åœ¨ Vue2 æ­£å¸¸ç»„ä»¶æ˜¯é€šè¿‡<code>Vue.extend</code>æ–¹æ³•è¿›è¡Œåˆ›å»ºï¼Œ å‡½æ•°å¼ç»„ä»¶å°±æ˜¯æ™®é€šçš„å‡½æ•°ï¼Œæ²¡æœ‰ new çš„è¿‡ç¨‹ã€‚æœ€ç»ˆå°±æ˜¯å°†è¿”å›çš„è™šæ‹Ÿ DOM å˜æˆçœŸå® DOM æ›¿æ¢å¯¹åº”çš„ç»„ä»¶ï¼ŒåŒæ—¶å‡½æ•°å¼ç»„ä»¶ä¸ä¼šè¢«è®°å½•åœ¨ç»„ä»¶çš„çˆ¶å­å…³ç³»ä¸­ã€‚</p><p><strong>å› æ­¤åœ¨ Vue2 ä¸­å‡½æ•°å¼ç»„ä»¶æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š</strong></p><ul><li><strong>æ€§èƒ½ä¼˜åŒ–ï¼š</strong> å‡½æ•°å¼ç»„ä»¶ç›¸å¯¹äºå¸¸è§„ç»„ä»¶åœ¨æ¸²æŸ“æ€§èƒ½ä¸Šå…·æœ‰ä¼˜åŠ¿ã€‚ç”±äºå‡½æ•°å¼ç»„ä»¶æ˜¯æ— çŠ¶æ€çš„ï¼Œä¸åŒ…å«ç”Ÿå‘½å‘¨æœŸé’©å­å’Œå®ä¾‹çŠ¶æ€ï¼Œæ¸²æŸ“æ—¶çš„å¼€é”€æ›´å°ã€‚</li><li><strong>æ²¡æœ‰ this</strong> ï¼š å‡½æ•°å¼ç»„ä»¶ä¸ä¾èµ–äº thisï¼Œä¸å†æœ‰ this ç»‘å®šé—®é¢˜ã€‚</li><li><strong>å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼š</strong> å‡½æ•°å¼ç»„ä»¶æ›´åŠ ç®€æ´å’Œç›´è§‚ã€‚åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ²¡æœ‰å¤æ‚çš„é€‰é¡¹å¯¹è±¡å’Œå®ä¾‹å±æ€§ã€‚è¿™ä½¿å¾—ä»£ç æ›´æ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚</li><li><strong>æ˜“æµ‹è¯•ï¼š</strong> ç”±äºå‡½æ•°å¼ç»„ä»¶æ˜¯çº¯å‡½æ•°ï¼Œå› æ­¤æ›´å®¹æ˜“ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</li></ul><blockquote><p><strong>ä½†åœ¨ Vue3 ä¸­å› ä¸ºæ‰€æœ‰çš„ç»„ä»¶éƒ½ä¸ç”¨ <code>new</code> äº†ï¼Œæœ¬èº«å°±æ˜¯å‡½æ•°å®ç°çš„ï¼Œæ‰€ä»¥åœ¨æ€§èƒ½ä¸Šæ²¡æœ‰äº†ä¼˜åŠ¿ï¼Œæ‰€ä»¥ä¸åœ¨å»ºè®®ä½¿ç”¨å‡½æ•°ç»„ä»¶</strong>~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.setæ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„</title>
      <link href="/2024/03/28/vue-set-fang-fa-shi-ru-he-shi-xian-de/"/>
      <url>/2024/03/28/vue-set-fang-fa-shi-ru-he-shi-xian-de/</url>
      
        <content type="html"><![CDATA[<p><code>Vue2</code> ä¸å…è®¸åœ¨å·²ç»åˆ›å»ºçš„å®ä¾‹ä¸ŠåŠ¨æ€æ·»åŠ æ–°çš„å“åº”å¼å±æ€§ã€‚æ‰€ä»¥é‡‡ç”¨ set API æ¥è¿›è¡Œå®ç°ã€‚</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">set</span><span class="token punctuation">(</span>targetx<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 1.æ˜¯å¼€å‘ç¯å¢ƒ target æ²¡å®šä¹‰æˆ–è€…æ˜¯åŸºç¡€ç±»å‹åˆ™æŠ¥é”™</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">"production"</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">isUndef</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isPrimitive</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Cannot set reactive property on undefined, null, or primitive value: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// 2.å¦‚æœæ˜¯æ•°ç»„ Vue.set(array,1,100); è°ƒç”¨æˆ‘ä»¬é‡å†™çš„spliceæ–¹æ³• (è¿™æ ·å¯ä»¥æ›´æ–°è§†å›¾)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isValidArrayIndex</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">.</span>length <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>length<span class="token punctuation">,</span> key<span class="token punctuation">)</span>    target<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> val<span class="token punctuation">)</span>    <span class="token keyword">return</span> val  <span class="token punctuation">&#125;</span>  <span class="token comment">// 3.å¦‚æœæ˜¯å¯¹è±¡æœ¬èº«çš„å±æ€§ï¼Œåˆ™ç›´æ¥æ·»åŠ å³å¯</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> target <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>key <span class="token keyword">in</span> Object<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val    <span class="token keyword">return</span> val  <span class="token punctuation">&#125;</span>  <span class="token comment">// 4.å¦‚æœæ˜¯Vueå®ä¾‹ æˆ– æ ¹æ•°æ®dataæ—¶ æŠ¥é”™,ï¼ˆæ›´æ–°_data æ— æ„ä¹‰ï¼‰</span>  <span class="token keyword">const</span> ob <span class="token operator">=</span> target<span class="token punctuation">.</span>__ob__  <span class="token keyword">if</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>_isVue <span class="token operator">||</span> <span class="token punctuation">(</span>ob <span class="token operator">&amp;&amp;</span> ob<span class="token punctuation">.</span>vmCount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">"production"</span> <span class="token operator">&amp;&amp;</span>      <span class="token function">warn</span><span class="token punctuation">(</span>        <span class="token string">"Avoid adding reactive properties to a Vue instance or its root $data "</span> <span class="token operator">+</span>          <span class="token string">"at runtime - declare it upfront in the data option."</span>      <span class="token punctuation">)</span>    <span class="token keyword">return</span> val  <span class="token punctuation">&#125;</span>  <span class="token comment">// 5.å¦‚æœä¸æ˜¯å“åº”å¼çš„ä¹Ÿä¸éœ€è¦å°†å…¶å®šä¹‰æˆå“åº”å¼å±æ€§</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ob<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val    <span class="token keyword">return</span> val  <span class="token punctuation">&#125;</span>  <span class="token comment">// 6.å°†å±æ€§å®šä¹‰æˆå“åº”å¼çš„</span>  <span class="token function">defineReactive</span><span class="token punctuation">(</span>ob<span class="token punctuation">.</span>value<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span>  <span class="token comment">// é€šçŸ¥è§†å›¾æ›´æ–°</span>  ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> val<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å½“æˆ‘ä»¬é€‰æ‹©æ–°å¢å±æ€§æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¯¹è±¡åˆå¹¶çš„æ–¹å¼å®ç°</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>info<span class="token punctuation">,</span><span class="token operator">...</span><span class="token punctuation">&#123;</span><span class="token literal-property property">newProperty1</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token literal-property property">newProperty2</span><span class="token operator">:</span><span class="token number">2</span> <span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><code>Vue3</code> åˆ™é‡‡ç”¨ proxy æ¥è¿›è¡Œæ•°æ®åŠ«æŒï¼Œå¯ä»¥ç›´æ¥åŠ«æŒåˆ°å±æ€§æ–°å¢çš„é€»è¾‘ï¼Œæ— éœ€é‡‡ç”¨è¡¥ä¸çš„æ–¹å¼æ¥è¿›è¡Œå®ç°ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueç»„ä»¶ä¸­çš„dataä¸ºä»€ä¹ˆå¿…é¡»æ˜¯å‡½æ•°</title>
      <link href="/2024/03/28/vue-zu-jian-zhong-de-data-wei-shi-me-bi-xu-shi-han-shu/"/>
      <url>/2024/03/28/vue-zu-jian-zhong-de-data-wei-shi-me-bi-xu-shi-han-shu/</url>
      
        <content type="html"><![CDATA[<ul><li>æ ¹å®ä¾‹å¯¹è±¡<code>data</code>å¯ä»¥æ˜¯å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯å‡½æ•°â€œå•ä¾‹â€ï¼Œä¸ä¼šäº§ç”Ÿæ•°æ®æ±¡æŸ“æƒ…å†µ</li><li>ç»„ä»¶å®ä¾‹å¯¹è±¡<code>data</code>å¿…é¡»ä¸ºå‡½æ•°ï¼Œç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å¤šä¸ªç»„ä»¶å®ä¾‹å¯¹è±¡ä¹‹é—´å…±ç”¨ä¸€ä¸ª<code>data</code>ï¼Œäº§ç”Ÿæ•°æ®æ±¡æŸ“ã€‚æ‰€ä»¥éœ€è¦é€šè¿‡å·¥å‚å‡½æ•°è¿”å›å…¨æ–°çš„ data ä½œä¸ºç»„ä»¶çš„æ•°æ®æº</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>Vue<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">Sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä¼šå°†dataå­˜èµ·æ¥</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>options<span class="token punctuation">.</span>data  <span class="token punctuation">&#125;</span>  Sub<span class="token punctuation">.</span>options <span class="token operator">=</span> options  <span class="token keyword">return</span> Sub<span class="token punctuation">&#125;</span><span class="token keyword">let</span> Child <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"xxx"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// ä¸¤ä¸ªç»„ä»¶å°±æ˜¯ä¸¤ä¸ªå®ä¾‹, å¸Œæœ›æ•°æ®äº’ä¸å¹²æ‰°</span><span class="token keyword">let</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">let</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span>child1<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"jw"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Vue3 ä¸€åˆ‡ä»ç»„ä»¶å¼€å§‹ï¼Œæ‰€ä»¥ data éƒ½ä¸ºå‡½æ•°å½¢å¼ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.extendæ–¹æ³•çš„ä½œç”¨</title>
      <link href="/2024/03/28/vue-extend-fang-fa-de-zuo-yong/"/>
      <url>/2024/03/28/vue-extend-fang-fa-de-zuo-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-Vue-extend-æ¦‚å¿µ"><a href="#1-1-Vue-extend-æ¦‚å¿µ" class="headerlink" title="1.1 Vue.extend æ¦‚å¿µ"></a>1.1 Vue.extend æ¦‚å¿µ</h2><p>ä½¿ç”¨åŸºç¡€ Vue æ„é€ å™¨ï¼Œåˆ›å»ºä¸€ä¸ªâ€œå­ç±»â€ã€‚å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«ç»„ä»¶é€‰é¡¹çš„å¯¹è±¡ã€‚</p><p><code>data</code> é€‰é¡¹æ˜¯ç‰¹ä¾‹ï¼Œéœ€è¦æ³¨æ„ - åœ¨ <code>Vue.extend()</code> ä¸­å®ƒå¿…é¡»æ˜¯å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> Profile <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">"&lt;p>&#123;&#123;firstName&#125;&#125; &#123;&#123;lastName&#125;&#125; aka &#123;&#123;alias&#125;&#125;&lt;/p>"</span><span class="token punctuation">,</span>  <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">firstName</span><span class="token operator">:</span> <span class="token string">"Walter"</span><span class="token punctuation">,</span>      <span class="token literal-property property">lastName</span><span class="token operator">:</span> <span class="token string">"White"</span><span class="token punctuation">,</span>      <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token string">"Heisenberg"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»º Profile å®ä¾‹ï¼Œå¹¶æŒ‚è½½åˆ°ä¸€ä¸ªå…ƒç´ ä¸Šã€‚</span><span class="token keyword">new</span> <span class="token class-name">Profile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token string">"#mount-point"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-2-åˆ†æ"><a href="#1-2-åˆ†æ" class="headerlink" title="1.2 åˆ†æ"></a>1.2 åˆ†æ</h2><ul><li>æ‰€æœ‰çš„ç»„ä»¶åˆ›å»ºæ—¶éƒ½ä¼šè°ƒç”¨<code>Vue.extend</code>æ–¹æ³•è¿›è¡Œåˆ›å»º</li><li>æœ‰äº†æ­¤æ–¹æ³•æˆ‘ä»¬å¯ä»¥ç”¨äºæ‰‹åŠ¨æŒ‚è½½ç»„ä»¶ã€‚</li><li>åç«¯å­˜å‚¨çš„å­—ç¬¦ä¸²æ¨¡æ¿æˆ‘ä»¬å¯ä»¥é€šè¿‡ Vue.extend æ–¹æ³•å°†å…¶è¿›è¡Œæ¸²æŸ“ï¼Œä½†æ˜¯éœ€è¦å¼•å…¥ç¼–è¯‘æ—¶ã€‚</li></ul><h2 id="1-3-Vue3-ä¸­æ‰‹åŠ¨æŒ‚è½½"><a href="#1-3-Vue3-ä¸­æ‰‹åŠ¨æŒ‚è½½" class="headerlink" title="1.3 Vue3 ä¸­æ‰‹åŠ¨æŒ‚è½½"></a>1.3 Vue3 ä¸­æ‰‹åŠ¨æŒ‚è½½</h2><blockquote><p>Vue3 ä¸­ä¸åœ¨ä½¿ç”¨ <code>Vue.extend</code> æ–¹æ³•ï¼Œè€Œæ˜¯é‡‡ç”¨<code>render</code>æ–¹æ³•è¿›è¡Œæ‰‹åŠ¨æ¸²æŸ“ã€‚</p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> render<span class="token punctuation">,</span> h<span class="token punctuation">,</span> ref <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./vue.esm-browser.js"</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div id="counter">&#123;&#123; count &#125;&#125;&lt;/div></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>    <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯´è¯´ä½ å¯¹åŒå‘ç»‘å®šçš„ç†è§£,ä»¥åŠå®ƒçš„å®ç°åŸç†å—</title>
      <link href="/2024/03/27/shuo-shuo-ni-dui-shuang-xiang-bang-ding-de-li-jie-yi-ji-ta-de-shi-xian-yuan-li-ma/"/>
      <url>/2024/03/27/shuo-shuo-ni-dui-shuang-xiang-bang-ding-de-li-jie-yi-ji-ta-de-shi-xian-yuan-li-ma/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-åŒå‘ç»‘å®šçš„æ¦‚å¿µ"><a href="#1-1-åŒå‘ç»‘å®šçš„æ¦‚å¿µ" class="headerlink" title="1.1 åŒå‘ç»‘å®šçš„æ¦‚å¿µ"></a>1.1 åŒå‘ç»‘å®šçš„æ¦‚å¿µ</h2><p>vue ä¸­åŒå‘ç»‘å®šé çš„æ˜¯æŒ‡ä»¤ v-modelï¼Œå¯ä»¥ç»‘å®šä¸€ä¸ªåŠ¨æ€å€¼åˆ°è§†å›¾ä¸Šï¼ŒåŒæ—¶ä¿®æ”¹è§†å›¾èƒ½æ”¹å˜æ•°æ®å¯¹åº”çš„å€¼ï¼ˆèƒ½ä¿®æ”¹çš„è§†å›¾å°±æ˜¯<strong>è¡¨å•ç»„ä»¶</strong>ï¼‰ ç»å¸¸ä¼šå¬åˆ°ä¸€å¥è¯ï¼šv-model æ˜¯ value + input çš„è¯­æ³•ç³–ã€‚</p><p><code>v-model</code> æŒ‡ä»¤æ‰©å±•ä¸º <code>modelValue</code> å’Œ <code>onUpdate:modelValue</code> åœ¨æ¨¡æ¿ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¿…é¡»è‡ªå·±æä¾›è¿™äº› propsï¼š</p><h2 id="1-2-è¡¨å•å…ƒç´ ä¸­çš„-v-model"><a href="#1-2-è¡¨å•å…ƒç´ ä¸­çš„-v-model" class="headerlink" title="1.2 è¡¨å•å…ƒç´ ä¸­çš„ v-model"></a>1.2 è¡¨å•å…ƒç´ ä¸­çš„ v-model</h2><p>å†…éƒ¨ä¼šæ ¹æ®æ ‡ç­¾çš„ä¸åŒè§£æå‡ºä¸åŒçš„è¯­æ³•ã€‚å¹¶ä¸”è¿™é‡Œæœ‰â€œé¢å¤–â€çš„å¤„ç†é€»è¾‘</p><ul><li>ä¾‹å¦‚ æ–‡æœ¬æ¡†ä¼šè¢«è§£ææˆ value + input äº‹ä»¶ (åŒæ—¶å¤„ç†ä¸­æ–‡è¾“å…¥é—®é¢˜)</li></ul><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;input :value&#x3D;&quot;value&quot; @input&#x3D;&quot;(e) &#x3D;&gt; (value &#x3D; e.target.value)&quot; &#x2F;&gt;&#x2F;&#x2F; è¾“å…¥ä¸­åˆè¿˜æ²¡åˆ°å±å¹•ä¹Ÿæ˜¯å“åº”å¼çš„&lt;input v-model&#x3D;&quot;value&quot; &#x2F;&gt;&#x2F;&#x2F;åº•å±‚åšè¿‡å¤„ç† å¯¹ä¸­æ–‡è¿›è¡Œæ‹¦æˆª<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ä¾‹å¦‚ å¤é€‰æ¡†ä¼šè¢«è§£ææˆ checked + change äº‹ä»¶</li><li>â€¦</li></ul><p><a href="https://github1s.com/vuejs/core/blob/HEAD/packages/runtime-dom/src/directives/vModel.ts#L45-L46">v-model</a></p><h2 id="1-3-ç»„ä»¶ä¸­çš„-v-model"><a href="#1-3-ç»„ä»¶ä¸­çš„-v-model" class="headerlink" title="1.3 ç»„ä»¶ä¸­çš„ v-model"></a>1.3 ç»„ä»¶ä¸­çš„ v-model</h2><p>å¾ˆé—æ†¾åœ¨ vue2 ä¸­ä¸æ”¯æŒä½¿ç”¨å¤šä¸ª v-model çš„ ï¼ˆä½¿ç”¨è¿‡æ—¶çš„<code>.sync</code>è¯­æ³•ï¼‰ã€‚vue3 ä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è¿›è¡Œç»‘å®šã€‚</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;my v-model:a&#x3D;&quot;a&quot; v-model:b&#x3D;&quot;b&quot; v-model:c&#x3D;&quot;c&quot;&gt;&lt;&#x2F;my&gt;&lt;my v-model&#x3D;&quot;value&quot;&gt;&lt;&#x2F;my&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.useæ˜¯å¹²ä»€ä¹ˆçš„</title>
      <link href="/2024/03/27/vue-use-shi-gan-shi-me-de/"/>
      <url>/2024/03/27/vue-use-shi-gan-shi-me-de/</url>
      
        <content type="html"><![CDATA[<h2 id="1-use-æ¦‚å¿µ"><a href="#1-use-æ¦‚å¿µ" class="headerlink" title=".1 use æ¦‚å¿µ"></a>.1 use æ¦‚å¿µ</h2><p>å®‰è£… Vue.js æ’ä»¶ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¿…é¡»æä¾› install æ–¹æ³•ã€‚å¦‚æœæ’ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¢«ä½œä¸º install æ–¹æ³•ã€‚install æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå°† Vue ä½œä¸ºå‚æ•°ä¼ å…¥,è¿™æ ·æ’ä»¶ä¸­å°±ä¸åœ¨éœ€è¦ä¾èµ– Vue äº†ã€‚(æ‰©å±•åº”ç”¨çš„åŠŸèƒ½)</p><h2 id="1-2-æ’ä»¶çš„åŠŸèƒ½"><a href="#1-2-æ’ä»¶çš„åŠŸèƒ½" class="headerlink" title="1.2 æ’ä»¶çš„åŠŸèƒ½"></a>1.2 æ’ä»¶çš„åŠŸèƒ½</h2><ul><li>æ·»åŠ å…¨å±€æŒ‡ä»¤ã€å…¨å±€è¿‡æ»¤å™¨(Vue3 ä¸å†æ”¯æŒè¿‡æ»¤å™¨)ã€å…¨å±€ç»„ä»¶ã€‚</li><li>é€šè¿‡å…¨å±€æ··å…¥æ¥æ·»åŠ ä¸€äº›ç»„ä»¶é€‰é¡¹ã€‚</li><li>æ·»åŠ å®ä¾‹æ–¹æ³•ï¼Œé€šè¿‡æŠŠå®ƒä»¬æ·»åŠ åˆ° <code>Vue.prototype</code> / <code>app.config.globalProperties</code>ä¸Šå®ç°ã€‚</li></ul><h2 id="1-3-å®ç°åŸç†"><a href="#1-3-å®ç°åŸç†" class="headerlink" title="1.3 å®ç°åŸç†"></a>1.3 å®ç°åŸç†</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Vue<span class="token punctuation">.</span><span class="token function-variable function">use</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">plugin</span><span class="token operator">:</span> Function <span class="token operator">|</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ’ä»¶ç¼“å­˜</span>  <span class="token keyword">const</span> installedPlugins <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_installedPlugins <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœå·²ç»æœ‰æ’ä»¶ ç›´æ¥è¿”å›</span>    <span class="token keyword">return</span> <span class="token keyword">this</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// additional parameters</span>  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">toArray</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// é™¤äº†ç¬¬ä¸€é¡¹å…¶ä»–çš„å‚æ•°æ•´åˆæˆæ•°ç»„</span>  args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// å°†Vue æ”¾å…¥åˆ°æ•°ç»„ä¸­</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin<span class="token punctuation">.</span>install <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è°ƒç”¨installæ–¹æ³•</span>    plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>plugin<span class="token punctuation">,</span> args<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plugin <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç›´æ¥è°ƒç”¨æ–¹æ³•</span>    <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  installedPlugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span> <span class="token comment">// ç¼“å­˜æ’ä»¶</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Vue3 ä¸­ä½¿ç”¨<a href="https://github1s.com/vuejs/core/blob/main/packages/runtime-core/src/apiCreateApp.ts#L256-L257">app.use</a>è¿›è¡Œæ’ä»¶çš„æ³¨å†Œï¼ŒåŸç†åŒ Vue2~</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">plugin</span><span class="token operator">:</span> Plugin<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token operator">:</span> any<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedPlugins<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      __DEV__ <span class="token operator">&amp;&amp;</span> <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Plugin has already been applied to target app.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>plugin <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>plugin<span class="token punctuation">.</span>install<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      installedPlugins<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span>      plugin<span class="token punctuation">.</span><span class="token function">install</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      installedPlugins<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span>      <span class="token function">plugin</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token operator">...</span>options<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">A plugin must either be a function or an object with an "install" </span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> app  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue.mixinçš„ä½¿ç”¨åœºæ™¯å’ŒåŸç†</title>
      <link href="/2024/03/27/vue-mixin-de-shi-yong-chang-jing-he-yuan-li/"/>
      <url>/2024/03/27/vue-mixin-de-shi-yong-chang-jing-he-yuan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-Vue-mixin-æ¦‚å¿µ"><a href="#1-1-Vue-mixin-æ¦‚å¿µ" class="headerlink" title="1.1 Vue.mixin æ¦‚å¿µ"></a>1.1 Vue.mixin æ¦‚å¿µ</h2><p>mixin å¯ä»¥ç”¨æ¥æ‰©å±•ç»„ä»¶ï¼Œå°†å…¬å…±é€»è¾‘è¿›è¡ŒæŠ½ç¦»ã€‚åœ¨éœ€è¦è¯¥é€»è¾‘æ—¶è¿›è¡Œâ€œæ··å…¥â€ï¼Œé‡‡ç”¨ç­–ç•¥æ¨¡å¼é’ˆå¯¹ä¸åŒçš„å±æ€§è¿›è¡Œåˆå¹¶ã€‚å¦‚æœæ··å…¥çš„æ•°æ®å’Œæœ¬èº«ç»„ä»¶ä¸­çš„æ•°æ®å†²çªï¼Œä¼šé‡‡ç”¨â€œå°±è¿‘åŸåˆ™â€ä»¥ç»„ä»¶çš„æ•°æ®ä¸ºå‡†ã€‚</p><blockquote><p>mixin ä¸­æœ‰å¾ˆå¤šç¼ºé™· â€œå‘½åå†²çªé—®é¢˜â€ã€â€æ•°æ®æ¥æºé—®é¢˜â€ï¼ŒVue3 é‡‡ç”¨ CompositionAPI æå–å…¬å…±é€»è¾‘éå¸¸æ–¹ä¾¿ã€‚</p></blockquote><p><strong>mixins åœ¨ Vue 3 æ”¯æŒä¸»è¦æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œå› ä¸ºç”Ÿæ€ä¸­æœ‰è®¸å¤šåº“ä½¿ç”¨åˆ°ã€‚åœ¨æ–°çš„åº”ç”¨ä¸­åº”å°½é‡é¿å…ä½¿ç”¨ mixinï¼Œç‰¹åˆ«æ˜¯å…¨å±€ mixinã€‚</strong></p><h2 id="1-2-æ··å…¥æ–¹å¼"><a href="#1-2-æ··å…¥æ–¹å¼" class="headerlink" title="1.2 æ··å…¥æ–¹å¼"></a>1.2 æ··å…¥æ–¹å¼</h2><p>åœ¨<code>Vue</code>ä¸­æˆ‘ä»¬å¯ä»¥<strong>å±€éƒ¨æ··å…¥</strong>è·Ÿ<strong>å…¨å±€æ··å…¥</strong>ã€‚ä¸€èˆ¬æƒ…å†µä¸‹å…¨å±€æ··å…¥ç”¨äºç¼–å†™æ’ä»¶ã€‚å±€éƒ¨æ··å…¥ç”¨äºå¤ç”¨é€»è¾‘ã€‚</p><p><a href="https://github.com/vuejs/vue-router/blob/dev/src/install.js#L21">vue-router</a><a href="https://github.com/vuejs/vuex/blob/3.x/src/store.js#L549">vuex</a></p><h2 id="1-3-mixin-åˆå¹¶ç­–ç•¥"><a href="#1-3-mixin-åˆå¹¶ç­–ç•¥" class="headerlink" title="1.3 mixin åˆå¹¶ç­–ç•¥"></a>1.3 mixin åˆå¹¶ç­–ç•¥</h2><p>æ ¸å¿ƒå°±æ˜¯ï¼šå¯¹è±¡çš„åˆå¹¶å¤„ç†ã€‚</p><ul><li>propsã€methodsã€injectã€computed åŒåæ—¶ä¼šè¢«æ›¿æ¢</li><li>data ä¼šè¢«åˆå¹¶</li><li>ç”Ÿå‘½å‘¨æœŸå’Œ watch æ–¹æ³• ä¼šè¢«åˆå¹¶æˆé˜Ÿåˆ—</li><li>componentsã€directivesã€filters ä¼šåœ¨åŸå‹é“¾ä¸Šå åŠ </li></ul><blockquote><p>ç»„ä»¶çš„æ‰©å±•é™¤äº† mixin ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ªå±æ€§å« extendsï¼Œä½†æ˜¯ä¸æ€ä¹ˆå¸¸ç”¨~~~ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯´æ˜¯vueçš„å£°æ˜å‘¨æœŸ</title>
      <link href="/2024/03/26/shuo-shi-vue-de-sheng-ming-zhou-qi/"/>
      <url>/2024/03/26/shuo-shi-vue-de-sheng-ming-zhou-qi/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-Vue2-ä¸­çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#1-1-Vue2-ä¸­çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.1 Vue2 ä¸­çš„ç”Ÿå‘½å‘¨æœŸ"></a>1.1 Vue2 ä¸­çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>ä¸»è¦çš„ç”Ÿå‘½å‘¨æœŸæœ‰ï¼šåˆ›å»ºå‰å, æŒ‚è½½å‰å, æ›´æ–°å‰å, é”€æ¯å‰å</p><ul><li>beforeCreate åˆå§‹åŒ–çˆ¶å­å…³ç³»åŠäº‹ä»¶ï¼Œæ•°æ®è§‚æµ‹(data observer) ä¹‹å‰è¢«è°ƒç”¨ã€‚ç”¨æ­¤æ–¹æ³•ä¸€èˆ¬ç¼–å†™æ’ä»¶çš„æ—¶å€™ä¼šç”¨åˆ°ã€‚</li><li>created å®ä¾‹å·²ç»åˆ›å»ºå®Œæˆä¹‹åè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹å·²å®Œæˆä»¥ä¸‹çš„é…ç½®ï¼šæ•°æ®è§‚æµ‹(data observer)ï¼Œå±æ€§å’Œæ–¹æ³•ç­‰ï¼Œ ä½†æ˜¯è¿™é‡Œæ²¡æœ‰$elï¼Œä¸€èˆ¬ä¹Ÿä¸å’‹ç”¨ã€‚</li><li>beforeMount åœ¨æŒ‚è½½å¼€å§‹ä¹‹å‰è¢«è°ƒç”¨ï¼šç›¸å…³çš„ render å‡½æ•°é¦–æ¬¡è¢«è°ƒç”¨ã€‚</li><li>mounted el è¢«æ–°åˆ›å»ºçš„ vm.$el æ›¿æ¢ï¼Œå¹¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå»ä¹‹åè°ƒç”¨è¯¥é’©å­ã€‚å¯ä»¥ç”¨äºè·å– DOM å…ƒç´ </li><li>beforeUpdate æ•°æ®æ›´æ–°æ—¶è°ƒç”¨ï¼Œå‘ç”Ÿåœ¨è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ä¹‹å‰ã€‚æ­¤æ—¶ä¿®æ”¹æ•°æ®ä¸ä¼šå†æ¬¡å‡ºå‘æ›´æ–°æ–¹æ³•</li><li>updated ç”±äºæ•°æ®æ›´æ”¹å¯¼è‡´çš„è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ï¼Œåœ¨è¿™ä¹‹åä¼šè°ƒç”¨è¯¥é’©å­ã€‚</li><li>beforeDestroy å®ä¾‹é”€æ¯ä¹‹å‰è°ƒç”¨ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œå®ä¾‹ä»ç„¶å®Œå…¨å¯ç”¨ã€‚</li><li>destroyed Vue å®ä¾‹é”€æ¯åè°ƒç”¨ã€‚è°ƒç”¨åï¼ŒVue å®ä¾‹æŒ‡ç¤ºçš„æ‰€æœ‰ä¸œè¥¿éƒ½ä¼šè§£ç»‘å®šï¼Œæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨ä¼šè¢«ç§»é™¤ï¼Œæ‰€æœ‰çš„å­å®ä¾‹ä¹Ÿä¼šè¢«é”€æ¯ã€‚ è¯¥é’©å­åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æœŸé—´ä¸è¢«è°ƒç”¨ã€‚</li><li>keep-alive (activated å’Œ deactivated)</li></ul><h2 id="1-2-V2-å’Œ-V3-ä¸­çš„ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”"><a href="#1-2-V2-å’Œ-V3-ä¸­çš„ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”" class="headerlink" title="1.2 V2 å’Œ V3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”"></a>1.2 V2 å’Œ V3 ä¸­çš„ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”</h2><p><a href="https://v2.cn.vuejs.org/images/lifecycle.png">Vue2 ç”Ÿå‘½å‘¨æœŸ</a><a href="https://cn.vuejs.org/guide/essentials/lifecycle.html#lifecycle-diagram">Vue3 ç”Ÿå‘½å‘¨æœŸ</a></p><table><thead><tr><th align="left">ç”Ÿå‘½å‘¨æœŸ v2</th><th align="left">ç”Ÿå‘½å‘¨æœŸ v3</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">beforeCreate</td><td align="left">beforeCreate</td><td align="left">ç»„ä»¶å®ä¾‹è¢«åˆ›å»ºä¹‹åˆ</td></tr><tr><td align="left">created</td><td align="left">created</td><td align="left">ç»„ä»¶å®ä¾‹å·²ç»å®Œå…¨åˆ›å»º</td></tr><tr><td align="left">beforeMount</td><td align="left">beforeMount</td><td align="left">ç»„ä»¶æŒ‚è½½ä¹‹å‰</td></tr><tr><td align="left">mounted</td><td align="left">mounted</td><td align="left">ç»„ä»¶æŒ‚è½½åˆ°å®ä¾‹ä¸Šå»ä¹‹å</td></tr><tr><td align="left">beforeUpdate</td><td align="left">beforeUpdate</td><td align="left">ç»„ä»¶æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°ä¹‹å‰</td></tr><tr><td align="left">updated</td><td align="left">updated</td><td align="left">æ•°æ®æ•°æ®æ›´æ–°ä¹‹å</td></tr><tr><td align="left">beforeDestroy</td><td align="left"><strong>beforeUnmount</strong></td><td align="left">ç»„ä»¶å®ä¾‹é”€æ¯ä¹‹å‰</td></tr><tr><td align="left">destroyed</td><td align="left"><strong>unmounted</strong></td><td align="left">ç»„ä»¶å®ä¾‹é”€æ¯ä¹‹å</td></tr><tr><td align="left">activated</td><td align="left">activated</td><td align="left">keep-alive ç¼“å­˜çš„ç»„ä»¶æ¿€æ´»æ—¶</td></tr><tr><td align="left">deactivated</td><td align="left">deactivated</td><td align="left">keep-alive ç¼“å­˜çš„ç»„ä»¶åœç”¨æ—¶è°ƒç”¨</td></tr><tr><td align="left">errorCaptured</td><td align="left">errorCaptured</td><td align="left">æ•è·ä¸€ä¸ªæ¥è‡ªå­å­™ç»„ä»¶çš„é”™è¯¯æ—¶è¢«è°ƒç”¨</td></tr><tr><td align="left">-</td><td align="left"><strong>renderTracked Dev</strong></td><td align="left">è°ƒè¯•é’©å­ï¼Œå“åº”å¼ä¾èµ–è¢«æ”¶é›†æ—¶è°ƒç”¨</td></tr><tr><td align="left">-</td><td align="left"><strong>renderTriggered Dev</strong></td><td align="left">è°ƒè¯•é’©å­ï¼Œå“åº”å¼ä¾èµ–è¢«è§¦å‘æ—¶è°ƒç”¨</td></tr><tr><td align="left">-</td><td align="left"><strong>serverPrefetch</strong></td><td align="left">ssr onlyï¼Œç»„ä»¶å®ä¾‹åœ¨æœåŠ¡å™¨ä¸Šè¢«æ¸²æŸ“å‰è°ƒç”¨</td></tr></tbody></table><blockquote><p>Vue3 ä¸­æ–°å¢äº†ï¼Œç»„åˆå¼ APIï¼šç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä½†æ˜¯ä¸å­˜åœ¨ onBeforeCreate å’Œ onCreated é’©å­</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-onceçš„ä½¿ç”¨åœºæ™¯æœ‰å“ªäº›</title>
      <link href="/2024/03/25/v-once-de-shi-yong-chang-jing-you-na-xie/"/>
      <url>/2024/03/25/v-once-de-shi-yong-chang-jing-you-na-xie/</url>
      
        <content type="html"><![CDATA[<ul><li>v-once æ˜¯ Vue ä¸­å†…ç½®æŒ‡ä»¤ï¼Œåªæ¸²æŸ“å…ƒç´ å’Œç»„ä»¶ä¸€æ¬¡ã€‚éšåçš„é‡æ–°æ¸²æŸ“ï¼Œå…ƒç´ /ç»„ä»¶åŠå…¶æ‰€æœ‰çš„å­èŠ‚ç‚¹å°†è¢«è§†ä¸ºé™æ€å†…å®¹å¹¶è·³è¿‡ã€‚è¿™å¯ä»¥ç”¨äºä¼˜åŒ–æ›´æ–°æ€§èƒ½ã€‚<br><strong>æ ¸å¿ƒå®ç°åŸç†æ˜¯åˆ©ç”¨ç¼“å­˜</strong></li></ul><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!-- å•ä¸ªå…ƒç´  --&gt;&lt;span v-once&gt;This will never change: &#123;&#123;msg&#125;&#125;&lt;&#x2F;span&gt;&lt;!-- æœ‰å­å…ƒç´  --&gt;&lt;div v-once&gt;  &lt;h1&gt;comment&lt;&#x2F;h1&gt;  &lt;p&gt;&#123;&#123;msg&#125;&#125;&lt;&#x2F;p&gt;&lt;&#x2F;div&gt;&lt;!-- ç»„ä»¶ --&gt;&lt;my-component v-once :comment&#x3D;&quot;msg&quot;&gt;&lt;&#x2F;my-component&gt;&lt;!-- &#96;v-for&#96; æŒ‡ä»¤--&gt;&lt;ul&gt;  &lt;li v-for&#x3D;&quot;i in list&quot; v-once&gt;&#123;&#123;i&#125;&#125;&lt;&#x2F;li&gt;&lt;&#x2F;ul&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>vue3.2 ä¹‹åï¼Œå¢åŠ äº† v-memo æŒ‡ä»¤ï¼Œé€šè¿‡ä¾èµ–åˆ—è¡¨çš„æ–¹å¼æ§åˆ¶é¡µé¢æ¸²æŸ“ã€‚</li></ul><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;div&gt;  &lt;div v-memo&#x3D;&quot;[valueA,valueB]&quot;&gt;    &lt;div class&#x3D;&quot;box&quot; v-for&#x3D;&quot;item in arr&quot; :key&#x3D;&quot;item&quot;&gt;&#123;&#123; item &#125;&#125;&lt;&#x2F;div&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-ifå’Œv-forå“ªä¸ªä¼˜å…ˆçº§æ›´é«˜</title>
      <link href="/2024/03/25/v-if-he-v-for-na-ge-you-xian-ji-geng-gao/"/>
      <url>/2024/03/25/v-if-he-v-for-na-ge-you-xian-ji-geng-gao/</url>
      
        <content type="html"><![CDATA[<ul><li><p>åŒæ—¶ä½¿ç”¨ v-if å’Œ v-for æ˜¯ä¸æ¨èçš„ï¼Œå› ä¸ºè¿™æ ·äºŒè€…çš„ä¼˜å…ˆçº§ä¸æ˜æ˜¾ã€‚</p></li><li><p>åœ¨ Vue3 ä¸­ v-if çš„ä¼˜å…ˆçº§é«˜äº v-forï¼Œè¿™æ„å‘³ç€ v-if çš„æ¡ä»¶å°†æ— æ³•è®¿é—®åˆ° v-for ä½œç”¨åŸŸå†…å®šä¹‰çš„å˜é‡åˆ«åï¼š</p></li></ul><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;!-- è¿™ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå±æ€§ todo æ­¤æ—¶ æ²¡æœ‰åœ¨è¯¥å®ä¾‹ä¸Šå®šä¹‰--&gt;&lt;li v-for&#x3D;&quot;todo in todos&quot; v-if&#x3D;&quot;!todo.isComplete&quot;&gt;  &#123;&#123; todo.name &#125;&#125;&lt;&#x2F;li&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å¤–æ–°åŒ…è£…ä¸€å±‚ <template> å†åœ¨å…¶ä¸Šä½¿ç”¨ v-for å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ (è¿™ä¹Ÿæ›´åŠ æ˜æ˜¾æ˜“è¯»)ï¼š<br>é˜²æ­¢å¾ªç¯å¯ä»¥é‡‡å–è®¡ç®—å±æ€§ï¼Œæˆ–è€…ä½¿ç”¨ v-for å¾ªç¯æ—¶ï¼Œä½¿ç”¨è®¡ç®—å±æ€§æˆ–æ–¹æ³•æ¥è¿‡æ»¤æ•°æ®ã€‚</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template v-for&#x3D;&quot;todo in todos&quot;&gt;  &lt;li v-if&#x3D;&quot;!todo.isComplete&quot;&gt;    &#123;&#123; todo.name &#125;&#125;  &lt;&#x2F;li&gt;&lt;&#x2F;template&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>åœ¨ Vue2 ä¸­è§£ææ—¶ï¼Œå…ˆè§£æ v-for åœ¨è§£æ v-ifã€‚ä¼šå¯¼è‡´å…ˆå¾ªç¯ååœ¨å¯¹æ¯ä¸€é¡¹è¿›è¡Œåˆ¤æ–­ï¼Œæµªè´¹æ€§èƒ½ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueä¸­çš„v-showå’Œv-ifæ€ä¹ˆç†è§£</title>
      <link href="/2024/03/25/vue-zhong-de-v-show-he-v-if-zen-me-li-jie/"/>
      <url>/2024/03/25/vue-zhong-de-v-show-he-v-if-zen-me-li-jie/</url>
      
        <content type="html"><![CDATA[<ul><li><p>v-if æ˜¯â€œçœŸå®çš„â€æŒ‰æ¡ä»¶æ¸²æŸ“ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†åœ¨åˆ‡æ¢æ—¶ï¼Œæ¡ä»¶åŒºå—å†…çš„äº‹ä»¶ç›‘å¬å™¨å’Œå­ç»„ä»¶éƒ½ä¼šè¢«é”€æ¯ä¸é‡å»ºã€‚</p></li><li><p>v-if ä¹Ÿæ˜¯æƒ°æ€§çš„ï¼š(å¯ä»¥é˜»æ–­å†…éƒ¨ä»£ç æ˜¯å¦æ‰§è¡Œ),å¦‚æœåœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ¡ä»¶å€¼ä¸º falseï¼Œåˆ™ä¸ä¼šåšä»»ä½•äº‹ã€‚æ¡ä»¶åŒºå—åªæœ‰å½“æ¡ä»¶é¦–æ¬¡å˜ä¸º true æ—¶æ‰è¢«æ¸²æŸ“ã€‚</p></li><li><p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œv-show ç®€å•è®¸å¤šï¼Œå…ƒç´ æ— è®ºåˆå§‹æ¡ä»¶å¦‚ä½•ï¼Œå§‹ç»ˆä¼šè¢«æ¸²æŸ“ï¼Œåªæœ‰ CSS display å±æ€§ä¼šè¢«åˆ‡æ¢ã€‚</p></li><li><p>æ€»çš„æ¥è¯´ï¼Œv-if æœ‰æ›´é«˜çš„åˆ‡æ¢å¼€é”€ï¼Œè€Œ v-show æœ‰æ›´é«˜çš„åˆå§‹æ¸²æŸ“å¼€é”€ã€‚</p><ul><li>å¦‚æœéœ€è¦é¢‘ç¹åˆ‡æ¢ï¼Œåˆ™ä½¿ç”¨ v-show è¾ƒå¥½ï¼›</li><li>å¦‚æœåœ¨è¿è¡Œæ—¶ç»‘å®šæ¡ä»¶å¾ˆå°‘æ”¹å˜ï¼Œåˆ™ v-if ä¼šæ›´åˆé€‚ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•çœ‹å¾…CompositionAPIå’ŒOptionsAPI</title>
      <link href="/2024/03/25/ru-he-kan-dai-compositionapi-he-optionsapi/"/>
      <url>/2024/03/25/ru-he-kan-dai-compositionapi-he-optionsapi/</url>
      
        <content type="html"><![CDATA[<ul><li>åœ¨ Vue2 ä¸­é‡‡ç”¨çš„æ˜¯ OptionsAPI, ç”¨æˆ·æä¾›çš„ data,props,methods,computed,watch ç­‰å±æ€§ (ç”¨æˆ·ç¼–å†™å¤æ‚ä¸šåŠ¡é€»è¾‘ä¼šå‡ºç°åå¤æ¨ªè·³é—®é¢˜)</li><li>Vue2 ä¸­æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯é€šè¿‡<code>this</code>è®¿é—®ï¼Œ<code>this</code>å­˜åœ¨æŒ‡å‘æ˜ç¡®é—®é¢˜</li><li>Vue2 ä¸­å¾ˆå¤šæœªä½¿ç”¨æ–¹æ³•æˆ–å±æ€§ä¾æ—§ä¼šè¢«æ‰“åŒ…ï¼Œå¹¶ä¸”æ‰€æœ‰å…¨å±€ API éƒ½åœ¨ Vue å¯¹è±¡ä¸Šå…¬å¼€ã€‚Composition API å¯¹ tree-shaking æ›´åŠ å‹å¥½ï¼Œä»£ç ä¹Ÿæ›´å®¹æ˜“å‹ç¼©ã€‚</li><li>ç»„ä»¶é€»è¾‘å…±äº«é—®é¢˜ï¼Œ Vue2 é‡‡ç”¨ mixins å®ç°ç»„ä»¶ä¹‹é—´çš„é€»è¾‘å…±äº«ï¼› ä½†æ˜¯ä¼šæœ‰æ•°æ®æ¥æºä¸æ˜ç¡®ï¼Œå‘½åå†²çªç­‰é—®é¢˜ã€‚ Vue3 é‡‡ç”¨ CompositionAPI æå–å…¬å…±é€»è¾‘éå¸¸æ–¹ä¾¿</li></ul><blockquote><p>å°†åŒä¸€ä¸ªé€»è¾‘çš„ç›¸å…³ä»£ç æ”¶é›†åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯å¤ç”¨ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3å¯¹â½Vue2çš„å˜åŒ–</title>
      <link href="/2024/03/25/vue3-dui-vue2-de-bian-hua/"/>
      <url>/2024/03/25/vue3-dui-vue2-de-bian-hua/</url>
      
        <content type="html"><![CDATA[<ul><li>æ€§èƒ½ä¼˜åŒ–ï¼ˆæ›´å¿«ï¼‰ï¼š<ul><li>ä½¿ç”¨äº†<strong>Proxy</strong>æ›¿ä»£ Object.defineProperty å®ç°å“åº”å¼ã€‚ï¼ˆä¸ºä»€ä¹ˆï¼ŸdefineProperty éœ€è¦å¯¹å±æ€§è¿›è¡Œé€’å½’é‡å†™æ·»åŠ <code>getter</code>åŠ<code>setter</code> <strong>æ€§èƒ½å·®</strong>ï¼ŒåŒæ—¶æ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§æ—¶æ— æ³•ç›‘æ§å˜åŒ–ï¼Œéœ€è¦$setã€$delete æ–¹æ³•ã€‚æ­¤æ–¹æ³•å¯¹æ•°ç»„åŠ«æŒæ€§èƒ½å·®ï¼ŒåŒæ—¶ä¸æ”¯æŒ map å’Œ set çš„æ•°æ®ç»“æ„ã€‚ï¼‰</li><li>æ¨¡æ¿ç¼–è¯‘ä¼˜åŒ–ã€‚ç»™åŠ¨æ€èŠ‚ç‚¹å¢æ·» PatchFlag æ ‡è®°ï¼›å¯¹é™æ€èŠ‚ç‚¹è¿›è¡Œé™æ€æå‡ï¼›å¯¹äº‹ä»¶è¿›è¡Œç¼“å­˜å¤„ç†ç­‰ã€‚</li><li>Diff ç®—æ³•ä¼˜åŒ–ï¼Œå…¨é‡ diff ç®—æ³•ä¸­é‡‡ç”¨æœ€é•¿é€’å¢å­åºåˆ—å‡å°‘èŠ‚ç‚¹çš„ç§»åŠ¨ã€‚åœ¨éå…¨é‡ diff ç®—æ³•ä¸­åªæ¯”è¾ƒåŠ¨æ€èŠ‚ç‚¹ï¼Œé€šè¿‡ PatchFlag æ ‡è®°æ›´æ–°åŠ¨æ€çš„éƒ¨åˆ†ã€‚</li></ul></li><li>ä½“ç§¯ä¼˜åŒ–ï¼ˆæ›´å°ï¼‰:<ul><li>Vue3 ç§»é™¤äº†ä¸å¸¸ç”¨çš„ API<ul><li>ç§»é™¤ inline-template (Vue2 ä¸­å°±ä¸æ¨èä½¿ç”¨)</li><li>$onã€$offã€$once ï¼ˆå¦‚æœæœ‰éœ€è¦å¯ä»¥é‡‡ç”¨ mitt åº“æ¥å®ç°ï¼‰</li><li>åˆ é™¤è¿‡æ»¤å™¨ ï¼ˆå¯ä»¥é€šè¿‡è®¡ç®—å±æ€§æˆ–è€…æ–¹æ³•æ¥å®ç°ï¼‰</li><li>$childrenç§»é™¤ ï¼ˆå¯ä»¥é€šè¿‡provideï¼Œinjectæ–¹æ³•æ„å»º$childrenï¼‰</li><li>ç§»é™¤<code>.sync</code> <code>.native</code>)ä¿®é¥°ç¬¦ (<code>.sync</code>é€šè¿‡ <code>v-model:xxx</code>å®ç°ï¼Œ<code>.native</code>ä¸º Vue3 ä¸­çš„é»˜è®¤è¡Œä¸º) ä»¥åŠä¸åœ¨æ”¯æŒ keycode ä½œä¸º<code>v-on</code>ä¿®é¥°ç¬¦ï¼ˆ@keyup.13 ä¸åœ¨æ”¯æŒï¼‰</li><li>ç§»é™¤å…¨å±€ APIã€‚Vue.componentã€Vue.useã€Vue.directive (å°†è¿™äº› api æŒ‚è½½åˆ°å®ä¾‹ä¸Š)</li></ul></li><li>é€šè¿‡æ„å»ºå·¥å…· Tree-shaking æœºåˆ¶å®ç°æŒ‰éœ€å¼•å…¥ï¼Œå‡å°‘ç”¨æˆ·æ‰“åŒ…åä½“ç§¯ã€‚</li></ul></li><li>æ”¯æŒè‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼š<ul><li>ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰æ¸²æŸ“ API è¾¾åˆ°è·¨å¹³å°çš„ç›®çš„ã€‚æ‰©å±•èƒ½åŠ›æ›´å¼ºï¼Œæ— éœ€æ”¹é€  Vue æºç ã€‚</li></ul></li><li>TypeScript æ”¯æŒï¼š<ul><li>Vue3 æºç é‡‡ç”¨ Typescript æ¥è¿›è¡Œé‡å†™ , å¯¹ Ts çš„æ”¯æŒæ›´åŠ å‹å¥½ã€‚</li></ul></li><li>æºç ç»“æ„å˜åŒ–ï¼š<ul><li>Vue3 æºç é‡‡ç”¨ monorepo æ–¹å¼è¿›è¡Œç®¡ç†ï¼Œå°†æ¨¡å—æ‹†åˆ†åˆ° package ç›®å½•ä¸­ï¼Œè§£è€¦åå¯å•ç‹¬ä½¿ç”¨ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ çŸ¥é“å“ªäº›Vue3æ–°ç‰¹æ€§</title>
      <link href="/2024/03/25/ni-zhi-dao-na-xie-vue3-xin-te-xing/"/>
      <url>/2024/03/25/ni-zhi-dao-na-xie-vue3-xin-te-xing/</url>
      
        <content type="html"><![CDATA[<ul><li><p>Composition API</p><ul><li>ä½¿ç”¨å‡½æ•°çš„æ–¹å¼ç¼–å†™ vue ç»„ä»¶ã€‚</li><li>ç»„åˆå¼ API (å“åº”å¼ API <code>ref()ã€reactive()</code>ï¼Œç”Ÿå‘½å‘¨æœŸé’©å­<code>onMounted()ã€onUnmounted()</code>ï¼Œä¾èµ–æ³¨å…¥<code>inject()ã€provide()</code>)</li><li>ç»„åˆå¼ API å¹¶ä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹ã€‚</li></ul><blockquote><p>è™½ç„¶è¿™å¥— API çš„é£æ ¼æ˜¯åŸºäºå‡½æ•°çš„ç»„åˆï¼Œä½†<strong>ç»„åˆå¼ API å¹¶ä¸æ˜¯å‡½æ•°å¼ç¼–ç¨‹</strong>ã€‚ç»„åˆå¼ API æ˜¯ä»¥ Vue ä¸­æ•°æ®å¯å˜çš„ã€ç»†ç²’åº¦çš„å“åº”æ€§ç³»ç»Ÿä¸ºåŸºç¡€çš„ï¼Œè€Œ<strong>å‡½æ•°å¼ç¼–ç¨‹é€šå¸¸å¼ºè°ƒæ•°æ®ä¸å¯å˜ã€‚</strong></p></blockquote></li><li><p><code>&lt;script setup&gt; </code>æ˜¯åœ¨å•æ–‡ä»¶ç»„ä»¶ (SFC) ä¸­ä½¿ç”¨ç»„åˆå¼ API çš„ç¼–è¯‘æ—¶è¯­æ³•ç³–ã€‚</p><ul><li>è®©ä»£ç æ›´ç®€æ´ï¼Œæ€§èƒ½æ›´å¥½ï¼ˆä¸éœ€è¦å€ŸåŠ©ä»£ç†å¯¹è±¡ï¼‰ã€‚</li></ul></li><li><p>Teleport</p><ul><li><p>ç±»ä¼¼äº React ä¸­çš„ Portal ä¼ é€é—¨ç»„ä»¶ï¼ŒæŒ‡å®šå°†ç»„ä»¶æ¸²æŸ“åˆ°æŸä¸ªå®¹å™¨ä¸­ã€‚</p></li><li><p>ç»å¸¸ç”¨äºå¤„ç†å¼¹çª—ç»„ä»¶å’Œæ¨¡æ€æ¡†ç»„ä»¶ã€‚</p></li></ul></li></ul><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;button @click&#x3D;&quot;open &#x3D; true&quot;&gt;æ‰“å¼€æ¨¡æ€æ¡†&lt;&#x2F;button&gt;&lt;Teleport to&#x3D;&quot;body&quot;&gt;  &lt;div v-if&#x3D;&quot;open&quot; class&#x3D;&quot;modal&quot;&gt;    &lt;button @click&#x3D;&quot;open &#x3D; false&quot;&gt;å…³é—­&lt;&#x2F;button&gt;  &lt;&#x2F;div&gt;&lt;&#x2F;Teleport&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>Fragments</p><ul><li>Fragmentï¼ˆç‰‡æ®µï¼‰Vue3 ä¸­å…è®¸ç»„ä»¶ä¸­åŒ…å«å¤šä¸ªèŠ‚ç‚¹ã€‚æ— éœ€å¼•å…¥é¢å¤–çš„ DOM å…ƒç´ ã€‚</li></ul></li><li><p>Emits Component Option</p><ul><li>Vue3 ä¸­é»˜è®¤ç»‘å®šçš„äº‹ä»¶ä¼šè¢«ç»‘å®šåˆ°æ ¹å…ƒç´ ä¸Šã€‚é€šè¿‡ Emits å±æ€§å¯å°†äº‹ä»¶ä»<code>attrs</code> ä¸­ç§»é™¤ã€‚</li></ul></li><li><p>createRenderer API from @vue/runtime-core to create custom renderers</p><ul><li>æä¾›è‡ªå®šä¹‰æ¸²æŸ“å™¨ï¼Œå¯ä»¥åœ¨é DOM ç¯å¢ƒä¸­ä½¿ç”¨ Vue çš„è¿è¡Œæ—¶ã€‚</li></ul></li><li><p><a href="https://cn.vuejs.org/api/sfc-css-features.html#v-bind-in-css">å•æ–‡ä»¶ç»„ä»¶ä¸­çš„çŠ¶æ€é©±åŠ¨çš„ CSS å˜é‡ (``ä¸­çš„<code>v-bind</code>)</a></p><ul><li><p>åœ¨ css ä¸­ä½¿ç”¨ v-bind ç»‘å®šæ ·å¼</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">background</span><span class="token operator">:</span> v <span class="token operator">-</span> <span class="token function">bind</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul></li><li><p><a href="https://github.com/vuejs/rfcs/blob/master/active-rfcs/0023-scoped-styles-changes.md">SFC <code> &lt;style scoped&gt;</code> æ–°å¢å…¨å±€è§„åˆ™å’Œé’ˆå¯¹æ’æ§½å†…å®¹çš„è§„åˆ™</a></p><ul><li><p>åœ¨ä½œç”¨åŸŸæ ·å¼ä¸­å¯ä»¥åŒ…å«å…¨å±€è§„åˆ™æˆ–åªé’ˆå¯¹æ’æ§½å†…å®¹çš„è§„åˆ™</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* è·¨ç»„ä»¶ä¿®æ”¹ç»„ä»¶å†…æ ·å¼ */</span><span class="token selector">.parent :deep(h1)</span> <span class="token punctuation">&#123;</span>  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* æ§åˆ¶å…¨å±€æ ·å¼ */</span><span class="token selector">:global(.root)</span> <span class="token punctuation">&#123;</span>  <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>  <span class="token property">height</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>  <span class="token property">background</span><span class="token punctuation">:</span> yellow<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* æ§åˆ¶æ’æ§½å†…å®¹çš„æ ·å¼ */</span><span class="token selector">:slotted(.child)</span> <span class="token punctuation">&#123;</span>  <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>Suspense experimental</p><ul><li>ä¸»è¦çš„ä½œç”¨ä¼˜é›…åœ°å¤„ç†å¼‚æ­¥ç»„ä»¶çš„åŠ è½½çŠ¶æ€</li></ul></li></ul><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;Suspense&gt;    &lt;template #default&gt;        &lt;!-- å¯ä»¥é…åˆasync setupä½¿ç”¨ --&gt;        &lt;AsyncComponent&gt;&lt;&#x2F;AsyncComponent&gt;    &lt;&#x2F;template&gt;    &lt;template #fallback&gt;        æ­£åœ¨åŠ è½½å¼‚æ­¥ç»„ä»¶...    &lt;&#x2F;template&gt;&lt;&#x2F;Suspense&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°ˆè°ˆVue3ä¸­æ¨¡æ¿ç¼–è¯‘åšäº†å“ªäº›ä¼˜åŒ–</title>
      <link href="/2024/03/25/tan-tan-vue3-zhong-mo-ban-bian-yi-zuo-liao-na-xie-you-hua/"/>
      <url>/2024/03/25/tan-tan-vue3-zhong-mo-ban-bian-yi-zuo-liao-na-xie-you-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-PatchFlags-ä¼˜åŒ–"><a href="#1-1-PatchFlags-ä¼˜åŒ–" class="headerlink" title="1.1 PatchFlags ä¼˜åŒ–"></a>1.1 PatchFlags ä¼˜åŒ–</h2><p>Diff ç®—æ³•æ— æ³•é¿å…æ–°æ—§è™šæ‹Ÿ DOM ä¸­æ— ç”¨çš„æ¯”è¾ƒæ“ä½œï¼Œé€šè¿‡ patchFlags æ¥æ ‡è®°åŠ¨æ€å†…å®¹ï¼Œå¯ä»¥å®ç°å¿«é€Ÿ diff ç®—æ³•</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;div&gt;  &lt;h1 a&#x3D;&#39;a&#39; :b&#x3D;&quot;b&quot;&gt;Hello&lt;&#x2F;h1&gt;  &lt;span&gt;&#123;&#123;name&#125;&#125;&lt;&#x2F;span&gt;&lt;&#x2F;div&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span>        <span class="token string">"h1"</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>          <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"a"</span><span class="token punctuation">,</span>          <span class="token literal-property property">b</span><span class="token operator">:</span> _ctx<span class="token punctuation">.</span>b<span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token string">"Hello"</span><span class="token punctuation">,</span>        <span class="token number">8</span> <span class="token comment">/* PROPS */</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string">"b"</span><span class="token punctuation">]</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹"><a href="#åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹"></a>åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹</h3><blockquote><p>ç”Ÿæˆçš„è™šæ‹Ÿ DOM æ˜¯ï¼š</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"div"</span><span class="token punctuation">,</span>    <span class="token literal-property property">__v_isVNode</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">children</span><span class="token operator">:</span><span class="token punctuation">[</span>       <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> â€¦<span class="token punctuation">&#125;</span>       <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> â€¦<span class="token punctuation">&#125;</span>   <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> â€¦<span class="token punctuation">&#125;</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">dynamicChildren</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'span'</span><span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> _ctx<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token literal-property property">patchFlag</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ­¤æ—¶ç”Ÿæˆçš„è™šæ‹ŸèŠ‚ç‚¹å¤šå‡ºä¸€ä¸ª dynamicChildren å±æ€§ã€‚è¿™ä¸ªå°±æ˜¯ block çš„ä½œç”¨ï¼Œblock å¯ä»¥æ”¶é›†æ‰€æœ‰åä»£åŠ¨æ€èŠ‚ç‚¹ã€‚è¿™æ ·åç»­æ›´æ–°æ—¶å¯ä»¥ç›´æ¥è·³è¿‡é™æ€èŠ‚ç‚¹ï¼Œå®ç°é¶å‘æ›´æ–°</p></blockquote><h3 id="åŠ¨æ€æ ‡è¯†"><a href="#åŠ¨æ€æ ‡è¯†" class="headerlink" title="åŠ¨æ€æ ‡è¯†"></a>åŠ¨æ€æ ‡è¯†</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token keyword">enum</span> PatchFlags <span class="token punctuation">&#123;</span>  <span class="token constant">TEXT</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€æ–‡æœ¬èŠ‚ç‚¹</span>  <span class="token constant">CLASS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€class</span>  <span class="token constant">STYLE</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€style</span>  <span class="token constant">PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// é™¤äº†class\styleåŠ¨æ€å±æ€§</span>  <span class="token constant">FULL_PROPS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// æœ‰keyï¼Œéœ€è¦å®Œæ•´diff</span>  <span class="token constant">HYDRATE_EVENTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‚è½½è¿‡äº‹ä»¶çš„</span>  <span class="token constant">STABLE_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token comment">// ç¨³å®šåºåˆ—ï¼Œå­èŠ‚ç‚¹é¡ºåºä¸ä¼šå‘ç”Ÿå˜åŒ–</span>  <span class="token constant">KEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token comment">// å­èŠ‚ç‚¹æœ‰keyçš„fragment</span>  <span class="token constant">UNKEYED_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token comment">// å­èŠ‚ç‚¹æ²¡æœ‰keyçš„fragment</span>  <span class="token constant">NEED_PATCH</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token comment">// è¿›è¡Œépropsæ¯”è¾ƒ, refæ¯”è¾ƒ</span>  <span class="token constant">DYNAMIC_SLOTS</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// åŠ¨æ€æ’æ§½</span>  <span class="token constant">DEV_ROOT_FRAGMENT</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">11</span><span class="token punctuation">,</span>  <span class="token constant">HOISTED</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// è¡¨ç¤ºé™æ€èŠ‚ç‚¹ï¼Œå†…å®¹å˜åŒ–ï¼Œä¸æ¯”è¾ƒå„¿å­</span>  <span class="token constant">BAIL</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token comment">// è¡¨ç¤ºdiffç®—æ³•åº”è¯¥ç»“æŸ</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-2-BlockTree"><a href="#1-2-BlockTree" class="headerlink" title="1.2 BlockTree"></a>1.2 BlockTree</h2><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦æå‡º blockTree çš„æ¦‚å¿µï¼Ÿ åªæœ‰ block ä¸å°±æŒºå¥½çš„ä¹ˆï¼Ÿ é—®é¢˜å‡ºåœ¨ block åœ¨æ”¶é›†åŠ¨æ€èŠ‚ç‚¹æ—¶æ˜¯å¿½ç•¥è™šæ‹Ÿ DOM æ ‘å±‚çº§çš„ã€‚</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flag<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123;a&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123;a&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™é‡Œæˆ‘ä»¬çŸ¥é“é»˜è®¤æ ¹èŠ‚ç‚¹æ˜¯ä¸€ä¸ª block èŠ‚ç‚¹ï¼Œå¦‚æœè¦æ˜¯æŒ‰ç…§ä¹‹å‰çš„å¥—è·¯æ¥æï¼Œè¿™æ—¶å€™åˆ‡æ¢ flag çš„çŠ¶æ€å°†æ— æ³•ä» p æ ‡ç­¾åˆ‡æ¢åˆ° div æ ‡ç­¾ã€‚ <strong>è§£å†³æ–¹æ¡ˆï¼šå°±æ˜¯å°†ä¸ç¨³å®šçš„ç»“æ„ä¹Ÿä½œä¸º block æ¥è¿›è¡Œå¤„ç†</strong></p></blockquote><h3 id="ä¸ç¨³å®šç»“æ„"><a href="#ä¸ç¨³å®šç»“æ„" class="headerlink" title="ä¸ç¨³å®šç»“æ„"></a>ä¸ç¨³å®šç»“æ„</h3><p>æ‰€è°“çš„ä¸ç¨³ç»“æ„å°±æ˜¯ DOM æ ‘çš„ç»“æ„å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚ä¸ç¨³å®šç»“æ„æœ‰å“ªäº›å‘¢ï¼Ÿ ï¼ˆv-if/v-for/Fragmentï¼‰</p><h4 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h4><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flag<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123;a&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123;a&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç¼–è¯‘åçš„ç»“æœ:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      _ctx<span class="token punctuation">.</span>flag        <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>            <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>            <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"p"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">Block(div)Blcok(div,&#123;key:0&#125;)Block(div,&#123;key:1&#125;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>çˆ¶èŠ‚ç‚¹é™¤äº†ä¼šæ”¶é›†åŠ¨æ€èŠ‚ç‚¹ä¹‹å¤–ï¼Œä¹Ÿä¼šæ”¶é›†å­ blockã€‚ æ›´æ–°æ—¶å›  key å€¼ä¸åŒä¼šè¿›è¡Œåˆ é™¤é‡æ–°åˆ›å»º</p><h4 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h4><p>éšç€<code>v-for</code>å˜é‡çš„å˜åŒ–ä¹Ÿä¼šå¯¼è‡´è™šæ‹Ÿ DOM æ ‘å˜å¾—ä¸ç¨³å®š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in fruits<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123;item&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span>      _Fragment<span class="token punctuation">,</span>      <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token function">_renderList</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>fruits<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token number">256</span> <span class="token comment">/* UNKEYED_FRAGMENT */</span>    <span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å¯ä»¥è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä¸å¢åŠ è¿™ä¸ª blockï¼Œå‰åå…ƒç´ ä¸ä¸€è‡´æ˜¯æ— æ³•åšåˆ°é¶å‘æ›´æ–°çš„ã€‚å› ä¸º dynamicChildren ä¸­è¿˜æœ‰å¯èƒ½æœ‰å…¶ä»–å±‚çº§çš„å…ƒç´ ã€‚åŒæ—¶è¿™é‡Œè¿˜ç”Ÿæˆäº†ä¸€ä¸ª Fragmentï¼Œå› ä¸ºå‰åå…ƒç´ ä¸ªæ•°ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸º<strong>ä¸ç¨³å®šåºåˆ—</strong>ã€‚</p></blockquote><h3 id="ç¨³å®š-Fragment"><a href="#ç¨³å®š-Fragment" class="headerlink" title="ç¨³å®š Fragment"></a>ç¨³å®š Fragment</h3><p>è¿™é‡Œæ˜¯å¯ä»¥é¶å‘æ›´æ–°çš„, å› ä¸ºç¨³å®šåˆ™æœ‰å‚ç…§ç‰©</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in 3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123;item&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//ä¼šæ”¶é›†</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_createElementBlock</span><span class="token punctuation">(</span>        _Fragment<span class="token punctuation">,</span>        <span class="token keyword">null</span><span class="token punctuation">,</span>        <span class="token function">_renderList</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">64</span> <span class="token comment">/* STABLE_FRAGMENT */</span>      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-3-é™æ€æå‡"><a href="#1-3-é™æ€æå‡" class="headerlink" title="1.3 é™æ€æå‡"></a>1.3 é™æ€æå‡</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">a</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span> <span class="token attr-name">b</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>&#123;&#123;name&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>&#123;&#123;age&#125;&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬æŠŠæ¨¡æ¿ç›´æ¥è½¬åŒ–æˆ render å‡½æ•°æ˜¯è¿™ä¸ªæ ·å­çš„ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ˜¯æ¯æ¬¡è°ƒç”¨<code>render</code>å‡½æ•°éƒ½è¦é‡æ–°åˆ›å»ºè™šæ‹ŸèŠ‚ç‚¹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span>        <span class="token string">"span"</span><span class="token punctuation">,</span>        <span class="token punctuation">&#123;</span>          <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>          <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token number">1</span> <span class="token comment">/* TEXT */</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å¼€<code>hoistStatic</code></p><p>æå‡åçš„ä»£ç </p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span><span class="token keyword">const</span> _hoisted_2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>      _hoisted_1<span class="token punctuation">,</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> _hoisted_2<span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_createElementVNode</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-4-é¢„å­—ç¬¦ä¸²åŒ–"><a href="#1-4-é¢„å­—ç¬¦ä¸²åŒ–" class="headerlink" title="1.4 é¢„å­—ç¬¦ä¸²åŒ–"></a>1.4 é¢„å­—ç¬¦ä¸²åŒ–</h2><p>é™æ€æå‡çš„èŠ‚ç‚¹éƒ½æ˜¯é™æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†æå‡å‡ºæ¥çš„èŠ‚ç‚¹å­—ç¬¦ä¸²åŒ–ã€‚ å½“è¿ç»­é™æ€èŠ‚ç‚¹è¶…è¿‡ 20 ä¸ªæ—¶ï¼Œä¼šå°†é™æ€èŠ‚ç‚¹åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> <span class="token function">_createStaticVNode</span><span class="token punctuation">(</span>  <span class="token string">"&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>&lt;span>hello&lt;/span>"</span><span class="token punctuation">,</span>  <span class="token number">10</span><span class="token punctuation">)</span><span class="token keyword">const</span> _hoisted_11 <span class="token operator">=</span> <span class="token punctuation">[</span>_hoisted_1<span class="token punctuation">]</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> _hoisted_11<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-5-ç¼“å­˜å‡½æ•°"><a href="#1-5-ç¼“å­˜å‡½æ•°" class="headerlink" title="1.5 ç¼“å­˜å‡½æ•°"></a>1.5 ç¼“å­˜å‡½æ•°</h2><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>e=>v=e.target.value<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>æ¯æ¬¡è°ƒç”¨ render çš„æ—¶éƒ½è¦åˆ›å»ºæ–°å‡½æ•°</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span>      <span class="token string">"div"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token function-variable function">onClick</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>v <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token number">8</span> <span class="token comment">/* PROPS */</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span><span class="token string">"onClick"</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰“å¼€<code>cacheHandlers</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache<span class="token punctuation">,</span> $props<span class="token punctuation">,</span> $setup<span class="token punctuation">,</span> $data<span class="token punctuation">,</span> $options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">_createElementBlock</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">onClick</span><span class="token operator">:</span> _cache<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_cache<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>v <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€»è¨€ä¹‹ï¼š</p><ol><li><p>ç»™åŠ¨æ€å…ƒç´ éƒ½åšå¥½æ ‡è®°ï¼Œåˆ°æ—¶å€™ diff ç®—æ³•çš„æ—¶å€™ä»–ä¼šå»çœ‹æ ‡è®°æ˜¯æ–‡æœ¬ï¼Œä»–å°±åªæ›´æ–°æ–‡æœ¬ï¼Œå±æ€§åªæ›´æ–°å±æ€§ï¼Œæ€§èƒ½é«˜</p></li><li><p>æŠŠåŠ¨æ€èŠ‚ç‚¹å•ç‹¬æ”¶é›†åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¯ä»¥åšé¶å‘æ›´æ–°ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡æ›´æ–°ï¼Œä½†æ˜¯æœ‰äº›ç»“æ„ä¸ç¨³å®šçš„ä¸èƒ½é€šè¿‡ä¸€ä¸ª block æ”¶é›†ï¼Œå¤šä¸ª blockï¼Œä¿è¯æ›´æ–°ä¸å‡ºé”™</p></li><li><p>é™æ€æå‡ï¼ŒæŠŠä¸€äº›ä¸å˜çš„ä¸œè¥¿æ‹¿å‡ºå»ï¼Œä¸éœ€è¦æ¯æ¬¡åˆ›å»º</p></li><li><p>èŠ‚ç‚¹æ˜¯å›ºå®šï¼Œé‡å¤æ€§æ¯”è¾ƒå¤šçš„ï¼Œè¿›è¡Œé¢„å­—ç¬¦ä¸²åŒ–</p></li><li><p>ç¼“å­˜å‡½æ•°ï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™éƒ½ç”¨ä»¥å‰çš„</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>keyçš„ä½œç”¨å’ŒåŸç†</title>
      <link href="/2024/03/22/key-de-zuo-yong-he-yuan-li/"/>
      <url>/2024/03/22/key-de-zuo-yong-he-yuan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-key-çš„æ¦‚å¿µ"><a href="#1-1-key-çš„æ¦‚å¿µ" class="headerlink" title="1.1 key çš„æ¦‚å¿µ"></a>1.1 key çš„æ¦‚å¿µ</h2><ul><li><p>key çš„ç‰¹æ®Š attribute ä¸»è¦ç”¨åœ¨ Vue çš„è™šæ‹Ÿ DOM ç®—æ³•ï¼Œåœ¨æ–°æ—§ nodes å¯¹æ¯”æ—¶è¾¨è¯† VNodesã€‚å¦‚æœä¸ä½¿ç”¨ keyï¼ŒVue ä¼šä½¿ç”¨ä¸€ç§æœ€å¤§é™åº¦å‡å°‘åŠ¨æ€å…ƒç´ å¹¶ä¸”å°½å¯èƒ½çš„å°è¯•å°±åœ°ä¿®æ”¹/å¤ç”¨ç›¸åŒç±»å‹å…ƒç´ çš„ç®—æ³•ã€‚</p></li><li><p>å½“ Vue æ­£åœ¨æ›´æ–°ä½¿ç”¨ v-for æ¸²æŸ“çš„å…ƒç´ åˆ—è¡¨æ—¶ï¼Œå®ƒé»˜è®¤ä½¿ç”¨â€œå°±åœ°æ›´æ–°â€çš„ç­–ç•¥ã€‚å¦‚æœæ•°æ®é¡¹çš„é¡ºåºè¢«æ”¹å˜ï¼ŒVue å°†ä¸ä¼šç§»åŠ¨ DOM å…ƒç´ æ¥åŒ¹é…æ•°æ®é¡¹çš„é¡ºåºï¼Œè€Œæ˜¯å°±åœ°æ›´æ–°æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”ç¡®ä¿å®ƒä»¬åœ¨æ¯ä¸ªç´¢å¼•ä½ç½®æ­£ç¡®æ¸²æŸ“</p></li></ul><h2 id="1-2-key-çš„ä½œç”¨"><a href="#1-2-key-çš„ä½œç”¨" class="headerlink" title="1.2 key çš„ä½œç”¨"></a>1.2 key çš„ä½œç”¨</h2><ul><li>Vue åœ¨ patch è¿‡ç¨‹ä¸­é€šè¿‡ key å¯ä»¥åˆ¤æ–­ä¸¤ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ˜¯å¦æ˜¯ç›¸åŒèŠ‚ç‚¹ã€‚ ï¼ˆå¯ä»¥å¤ç”¨è€èŠ‚ç‚¹ï¼‰</li><li>æ—  key ä¼šå¯¼è‡´æ›´æ–°çš„æ—¶å€™å‡ºé—®é¢˜</li><li>å°½é‡ä¸è¦é‡‡ç”¨ç´¢å¼•ä½œä¸º key ( å€’å™åˆ é™¤ï¼Œæ­£åºæ’å…¥ )</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueä¸­çš„diffç®—æ³•</title>
      <link href="/2024/03/22/vue-zhong-de-diff-suan-fa/"/>
      <url>/2024/03/22/vue-zhong-de-diff-suan-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-Diff-æ¦‚å¿µ"><a href="#1-1-Diff-æ¦‚å¿µ" class="headerlink" title="1.1 Diff æ¦‚å¿µ"></a>1.1 Diff æ¦‚å¿µ</h2><p>vue åŸºäºè™šæ‹Ÿ DOM åšæ›´æ–° ã€‚diff çš„æ ¸å¿ƒå°±æ˜¯æ¯”è¾ƒä¸¤ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„å·®å¼‚ ã€‚Vue çš„ diff ç®—æ³•æ˜¯<strong>å¹³çº§æ¯”è¾ƒï¼Œä¸è€ƒè™‘è·¨çº§æ¯”è¾ƒ</strong>çš„æƒ…å†µã€‚å†…éƒ¨é‡‡ç”¨<strong>æ·±åº¦é€’å½’çš„æ–¹å¼ + åŒæŒ‡é’ˆçš„æ–¹å¼</strong>è¿›è¡Œæ¯”è¾ƒã€‚</p><h2 id="1-2-Vue2-Diff-æ¯”è¾ƒæµç¨‹"><a href="#1-2-Vue2-Diff-æ¯”è¾ƒæµç¨‹" class="headerlink" title="1.2 Vue2 Diff æ¯”è¾ƒæµç¨‹"></a>1.2 Vue2 Diff æ¯”è¾ƒæµç¨‹</h2><ul><li>1.å…ˆæ¯”è¾ƒæ˜¯å¦æ˜¯ç›¸åŒèŠ‚ç‚¹ key tag</li><li>2.ç›¸åŒèŠ‚ç‚¹æ¯”è¾ƒå±æ€§,å¹¶å¤ç”¨è€èŠ‚ç‚¹ï¼ˆå°†è€çš„è™šæ‹Ÿ dom å¤ç”¨ç»™æ–°çš„è™šæ‹ŸèŠ‚ç‚¹ DOMï¼‰</li><li>3.æ¯”è¾ƒå„¿å­èŠ‚ç‚¹ï¼Œè€ƒè™‘è€èŠ‚ç‚¹å’Œæ–°èŠ‚ç‚¹å„¿å­çš„æƒ…å†µ<ul><li>è€çš„æ²¡å„¿å­ï¼Œç°åœ¨æœ‰å„¿å­ã€‚ ç›´æ¥æ’å…¥æ–°çš„å„¿å­</li><li>è€çš„æœ‰å„¿å­ï¼Œæ–°çš„æ²¡å„¿å­ã€‚ç›´æ¥åˆ é™¤é¡µé¢èŠ‚ç‚¹</li><li>è€çš„å„¿å­æ˜¯æ–‡æœ¬ï¼Œæ–°çš„å„¿å­æ˜¯æ–‡æœ¬ï¼Œç›´æ¥æ›´æ–°æ–‡æœ¬èŠ‚ç‚¹å³å¯</li><li>è€çš„å„¿å­æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ–°çš„å„¿å­ä¹Ÿæ˜¯ä¸€ä¸ªåˆ—è¡¨ updateChildren</li></ul></li><li>4.ä¼˜åŒ–æ¯”è¾ƒï¼šå¤´å¤´ã€å°¾å°¾ã€å¤´å°¾ã€å°¾å¤´</li><li>5.æ¯”å¯¹æŸ¥æ‰¾è¿›è¡Œå¤ç”¨</li><li><ol start="6"><li>ä¹±åºçš„æ—¶å€™ï¼Œå–æ–°çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåœ¨æ—§çš„é‡Œé¢æŸ¥æ‰¾ ï¼ˆæ–°çš„å»è€çš„é‡Œé¢æŸ¥æ‰¾ï¼‰</li></ol></li></ul><blockquote><p>Vue3 ä¸­é‡‡ç”¨æœ€é•¿é€’å¢å­åºåˆ—æ¥å®ç° diff ä¼˜åŒ–</p></blockquote><h2 id="3-Vue3-Diff-ç®—æ³•æ¯”è¾ƒæµç¨‹"><a href="#3-Vue3-Diff-ç®—æ³•æ¯”è¾ƒæµç¨‹" class="headerlink" title="3 Vue3 Diff ç®—æ³•æ¯”è¾ƒæµç¨‹"></a>3 Vue3 Diff ç®—æ³•æ¯”è¾ƒæµç¨‹</h2><p>å…¨é‡ Diffï¼š</p><ul><li>åˆšå¼€å§‹é»˜è®¤ä»å¤´æ¯”å¯¹ï¼Œç›¸åŒèŠ‚ç‚¹åˆ™å¤ç”¨èŠ‚ç‚¹ã€‚</li><li>å¦‚æœå¤´éƒ¨èŠ‚ç‚¹ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬å°±ä»åå‘å‰å¯¹æ¯”ï¼Œç›¸åŒèŠ‚ç‚¹åˆ™å¤ç”¨ã€‚</li><li>é»˜è®¤ä¼˜åŒ–äº†å­èŠ‚ç‚¹è¿½åŠ å’Œå­èŠ‚ç‚¹åˆ é™¤çš„æƒ…å†µã€‚</li><li>ä¹±åºæ¯”å¯¹ï¼Œé€šè¿‡æœ€é•¿é€’å¢å­åºåˆ—å®ç°åœ¨å¤ç”¨è¿‡ç¨‹ä¸­å‡å°‘èŠ‚ç‚¹çš„ç§»åŠ¨æ“ä½œã€‚</li></ul><blockquote><p>Vue3 é‡‡ç”¨æœ€é•¿é€’å¢å­åºåˆ—ï¼Œæ±‚è§£ä¸éœ€è¦ç§»åŠ¨çš„å…ƒç´ æœ‰å“ªäº›</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue ä¸­å¦‚ä½•æ£€æµ‹æ•°ç»„å˜åŒ–?</title>
      <link href="/2024/03/22/zhong-ru-he-jian-ce-shu-zu-bian-hua/"/>
      <url>/2024/03/22/zhong-ru-he-jian-ce-shu-zu-bian-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-Vue2-ä¸­é‡‡ç”¨é‡å†™æ•°ç»„æ–¹æ³•çš„æ–¹å¼"><a href="#1-1-Vue2-ä¸­é‡‡ç”¨é‡å†™æ•°ç»„æ–¹æ³•çš„æ–¹å¼" class="headerlink" title="1.1 Vue2 ä¸­é‡‡ç”¨é‡å†™æ•°ç»„æ–¹æ³•çš„æ–¹å¼"></a>1.1 Vue2 ä¸­é‡‡ç”¨é‡å†™æ•°ç»„æ–¹æ³•çš„æ–¹å¼</h2><ul><li>æ•°ç»„è€ƒè™‘æ€§èƒ½åŸå› æ²¡æœ‰ç”¨<code>defineProperty</code>å¯¹æ•°ç»„çš„æ¯ä¸€é¡¹è¿›è¡Œæ‹¦æˆªï¼Œè€Œæ˜¯é€‰æ‹©é‡å†™æ•°ç»„ï¼ˆ<code>push,shift,pop,splice,unshift,sort,reverse</code>ï¼‰æ–¹æ³•ã€‚<strong>æ•°ç»„ä¸­å¦‚æœæ˜¯å¯¹è±¡æ•°æ®ç±»å‹ä¹Ÿä¼šè¿›è¡Œé€’å½’åŠ«æŒ</strong>ã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> methodsToPatch <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token string">'push'</span><span class="token punctuation">,</span>  <span class="token string">'pop'</span><span class="token punctuation">,</span>  <span class="token string">'shift'</span><span class="token punctuation">,</span>  <span class="token string">'unshift'</span><span class="token punctuation">,</span>  <span class="token string">'splice'</span><span class="token punctuation">,</span>  <span class="token string">'sort'</span><span class="token punctuation">,</span>  <span class="token string">'reverse'</span><span class="token punctuation">]</span>methodsToPatch<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// cache original method</span>  <span class="token keyword">const</span> original <span class="token operator">=</span> arrayProto<span class="token punctuation">[</span>method<span class="token punctuation">]</span>  <span class="token function">def</span><span class="token punctuation">(</span>arrayMethods<span class="token punctuation">,</span> method<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token function">mutator</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">original</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>    <span class="token keyword">const</span> ob <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>__ob__    <span class="token keyword">let</span> inserted    <span class="token keyword">switch</span> <span class="token punctuation">(</span>method<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">case</span> <span class="token string">'push'</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">'unshift'</span><span class="token operator">:</span>        inserted <span class="token operator">=</span> args        <span class="token keyword">break</span>      <span class="token keyword">case</span> <span class="token string">'splice'</span><span class="token operator">:</span>        inserted <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token keyword">break</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>inserted<span class="token punctuation">)</span> ob<span class="token punctuation">.</span><span class="token function">observeArray</span><span class="token punctuation">(</span>inserted<span class="token punctuation">)</span>    <span class="token comment">// notify change</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>__DEV__<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> TriggerOpTypes<span class="token punctuation">.</span><span class="token constant">ARRAY_MUTATION</span><span class="token punctuation">,</span>        <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>        <span class="token literal-property property">key</span><span class="token operator">:</span> method      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      ob<span class="token punctuation">.</span>dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> result  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-2-Vue3-ç›´æ¥é‡‡ç”¨çš„æ˜¯-Proxy"><a href="#1-2-Vue3-ç›´æ¥é‡‡ç”¨çš„æ˜¯-Proxy" class="headerlink" title="1.2 Vue3 ç›´æ¥é‡‡ç”¨çš„æ˜¯ Proxy"></a>1.2 Vue3 ç›´æ¥é‡‡ç”¨çš„æ˜¯ Proxy</h2><ul><li>åœ¨ Vue 3.x ä¸­ï¼Œç›´æ¥ä½¿ç”¨ Proxy å®ç°äº†æ›´<em>é«˜æ•ˆ</em>å’Œ<em>ç²¾ç¡®</em>çš„æ•°ç»„å˜åŒ–æ£€æµ‹ï¼Œé€šè¿‡ Proxyï¼ŒVue å¯ä»¥æ•è·åˆ°æ•°ç»„ç´¢å¼•å’Œé•¿åº¦çš„å˜åŒ–ï¼Œä¸å†éœ€è¦é‡å†™æ•°ç»„çš„æ–¹æ³•ã€‚è¿™æ˜¯ Vue 3.x åœ¨æ€§èƒ½æ–¹é¢çš„ä¸€ä¸ªé‡è¦æ”¹è¿›ï¼ˆä½†æ˜¯ç”±äºä»£ç†é—®é¢˜ï¼Œè¿˜éœ€è¦å¯¹éƒ¨åˆ†æ£€æµ‹æ–¹æ³•è¿›è¡Œé‡å†™ï¼‰ã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">n</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>arr<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">createArrayInstrumentations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token literal-property property">instrumentations</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span>string<span class="token punctuation">,</span> Function<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">// instrument identity-sensitive Array methods to account for possible reactive</span>  <span class="token comment">// values</span>  <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'includes'</span><span class="token punctuation">,</span> <span class="token string">'indexOf'</span><span class="token punctuation">,</span> <span class="token string">'lastIndexOf'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    instrumentations<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> unknown<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> unknown<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token function">toRaw</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">as</span> any      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">track</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> TrackOpTypes<span class="token punctuation">.</span><span class="token constant">GET</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token comment">// we run the method using the original args first (which may be reactive)</span>      <span class="token keyword">const</span> res <span class="token operator">=</span> arr<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">||</span> res <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// if that didn't work, run it again using raw values.</span>        <span class="token keyword">return</span> arr<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>toRaw<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// instrument length-altering mutation methods to avoid length being tracked</span>  <span class="token comment">// which leads to infinite loops in some cases (#2137)</span>  <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'push'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'shift'</span><span class="token punctuation">,</span> <span class="token string">'unshift'</span><span class="token punctuation">,</span> <span class="token string">'splice'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    instrumentations<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">this</span><span class="token operator">:</span> unknown<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> unknown<span class="token punctuation">[</span><span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">pauseTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token function">pauseScheduling</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">toRaw</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token keyword">as</span> any<span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>      <span class="token function">resetScheduling</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token function">resetTracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">return</span> res    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> instrumentations<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><a href="https://github.com/vuejs/vue/blob/main/src/core/observer/array.ts#L12">Vue2 æ•°ç»„é‡å†™</a>ï¼Œ<a href="https://github.com/vuejs/core/blob/main/packages/reactivity/src/baseHandlers.ts#L53">Vue3 æ•°ç»„é‡å†™</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue ä¸­å¦‚ä½•è¿›è¡Œä¾èµ–æ”¶é›†</title>
      <link href="/2024/03/22/zhong-ru-he-jin-xing-yi-lai-shou-ji/"/>
      <url>/2024/03/22/zhong-ru-he-jin-xing-yi-lai-shou-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-ä¾èµ–æ”¶é›†çš„æµç¨‹"><a href="#1-1-ä¾èµ–æ”¶é›†çš„æµç¨‹" class="headerlink" title="1.1 ä¾èµ–æ”¶é›†çš„æµç¨‹"></a>1.1 ä¾èµ–æ”¶é›†çš„æµç¨‹</h2><ul><li>æ¯ä¸ªå±æ€§éƒ½æ‹¥æœ‰è‡ªå·±çš„<code>dep</code>å±æ€§ï¼Œå­˜æ”¾ä»–æ‰€ä¾èµ–çš„ watcherï¼Œå½“å±æ€§å˜åŒ–åä¼šé€šçŸ¥è‡ªå·±å¯¹åº”çš„ watcher å»æ›´æ–°</li><li>é»˜è®¤åœ¨åˆå§‹åŒ–æ—¶ä¼šè°ƒç”¨ render å‡½æ•°ï¼Œæ­¤æ—¶ä¼šè§¦å‘å±æ€§ä¾èµ–æ”¶é›† <code>dep.depend</code></li><li>å½“å±æ€§å‘ç”Ÿä¿®æ”¹æ—¶ä¼šè§¦å‘<code>watcher</code>æ›´æ–° <code>dep.notify()</code></li></ul><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img20240322144336.png"></p><h2 id="1-2-Vue3ä¾èµ–æ”¶é›†"><a href="#1-2-Vue3ä¾èµ–æ”¶é›†" class="headerlink" title="1.2 Vue3ä¾èµ–æ”¶é›†"></a>1.2 <code>Vue3</code>ä¾èµ–æ”¶é›†</h2><ul><li><code>Vue3</code>ä¸­ä¼šé€šè¿‡<code>Map</code>ç»“æ„å°†å±æ€§å’Œ<code>effect</code>æ˜ å°„èµ·æ¥ã€‚</li><li>é»˜è®¤åœ¨åˆå§‹åŒ–æ—¶ä¼šè°ƒç”¨ render å‡½æ•°ï¼Œæ­¤æ—¶ä¼šè§¦å‘å±æ€§ä¾èµ–æ”¶é›†<code>track</code>ï¼Œ</li><li>å½“å±æ€§å‘ç”Ÿä¿®æ”¹æ—¶ä¼šæ‰¾åˆ°å¯¹åº”çš„<code>effect</code>åˆ—è¡¨ä¾æ¬¡æ‰§è¡Œ<code>trigger</code></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token punctuation">&#123;</span><span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>effect1<span class="token punctuation">,</span>effect2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å°†templateè½¬æ¢æˆrenderå‡½æ•°</title>
      <link href="/2024/03/22/ru-he-jiang-template-zhuan-huan-cheng-render-han-shu/"/>
      <url>/2024/03/22/ru-he-jiang-template-zhuan-huan-cheng-render-han-shu/</url>
      
        <content type="html"><![CDATA[<p>Vue ä¸­å«æœ‰æ¨¡ç‰ˆç¼–è¯‘çš„åŠŸèƒ½ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†ç”¨æˆ·ç¼–å†™çš„ template ç¼–è¯‘ä¸º js ä¸­å¯æ‰§è¡Œçš„ render å‡½æ•°ã€‚</p><h2 id="Vue-ä¸­çš„æ¨¡ç‰ˆè½¬åŒ–æµç¨‹"><a href="#Vue-ä¸­çš„æ¨¡ç‰ˆè½¬åŒ–æµç¨‹" class="headerlink" title="Vue ä¸­çš„æ¨¡ç‰ˆè½¬åŒ–æµç¨‹"></a>Vue ä¸­çš„æ¨¡ç‰ˆè½¬åŒ–æµç¨‹</h2><ol><li>å°† template æ¨¡æ¿è½¬æ¢æˆ ast è¯­æ³•æ ‘ - parserHTML (ast æè¿°è¯­æ³•çš„ï¼Œè™šæ‹Ÿ dom æè¿°çš„ Dom ç»“æ„çš„)</li><li>Vue2 å¯¹é™æ€è¯­æ³•åšé™æ€æ ‡è®° - optimize / Vue3 å¯¹ ast è¯­æ³•è¿›è¡Œè½¬åŒ– - transformï¼ˆæ›´ç»†è‡´ï¼‰</li><li>é‡æ–°ç”Ÿæˆä»£ç  - codeGen</li></ol><p><a href="https://github1s.com/vuejs/vue/blob/main/src/platforms/web/runtime-with-compiler.ts#L21-L22">Vue2 æ¨¡æ¿ç¼–è¯‘çš„è¿‡ç¨‹</a></p><p><a href="https://github.com/vuejs/core/blob/main/packages/compiler-core/src/compile.ts#L61">Vue3 æ¨¡ç‰ˆç¼–è¯‘çš„è¿‡ç¨‹</a></p><blockquote><p>Vue3 ä¸­çš„æ¨¡ç‰ˆè½¬åŒ–ï¼Œåšäº†æ›´å¤šçš„ä¼˜åŒ–æ“ä½œã€‚Vue2 ä»…ä»…æ˜¯æ ‡è®°äº†é™æ€èŠ‚ç‚¹è€Œå·²~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯·è¯´ä¸€ä¸‹ä½ å¯¹å“åº”å¼æ•°æ®çš„ç†è§£ï¼Ÿ</title>
      <link href="/2024/03/22/qing-shuo-yi-xia-ni-dui-xiang-ying-shi-shu-ju-de-li-jie/"/>
      <url>/2024/03/22/qing-shuo-yi-xia-ni-dui-xiang-ying-shi-shu-ju-de-li-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-å¦‚ä½•å®ç°å“åº”å¼æ•°æ®"><a href="#1-1-å¦‚ä½•å®ç°å“åº”å¼æ•°æ®" class="headerlink" title="1.1 å¦‚ä½•å®ç°å“åº”å¼æ•°æ®"></a>1.1 å¦‚ä½•å®ç°å“åº”å¼æ•°æ®</h2><p>æ•°ç»„å’Œå¯¹è±¡ç±»å‹å½“å€¼å˜åŒ–æ—¶å¦‚ä½•åŠ«æŒåˆ°ã€‚å¯¹è±¡å†…éƒ¨é€šè¿‡<code>defineReactive</code>æ–¹æ³•ï¼Œä½¿ç”¨<code>Object.defineProperty</code>å°†å±æ€§è¿›è¡ŒåŠ«æŒï¼ˆåªä¼šåŠ«æŒå·²ç»å­˜åœ¨çš„å±æ€§ï¼‰ï¼Œæ•°ç»„åˆ™æ˜¯é€šè¿‡é‡å†™æ•°ç»„æ–¹æ³•æ¥å®ç°ã€‚ å¤šå±‚å¯¹è±¡æ˜¯é€šè¿‡<strong>é€’å½’</strong>æ¥å®ç°åŠ«æŒã€‚<code>Vue3</code>åˆ™é‡‡ç”¨ proxy</p><h2 id="1-2-vue2-å¤„ç†ç¼ºé™·"><a href="#1-2-vue2-å¤„ç†ç¼ºé™·" class="headerlink" title="1.2 vue2 å¤„ç†ç¼ºé™·"></a>1.2 <code>vue2</code> å¤„ç†ç¼ºé™·</h2><ul><li>åœ¨ <code>Vue2</code> çš„æ—¶å€™ä½¿ç”¨ <code>defineProperty</code> æ¥è¿›è¡Œæ•°æ®çš„åŠ«æŒ, éœ€è¦å¯¹å±æ€§è¿›è¡Œé‡å†™æ·»åŠ <code>getter</code>åŠ<code>setter</code> <strong>æ€§èƒ½å·®</strong>ã€‚</li><li>å½“æ–°å¢å±æ€§å’Œåˆ é™¤å±æ€§æ—¶æ— æ³•ç›‘æ§å˜åŒ–ã€‚éœ€è¦é€šè¿‡<code>$set</code>ã€<code>$delete</code>å®ç°</li><li>æ•°ç»„ä¸é‡‡ç”¨ <code>defineProperty</code> æ¥è¿›è¡ŒåŠ«æŒ ï¼ˆæµªè´¹æ€§èƒ½ï¼Œå¯¹æ‰€æœ‰ç´¢å¼•è¿›è¡ŒåŠ«æŒä¼šé€ æˆæ€§èƒ½æµªè´¹ï¼‰éœ€è¦å¯¹æ•°ç»„å•ç‹¬è¿›è¡Œå¤„ç†ã€‚</li><li>å¯¹äº <code>ES6</code> ä¸­æ–°äº§ç”Ÿçš„ Mapã€Set è¿™äº›æ•°æ®ç»“æ„ä¸æ”¯æŒã€‚</li></ul><h2 id="1-3-Vue2-ä¸-Vue3-å®ç°å¯¹æ¯”"><a href="#1-3-Vue2-ä¸-Vue3-å®ç°å¯¹æ¯”" class="headerlink" title="1.3 Vue2 ä¸ Vue3 å®ç°å¯¹æ¯”"></a>1.3 <code>Vue2</code> ä¸ <code>Vue3</code> å®ç°å¯¹æ¯”</h2><p>Vue2</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span><span class="token punctuation">&#123;</span> Â¸v        <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token comment">//ä¾èµ–æ”¶é›†</span>            <span class="token keyword">return</span> value<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!==</span> newValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>                <span class="token function">observer</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">!==</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> data    <span class="token punctuation">&#125;</span>  <span class="token comment">//ä¾èµ–æ›´æ–°</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">defineReactive</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>key<span class="token punctuation">,</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>vue3</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> handler <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> oldValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldValue <span class="token operator">!==</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“ï¼š"><a href="#æ€»ç»“ï¼š" class="headerlink" title="æ€»ç»“ï¼š"></a>æ€»ç»“ï¼š</h2><p><a href="https://github1s.com/vuejs/vue/blob/HEAD/src/core/observer/index.ts#L105-L106">Vue2 æºç </a> ,<a href="https://github1s.com/vuejs/core/blob/main/packages/reactivity/src/reactive.ts#L90-L91">Vue3 æºç </a></p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¢ç„¶ Vue é€šè¿‡æ•°æ®åŠ«æŒå¯ä»¥ç²¾å‡†æ¢æµ‹æ•°æ®å˜åŒ–,ä¸ºä»€ä¹ˆè¿˜éœ€è¦è™šæ‹Ÿ DOM è¿›è¡Œ diff æ£€æµ‹å·®å¼‚ï¼Ÿ</title>
      <link href="/2024/03/22/wei-shi-me-yao-you-diff-suan-fa/"/>
      <url>/2024/03/22/wei-shi-me-yao-you-diff-suan-fa/</url>
      
        <content type="html"><![CDATA[<ul><li><p>Vue çš„æ•°æ®åŠ«æŒæ˜¯é€šè¿‡ Object.defineProperty æˆ– Proxy æ¥å®ç°çš„ã€‚</p></li><li><p>è™šæ‹Ÿ DOM æ˜¯ç”¨äºæ¯”è¾ƒä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´çš„è™šæ‹Ÿæ ‘ï¼Œæ‰¾å‡ºå·®å¼‚å¹¶ä»…æ›´æ–°å¿…è¦çš„éƒ¨åˆ†ã€‚ä»è€Œæé«˜æ€§èƒ½ï¼Œå‡å°‘ç›´æ¥æ“ä½œå®é™… DOM çš„æ¬¡æ•°ã€‚ï¼ˆç›´æ¥æ“ä½œçœŸå® DOM æ˜¯ä»£ä»·æ˜¯éå¸¸æ˜‚è´µçš„ï¼‰</p></li></ul><blockquote><p>Vue å†…éƒ¨è®¾è®¡åŸå› å¯¼è‡´ï¼Œvue è®¾è®¡çš„æ˜¯æ¯ä¸ªç»„ä»¶ä¸€ä¸ª watcherï¼ˆæ¸²æŸ“ watcherï¼‰ï¼Œæ²¡æœ‰é‡‡ç”¨ä¸€ä¸ªå±æ€§å¯¹åº”ä¸€ä¸ª watcherã€‚è¿™æ ·ä¼šå¯¼è‡´å¤§é‡ watcher çš„äº§ç”Ÿè€Œä¸”æµªè´¹å†…å­˜ï¼Œå¦‚æœç²’åº¦è¿‡ä½ä¹Ÿæ— æ³•ç²¾å‡†æ£€æµ‹å˜åŒ–ã€‚æ‰€ä»¥é‡‡ç”¨ diff ç®—æ³• + ç»„ä»¶çº§ watcherã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°ˆè°ˆvueç»„ä»¶åŒ–çš„ç†è§£</title>
      <link href="/2024/03/22/tan-tan-vue-zu-jian-hua-de-li-jie/"/>
      <url>/2024/03/22/tan-tan-vue-zu-jian-hua-de-li-jie/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>WebComponent</code> ç»„ä»¶åŒ–çš„æ ¸å¿ƒç»„æˆï¼šæ¨¡æ¿ã€å±æ€§ã€äº‹ä»¶ã€æ’æ§½ã€ç”Ÿå‘½å‘¨æœŸã€‚</p></blockquote><p>ç»„ä»¶åŒ–å¥½å¤„: é«˜å†…èšã€å¯é‡ç”¨ã€å¯ç»„åˆ</p><ul><li>ç»„ä»¶åŒ–å¼€å‘èƒ½å¤§å¹…æé«˜åº”ç”¨å¼€å‘æ•ˆç‡ã€æµ‹è¯•æ€§ã€å¤ç”¨æ€§ç­‰;</li><li>é™ä½æ›´æ–°èŒƒå›´ï¼Œåªé‡æ–°æ¸²æŸ“å˜åŒ–çš„ç»„ä»¶ï¼›</li></ul><h2 id="è¡¥å……ï¼š"><a href="#è¡¥å……ï¼š" class="headerlink" title="è¡¥å……ï¼š"></a>è¡¥å……ï¼š</h2><ul><li><p>Vue ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰ä¸€ä¸ªæ¸²æŸ“å‡½æ•° watcherã€effectã€‚</p></li><li><p>æ•°æ®æ˜¯å“åº”å¼çš„ï¼Œæ•°æ®å˜åŒ–åä¼šæ‰§è¡Œ watcher æˆ–è€… effectã€‚</p></li><li><p>ç»„ä»¶è¦åˆç†çš„åˆ’åˆ†ï¼Œå¦‚æœä¸æ‹†åˆ†ç»„ä»¶ï¼Œé‚£æ›´æ–°çš„æ—¶å€™æ•´ä¸ªé¡µé¢éƒ½è¦é‡æ–°æ›´æ–°ã€‚</p></li><li><p>å¦‚æœè¿‡åˆ†çš„æ‹†åˆ†ç»„ä»¶ä¼šå¯¼è‡´ watcherã€effect äº§ç”Ÿè¿‡å¤šä¹Ÿä¼šé€ æˆæ€§èƒ½æµªè´¹ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vueä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM</title>
      <link href="/2024/03/21/vue-wei-shi-me-xu-yao-xu-ni-dom/"/>
      <url>/2024/03/21/vue-wei-shi-me-xu-yao-xu-ni-dom/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1-åŸºæœ¬æ¦‚å¿µ"><a href="#1-1-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="1.1 åŸºæœ¬æ¦‚å¿µ"></a>1.1 åŸºæœ¬æ¦‚å¿µ</h2><blockquote><p>åŸºæœ¬ä¸Šæ‰€æœ‰æ¡†æ¶éƒ½å¼•å…¥äº†è™šæ‹Ÿ DOM æ¥å¯¹çœŸå® DOM è¿›è¡ŒæŠ½è±¡ï¼Œä¹Ÿå°±æ˜¯ç°åœ¨å¤§å®¶æ‰€ç†ŸçŸ¥çš„ VNode å’Œ VDOM</p></blockquote><ul><li>Virtual DOM å°±æ˜¯ç”¨ js å¯¹è±¡æ¥æè¿°çœŸå® DOMï¼Œæ˜¯å¯¹çœŸå® DOM çš„æŠ½è±¡ï¼Œç”±äºç›´æ¥æ“ä½œ DOM æ€§èƒ½ä½ä½†æ˜¯ js å±‚çš„æ“ä½œæ•ˆç‡é«˜ï¼Œå¯ä»¥å°† DOM æ“ä½œè½¬åŒ–æˆå¯¹è±¡æ“ä½œï¼Œæœ€ç»ˆé€šè¿‡ diff ç®—æ³•æ¯”å¯¹å·®å¼‚è¿›è¡Œæ›´æ–° DOMï¼ˆå‡å°‘äº†å¯¹çœŸå® DOM çš„æ“ä½œï¼‰ã€‚</li><li>è™šæ‹Ÿ DOM ä¸ä¾èµ–çœŸå®å¹³å°ç¯å¢ƒä»è€Œä¹Ÿå¯ä»¥å®ç°è·¨å¹³å°ã€‚</li></ul><h2 id="1-2-VDOM-æ˜¯å¦‚ä½•ç”Ÿæˆçš„-ï¼Ÿ"><a href="#1-2-VDOM-æ˜¯å¦‚ä½•ç”Ÿæˆçš„-ï¼Ÿ" class="headerlink" title="1.2 VDOM æ˜¯å¦‚ä½•ç”Ÿæˆçš„ ï¼Ÿ"></a>1.2 VDOM æ˜¯å¦‚ä½•ç”Ÿæˆçš„ ï¼Ÿ</h2><ul><li>åœ¨ vue ä¸­æˆ‘ä»¬å¸¸å¸¸ä¼šä¸ºç»„ä»¶ç¼–å†™æ¨¡æ¿ - template</li><li>è¿™ä¸ªæ¨¡æ¿ä¼šè¢«ç¼–è¯‘å™¨ç¼–è¯‘ä¸ºæ¸²æŸ“å‡½æ•° - render</li><li>åœ¨æ¥ä¸‹æ¥çš„æŒ‚è½½è¿‡ç¨‹ä¸­ä¼šè°ƒç”¨ render å‡½æ•°ï¼Œè¿”å›çš„å¯¹è±¡å°±æ˜¯è™šæ‹Ÿ dom</li><li>ä¼šåœ¨åç»­çš„ patch è¿‡ç¨‹ä¸­è¿›ä¸€æ­¥è½¬åŒ–ä¸º çœŸå® domã€‚</li></ul><h2 id="1-3-VDOM-å¦‚ä½•åš-diff-çš„ï¼Ÿ"><a href="#1-3-VDOM-å¦‚ä½•åš-diff-çš„ï¼Ÿ" class="headerlink" title="1.3 VDOM å¦‚ä½•åš diff çš„ï¼Ÿ"></a>1.3 VDOM å¦‚ä½•åš diff çš„ï¼Ÿ</h2><ul><li>æŒ‚è½½è¿‡ç¨‹ç»“æŸåï¼Œä¼šè®°å½•ç¬¬ä¸€æ¬¡ç”Ÿæˆçš„ VDOM - oldVnode</li><li>å½“å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°†ä¼šå¼•èµ·ç»„ä»¶é‡æ–° renderï¼Œæ­¤æ—¶å°±ä¼šç”Ÿæˆæ–°çš„ VDOM - newVnode</li><li>ä½¿ç”¨ oldVnode ä¸ newVnode åš diff æ“ä½œï¼Œå°†æ›´æ”¹çš„éƒ¨åˆ†åº”åˆ°çœŸå® DOM ä¸Šï¼Œä»è€Œè½¬æ¢ä¸ºæœ€å°é‡çš„ dom æ“ä½œï¼Œé«˜æ•ˆæ›´æ–°è§†å›¾ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°ˆè°ˆä½ å¯¹vueçš„ç†è§£</title>
      <link href="/2024/03/21/tan-tan-ni-dui-vue-de-li-jie/"/>
      <url>/2024/03/21/tan-tan-ni-dui-vue-de-li-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="1-è°ˆè°ˆä½ å¯¹-vue-çš„ç†è§£-ï¼Ÿ"><a href="#1-è°ˆè°ˆä½ å¯¹-vue-çš„ç†è§£-ï¼Ÿ" class="headerlink" title="1.è°ˆè°ˆä½ å¯¹ vue çš„ç†è§£ ï¼Ÿ"></a>1.è°ˆè°ˆä½ å¯¹ vue çš„ç†è§£ ï¼Ÿ</h1><p>å®˜æ–¹ï¼š <strong>Vue</strong>æ˜¯ä¸€å¥—ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„<strong>æ¸è¿›å¼æ¡†æ¶</strong>ï¼ŒVue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚</p><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img20240321153030.png"></p><p>å£°æ˜å¼æ¸²æŸ“ï¼ˆdataï¼Œmathodï¼‰ï¼ŒåŠŸèƒ½ä¸å¤Ÿï¼Œå¤§å‹é¡¹ç›®éœ€è¦æ‹†åˆ†ï¼Œæä¾›äº†ç»„ä»¶åŒ–åŠŸèƒ½ï¼Œæœ‰æä¾›äº†å®¢æˆ·ç«¯è·¯ç”±çš„æ¨¡å¼ï¼Œéœ€è¦é€šä¿¡ï¼Œæä¾›äº†çŠ¶æ€ç®¡ç†ï¼ˆvuexï¼Œpiniaï¼‰ï¼Œä¸Šçº¿æ‰“åŒ…ï¼Œæä¾›äº†æ„å»ºå·¥å…·ç­‰..,æ¸è¿›å¼æ¡†æ¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä¸­çš„éƒ¨åˆ†åŠŸèƒ½ï¼Œéœ€è¦äº†å†æ‹¿è¿‡æ¥</p><h2 id="1-1-å£°æ˜å¼æ¡†æ¶"><a href="#1-1-å£°æ˜å¼æ¡†æ¶" class="headerlink" title="1.1 å£°æ˜å¼æ¡†æ¶"></a>1.1 å£°æ˜å¼æ¡†æ¶</h2><p><strong>ä»¤å¼å’Œå£°æ˜å¼çš„åŒºåˆ«</strong></p><ul><li><p>æ—©åœ¨ JQ çš„æ—¶ä»£ç¼–å†™çš„ä»£ç éƒ½æ˜¯å‘½ä»¤å¼çš„ï¼Œå‘½ä»¤å¼æ¡†æ¶é‡è¦<strong>ç‰¹ç‚¹å°±æ˜¯å…³æ³¨è¿‡ç¨‹</strong></p></li><li><p><strong>å£°æ˜å¼æ¡†æ¶æ›´åŠ å…³æ³¨ç»“æœ</strong>ã€‚å‘½ä»¤å¼çš„ä»£ç å°è£…åˆ°äº† Vuejs ä¸­ï¼Œè¿‡ç¨‹é  vuejs æ¥å®ç°</p><blockquote><p>å£°æ˜å¼ä»£ç æ›´åŠ ç®€å•ï¼Œä¸éœ€è¦å…³æ³¨å®ç°ï¼ŒæŒ‰ç…§è¦æ±‚å¡«ä»£ç å°±å¯ä»¥ ï¼ˆç»™ä¸ŠåŸææ–™å°±å‡ºç»“æœï¼‰</p></blockquote></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">-</span> å‘½ä»¤å¼ç¼–ç¨‹ï¼š<span class="token keyword">let</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token keyword">let</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numbers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  total <span class="token operator">+=</span> numbers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> å…³æ³¨äº†è¿‡ç¨‹<span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token operator">-</span> å£°æ˜å¼ç¼–ç¨‹ï¼š<span class="token keyword">let</span> total2 <span class="token operator">=</span> numbers<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span>current</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> memo <span class="token operator">+</span> current<span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>total2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-2-MVVM-æ¨¡å¼"><a href="#1-2-MVVM-æ¨¡å¼" class="headerlink" title="1.2 MVVM æ¨¡å¼"></a>1.2 MVVM æ¨¡å¼</h2><h3 id="1-2-1-MVC-æ¨¡å¼"><a href="#1-2-1-MVC-æ¨¡å¼" class="headerlink" title="1.2.1 MVC æ¨¡å¼"></a>1.2.1 MVC æ¨¡å¼</h3><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img20240321154403.png"></p><p>è¿™æ˜¯ä¸€ä¸ªå•å‘çš„è¿‡ç¨‹</p><blockquote><p>ç”¨æˆ·è¯·æ±‚èµ„æºåˆ°æ§åˆ¶å±‚ï¼Œæ§åˆ¶å±‚æ”¾ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åç„¶åå»æ‰ service æœåŠ¡å±‚é€šè¿‡ model å»æŸ¥æ•°æ®ï¼Œæ¸²æŸ“åˆ°é¡µé¢ view å±‚</p></blockquote><p>å¯¹äºå‰ç«¯è€Œè¨€å°±æ˜¯å¦‚ä½•å°†æ•°æ®åŒæ­¥åˆ°é¡µé¢ä¸Šï¼Œä¹Ÿæ˜¯å€Ÿé‰´åç«¯æ€æƒ³ã€‚</p><h3 id="1-2-3-MVVM-æ¨¡å¼-æ˜ å°„å…³ç³»çš„ç®€åŒ–-ï¼ˆéšè—-controllerï¼‰"><a href="#1-2-3-MVVM-æ¨¡å¼-æ˜ å°„å…³ç³»çš„ç®€åŒ–-ï¼ˆéšè—-controllerï¼‰" class="headerlink" title="1.2.3 MVVM æ¨¡å¼ : æ˜ å°„å…³ç³»çš„ç®€åŒ– ï¼ˆéšè— controllerï¼‰"></a>1.2.3 MVVM æ¨¡å¼ : æ˜ å°„å…³ç³»çš„ç®€åŒ– ï¼ˆéšè— controllerï¼‰</h3><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img20240321154946.png"></p><p>ViewModel ï¼šè‡ªåŠ¨ç›‘å¬ dom å˜åŒ–ï¼Œå°†æ•°æ®æ›´æ–°åˆ° Model ä¸­ï¼Œä¹Ÿå¯ä»¥æŠŠæ•°æ®ç»‘å®šåˆ°è§†å›¾ä¸­ï¼Œv-model</p><blockquote><p>è™½ç„¶æ²¡æœ‰å®Œå…¨éµå¾ª <strong>MVVM</strong> æ¨¡å‹ï¼Œä½†æ˜¯ Vue çš„è®¾è®¡ä¹Ÿå—åˆ°äº†å®ƒçš„å¯å‘ã€‚å› æ­¤åœ¨æ–‡æ¡£ä¸­ç»å¸¸ä¼šä½¿ç”¨ <code>vm</code> (ViewModel çš„ç¼©å†™) è¿™ä¸ªå˜é‡åè¡¨ç¤º Vue å®ä¾‹ã€‚(å¯ä»¥é€šè¿‡ ref æ›´æ”¹æ•°æ®)</p></blockquote><h2 id="1-3-é‡‡ç”¨è™šæ‹Ÿ-DOM"><a href="#1-3-é‡‡ç”¨è™šæ‹Ÿ-DOM" class="headerlink" title="1.3 é‡‡ç”¨è™šæ‹Ÿ DOM"></a>1.3 é‡‡ç”¨è™šæ‹Ÿ DOM</h2><p>ä¼ ç»Ÿæ›´æ–°é¡µé¢ï¼Œæ‹¼æ¥ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸² innerHTML å…¨éƒ¨é‡æ–°æ¸²æŸ“ï¼Œæ·»åŠ è™šæ‹Ÿ DOM åï¼Œå¯ä»¥æ¯”è¾ƒæ–°æ—§è™šæ‹ŸèŠ‚ç‚¹ï¼Œæ‰¾åˆ°å˜åŒ–åœ¨è¿›è¡Œæ›´æ–°ã€‚<strong>è™šæ‹Ÿ DOM å°±æ˜¯ä¸€ä¸ªå¯¹è±¡</strong>ï¼Œç”¨æ¥æè¿°çœŸå® DOM çš„</p><h3 id="æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ"><a href="#æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ" class="headerlink" title="æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ"></a>æœ€å¤§çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆ</h3><ul><li>å¯ä»¥è·¨å¹³å°ï¼Œå¯¹è±¡æ˜¯å¯ä»¥è·¨å¹³å°çš„</li><li>è™šæ‹Ÿ dom å¯ä»¥åšç¼“å­˜å±‚ï¼Œæ‰€æœ‰çš„ä¿®æ”¹éƒ½å¯ä»¥åœ¨è™šæ‹Ÿ dom å±‚é¢ã€diff ç®—æ³•ã€‘</li></ul><p><a href="https://github1s.com/vuejs/vue/blob/main/src/core/vdom/vnode.ts">https://github.com/vuejs/vue/blob/main/src/core/vdom/vnode.ts</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">tag<span class="token operator">?</span><span class="token operator">:</span> string<span class="token literal-property property">data</span><span class="token operator">:</span> VNodeData <span class="token operator">|</span> <span class="token keyword">undefined</span>children<span class="token operator">?</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>VNode<span class="token operator">></span> <span class="token operator">|</span> <span class="token keyword">null</span>text<span class="token operator">?</span><span class="token operator">:</span> string<span class="token literal-property property">elm</span><span class="token operator">:</span> Node <span class="token operator">|</span> <span class="token keyword">undefined</span>ns<span class="token operator">?</span><span class="token operator">:</span> stringcontext<span class="token operator">?</span><span class="token operator">:</span> Component <span class="token comment">// rendered in this component's scope</span><span class="token literal-property property">key</span><span class="token operator">:</span> string <span class="token operator">|</span> number <span class="token operator">|</span> <span class="token keyword">undefined</span>componentOptions<span class="token operator">?</span><span class="token operator">:</span> VNodeComponentOptionscomponentInstance<span class="token operator">?</span><span class="token operator">:</span> Component <span class="token comment">// component instance</span><span class="token literal-property property">parent</span><span class="token operator">:</span> VNode <span class="token operator">|</span> <span class="token keyword">undefined</span> <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token comment">// component placeholder node</span><span class="token comment">// strictly internal</span><span class="token literal-property property">raw</span><span class="token operator">:</span> boolean <span class="token comment">// contains raw HTML? (server only)</span><span class="token literal-property property">isStatic</span><span class="token operator">:</span> boolean <span class="token comment">// hoisted static node</span><span class="token literal-property property">isRootInsert</span><span class="token operator">:</span> boolean <span class="token comment">// necessary for enter transition check</span><span class="token literal-property property">isComment</span><span class="token operator">:</span> boolean <span class="token comment">// empty comment placeholder?</span><span class="token literal-property property">isCloned</span><span class="token operator">:</span> boolean <span class="token comment">// is a cloned node?</span><span class="token literal-property property">isOnce</span><span class="token operator">:</span> boolean <span class="token comment">// is a v-once node?</span>asyncFactory<span class="token operator">?</span><span class="token operator">:</span> Function <span class="token comment">// async component factory function</span><span class="token literal-property property">asyncMeta</span><span class="token operator">:</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token literal-property property">isAsyncPlaceholder</span><span class="token operator">:</span> booleanssrContext<span class="token operator">?</span><span class="token operator">:</span> Object <span class="token operator">|</span> <span class="token keyword">void</span><span class="token literal-property property">fnContext</span><span class="token operator">:</span> Component <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token comment">// real context vm for functional nodes</span>fnOptions<span class="token operator">?</span><span class="token operator">:</span> ComponentOptions <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token comment">// for SSR caching</span>devtoolsMeta<span class="token operator">?</span><span class="token operator">:</span> Object <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token comment">// used to store functional render context for devtools</span>fnScopeId<span class="token operator">?</span><span class="token operator">:</span> string <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token comment">// functional scope id support</span>isComponentRootElement<span class="token operator">?</span><span class="token operator">:</span> boolean <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token comment">// for SSR directives</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="1-4-åŒºåˆ†ç¼–è¯‘æ—¶-æ‰“åŒ…-å’Œè¿è¡Œ-æµè§ˆå™¨-æ—¶"><a href="#1-4-åŒºåˆ†ç¼–è¯‘æ—¶-æ‰“åŒ…-å’Œè¿è¡Œ-æµè§ˆå™¨-æ—¶" class="headerlink" title="1.4 åŒºåˆ†ç¼–è¯‘æ—¶(æ‰“åŒ…)å’Œè¿è¡Œ(æµè§ˆå™¨)æ—¶"></a>1.4 åŒºåˆ†ç¼–è¯‘æ—¶(æ‰“åŒ…)å’Œè¿è¡Œ(æµè§ˆå™¨)æ—¶</h2><ul><li>Vue çš„æ¸²æŸ“æ ¸å¿ƒå°±æ˜¯è°ƒç”¨æ¸²æŸ“ï¼ˆrenderï¼‰æ–¹æ³•å°†è™šæ‹Ÿ DOM æ¸²æŸ“æˆçœŸå® DOM ï¼ˆç¼ºç‚¹å°±æ˜¯è™šæ‹Ÿ DOM ç¼–å†™éº»çƒ¦ï¼‰</li><li>ä¸“é—¨å†™ä¸ªç¼–è¯‘æ—¶å¯ä»¥å°†æ¨¡æ¿ç¼–è¯‘æˆè™šæ‹Ÿ DOM ï¼ˆåœ¨æ„å»ºçš„æ—¶å€™è¿›è¡Œç¼–è¯‘æ€§èƒ½æ›´é«˜ï¼Œä¸éœ€è¦å†è¿è¡Œçš„æ—¶å€™è¿›è¡Œç¼–è¯‘ï¼‰</li></ul><h2 id="1-5-ç»„ä»¶åŒ–"><a href="#1-5-ç»„ä»¶åŒ–" class="headerlink" title="1.5 ç»„ä»¶åŒ–"></a>1.5 ç»„ä»¶åŒ–</h2><p>å®ç°é«˜å†…èšã€ä½è€¦åˆã€å•å‘æ•°æ®æµ</p><ul><li>ç»„ä»¶åŒ–å¼€å‘èƒ½å¤§å¹…æé«˜åº”ç”¨å¼€å‘æ•ˆç‡ã€æµ‹è¯•æ€§ã€å¤ç”¨æ€§ç­‰;</li><li>é™ä½æ›´æ–°èŒƒå›´ï¼Œåªé‡æ–°æ¸²æŸ“å˜åŒ–çš„ç»„ä»¶</li></ul><p>æ¨¡å—åŒ–ï¼šé’ˆå¯¹çš„ä¸šåŠ¡é€»è¾‘ï¼Œé€»è¾‘ä¸Šçš„å°è£…å’ŒæŠ½ç¦»ã€‚ç»„ä»¶åŒ–æ˜¯å¯¹ UI çš„æŠ½ç¦»</p><p><strong>æ€»ç»“ï¼š</strong></p><p>vue å£°æ˜å¼æ¡†æ¶ï¼Œé‡Œé¢å€Ÿé‰´äº† mvvm æ€æƒ³ï¼Œæœ‰è™šæ‹Ÿ domï¼Œæœ‰ç¼–è¯‘ï¼Œæ¸²æŸ“çš„æ—¶å€™æœ‰ç»„ä»¶åŒ–çš„ç‰¹ç‚¹ï¼Œåšä¸€äº›æ‹†åˆ†</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>echartsè‡ªé€‚åº”é—®é¢˜é«˜çº§è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2024/01/26/echarts-zi-gua-ying-wen-ti-gao-ji-jie-jue-fang-an/"/>
      <url>/2024/01/26/echarts-zi-gua-ying-wen-ti-gao-ji-jie-jue-fang-an/</url>
      
        <content type="html"><![CDATA[<h2 id="1-èƒŒæ™¯"><a href="#1-èƒŒæ™¯" class="headerlink" title="1. èƒŒæ™¯"></a>1. èƒŒæ™¯</h2><p>åœ¨ç§»åŠ¨ç«¯æˆ–è€… PC ç«¯å½“é¡µé¢å°ºå¯¸å‘ç”Ÿå˜åŒ–æ—¶ï¼Œecharts å›¾è¡¨éœ€è¦è‡ªé€‚åº”ï¼Œä»¥é€‚åº”é¡µé¢å°ºå¯¸çš„å˜åŒ–ã€‚</p><h2 id="2-è§£å†³æ–¹æ¡ˆ"><a href="#2-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="2. è§£å†³æ–¹æ¡ˆ"></a>2. è§£å†³æ–¹æ¡ˆ</h2><h3 id="å¢åŠ å›¾è¡¨-resize"><a href="#å¢åŠ å›¾è¡¨-resize" class="headerlink" title="å¢åŠ å›¾è¡¨ resize"></a>å¢åŠ å›¾è¡¨ resize</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  chart<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="è§£å†³-canvas-ç”»å¸ƒå¤§å°å’Œå®¹å™¨å¤§å°ä¸ä¸€è‡´çš„é—®é¢˜"><a href="#è§£å†³-canvas-ç”»å¸ƒå¤§å°å’Œå®¹å™¨å¤§å°ä¸ä¸€è‡´çš„é—®é¢˜" class="headerlink" title="è§£å†³ canvas ç”»å¸ƒå¤§å°å’Œå®¹å™¨å¤§å°ä¸ä¸€è‡´çš„é—®é¢˜"></a>è§£å†³ canvas ç”»å¸ƒå¤§å°å’Œå®¹å™¨å¤§å°ä¸ä¸€è‡´çš„é—®é¢˜</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resizeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// Auto resizes the chart when the browser window is resized.</span><span class="token keyword">const</span> <span class="token function-variable function">resizeHandler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"resize.."</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>chart<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token keyword">let</span> width <span class="token operator">=</span> myChart<span class="token punctuation">.</span>value<span class="token punctuation">.</span>offsetWidth  <span class="token keyword">let</span> height <span class="token operator">=</span> myChart<span class="token punctuation">.</span>value<span class="token punctuation">.</span>offsetHeight  chart<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„</strong></p><ul><li>çª—å£æ”¹å˜æ—¶ EChart ä¼šç«‹å³è·å–å®½åº¦ï¼Œä½†æ˜¯æ­¤æ—¶å®½åº¦è¿˜åœ¨å˜åŒ–ä¸­ï¼Œå¯èƒ½ä¸æ˜¯æœ€ç»ˆå€¼ï¼Œæ‰€ä»¥ ECharts æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œä¿®æ”¹æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ªå»¶æ—¶ã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"resize"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">resizeHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è§£å†³æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> echarts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç§»åŠ¨è®¾å¤‡ä¸Šçš„å®‰å…¨åŒºåŸŸé€‚é…</title>
      <link href="/2024/01/26/yi-dong-she-bei-shang-de-an-quan-qu-yu-gua-pei/"/>
      <url>/2024/01/26/yi-dong-she-bei-shang-de-an-quan-qu-yu-gua-pei/</url>
      
        <content type="html"><![CDATA[<h1 id="CSS-ä»£ç è§£æ"><a href="#CSS-ä»£ç è§£æ" class="headerlink" title="CSS ä»£ç è§£æ"></a>CSS ä»£ç è§£æ</h1><h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>å½“æˆ‘ä»¬å†™ä¸ªåŠŸèƒ½ï¼Œå®¹å™¨çš„é«˜åº¦éœ€è¦è®¾ç½®ä¸º 100vhï¼Œå‘ç°åœ¨ ios(safari)æµè§ˆå™¨æ˜¾ç¤ºçš„æ—¶å€™ï¼Œæµè§ˆå™¨çš„åº•éƒ¨å·¥å…·æ æ€»æ˜¯ä¼šæŒ¡ä½åº•ä¸‹çš„ä¸€éƒ¨åˆ†ï¼Œåªæœ‰å·¥å…·æ éšè—æˆ–è€…å‘ä¸Šæ»šåŠ¨çš„æ—¶å€™æ‰èƒ½çœ‹åˆ°ã€‚</p><h2 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h2><p>æ²¡æ‰¾åˆ°ç›¸å…³å®˜æ–¹çš„é—®é¢˜ï¼Œä»çŸ¥ä¹ä¸Šæœåˆ°ä¸€ä¸ªè§£é‡Šï¼Œè§‰å¾—åˆç†ï¼Œå°±å½“æ˜¯åŸå› å§ï¼šåœ¨ Safari ä¸Šå·¥ä½œæ—¶ï¼Œè¯¥å›¢é˜ŸåŠªåŠ›åªåœ¨å¿…è¦æ—¶æ˜¾ç¤ºæŒ‰é’®æ ã€‚ä»–ä»¬çš„ç›®æ ‡æ˜¯å°½å¯èƒ½ç»™ç½‘ç«™æ›´å¤šçš„ç©ºé—´ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæŒ‰é’®æ åœ¨æ»šåŠ¨æ—¶éšè—ã€‚è¿™å¯¼è‡´äº†ä¸€ä¸ªå…³äºå¦‚ä½•å¤„ç†è§†å£é«˜åº¦çš„è‰°éš¾å†³å®šã€‚å®ƒä¼š</p><ul><li>æ¯æ¬¡å·¥å…·æ¡éšè—å’Œæ˜¾ç¤ºæ—¶æ›´æ”¹é«˜åº¦ã€‚</li><li>ä½¿è§†å£é«˜åº¦ä¿æŒä¸å˜ï¼Œå¹¶è®©æŒ‰é’®æ è¦†ç›–è§†å£çš„ä¸€éƒ¨åˆ†ã€‚</li></ul><h2 id="è§£å†³æ–¹æ³•"><a href="#è§£å†³æ–¹æ³•" class="headerlink" title="è§£å†³æ–¹æ³•"></a>è§£å†³æ–¹æ³•</h2><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>  <span class="token property">min-height</span><span class="token punctuation">:</span> 100vh<span class="token punctuation">,</span> -webkit-fill-available<span class="token punctuation">;</span>  <span class="token comment">/* min-height: 100vh;  min-height: -webkit-fill-available; */</span>  <span class="token comment">/* é€‚é…é½åˆ˜æµ·*/</span>  <span class="token property">padding-top</span><span class="token punctuation">:</span> <span class="token function">constant</span><span class="token punctuation">(</span>safe-area-inset-top<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">padding-top</span><span class="token punctuation">:</span> <span class="token function">env</span><span class="token punctuation">(</span>safe-area-inset-top<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* é€‚é…åº•éƒ¨é»‘æ¡*/</span>  <span class="token comment">/* padding-bottom: constant(safe-area-inset-bottom);  padding-bottom: env(safe-area-inset-bottom); */</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h3><ul><li><p>min-height: 100vh;: è¿™ä¸€è¡Œè®¾ç½®é¡µé¢çš„æœ€å°é«˜åº¦ä¸ºè§†çª—é«˜åº¦çš„ 100%ã€‚vh è¡¨ç¤ºè§†çª—é«˜åº¦çš„ç™¾åˆ†æ¯”å•ä½ï¼Œ100vh å³è¡¨ç¤ºæ•´ä¸ªè§†çª—é«˜åº¦ã€‚</p></li><li><p>min-height: -webkit-fill-available;: è¿™æ˜¯ä¸ºäº†åœ¨ WebKitï¼ˆä¾‹å¦‚ï¼ŒSafari æµè§ˆå™¨ï¼‰ä¸­è®¾ç½®é¡µé¢æœ€å°é«˜åº¦ï¼Œä½¿å…¶å¡«å……å¯ç”¨çš„è§†çª—é«˜åº¦ã€‚è¿™åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šç¡®ä¿äº†æ•´ä¸ªè§†çª—é«˜åº¦çš„ä½¿ç”¨ã€‚</p></li><li><p>padding-top: constant(safe-area-inset-top);: è¿™ä¸€è¡Œä½¿ç”¨äº† constant() å‡½æ•°ï¼Œå®ƒç”¨äºæŒ‡å®šä¸€ä¸ªå¸¸é‡å€¼ã€‚safe-area-inset-top è¡¨ç¤ºè®¾å¤‡çš„å®‰å…¨åŒºåŸŸåœ¨é¡¶éƒ¨çš„é«˜åº¦ã€‚è¿™æ ·è®¾ç½®çš„ç›®çš„æ˜¯åœ¨é¡µé¢çš„é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªä¸å®‰å…¨åŒºåŸŸé«˜åº¦ç›¸ç­‰çš„å†…è¾¹è·ï¼Œä»¥ç¡®ä¿é¡µé¢å†…å®¹ä¸è¢«é®æŒ¡åœ¨è®¾å¤‡çš„åˆ˜æµ·æˆ–çŠ¶æ€æ ç­‰åŒºåŸŸã€‚</p></li><li><p>padding-top: env(safe-area-inset-top);: è¿™ä¸€è¡Œä½¿ç”¨äº† env() å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¹Ÿç”¨äºæŒ‡å®šä¸€ä¸ªç¯å¢ƒå˜é‡å€¼ã€‚åŒæ ·ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†åœ¨é¡µé¢é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªä¸å®‰å…¨åŒºåŸŸé«˜åº¦ç›¸ç­‰çš„å†…è¾¹è·ï¼Œç¡®ä¿é€‚åº”è®¾å¤‡çš„å®‰å…¨åŒºåŸŸã€‚</p></li></ul><h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><p>æˆ‘ä»¬éœ€è¦å°†é¡¶éƒ¨å’Œåº•éƒ¨åˆç†çš„æ‘†æ”¾åœ¨å®‰å…¨åŒºåŸŸå†…ï¼ŒiOS11 æ–°å¢äº†ä¸¤ä¸ª CSS å‡½æ•° <code>envã€constant</code>ï¼Œç”¨äºè®¾å®šå®‰å…¨åŒºåŸŸä¸è¾¹ç•Œçš„è·ç¦»ã€‚</p><p>å‡½æ•°å†…éƒ¨å¯ä»¥æ˜¯å››ä¸ªå¸¸é‡ï¼š</p><ul><li><code>safe-area-inset-left</code>ï¼šå®‰å…¨åŒºåŸŸè·ç¦»å·¦è¾¹è¾¹ç•Œè·ç¦»</li><li><code>safe-area-inset-right</code>ï¼šå®‰å…¨åŒºåŸŸè·ç¦»å³è¾¹è¾¹ç•Œè·ç¦»</li><li><code>safe-area-inset-top</code>ï¼šå®‰å…¨åŒºåŸŸè·ç¦»é¡¶éƒ¨è¾¹ç•Œè·ç¦»</li><li><code>safe-area-inset-bottom</code>ï¼šå®‰å…¨åŒºåŸŸè·ç¦»åº•éƒ¨è¾¹ç•Œè·ç¦»</li></ul><p>æ³¨æ„ï¼šæˆ‘ä»¬å¿…é¡»æŒ‡å®š <code>viweport-fit</code> åæ‰èƒ½ä½¿ç”¨è¿™ä¸¤ä¸ªå‡½æ•°ï¼š</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, viewport-fit=cover<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>constant</code>åœ¨<code>iOS &lt; 11.2</code>çš„ç‰ˆæœ¬ä¸­ç”Ÿæ•ˆï¼Œ<code>env</code>åœ¨<code>iOS &gt;= 11.2</code>çš„ç‰ˆæœ¬ä¸­ç”Ÿæ•ˆï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¾€å¾€è¦åŒæ—¶è®¾ç½®ä»–ä»¬ï¼Œå°†é¡µé¢é™åˆ¶åœ¨å®‰å…¨åŒºåŸŸå†…ï¼š</p><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">&#123;</span>  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> <span class="token function">constant</span><span class="token punctuation">(</span>safe-area-inset-bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token property">padding-bottom</span><span class="token punctuation">:</span> <span class="token function">env</span><span class="token punctuation">(</span>safe-area-inset-bottom<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è§£å†³æ–¹æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç§»åŠ¨ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>v-code-diffä½¿ç”¨</title>
      <link href="/2023/08/29/v-code-diff-shi-yong/"/>
      <url>/2023/08/29/v-code-diff-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="å‚è€ƒï¼š"><a href="#å‚è€ƒï¼š" class="headerlink" title="å‚è€ƒï¼š"></a>å‚è€ƒï¼š</h2><ul><li><a href="https://github.com/Shimada666/v-code-diff/blob/master/README-zh.md">https://github.com/Shimada666/v-code-diff/blob/master/README-zh.md</a></li><li><a href="https://www.npmjs.com/package/v-code-diff">https://www.npmjs.com/package/v-code-diff</a></li><li><a href="https://www.npmjs.com/package/deep-parse-json">https://www.npmjs.com/package/deep-parse-json</a></li></ul><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i deep-parse-json <span class="token comment"># æ·±åº¦è§£æjson</span><span class="token function">npm</span> i v-code-diff<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><h3 id="Vue3-æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶"><a href="#Vue3-æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶" class="headerlink" title="Vue3 æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶"></a>Vue3 æ³¨å†Œä¸ºå…¨å±€ç»„ä»¶</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createApp <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">import</span> CodeDiff <span class="token keyword">from</span> <span class="token string">"v-code-diff"</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>CodeDiff<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">"#app"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;code-diff :old-string&#x3D;&quot;diffData.oldString&quot; :new-string&#x3D;&quot;diffData.newString&quot; output-format&#x3D;&quot;side-by-side&quot; &#x2F;&gt;&lt;&#x2F;template&gt;&lt;script lang&#x3D;&quot;ts&quot; setup&gt;const diffData &#x3D; reactive(&#123;  oldString: &quot;&quot;,  newString: &quot;&quot;,&#125;)onMount(() &#x3D;&gt; &#123;  diffData.oldString &#x3D; JSON.stringify(deepParseJson(&quot;123&quot;), null, 4)  diffData.newString &#x3D; JSON.stringify(deepParseJson(&quot;456&quot;), null, 4)&#125;)&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯¼å‡ºexeclæ–‡ä»¶</title>
      <link href="/2023/08/28/dao-chu-execl-wen-jian/"/>
      <url>/2023/08/28/dao-chu-execl-wen-jian/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒï¼š</p><ul><li><p><a href="https://www.npmjs.com/package/xlsx">https://www.npmjs.com/package/xlsx</a></p></li><li><p><a href="https://juejin.cn/post/7018094518931030053">https://juejin.cn/post/7018094518931030053</a></p></li></ul><ol><li>å®‰è£… xlsx åº“</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm install xlsx <span class="token operator">--</span>save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>å®‰è£… file-saver</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm install file<span class="token operator">-</span>saver <span class="token operator">--</span>save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>ç¼–å†™å‡½æ•°â€”æ–°å»º exportsExcel.js æ–‡ä»¶</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//å°†åŒ…å¯¼å…¥</span><span class="token keyword">import</span> FileSaver <span class="token keyword">from</span> <span class="token string">"file-saver"</span><span class="token keyword">import</span> <span class="token constant">XLSX</span> <span class="token keyword">from</span> <span class="token string">"xlsx"</span><span class="token comment">// ä¼ å…¥jsonæ•°æ®</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">exportDataToExcel</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> title</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> workbook <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//  åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œç°¿</span>  <span class="token keyword">let</span> worksheet <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">json_to_sheet</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment">//æ ¹æ®dataç”Ÿæˆä¸€ä¸ªå·¥ä½œè¡¨:</span>  <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> worksheet<span class="token punctuation">,</span> <span class="token string">"Sheet1"</span><span class="token punctuation">)</span> <span class="token comment">//å°†å·¥ä½œè¡¨å‘½åä¸ºSheet1è¿½åŠ åˆ°å·¥ä½œç°¿</span>  <span class="token keyword">let</span> wbout <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">bookType</span><span class="token operator">:</span> <span class="token string">"xlsx"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"array"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token function">saveAs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>wbout<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"application/octet-stream"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title <span class="token operator">+</span> <span class="token string">".xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¼ å…¥å…ƒç´ idæ•°æ®</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">exportDdomToExcel</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> title</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> workbook <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//  åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œç°¿</span>  <span class="token keyword">let</span> worksheet <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">table_to_shell</span><span class="token punctuation">(</span><span class="token function">documenletuerySelector</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//æ ¹æ®DOMç”Ÿæˆä¸€ä¸ªå·¥ä½œè¡¨:</span>  <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">book_append_sheet</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> worksheet<span class="token punctuation">,</span> <span class="token string">"Sheet1"</span><span class="token punctuation">)</span> <span class="token comment">//å°†å·¥ä½œè¡¨å‘½åä¸ºSheet1è¿½åŠ åˆ°å·¥ä½œç°¿</span>  <span class="token keyword">let</span> wbout <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">bookType</span><span class="token operator">:</span> <span class="token string">"xlsx"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"array"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token function">saveAs</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>wbout<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"application/octet-stream"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title <span class="token operator">+</span> <span class="token string">".xlsx"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TS-å…¼å®¹æ€§</title>
      <link href="/2023/08/15/ts-jian-rong-xing/"/>
      <url>/2023/08/15/ts-jian-rong-xing/</url>
      
        <content type="html"><![CDATA[<blockquote><p>TS ä¸­çš„å…¼å®¹æ€§ï¼Œä¸»è¦çœ‹ç»“æ„æ˜¯å¦å…¼å®¹ã€‚ï¼ˆæ ¸å¿ƒæ˜¯è€ƒè™‘å®‰å…¨æ€§ï¼‰</p></blockquote><h2 id="ä¸€-åŸºæœ¬æ•°æ®ç±»å‹çš„å…¼å®¹æ€§"><a href="#ä¸€-åŸºæœ¬æ•°æ®ç±»å‹çš„å…¼å®¹æ€§" class="headerlink" title="ä¸€.åŸºæœ¬æ•°æ®ç±»å‹çš„å…¼å®¹æ€§"></a>ä¸€.åŸºæœ¬æ•°æ®ç±»å‹çš„å…¼å®¹æ€§</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> temp<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token keyword">let</span> num<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span>temp <span class="token operator">=</span> num<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>ä½ è¦çš„æˆ‘æœ‰å°±å¯ä»¥</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> num<span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"zf"</span>num <span class="token operator">=</span> str <span class="token comment">// å­—ç¬¦ä¸²ä¸­å…·å¤‡toString()æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œå…¼å®¹</span><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T1</span></span> <span class="token operator">=</span> <span class="token builtin">string</span> <span class="token keyword">extends</span> <span class="token punctuation">&#123;</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">&#125;</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æˆ‘ä»¬å¯ä»¥æŠŠ string çœ‹æˆä¸€ä¸ªå¯¹è±¡ åŸºäº toString æ‰©å±•äº†å…¶ä»–çš„åŠŸèƒ½</li></ul><h2 id="äºŒ-æ¥å£å…¼å®¹æ€§"><a href="#äºŒ-æ¥å£å…¼å®¹æ€§" class="headerlink" title="äºŒ.æ¥å£å…¼å®¹æ€§"></a>äºŒ.æ¥å£å…¼å®¹æ€§</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">IAnimal</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token builtin">string</span>  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token builtin">string</span>  age<span class="token operator">:</span> <span class="token builtin">number</span>  address<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> animal<span class="token operator">:</span> IAnimal<span class="token keyword">let</span> person<span class="token operator">:</span> IPerson <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token string">"zs"</span><span class="token punctuation">,</span>  age<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span>  address<span class="token operator">:</span> <span class="token string">"å›é¾™è§‚"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>animal <span class="token operator">=</span> person <span class="token comment">// å­ç±»èµ‹äºˆç»™çˆ¶ç±» å…¼å®¹ ã€ ä½ è¦çš„æˆ‘éƒ½æœ‰å®‰å…¨</span><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">T2</span></span> <span class="token operator">=</span> IPerson <span class="token keyword">extends</span> <span class="token class-name">IAnimal</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ¥å£çš„å…¼å®¹æ€§ï¼Œåªè¦æ»¡è¶³æ¥å£ä¸­æ‰€éœ€è¦çš„ç±»å‹å³å¯ï¼<br>å¤šçš„èµ‹ç»™å°‘çš„ | å­ç±»èµ‹äºˆç»™çˆ¶ç±»</p></blockquote><h2 id="ä¸‰-å‡½æ•°çš„å…¼å®¹æ€§"><a href="#ä¸‰-å‡½æ•°çš„å…¼å®¹æ€§" class="headerlink" title="ä¸‰.å‡½æ•°çš„å…¼å®¹æ€§"></a>ä¸‰.å‡½æ•°çš„å…¼å®¹æ€§</h2><p>å‡½æ•°çš„å…¼å®¹æ€§ä¸»è¦æ˜¯æ¯”è¾ƒå‚æ•°å’Œè¿”å›å€¼,åˆ©äº forEach å‡½æ•°æä¾›ä¸‰ä¸ªå‚æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åªç”¨ä¸€ä¸ª</p><ul><li><p>å‚æ•°</p><p>å°‘çš„èµ‹äºˆç»™å¤šçš„ï¼Œå¤šäº†æ— æ³•åˆ¤æ–­ç±»å‹æ˜¯å¦æ­£ç¡®ï¼Œä¸å®‰å…¨</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> <span class="token function-variable function">sum1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">+</span> b<span class="token keyword">let</span> <span class="token function-variable function">sum2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> asum1 <span class="token operator">=</span> sum2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>èµ‹å€¼å‡½æ•°çš„å‚æ•°è¦å°‘äºç­‰äºè¢«èµ‹å€¼çš„å‡½æ•°ï¼Œä¸å¯¹è±¡ç›¸å</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Func<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token punctuation">(</span>item<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">,</span> index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">forEach</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>arr<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> cb<span class="token operator">:</span> Func<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">cb</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>è¿”å›å€¼</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">sum1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token builtin">number</span><span class="token keyword">type</span> <span class="token class-name">sum2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span><span class="token keyword">let</span> fn1<span class="token operator">:</span> sum1<span class="token keyword">let</span> fn2<span class="token operator">!</span><span class="token operator">:</span> sum2fn1 <span class="token operator">=</span> fn2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="å››-æ ‡ç§°ç±»å‹"><a href="#å››-æ ‡ç§°ç±»å‹" class="headerlink" title="å››.æ ‡ç§°ç±»å‹"></a>å››.æ ‡ç§°ç±»å‹</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">AddType<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">private</span> _type<span class="token operator">!</span><span class="token operator">:</span> <span class="token constant">S</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">NewType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">S</span> <span class="token keyword">extends</span> <span class="token builtin">string</span><span class="token operator">></span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token operator">&amp;</span> AddType<span class="token operator">&lt;</span><span class="token constant">S</span><span class="token operator">></span><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">BTC</span></span> <span class="token operator">=</span> NewType<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token string">"btc"</span><span class="token operator">></span> <span class="token comment">// number + BTC</span><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">USDT</span></span> <span class="token operator">=</span> NewType<span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token punctuation">,</span> <span class="token string">"usdt"</span><span class="token operator">></span> <span class="token comment">// number + USDT</span><span class="token keyword">let</span> btc <span class="token operator">=</span> <span class="token number">100</span> <span class="token keyword">as</span> <span class="token constant">BTC</span><span class="token keyword">let</span> usdt <span class="token operator">=</span> <span class="token number">100</span> <span class="token keyword">as</span> <span class="token constant">USDT</span><span class="token keyword">function</span> <span class="token function">getCount</span><span class="token punctuation">(</span>count<span class="token operator">:</span> <span class="token constant">USDT</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> count<span class="token punctuation">&#125;</span><span class="token function">getCount</span><span class="token punctuation">(</span>usdt<span class="token punctuation">)</span> <span class="token comment">// æ ‡ç§°ç±»å‹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”-ç±»çš„å…¼å®¹æ€§"><a href="#äº”-ç±»çš„å…¼å®¹æ€§" class="headerlink" title="äº”.ç±»çš„å…¼å®¹æ€§"></a>äº”.ç±»çš„å…¼å®¹æ€§</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Perent</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"zs"</span>  age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Parent1</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"zs"</span>  age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> parent<span class="token operator">:</span> Perent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œåªè¦æœ‰ private æˆ–è€… protected å…³é”®å­—ç±»å‹å°±ä¼šä¸ä¸€è‡´;ä½†æ˜¯ç»§æ‰¿çš„ç±»å¯ä»¥å…¼å®¹</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">private</span> name<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>  age<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name"><span class="token constant">B</span></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">private</span> name<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">string</span>  age<span class="token operator">!</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> a<span class="token operator">:</span> <span class="token constant">A</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">B</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¯­æ³•é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Parent1</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">protected</span> name<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"zs"</span>  age<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent1</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> child<span class="token operator">:</span> Parent1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…­-æ³›å‹çš„å…¼å®¹æ€§"><a href="#å…­-æ³›å‹çš„å…¼å®¹æ€§" class="headerlink" title="å…­.æ³›å‹çš„å…¼å®¹æ€§"></a>å…­.æ³›å‹çš„å…¼å®¹æ€§</h2><blockquote><p>æ³›å‹çš„å…¼å®¹æ€§ æ³›å‹æ¯”è¾ƒçš„æ˜¯æœ€ç»ˆçš„ç»“æœ æ¯”è¾ƒçš„ä¸æ˜¯æ³›å‹ä¼ é€’çš„å‚æ•°</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">II</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span> <span class="token punctuation">&#123;</span>  a<span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> a1<span class="token operator">!</span><span class="token operator">:</span> <span class="token constant">II</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token keyword">let</span> a2<span class="token operator">!</span><span class="token operator">:</span> <span class="token constant">II</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span><span class="token keyword">type</span> <span class="token class-name">xx</span> <span class="token operator">=</span> <span class="token constant">II</span><span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">II</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">></span></span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">//false</span>a1 <span class="token operator">=</span> a2 <span class="token comment">// è¯­æ³•é”™è¯¯</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸ƒ-æšä¸¾çš„å…¼å®¹æ€§"><a href="#ä¸ƒ-æšä¸¾çš„å…¼å®¹æ€§" class="headerlink" title="ä¸ƒ.æšä¸¾çš„å…¼å®¹æ€§"></a>ä¸ƒ.æšä¸¾çš„å…¼å®¹æ€§</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">enum</span> <span class="token constant">USER1</span> <span class="token punctuation">&#123;</span>  role <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">enum</span> <span class="token constant">USER2</span> <span class="token punctuation">&#123;</span>  role <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> user1<span class="token operator">!</span><span class="token operator">:</span> <span class="token constant">USER1</span><span class="token keyword">let</span> user2<span class="token operator">!</span><span class="token operator">:</span> <span class="token constant">USER2</span>user1 <span class="token operator">=</span> user2 <span class="token comment">// é”™è¯¯è¯­æ³•</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>ä¸åŒçš„æšä¸¾ç±»å‹ä¸å…¼å®¹</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TS-ç±»å‹æ¨æ–­</title>
      <link href="/2023/08/14/ts-lei-xing-tui-duan/"/>
      <url>/2023/08/14/ts-lei-xing-tui-duan/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-èµ‹å€¼æ¨æ–­"><a href="#ä¸€-èµ‹å€¼æ¨æ–­" class="headerlink" title="ä¸€.èµ‹å€¼æ¨æ–­"></a>ä¸€.èµ‹å€¼æ¨æ–­</h2><p>èµ‹å€¼æ—¶æ¨æ–­ï¼Œç±»å‹ä»å³åƒå·¦æµåŠ¨,ä¼šæ ¹æ®èµ‹å€¼æ¨æ–­å‡ºå˜é‡ç±»å‹</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token string">"zhangsan"</span><span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">11</span><span class="token keyword">let</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="äºŒ-è¿”å›å€¼æ¨æ–­"><a href="#äºŒ-è¿”å›å€¼æ¨æ–­" class="headerlink" title="äºŒ.è¿”å›å€¼æ¨æ–­"></a>äºŒ.è¿”å›å€¼æ¨æ–­</h2><p>è‡ªåŠ¨æ¨æ–­å‡½æ•°è¿”å›å€¼ç±»å‹</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">&#125;</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸‰-å‡½æ•°æ¨æ–­"><a href="#ä¸‰-å‡½æ•°æ¨æ–­" class="headerlink" title="ä¸‰.å‡½æ•°æ¨æ–­"></a>ä¸‰.å‡½æ•°æ¨æ–­</h2><p>å‡½æ•°ä»å·¦åˆ°å³è¿›è¡Œæ¨æ–­</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> sum<span class="token operator">:</span> <span class="token function-variable function">ISum</span> <span class="token operator">=</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">//  a-> string b-> string</span>  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token comment">// -> string</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ICallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span> <span class="token comment">// ä¸å…³å¿ƒè¿”å›å€¼</span><span class="token comment">// æ ‡è®°æˆvoid æ„å‘³ç€ç”¨æˆ·å¯ä»¥å†™è¿”å›å€¼ï¼Œä½†æ˜¯å®é™…ä¸Šç”¨ä¸åˆ°</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span>cb<span class="token operator">:</span> ICallback<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token comment">// è°ƒç”¨å‡½æ•°åä¸ä¼šæ ¹æ®è¿”å›å€¼æ¥æ¨å¯¼ï¼Œé»˜è®¤é‡‡ç”¨å°±æ˜¯ä¸Šä¸‹æ–‡ä¸­å£°æ˜çš„ç±»å‹</span><span class="token punctuation">&#125;</span><span class="token comment">// å‡½æ•°çš„å‚æ•° æ¨æ–­æ˜¯æŒ‰ç…§ä¸Šä¸‹æ–‡ç±»å‹çš„ä½ç½®æ¥æ¨æ–­çš„</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››-ç±»å‹åæ¨"><a href="#å››-ç±»å‹åæ¨" class="headerlink" title="å››.ç±»å‹åæ¨"></a>å››.ç±»å‹åæ¨</h2><p>å¯ä»¥ä½¿ç”¨<code>typeof</code>å…³é”®å­—åæ¨å˜é‡ç±»å‹</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token string">"zf"</span><span class="token punctuation">,</span>  age<span class="token operator">:</span> <span class="token number">11</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token operator">=</span> <span class="token keyword">typeof</span> person<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”-ç´¢å¼•è®¿é—®æ“ä½œç¬¦"><a href="#äº”-ç´¢å¼•è®¿é—®æ“ä½œç¬¦" class="headerlink" title="äº”.ç´¢å¼•è®¿é—®æ“ä½œç¬¦"></a>äº”.ç´¢å¼•è®¿é—®æ“ä½œç¬¦</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token builtin">string</span>  age<span class="token operator">:</span> <span class="token builtin">number</span>  job<span class="token operator">:</span> <span class="token punctuation">&#123;</span>    address<span class="token operator">:</span> <span class="token builtin">string</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">job</span> <span class="token operator">=</span> IPerson<span class="token punctuation">[</span><span class="token string">"job"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…­-ç±»å‹æ˜ å°„"><a href="#å…­-ç±»å‹æ˜ å°„" class="headerlink" title="å…­.ç±»å‹æ˜ å°„"></a>å…­.ç±»å‹æ˜ å°„</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">IPerson</span> <span class="token punctuation">&#123;</span>  name<span class="token operator">:</span> <span class="token builtin">string</span>  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">MapPerson</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token keyword">keyof</span> IPerson<span class="token punctuation">]</span><span class="token operator">:</span> IPerson<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TS-ç±»å‹ä¿æŠ¤</title>
      <link href="/2023/08/14/ts-lei-xing-bao-hu/"/>
      <url>/2023/08/14/ts-lei-xing-bao-hu/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li><p>ts é»˜è®¤åœ¨ä½¿ç”¨çš„æ—¶å€™ éƒ½æ˜¯è”åˆç±»å‹ï¼Œ ä¸èƒ½ç›´æ¥ä½¿ç”¨è”åˆç±»å‹ã€‚</p></li><li><p>è¯†åˆ«ç±»å‹ï¼Œé€šè¿‡åˆ¤æ–­è¯†åˆ«æ‰€æ‰§è¡Œçš„ä»£ç å—ï¼Œè‡ªåŠ¨è¯†åˆ«å˜é‡å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹ä¸åŒçš„ç±»å‹è¿›è¡ŒèŒƒå›´ç¼©å°</p></li></ul></blockquote><h2 id="ä¸€-typeofç±»å‹ä¿æŠ¤"><a href="#ä¸€-typeofç±»å‹ä¿æŠ¤" class="headerlink" title="ä¸€.typeofç±»å‹ä¿æŠ¤"></a>ä¸€.<code>typeof</code>ç±»å‹ä¿æŠ¤</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">getTypeof</span><span class="token punctuation">(</span>val<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> val <span class="token operator">===</span> <span class="token string">"number"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    val <span class="token comment">//number</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    val <span class="token comment">//string</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒ-instanceofç±»å‹ä¿æŠ¤"><a href="#äºŒ-instanceofç±»å‹ä¿æŠ¤" class="headerlink" title="äºŒ.instanceofç±»å‹ä¿æŠ¤"></a>äºŒ.<code>instanceof</code>ç±»å‹ä¿æŠ¤</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>clazz<span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Dog <span class="token operator">|</span> Cat <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">clazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getInstance1</span><span class="token punctuation">(</span>clazz<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=></span> Dog <span class="token operator">|</span> Cat<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">clazz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> type <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span>Cat<span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token class-name"><span class="token keyword">instanceof</span></span> Cat<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">type</span> <span class="token comment">//Cat</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">type</span> <span class="token comment">//Dog</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸‰-inç±»å‹ä¿æŠ¤"><a href="#ä¸‰-inç±»å‹ä¿æŠ¤" class="headerlink" title="ä¸‰.inç±»å‹ä¿æŠ¤"></a>ä¸‰.<code>in</code>ç±»å‹ä¿æŠ¤</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Fish</span> <span class="token punctuation">&#123;</span>  swiming<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Bird</span> <span class="token punctuation">&#123;</span>  fly<span class="token operator">:</span> <span class="token builtin">string</span>  leg<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getType</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Fish <span class="token operator">|</span> Bird<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"swiming"</span> <span class="token keyword">in</span> animal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    animal <span class="token comment">// Fish</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    animal <span class="token comment">// Bird</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>Array.isArray</code>ç¡®ä¿ä¸€ä¸ªå˜é‡æ˜¯æ•°ç»„</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// ç¡®ä¿ä¸€ä¸ªå˜é‡æ˜¯æ•°ç»„</span><span class="token keyword">function</span> <span class="token generic-function"><span class="token function">ensureArray</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">></span></span></span><span class="token punctuation">(</span>input<span class="token operator">:</span> <span class="token constant">T</span> <span class="token operator">|</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç±»å‹æ¥è¾¨è¯†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">Array</span><span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> input  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span>input<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››-å¯è¾¨è¯†è”åˆç±»å‹"><a href="#å››-å¯è¾¨è¯†è”åˆç±»å‹" class="headerlink" title="å››.å¯è¾¨è¯†è”åˆç±»å‹"></a>å››.å¯è¾¨è¯†è”åˆç±»å‹</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">WarningButton</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">"warning"</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">DangerButton</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">"danger"</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">createButton</span><span class="token punctuation">(</span>button<span class="token operator">:</span> WarningButton <span class="token operator">|</span> DangerButton<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>button<span class="token punctuation">.</span>class <span class="token operator">==</span> <span class="token string">"warning"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    button <span class="token comment">// WarningButton</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    button <span class="token comment">// DangerButton</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”-null-ä¿æŠ¤"><a href="#äº”-null-ä¿æŠ¤" class="headerlink" title="äº”. null ä¿æŠ¤"></a>äº”. <code>null</code> ä¿æŠ¤</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token function-variable function">addPrefix</span> <span class="token operator">=</span> <span class="token punctuation">(</span>num<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  num <span class="token operator">=</span> num <span class="token operator">||</span> <span class="token number">0</span> <span class="token comment">// null ä¿æŠ¤</span>  <span class="token keyword">function</span> <span class="token function">prefix</span><span class="token punctuation">(</span>fix<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> fix <span class="token operator">+</span> num<span class="token operator">!</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token function">prefix</span><span class="token punctuation">(</span><span class="token string">"$"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ ts æ— æ³•æ£€æµ‹å†…éƒ¨å‡½æ•°å˜é‡ç±»å‹</p></blockquote><h2 id="å…­-isè‡ªå®šä¹‰ç±»å‹ä¿æŠ¤"><a href="#å…­-isè‡ªå®šä¹‰ç±»å‹ä¿æŠ¤" class="headerlink" title="å…­.isè‡ªå®šä¹‰ç±»å‹ä¿æŠ¤"></a>å…­.<code>is</code>è‡ªå®šä¹‰ç±»å‹ä¿æŠ¤</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">Fish</span> <span class="token punctuation">&#123;</span>  swiming<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">Bird</span> <span class="token punctuation">&#123;</span>  fly<span class="token operator">:</span> <span class="token builtin">string</span>  leg<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token comment">//å·¥å…·æ–¹æ³•ä¸­åˆ¤æ–­ç±»å‹çš„æ–¹æ³• å…¨éƒ¨éœ€è¦ä½¿ç”¨ is è¯­æ³•</span><span class="token comment">// tsçš„è¿”å›å€¼ç±»å‹ animalè¿”å›å€¼trueä¸ºBurd</span><span class="token keyword">function</span> <span class="token function">isBird</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Fish <span class="token operator">|</span> Bird<span class="token punctuation">)</span><span class="token operator">:</span> animal <span class="token keyword">is</span> Bird <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token string">"swiming"</span> <span class="token keyword">in</span> animal <span class="token comment">// å¿…é¡»æ˜¯boolean</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getAniaml</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Fish <span class="token operator">|</span> Bird<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBird</span><span class="token punctuation">(</span>animal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    animal <span class="token comment">// Bird</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    animal <span class="token comment">// Fish</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸ƒ-å®Œæ•´æ€§ä¿æŠ¤"><a href="#ä¸ƒ-å®Œæ•´æ€§ä¿æŠ¤" class="headerlink" title="ä¸ƒ.å®Œæ•´æ€§ä¿æŠ¤"></a>ä¸ƒ.å®Œæ•´æ€§ä¿æŠ¤</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">interface</span> <span class="token class-name">ICircle</span> <span class="token punctuation">&#123;</span>  kind<span class="token operator">:</span> <span class="token string">"circle"</span>  r<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">IRant</span> <span class="token punctuation">&#123;</span>  kind<span class="token operator">:</span> <span class="token string">"rant"</span>  width<span class="token operator">:</span> <span class="token builtin">number</span>  height<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">interface</span> <span class="token class-name">ISquare</span> <span class="token punctuation">&#123;</span>  kind<span class="token operator">:</span> <span class="token string">"square"</span>  width<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">&#125;</span><span class="token keyword">type</span> <span class="token class-name">Area</span> <span class="token operator">=</span> ICircle <span class="token operator">|</span> IRant <span class="token operator">|</span> ISquare<span class="token keyword">const</span> <span class="token function-variable function">isAssertion</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token operator">:</span> <span class="token builtin">never</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">getArea</span> <span class="token operator">=</span> <span class="token punctuation">(</span>obj<span class="token operator">:</span> Area<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>kind<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token string">"circle"</span><span class="token operator">:</span>      <span class="token keyword">return</span> <span class="token number">3.14</span> <span class="token operator">*</span> obj<span class="token punctuation">.</span>r <span class="token operator">**</span> <span class="token number">2</span>    <span class="token keyword">case</span> <span class="token string">"rant"</span><span class="token operator">:</span>      <span class="token keyword">return</span> obj<span class="token punctuation">.</span>height <span class="token operator">*</span> obj<span class="token punctuation">.</span>width    <span class="token keyword">case</span> <span class="token string">"square"</span><span class="token operator">:</span>      <span class="token keyword">return</span> obj<span class="token punctuation">.</span>width <span class="token operator">*</span> obj<span class="token punctuation">.</span>width    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">return</span> <span class="token function">isAssertion</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token comment">// å¿…é¡»å®ç°æ‰€æœ‰é€»è¾‘</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TS-åŸºç¡€ç±»å‹</title>
      <link href="/2023/08/09/ts-ji-chu-lei-xing/"/>
      <url>/2023/08/09/ts-ji-chu-lei-xing/</url>
      
        <content type="html"><![CDATA[<blockquote><p>TS ä¸­å†’å·åé¢çš„éƒ½ä¸ºç±»å‹æ ‡è¯†</p></blockquote><h2 id="ä¸€-å¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²ç±»å‹"><a href="#ä¸€-å¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="ä¸€.å¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²ç±»å‹"></a>ä¸€.å¸ƒå°”ã€æ•°å­—ã€å­—ç¬¦ä¸²ç±»å‹</h2><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> bool<span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token keyword">let</span> num<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">let</span> str<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"hello"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>åŒ…è£…ç±»å‹</strong></p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> s1<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token comment">// let s2:string = new String('abc') //æŠ¥é”™</span><span class="token keyword">let</span> s3<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token string">"1"</span> <span class="token comment">// åœ¨èµ‹äºˆå€¼çš„æ—¶å€™ å­é›†å¯ä»¥èµ‹äºˆç»™çˆ¶çº§</span><span class="token keyword">let</span> s4<span class="token operator">:</span> String <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token comment">// ç±»çš„ç±»å‹ï¼Œç±»ç±»å‹ï¼Œç”¨æ¥æè¿°å®ä¾‹çš„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è§„èŒƒ</strong> :å°å†™çš„ç±»å‹ä¸€èˆ¬ç”¨äºæè¿°åŸºæœ¬ç±»å‹ å¤§å†™çš„ç”¨æ¥æè¿°çš„æ˜¯å®ä¾‹ç±»å‹</p><h2 id="äºŒ-æ•°ç»„"><a href="#äºŒ-æ•°ç»„" class="headerlink" title="äºŒ.æ•°ç»„"></a>äºŒ.æ•°ç»„</h2><p>å£°æ˜æ•°ç»„ä¸­å…ƒç´ æ•°æ®ç±»å‹</p><blockquote><p><strong>ç±»å‹[]</strong> å’Œ<strong>Array&lt;ç±»å‹&gt;</strong> éƒ½å¯ä»¥ç”¨äºå£°æ˜æ•°ç»„</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">let</span> arr1<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">let</span> arr2<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">]</span><span class="token keyword">let</span> arr3<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">let</span> arr4<span class="token operator">:</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token builtin">number</span> <span class="token operator">|</span> <span class="token builtin">string</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment">// æ³›å‹æ–¹å¼æ¥å£°æ˜</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>TSâ€”â€”ç¯å¢ƒé…ç½®å’Œæ­å»º</title>
      <link href="/2023/08/08/ts-huan-jing-pei-zhi-he-da-jian/"/>
      <url>/2023/08/08/ts-huan-jing-pei-zhi-he-da-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€-Typescript-çš„ä»·å€¼æ˜¯ä»€ä¹ˆ"><a href="#ä¸€-Typescript-çš„ä»·å€¼æ˜¯ä»€ä¹ˆ" class="headerlink" title="ä¸€.Typescript çš„ä»·å€¼æ˜¯ä»€ä¹ˆ"></a>ä¸€.Typescript çš„ä»·å€¼æ˜¯ä»€ä¹ˆ</h2><p><code>TypeScript</code>æ˜¯<code>Javascript</code>çš„è¶…é›†ï¼Œéµå¾ªæœ€æ–°çš„<code>ES5/ES6</code>è§„èŒƒã€‚<code>Typescript</code>æ‰©å±•äº†<code>Javascript</code>è¯­æ³•ã€‚</p><ul><li>Typescript æ›´åƒåç«¯ JAVA,è®©<code>JS</code>å¯ä»¥å¼€å‘å¤§å‹ä¼ä¸šåº”ç”¨</li><li>TS æä¾›çš„ç±»å‹ç³»ç»Ÿå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨å†™ä»£ç æ—¶æä¾›ä¸°å¯Œçš„è¯­æ³•æç¤º</li><li>åœ¨ç¼–å†™ä»£ç æ—¶ä¼šå¯¹ä»£ç è¿›è¡Œç±»å‹æ£€æŸ¥ä»è€Œé¿å…å¾ˆå¤šçº¿ä¸Šé”™è¯¯</li></ul><blockquote><p><code>TypeScript</code>ä¸ä¼šå–ä»£<code>JS</code>, <strong>å°¤é›¨æºªï¼š</strong> æˆ‘è®¤ä¸ºå°†ç±»å‹æ·»åŠ åˆ°<code>JS</code>æœ¬èº«æ˜¯ä¸€ä¸ªæ¼«é•¿çš„è¿‡ç¨‹ ã€‚è®©å§”å‘˜ä¼šè®¾è®¡ä¸€ä¸ªç±»å‹ç³»ç»Ÿæ˜¯ï¼ˆæ ¹æ®<code>TC39</code>çš„ç»å†æ¥åˆ¤æ–­ï¼‰ä¸åˆ‡å®é™…çš„ ã€‚</p></blockquote><h2 id="äºŒ-ç¯å¢ƒé…ç½®"><a href="#äºŒ-ç¯å¢ƒé…ç½®" class="headerlink" title="äºŒ.ç¯å¢ƒé…ç½®"></a>äºŒ.ç¯å¢ƒé…ç½®</h2><h3 id="1-å…¨å±€ç¼–è¯‘-TS-æ–‡ä»¶"><a href="#1-å…¨å±€ç¼–è¯‘-TS-æ–‡ä»¶" class="headerlink" title="1.å…¨å±€ç¼–è¯‘ TS æ–‡ä»¶"></a>1.å…¨å±€ç¼–è¯‘ TS æ–‡ä»¶</h3><p>å…¨å±€å®‰è£…<code>typescript</code>å¯¹<code>TS</code>è¿›è¡Œç¼–è¯‘</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> typescript <span class="token parameter variable">-g</span>tsc <span class="token parameter variable">--init</span> <span class="token comment"># ç”Ÿæˆtsconfig.json</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tsc <span class="token comment"># å¯ä»¥å°†tsæ–‡ä»¶ç¼–è¯‘æˆjsæ–‡ä»¶</span>tsc <span class="token parameter variable">--watch</span> <span class="token comment"># ç›‘æ§tsæ–‡ä»¶å˜åŒ–ç”Ÿæˆjsæ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>å¦‚ä½•è¿è¡Œ</strong></p><ol><li><p>æœ€ç»ˆç›´æ¥ç”Ÿæˆ js æ–‡ä»¶åœ¨è¿è¡Œã€‚</p></li><li><p>vscode æ’ä»¶æ¥å®ç°ä»£ç çš„è¿è¡Œ(ä¸´æ—¶æµ‹è¯•)</p></li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># code-runner å¦‚æœæ˜¯jsæ–‡ä»¶ å†…éƒ¨ä¼šç›´æ¥é‡‡ç”¨ node + æ–‡ä»¶åæ¥æ‰§è¡Œæ­¤æ–‡ä»¶ ,å¦‚æœæ˜¯tsæ–‡ä»¶ éœ€è¦é€šè¿‡ts-node æ¥ç›´æ¥æ‰§è¡Œ</span><span class="token function">npm</span> <span class="token function">install</span> ts-node <span class="token parameter variable">-g</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>é€šè¿‡æ„å»ºå·¥å…·å°†ä»£ç è½¬åŒ–æˆ js åœ¨å»è¿è¡Œ ï¼ˆwebpack,rollup,esbuildï¼‰ æœ€ç»ˆä¾¿è¡£æˆ js æ‰§è¡Œ</li></ol><h3 id="2-é…ç½®rollupç¯å¢ƒ"><a href="#2-é…ç½®rollupç¯å¢ƒ" class="headerlink" title="2.é…ç½®rollupç¯å¢ƒ"></a>2.é…ç½®<code>rollup</code>ç¯å¢ƒ</h3><ul><li><p>å®‰è£…ä¾èµ–</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> rollup typescript rollup-plugin-typescript2 @rollup/plugin-node-resolve rollup-plugin-serve <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>rollup-plugin-typescript2: è¿™æ˜¯ Rollup ä¸­æœ€å¸¸ç”¨çš„ TypeScript æ’ä»¶,å¯ä»¥å°† TypeScript ä»£ç ç¼–è¯‘ä¸º JavaScript ä»£ç ,å¹¶å…è®¸ Rollup å¤„ç†å’Œæ‰“åŒ…ã€‚</li><li>@rollup/plugin-node-resolve: è¿™ä¸ªæ’ä»¶å¯ä»¥è®© Rollup è§£æ Node.js æ–¹å¼çš„æ¨¡å—å¯¼å…¥,è¿™æ · Rollup å¯ä»¥æ­£ç¡®å¤„ç†åƒ import/export è¿™æ ·çš„è¯­æ³•ã€‚</li><li>rollup-plugin-serve: è¿™ä¸ªæ’ä»¶å¯ä»¥å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨,å¹¶å®æ—¶é‡æ–°åŠ è½½å’Œæ›´æ–°å½“æºä»£ç å˜åŒ–æ—¶çš„é¡µé¢ã€‚éå¸¸é€‚åˆåœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚</li><li>TypeScript: TypeScript æ˜¯ä¸€ä¸ª JavaScript çš„è¶…é›†è¯­è¨€,å¢åŠ äº†ç±»å‹ç³»ç»Ÿ,å¯ä»¥åœ¨ç¼–è¯‘ä¸º JavaScript å‰å¯¹ä»£ç è¿›è¡Œæ£€æŸ¥ã€‚</li><li>Rollup: Rollup æ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨,å¯ä»¥å°†å°å—ä»£ç ç¼–è¯‘æˆä¸€ä¸ªå¤§å—å¤æ‚çš„ä»£ç ,å¸¸ç”¨äºæ‰“åŒ… JavaScript åº“ã€‚</li></ul></li><li><p>åˆå§‹åŒ–<code>TS</code>é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx tsc <span class="token parameter variable">--init</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p><code>rollup.config.js</code>é…ç½®æ“ä½œ</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// é»˜è®¤rollup æ‰“åŒ…çš„æ—¶å€™ä¼šæŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹ rollup.config.jsè¿™ä¸ªæ–‡ä»¶</span><span class="token comment">// é‡‡ç”¨esæ¨¡å—æ¥ç¼–å†™é…ç½®æ–‡ä»¶</span><span class="token comment">// nodeä¸­æœ‰æ¨¡å—è§„èŒƒé»˜è®¤æ˜¯ commonjs , ä¹Ÿå¯ä»¥æ”¹æˆesmæ¨¡å—è§„èŒƒ</span><span class="token keyword">import</span> ts <span class="token keyword">from</span> <span class="token string">"rollup-plugin-typescript2"</span><span class="token keyword">import</span> serve <span class="token keyword">from</span> <span class="token string">"rollup-plugin-serve"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> nodeResolve <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@rollup/plugin-node-resolve"</span><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> fileURLToPath <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"url"</span> <span class="token comment">//è½¬æ¢urlä¸ºpath</span><span class="token comment">// import.meta.url å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ file://xxxx/xxx/xxx</span><span class="token keyword">const</span> __filename <span class="token operator">=</span> <span class="token function">fileURLToPath</span><span class="token punctuation">(</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>url<span class="token punctuation">)</span> <span class="token comment">// å½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span><span class="token keyword">const</span> __dirname <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>__filename<span class="token punctuation">)</span> <span class="token comment">// å½“å‰æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ç›®å½• ç»å¯¹è·¯å¾„</span><span class="token comment">// æ‰“åŒ…çš„é…ç½®å¯¹è±¡</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">"./src/index.ts"</span><span class="token punctuation">,</span> <span class="token comment">// é¡¹ç›®å…¥å£</span>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">file</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist/bundle.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å½“å‰çš„æ–‡ä»¶åœ¨å½“å‰ç›®å½•ä¸‹çš„distç›®å½•</span>    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">"iife"</span><span class="token punctuation">,</span> <span class="token comment">// æ‰“åŒ…åçš„æ ¼å¼ iife è‡ªæ‰§è¡Œ  (function()&#123;&#125;)()</span>    <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">".js"</span><span class="token punctuation">,</span> <span class="token string">".ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// ï¼ˆç¬¬ä¸‰æ–¹åŒ…çš„å…¥å£ï¼‰å…¥å£æ–‡ä»¶å¯ä»¥æ˜¯js ä¹Ÿå¯ä»¥æ˜¯ts</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">ts</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">tsconfig</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"tsconfig.json"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//æ‰€éœ€è¦ç»“åˆçš„ts</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">serve</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">open</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token literal-property property">openPage</span><span class="token operator">:</span> <span class="token string">"/public/index.html"</span><span class="token punctuation">,</span>      <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>      <span class="token literal-property property">contentBase</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>package.json</code>é…ç½®</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"my-ts"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"test.js"</span><span class="token punctuation">,</span>  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"rollup -c -w"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"ISC"</span><span class="token punctuation">,</span>  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"@rollup/plugin-node-resolve"</span><span class="token operator">:</span> <span class="token string">"^15.1.0"</span><span class="token punctuation">,</span>    <span class="token property">"rollup"</span><span class="token operator">:</span> <span class="token string">"^3.27.2"</span><span class="token punctuation">,</span>    <span class="token property">"rollup-plugin-serve"</span><span class="token operator">:</span> <span class="token string">"^2.0.2"</span><span class="token punctuation">,</span>    <span class="token property">"rollup-plugin-typescript2"</span><span class="token operator">:</span> <span class="token string">"^0.35.0"</span><span class="token punctuation">,</span>    <span class="token property">"typescript"</span><span class="token operator">:</span> <span class="token string">"^5.1.6"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><code>tsconfig.json</code>é…ç½®ä¿®æ”¹</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//...</span>    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//å¼€å¯sourceMap</span>    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span> <span class="token comment">// æŒ‡å®šç”Ÿæˆçš„æ¨¡å—ä»£ç </span>    <span class="token comment">//....</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TypeScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è´ªå¿ƒç®—æ³•</title>
      <link href="/2023/08/02/tan-xin-suan-fa/"/>
      <url>/2023/08/02/tan-xin-suan-fa/</url>
      
        <content type="html"><![CDATA[<h2 id="455-åˆ†å‘é¥¼å¹²"><a href="#455-åˆ†å‘é¥¼å¹²" class="headerlink" title="455. åˆ†å‘é¥¼å¹²"></a>455. åˆ†å‘é¥¼å¹²</h2><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/assign-cookies/">https://leetcode.cn/problems/assign-cookies/</a></p><p>å‡è®¾ä½ æ˜¯ä¸€ä½å¾ˆæ£’çš„å®¶é•¿ï¼Œæƒ³è¦ç»™ä½ çš„å­©å­ä»¬ä¸€äº›å°é¥¼å¹²ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå­©å­æœ€å¤šåªèƒ½ç»™ä¸€å—é¥¼å¹²ã€‚</p><p>å¯¹æ¯ä¸ªå­©å­ <code>i</code>ï¼Œéƒ½æœ‰ä¸€ä¸ªèƒƒå£å€¼ <code>g[i]</code>ï¼Œè¿™æ˜¯èƒ½è®©å­©å­ä»¬æ»¡è¶³èƒƒå£çš„é¥¼å¹²çš„æœ€å°å°ºå¯¸ï¼›å¹¶ä¸”æ¯å—é¥¼å¹² <code>j</code>ï¼Œéƒ½æœ‰ä¸€ä¸ªå°ºå¯¸ <code>s[j]</code> ã€‚å¦‚æœ <code>s[j] &gt;= g[i]</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé¥¼å¹² <code>j</code> åˆ†é…ç»™å­©å­ <code>i</code> ï¼Œè¿™ä¸ªå­©å­ä¼šå¾—åˆ°æ»¡è¶³ã€‚ä½ çš„ç›®æ ‡æ˜¯å°½å¯èƒ½æ»¡è¶³è¶Šå¤šæ•°é‡çš„å­©å­ï¼Œå¹¶è¾“å‡ºè¿™ä¸ªæœ€å¤§æ•°å€¼ã€‚</p><p><strong>ç¤ºä¾‹ 1:</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥: g &#x3D; [1,2,3], s &#x3D; [1,1]è¾“å‡º: 1è§£é‡Š:ä½ æœ‰ä¸‰ä¸ªå­©å­å’Œä¸¤å—å°é¥¼å¹²ï¼Œ3ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯ï¼š1,2,3ã€‚è™½ç„¶ä½ æœ‰ä¸¤å—å°é¥¼å¹²ï¼Œç”±äºä»–ä»¬çš„å°ºå¯¸éƒ½æ˜¯1ï¼Œä½ åªèƒ½è®©èƒƒå£å€¼æ˜¯1çš„å­©å­æ»¡è¶³ã€‚æ‰€ä»¥ä½ åº”è¯¥è¾“å‡º1ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 2:</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥: g &#x3D; [1,2], s &#x3D; [1,2,3]è¾“å‡º: 2è§£é‡Š:ä½ æœ‰ä¸¤ä¸ªå­©å­å’Œä¸‰å—å°é¥¼å¹²ï¼Œ2ä¸ªå­©å­çš„èƒƒå£å€¼åˆ†åˆ«æ˜¯1,2ã€‚ä½ æ‹¥æœ‰çš„é¥¼å¹²æ•°é‡å’Œå°ºå¯¸éƒ½è¶³ä»¥è®©æ‰€æœ‰å­©å­æ»¡è¶³ã€‚æ‰€ä»¥ä½ åº”è¯¥è¾“å‡º2.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= g.length &lt;= 3 * 104</code></li><li><code>0 &lt;= s.length &lt;= 3 * 104</code></li><li><code>1 &lt;= g[i], s[j] &lt;= 231 - 1</code></li></ul><h3 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; g * @param &#123;number[]&#125; s * @return &#123;number&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">findContentChildren</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">g<span class="token punctuation">,</span> s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  g<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span>  s<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> g<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">>=</span> g<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token operator">++</span>      i<span class="token operator">++</span>      j<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      j<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="376-æ‘†åŠ¨åºåˆ—"><a href="#376-æ‘†åŠ¨åºåˆ—" class="headerlink" title="376. æ‘†åŠ¨åºåˆ—"></a>376. æ‘†åŠ¨åºåˆ—</h2><h3 id="é¢˜ç›®-1"><a href="#é¢˜ç›®-1" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combination-sum/">https://leetcode.cn/problems/combination-sum/</a></p><p>å¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸º <strong>æ‘†åŠ¨åºåˆ— ã€‚</strong>ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚ä»…æœ‰ä¸€ä¸ªå…ƒç´ æˆ–è€…å«ä¸¤ä¸ªä¸ç­‰å…ƒç´ çš„åºåˆ—ä¹Ÿè§†ä½œæ‘†åŠ¨åºåˆ—ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ <code>[1, 7, 4, 9, 2, 5]</code> æ˜¯ä¸€ä¸ª <strong>æ‘†åŠ¨åºåˆ—</strong> ï¼Œå› ä¸ºå·®å€¼ <code>(6, -3, 5, -7, 3)</code> æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚</li><li>ç›¸åï¼Œ<code>[1, 4, 7, 2, 5]</code> å’Œ <code>[1, 7, 4, 5, 5]</code> ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚</li></ul><p><strong>å­åºåˆ—</strong> å¯ä»¥é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚</p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¿”å› <code>nums</code> ä¸­ä½œä¸º <strong>æ‘†åŠ¨åºåˆ—</strong> çš„ <strong>æœ€é•¿å­åºåˆ—çš„é•¿åº¦</strong> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1,7,4,9,2,5]è¾“å‡ºï¼š6è§£é‡Šï¼šæ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (6, -3, 5, -7, 3) ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1,17,5,10,13,15,10,5,16,8]è¾“å‡ºï¼š7è§£é‡Šï¼šè¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º 7 æ‘†åŠ¨åºåˆ—ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ [1, 17, 10, 13, 10, 16, 8] ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (16, -7, 3, -3, 6, -8) ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1,2,3,4,5,6,7,8,9]è¾“å‡ºï¼š2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 1000</code></li><li><code>0 &lt;= nums[i] &lt;= 1000</code></li></ul><h3 id="è§£æ-1"><a href="#è§£æ-1" class="headerlink" title="è§£æ"></a>è§£æ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">wiggleMaxLength</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¾¹ç•Œæ¡ä»¶,æ•°ç»„é•¿åº¦å°äºç­‰äº1ç›´æ¥è¿”å›é•¿åº¦</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> nums<span class="token punctuation">.</span>length  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// è®°å½•æ‘†åŠ¨åºåˆ—çš„é•¿åº¦,é»˜è®¤ä¸º1</span>  <span class="token keyword">let</span> preDiff <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// å‰ä¸€å¯¹å·®å€¼</span>  <span class="token keyword">let</span> curDiff <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// å½“å‰ä¸€å¯¹å·®å€¼</span>  <span class="token comment">// ä» 0 åˆ°é•¿åº¦ - 1,ä¸¤ä¸¤æ¯”è¾ƒå…ƒç´ å¤§å°</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    curDiff <span class="token operator">=</span> nums<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// è®¡ç®—å½“å‰ä¸€å¯¹çš„å·®å€¼</span>    <span class="token comment">// å¦‚æœå½“å‰ä¸€å¯¹å·®å€¼ç¬¦å·ä¸å‰ä¸€å¯¹ä¸åŒ,æ›´æ–°æ‘†åŠ¨åºåˆ—é•¿åº¦</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>curDiff <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> preDiff <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>curDiff <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> preDiff <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      result<span class="token operator">++</span>      preDiff <span class="token operator">=</span> curDiff    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token comment">/** * æ ¸å¿ƒæ€è·¯: * 1. è®¡ç®—å‡ºç›¸é‚»å…ƒç´ çš„å·®å€¼ * 2. å¦‚æœå‰åå·®å€¼ç¬¦å·ä¸åŒ,è¡¨ç¤ºæ‘†åŠ¨,æ›´æ–°åºåˆ—é•¿åº¦ * 3. è¿”å›æœ€åå¾—åˆ°çš„æ‘†åŠ¨åºåˆ—çš„æœ€å¤§é•¿åº¦ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><ul><li>æ€ä¹ˆåˆ¤æ–­åˆ°è¾¾å®šç‚¹</li><li>æ€ä¹ˆåˆ é™¤å¤šä½™çš„æ•°æ®</li></ul><h2 id="æ‘†åŠ¨åºåˆ—-376"><a href="#æ‘†åŠ¨åºåˆ—-376" class="headerlink" title="æ‘†åŠ¨åºåˆ—-376"></a>æ‘†åŠ¨åºåˆ—-376</h2><h3 id="é¢˜ç›®-2"><a href="#é¢˜ç›®-2" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combination-sum/">https://leetcode.cn/problems/combination-sum/</a></p><p>å¦‚æœè¿ç»­æ•°å­—ä¹‹é—´çš„å·®ä¸¥æ ¼åœ°åœ¨æ­£æ•°å’Œè´Ÿæ•°ä¹‹é—´äº¤æ›¿ï¼Œåˆ™æ•°å­—åºåˆ—ç§°ä¸º <strong>æ‘†åŠ¨åºåˆ— ã€‚</strong>ç¬¬ä¸€ä¸ªå·®ï¼ˆå¦‚æœå­˜åœ¨çš„è¯ï¼‰å¯èƒ½æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ã€‚ä»…æœ‰ä¸€ä¸ªå…ƒç´ æˆ–è€…å«ä¸¤ä¸ªä¸ç­‰å…ƒç´ çš„åºåˆ—ä¹Ÿè§†ä½œæ‘†åŠ¨åºåˆ—ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ <code>[1, 7, 4, 9, 2, 5]</code> æ˜¯ä¸€ä¸ª <strong>æ‘†åŠ¨åºåˆ—</strong> ï¼Œå› ä¸ºå·®å€¼ <code>(6, -3, 5, -7, 3)</code> æ˜¯æ­£è´Ÿäº¤æ›¿å‡ºç°çš„ã€‚</li><li>ç›¸åï¼Œ<code>[1, 4, 7, 2, 5]</code> å’Œ <code>[1, 7, 4, 5, 5]</code> ä¸æ˜¯æ‘†åŠ¨åºåˆ—ï¼Œç¬¬ä¸€ä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„å‰ä¸¤ä¸ªå·®å€¼éƒ½æ˜¯æ­£æ•°ï¼Œç¬¬äºŒä¸ªåºåˆ—æ˜¯å› ä¸ºå®ƒçš„æœ€åä¸€ä¸ªå·®å€¼ä¸ºé›¶ã€‚</li></ul><p><strong>å­åºåˆ—</strong> å¯ä»¥é€šè¿‡ä»åŸå§‹åºåˆ—ä¸­åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å…ƒç´ æ¥è·å¾—ï¼Œå‰©ä¸‹çš„å…ƒç´ ä¿æŒå…¶åŸå§‹é¡ºåºã€‚</p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¿”å› <code>nums</code> ä¸­ä½œä¸º <strong>æ‘†åŠ¨åºåˆ—</strong> çš„ <strong>æœ€é•¿å­åºåˆ—çš„é•¿åº¦</strong> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1,7,4,9,2,5]è¾“å‡ºï¼š6è§£é‡Šï¼šæ•´ä¸ªåºåˆ—å‡ä¸ºæ‘†åŠ¨åºåˆ—ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (6, -3, 5, -7, 3) ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1,17,5,10,13,15,10,5,16,8]è¾“å‡ºï¼š7è§£é‡Šï¼šè¿™ä¸ªåºåˆ—åŒ…å«å‡ ä¸ªé•¿åº¦ä¸º 7 æ‘†åŠ¨åºåˆ—ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ [1, 17, 10, 13, 10, 16, 8] ï¼Œå„å…ƒç´ ä¹‹é—´çš„å·®å€¼ä¸º (16, -7, 3, -3, 6, -8) ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1,2,3,4,5,6,7,8,9]è¾“å‡ºï¼š2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 1000</code></li><li><code>0 &lt;= nums[i] &lt;= 1000</code></li></ul><h3 id="è§£æ-2"><a href="#è§£æ-2" class="headerlink" title="è§£æ"></a>è§£æ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">wiggleMaxLength</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¾¹ç•Œæ¡ä»¶,æ•°ç»„é•¿åº¦å°äºç­‰äº1ç›´æ¥è¿”å›é•¿åº¦</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> nums<span class="token punctuation">.</span>length  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// è®°å½•æ‘†åŠ¨åºåˆ—çš„é•¿åº¦,é»˜è®¤ä¸º1</span>  <span class="token keyword">let</span> preDiff <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// å‰ä¸€å¯¹å·®å€¼</span>  <span class="token keyword">let</span> curDiff <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// å½“å‰ä¸€å¯¹å·®å€¼</span>  <span class="token comment">// ä» 0 åˆ°é•¿åº¦ - 1,ä¸¤ä¸¤æ¯”è¾ƒå…ƒç´ å¤§å°</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    curDiff <span class="token operator">=</span> nums<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// è®¡ç®—å½“å‰ä¸€å¯¹çš„å·®å€¼</span>    <span class="token comment">// å¦‚æœå½“å‰ä¸€å¯¹å·®å€¼ç¬¦å·ä¸å‰ä¸€å¯¹ä¸åŒ,æ›´æ–°æ‘†åŠ¨åºåˆ—é•¿åº¦</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>curDiff <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> preDiff <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>curDiff <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> preDiff <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      result<span class="token operator">++</span>      preDiff <span class="token operator">=</span> curDiff    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token comment">/** * æ ¸å¿ƒæ€è·¯: * 1. è®¡ç®—å‡ºç›¸é‚»å…ƒç´ çš„å·®å€¼ * 2. å¦‚æœå‰åå·®å€¼ç¬¦å·ä¸åŒ,è¡¨ç¤ºæ‘†åŠ¨,æ›´æ–°åºåˆ—é•¿åº¦ * 3. è¿”å›æœ€åå¾—åˆ°çš„æ‘†åŠ¨åºåˆ—çš„æœ€å¤§é•¿åº¦ */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€è€ƒ-1"><a href="#æ€è€ƒ-1" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><ul><li>æ€ä¹ˆåˆ¤æ–­åˆ°è¾¾å®šç‚¹</li><li>æ€ä¹ˆåˆ é™¤å¤šä½™çš„æ•°æ®</li></ul><h2 id="æœ€å¤§å­æ•°ç»„å’Œ-53"><a href="#æœ€å¤§å­æ•°ç»„å’Œ-53" class="headerlink" title="æœ€å¤§å­æ•°ç»„å’Œ - 53"></a>æœ€å¤§å­æ•°ç»„å’Œ - 53</h2><h3 id="é¢˜ç›®-3"><a href="#é¢˜ç›®-3" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/maximum-subarray/">https://leetcode.cn/problems/maximum-subarray/</a></p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p><strong>å­æ•°ç»„</strong> æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [-2,1,-3,4,-1,2,1,-5,4]è¾“å‡ºï¼š6è§£é‡Šï¼šè¿ç»­å­æ•°ç»„ [4,-1,2,1] çš„å’Œæœ€å¤§ï¼Œä¸º 6 ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [1]è¾“å‡ºï¼š1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šnums &#x3D; [5,4,-1,7,8]è¾“å‡ºï¼š23<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= nums.length &lt;= 105</code></li><li><code>-104 &lt;= nums[i] &lt;= 104</code></li></ul><h3 id="è§£æ-3"><a href="#è§£æ-3" class="headerlink" title="è§£æ"></a>è§£æ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums * @return &#123;number&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">maxSubArray</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> max <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">//é»˜è®¤ç¬¬ä¸€é¡¹æœ€å¤§</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">//æˆªæ­¢å‰ä¸€é¡¹çš„æœ€å¤§å€¼</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> res <span class="token operator">+</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// è®¡ç®—ä¸‹ä¸€é¡¹çš„æœ€å¤§å€¼</span>    max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token comment">//æœ€ç»ˆçš„æ¯”è¾ƒ</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> max<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II-122"><a href="#ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº-II-122" class="headerlink" title="ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II - 122"></a>ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº II - 122</h2><h3 id="é¢˜ç›®-4"><a href="#é¢˜ç›®-4" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/">https://leetcode.cn/problems/best-time-to-buy-and-sell-stock-ii/</a></p><ul><li><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>prices</code> ï¼Œå…¶ä¸­ <code>prices[i]</code> è¡¨ç¤ºæŸæ”¯è‚¡ç¥¨ç¬¬ <code>i</code> å¤©çš„ä»·æ ¼ã€‚</p><p>åœ¨æ¯ä¸€å¤©ï¼Œä½ å¯ä»¥å†³å®šæ˜¯å¦è´­ä¹°å’Œ/æˆ–å‡ºå”®è‚¡ç¥¨ã€‚ä½ åœ¨ä»»ä½•æ—¶å€™ <strong>æœ€å¤š</strong> åªèƒ½æŒæœ‰ <strong>ä¸€è‚¡</strong> è‚¡ç¥¨ã€‚ä½ ä¹Ÿå¯ä»¥å…ˆè´­ä¹°ï¼Œç„¶ååœ¨ <strong>åŒä¸€å¤©</strong> å‡ºå”®ã€‚</p><p>è¿”å› <em>ä½ èƒ½è·å¾—çš„ <strong>æœ€å¤§</strong> åˆ©æ¶¦</em> ã€‚</p><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šprices &#x3D; [7,1,5,3,6,4]è¾“å‡ºï¼š7è§£é‡Šï¼šåœ¨ç¬¬ 2 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 3 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 5 - 1 &#x3D; 4 ã€‚     éšåï¼Œåœ¨ç¬¬ 4 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 3ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 6ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 6 - 3 &#x3D; 3 ã€‚     æ€»åˆ©æ¶¦ä¸º 4 + 3 &#x3D; 7 ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šprices &#x3D; [1,2,3,4,5]è¾“å‡ºï¼š4è§£é‡Šï¼šåœ¨ç¬¬ 1 å¤©ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 1ï¼‰çš„æ—¶å€™ä¹°å…¥ï¼Œåœ¨ç¬¬ 5 å¤© ï¼ˆè‚¡ç¥¨ä»·æ ¼ &#x3D; 5ï¼‰çš„æ—¶å€™å–å‡º, è¿™ç¬”äº¤æ˜“æ‰€èƒ½è·å¾—åˆ©æ¶¦ &#x3D; 5 - 1 &#x3D; 4 ã€‚     æ€»åˆ©æ¶¦ä¸º 4 ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><pre class="line-numbers language-none"><code class="language-none">è¾“å…¥ï¼šprices &#x3D; [7,6,4,3,1]è¾“å‡ºï¼š0è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹, äº¤æ˜“æ— æ³•è·å¾—æ­£åˆ©æ¶¦ï¼Œæ‰€ä»¥ä¸å‚ä¸äº¤æ˜“å¯ä»¥è·å¾—æœ€å¤§åˆ©æ¶¦ï¼Œæœ€å¤§åˆ©æ¶¦ä¸º 0 ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= prices.length &lt;= 3 * 104</code></li><li><code>0 &lt;= prices[i] &lt;= 104</code></li></ul></li></ul><h3 id="è§£æ-4"><a href="#è§£æ-4" class="headerlink" title="è§£æ"></a>è§£æ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">maxProfit</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prices</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> prices<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res <span class="token operator">+=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> prices<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> prices<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è´ªå¿ƒç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSè¾“å‡º</title>
      <link href="/2023/08/02/js-shu-chu/"/>
      <url>/2023/08/02/js-shu-chu/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è€ƒå¯Ÿå‡½æ•°å’Œä½œç”¨åŸŸçš„ PRIORITY,ä»¥åŠ new åœ¨æ‰§è¡Œæ—¶çš„ä¸€äº›æœºåˆ¶ã€‚éœ€è¦ç»“åˆæ‰§è¡Œä¸Šä¸‹æ–‡æ¥åˆ†æå‡½æ•°å’Œå˜é‡å£°æ˜çš„é¡ºåºä¸ä¼˜å…ˆçº§ã€‚</p></blockquote><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a><strong>é¢˜ç›®</strong></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"11=>"</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">&#125;</span>Foo<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"22=>"</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"33=>"</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> <span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"44=>"</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"55=>"</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>Foo<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Foo<span class="token punctuation">.</span>getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">new</span> <span class="token class-name">new</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 22=> 22</span><span class="token comment">// 44=> 44</span><span class="token comment">// 11=> 11</span><span class="token comment">// 11=> 11</span><span class="token comment">// 22=> 22</span><span class="token comment">// 33=> 33</span><span class="token comment">// 33=> 33</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ol><li>Foo.getName() è°ƒç”¨çš„æ˜¯ Foo ä¸Šçš„é™æ€æ–¹æ³•,è¾“å‡º 22ã€‚</li><li>ç¬¬ä¸€æ¬¡è°ƒç”¨ getName() è¾“å‡º 44,è°ƒç”¨çš„æ˜¯å…¨å±€ä½œç”¨åŸŸä¸‹å£°æ˜çš„ getName å˜é‡å‡½æ•°ã€‚</li><li>Foo().getName() è¾“å‡º 11,Foo() æ„é€ å‡½æ•°å†…éƒ¨å£°æ˜çš„ getName å˜é‡,ä¼˜å…ˆçº§æœ€é«˜ã€‚</li><li>ç¬¬äºŒæ¬¡è°ƒç”¨ getName() è¾“å‡º 11,å› ä¸ºè¢« Foo() å†…çš„ getName è¦†ç›–äº†ã€‚</li><li>new Foo.getName() è¾“å‡º 22,new æ‰§è¡Œçš„æ˜¯ Foo ä¸Šçš„é™æ€æ–¹æ³•ã€‚</li><li>new Foo().getName() è¾“å‡º 33,new Foo() åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹,è°ƒç”¨çš„æ˜¯åŸå‹ä¸Šçš„æ–¹æ³•ã€‚</li><li>new new Foo().getName() ä¹Ÿè¾“å‡º 33,æ–°çš„è¯­æ³•å¹¶æ²¡æœ‰æ”¹å˜å…¶æœºåˆ¶,ä»ç„¶æ‰§è¡ŒåŸå‹ä¸Šçš„æ–¹æ³•ã€‚</li></ol><h3 id="æ”¶è·"><a href="#æ”¶è·" class="headerlink" title="æ”¶è·"></a>æ”¶è·</h3><ol><li>è¿œç®—ä¼˜å…ˆçº§</li></ol><ul><li>åˆ†ç»„ï¼ˆâ€¦ï¼‰19</li><li>æˆå‘˜è®¿é—®ï¼ˆa.bï¼‰ ï¼Œnewï¼ˆå¸¦å‚æ•°äº†ï¼›åˆ—è¡¨ï¼‰ï¼Œå‡½æ•°è°ƒç”¨ï¼Œå¯é€‰é“¾ ä¼˜å…ˆçº§è¾ƒé«˜ ä¸º 18</li><li>newï¼ˆæ— å‚æ•°åˆ—è¡¨ï¼‰ 17 new Foo å±äºæ— å‚æ•°åˆ—è¡¨</li><li>åç½®é€’å¢ /é€’å‡ 16</li><li>èµ‹å€¼ ï¼ˆä»å³åˆ°å·¦ï¼‰ 2</li></ul><ol start="2"><li>new å…³é”®å­—ä¼šè¿›è¡Œå¦‚ä¸‹çš„æ“ä½œï¼š</li></ol><ul><li>åˆ›å»ºä¸€ä¸ªç©ºçš„ç®€å• JavaScript å¯¹è±¡ï¼ˆå³ {}ï¼‰ï¼›</li><li>ä¸ºæ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡æ·»åŠ å±æ€§ <strong>proto</strong>ï¼Œå°†è¯¥å±æ€§é“¾æ¥è‡³æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼›</li><li>å°†æ­¥éª¤ 1 æ–°åˆ›å»ºçš„å¯¹è±¡ä½œä¸º this çš„ä¸Šä¸‹æ–‡ï¼›</li><li>å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰è¿”å›å¯¹è±¡ï¼Œåˆ™è¿”å› thisã€‚</li></ul><ol start="3"><li><code>.</code>å’Œ<code>new</code>çš„ä¼˜å…ˆçº§</li></ol><ul><li>. å½“ new å’Œ . åŒæ—¶å‡ºç°æ—¶,new çš„ä¼˜å…ˆçº§æ›´é«˜,ä¾‹å¦‚:<br>new Foo().getName()<br>è¿™é‡Œ new Foo()ä¼šå…ˆæ‰§è¡Œã€‚</li><li>å½“ . åœ¨ new çš„å‚æ•°ä½ç½®æ—¶,. çš„ä¼˜å…ˆçº§æ›´é«˜,ä¾‹å¦‚:<br>new Foo.getName()<br>è¿™é‡Œ Foo.getName ä¼šå…ˆè§£æã€‚</li><li>å½“ . ä¸åœ¨ new çš„å‚æ•°ä½ç½®æ—¶,new çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚</li></ul><p>è¿™ä¹ˆè®¾å®šä¼˜å…ˆçº§ä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘:</p><ul><li>new ä½œä¸ºåˆ›å»ºå®ä¾‹çš„è¿ç®—ç¬¦,åº”è¯¥å…ˆæ‰§è¡Œã€‚</li><li>. åœ¨ new çš„å‚æ•°ä½ç½®æ—¶,è¦å…ˆè§£æå‡ºä¸€ä¸ªé™æ€æ–¹æ³•ã€‚</li><li>. ä¸åœ¨å‚æ•°ä½ç½®æ—¶,åº”è¯¥ä½œç”¨äº new åˆ›å»ºçš„å®ä¾‹ä¸Šã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•React-Hookså®ç°</title>
      <link href="/2023/07/31/react-hooks/"/>
      <url>/2023/07/31/react-hooks/</url>
      
        <content type="html"><![CDATA[<h2 id="1-React-Hooks"><a href="#1-React-Hooks" class="headerlink" title="1. React Hooks"></a>1. React Hooks</h2><ul><li>Hook å¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ <code>class</code> çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>state</code> ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§</li></ul><h2 id="2-useState"><a href="#2-useState" class="headerlink" title="2. useState"></a>2. useState</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> hookStates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">let</span> hookIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> oldState <span class="token operator">=</span> <span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span>    hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> initialState<span class="token punctuation">)</span>  <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> hookIndex  <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> newState <span class="token operator">=</span> <span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">"function"</span> <span class="token operator">?</span> <span class="token function">action</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span> <span class="token operator">:</span> action    hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> newState    <span class="token function">scheduleUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//é‡æ–°diffç®—æ³•æ¸²æŸ“</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> setState<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-useCallback-useMemo"><a href="#3-useCallback-useMemo" class="headerlink" title="3.useCallback+useMemo"></a>3.useCallback+useMemo</h2><ul><li>æŠŠå†…è”å›è°ƒå‡½æ•°åŠä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ <code>useCallback</code>ï¼Œå®ƒå°†è¿”å›è¯¥å›è°ƒå‡½æ•°çš„ memoized ç‰ˆæœ¬ï¼Œè¯¥å›è°ƒå‡½æ•°ä»…åœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°</li><li>æŠŠåˆ›å»ºå‡½æ•°å’Œä¾èµ–é¡¹æ•°ç»„ä½œä¸ºå‚æ•°ä¼ å…¥ <code>useMemo</code>ï¼Œå®ƒä»…ä¼šåœ¨æŸä¸ªä¾èµ–é¡¹æ”¹å˜æ—¶æ‰é‡æ–°è®¡ç®— memoized å€¼ã€‚è¿™ç§ä¼˜åŒ–æœ‰åŠ©äºé¿å…åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—</li></ul><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"./react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"./react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">let</span> <span class="token function-variable function">Child</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> handleClick <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Child render"</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>data<span class="token punctuation">.</span>number<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span>Child <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">memo</span><span class="token punctuation">(</span>Child<span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"App render"</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>name<span class="token punctuation">,</span> setName<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">"zhufeng"</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> data <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> number <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> handleClick <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>number<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span>        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>name<span class="token punctuation">&#125;</span></span>        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setName</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>      <span class="token punctuation">/></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Child</span></span> <span class="token attr-name">data</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span></span> <span class="token attr-name">handleClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token parameter">factory<span class="token punctuation">,</span> deps</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//éç¬¬ä¸€æ¬¡</span>    <span class="token keyword">let</span> <span class="token punctuation">[</span>lastMemo<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>    <span class="token keyword">let</span> same <span class="token operator">=</span> deps<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">===</span> lastDeps<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      hookIndex<span class="token operator">++</span>      <span class="token keyword">return</span> lastMemo    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> newMemo <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>newMemo<span class="token punctuation">,</span> deps<span class="token punctuation">]</span>      <span class="token keyword">return</span> newMemo    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆæ¬¡æ¸²æŸ“</span>    <span class="token keyword">let</span> newMemo <span class="token operator">=</span> <span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>newMemo<span class="token punctuation">,</span> deps<span class="token punctuation">]</span>    <span class="token keyword">return</span> newMemo  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useCallback</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> deps</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">[</span>lastCallback<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>    <span class="token keyword">let</span> same <span class="token operator">=</span> deps<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">===</span> lastDeps<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      hookIndex<span class="token operator">++</span>      <span class="token keyword">return</span> lastCallback    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> deps<span class="token punctuation">]</span>      <span class="token keyword">return</span> callback    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>callback<span class="token punctuation">,</span> deps<span class="token punctuation">]</span>    <span class="token keyword">return</span> callback  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-useReducer"><a href="#4-useReducer" class="headerlink" title="4. useReducer"></a>4. useReducer</h2><ul><li>useState çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚ (state, action) =&gt; newState çš„ reducerï¼Œå¹¶è¿”å›å½“å‰çš„ state ä»¥åŠä¸å…¶é…å¥—çš„ dispatch æ–¹æ³•</li><li>åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒuseReducer ä¼šæ¯” useState æ›´é€‚ç”¨ï¼Œä¾‹å¦‚ state é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–äºä¹‹å‰çš„ state ç­‰</li></ul><h3 id="æ¡ˆä¾‹-1"><a href="#æ¡ˆä¾‹-1" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"./react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"./react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token string">"ADD"</span><span class="token operator">:</span>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">case</span> <span class="token string">"MINUS"</span><span class="token operator">:</span>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">return</span> state  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token literal-property property">Count</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>number<span class="token punctuation">&#125;</span>      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"ADD"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"MINUS"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">-</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> initialState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> initialState  <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> hookIndex  <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> oldState <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>reducer<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> newState <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>oldState<span class="token punctuation">,</span> action<span class="token punctuation">)</span>      hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> newState    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> newState <span class="token operator">=</span> <span class="token keyword">typeof</span> action <span class="token operator">===</span> <span class="token string">"function"</span> <span class="token operator">?</span> <span class="token function">action</span><span class="token punctuation">(</span>oldState<span class="token punctuation">)</span> <span class="token operator">:</span> action      hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> newState    <span class="token punctuation">&#125;</span>    <span class="token function">scheduleUpdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æ›´æ–°</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> initialState<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-useContext"><a href="#5-useContext" class="headerlink" title="5. useContext"></a>5. useContext</h2><ul><li>æ¥æ”¶ä¸€ä¸ª context å¯¹è±¡ï¼ˆReact.createContext çš„è¿”å›å€¼ï¼‰å¹¶è¿”å›è¯¥ context çš„å½“å‰å€¼</li><li>å½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„ <code>&lt;MyContext.Provider&gt;</code> çš„ value prop å†³å®š</li><li>å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„ <code>&lt;MyContext.Provider&gt;</code> æ›´æ–°æ—¶ï¼Œè¯¥ Hook ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™ <code>MyContext provider</code> çš„ context value å€¼</li><li>useContext(MyContext) ç›¸å½“äº class ç»„ä»¶ä¸­çš„ <code>static contextType = MyContext</code> æˆ–è€… <code>&lt;MyContext.Consumer&gt;</code></li><li>useContext(MyContext) åªæ˜¯è®©ä½ èƒ½å¤Ÿè¯»å– context çš„å€¼ä»¥åŠè®¢é˜… context çš„å˜åŒ–ã€‚ä½ ä»ç„¶éœ€è¦åœ¨ä¸Šå±‚ç»„ä»¶æ ‘ä¸­ä½¿ç”¨ <code>&lt;MyContext.Provider&gt;</code> æ¥ä¸ºä¸‹å±‚ç»„ä»¶æä¾› context</li></ul><h3 id="æ¡ˆä¾‹-2"><a href="#æ¡ˆä¾‹-2" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"./react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"./react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> CounterContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token string">"add"</span><span class="token operator">:</span>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">case</span> <span class="token string">"minus"</span><span class="token operator">:</span>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> state<span class="token punctuation">.</span>number <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">default</span><span class="token operator">:</span>      <span class="token keyword">return</span> state  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">&#125;</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>CounterContext<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>number<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"add"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">+</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"minus"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">-</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useReducer</span><span class="token punctuation">(</span>reducer<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">number</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">CounterContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> dispatch <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">CounterContext.Provider</span></span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useContext</span><span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> context<span class="token punctuation">.</span>_currentValue<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="6-useEffect"><a href="#6-useEffect" class="headerlink" title="6. useEffect"></a>6. useEffect</h2><ul><li>åœ¨å‡½æ•°ç»„ä»¶ä¸»ä½“å†…ï¼ˆè¿™é‡ŒæŒ‡åœ¨ React æ¸²æŸ“é˜¶æ®µï¼‰æ”¹å˜ DOMã€æ·»åŠ è®¢é˜…ã€è®¾ç½®å®šæ—¶å™¨ã€è®°å½•æ—¥å¿—ä»¥åŠæ‰§è¡Œå…¶ä»–åŒ…å«å‰¯ä½œç”¨çš„æ“ä½œéƒ½æ˜¯ä¸è¢«å…è®¸çš„ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šäº§ç”Ÿè«åå…¶å¦™çš„ bug å¹¶ç ´å UI çš„ä¸€è‡´æ€§</li><li>ä½¿ç”¨ useEffect å®Œæˆå‰¯ä½œç”¨æ“ä½œã€‚èµ‹å€¼ç»™ useEffect çš„å‡½æ•°ä¼šåœ¨ç»„ä»¶æ¸²æŸ“åˆ°å±å¹•ä¹‹åæ‰§è¡Œã€‚ä½ å¯ä»¥æŠŠ effect çœ‹ä½œä» React çš„çº¯å‡½æ•°å¼ä¸–ç•Œé€šå¾€å‘½ä»¤å¼ä¸–ç•Œçš„é€ƒç”Ÿé€šé“</li><li>useEffect å°±æ˜¯ä¸€ä¸ª Effect Hookï¼Œç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ“ä½œå‰¯ä½œç”¨çš„èƒ½åŠ›ã€‚å®ƒè·Ÿ class ç»„ä»¶ä¸­çš„ <code>componentDidMount</code>ã€<code>componentDidUpdate</code> å’Œ <code>componentWillUnmount</code> å…·æœ‰ç›¸åŒçš„ç”¨é€”ï¼Œåªä¸è¿‡è¢«åˆå¹¶æˆäº†ä¸€ä¸ª API</li><li>è¯¥ Hook æ¥æ”¶ä¸€ä¸ªåŒ…å«å‘½ä»¤å¼ã€ä¸”å¯èƒ½æœ‰å‰¯ä½œç”¨ä»£ç çš„å‡½æ•°</li></ul><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"./react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"./react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"å¼€å¯ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨"</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> $timer <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">setNumber</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token operator">=></span> number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"é”€æ¯è€çš„å®šæ—¶å™¨"</span><span class="token punctuation">)</span>      <span class="token function">clearInterval</span><span class="token punctuation">(</span>$timer<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>number<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/></span></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-3"><a href="#å®ç°-3" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> dependencies</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> hookIndex  <span class="token keyword">if</span> <span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">[</span>destroy<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>    <span class="token keyword">let</span> same <span class="token operator">=</span>      dependencies <span class="token operator">&amp;&amp;</span>      dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">===</span> lastDeps<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      hookIndex<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      destroy <span class="token operator">&amp;&amp;</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dependencies<span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      hookIndex<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dependencies<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    hookIndex<span class="token operator">++</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-useLayoutEffect"><a href="#7-useLayoutEffect" class="headerlink" title="7. useLayoutEffect"></a>7. useLayoutEffect</h2><ul><li><p>å…¶å‡½æ•°ç­¾åä¸ <code>useEffect</code> ç›¸åŒï¼Œä½†å®ƒä¼šåœ¨æ‰€æœ‰çš„ <code>DOM</code> å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ effect</p></li><li><p><code>useEffect</code>ä¸ä¼šé˜»å¡æµè§ˆå™¨æ¸²æŸ“ï¼Œè€Œ <code>useLayoutEffect</code> ä¼šæµè§ˆå™¨æ¸²æŸ“</p></li><li><p><code>useEffect</code>ä¼šåœ¨æµè§ˆå™¨æ¸²æŸ“ç»“æŸåæ‰§è¡Œ,<code>useLayoutEffect</code> åˆ™æ˜¯åœ¨ <code>DOM</code> æ›´æ–°å®Œæˆå,æµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰æ‰§è¡Œ</p></li><li><p>useLayoutEffect ç›¸å¯¹äºå¾®ä»»åŠ¡ï¼ŒuseEffect ç›¸å½“äºå®ä»»åŠ¡</p></li></ul><h3 id="æ¡ˆä¾‹-3"><a href="#æ¡ˆä¾‹-3" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">Animate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> ref <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate(500px)</span><span class="token template-punctuation string">`</span></span> <span class="token comment">//TODO</span>    ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">all 500ms</span><span class="token template-punctuation string">`</span></span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> style <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">"100px"</span><span class="token punctuation">,</span>    <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">"100px"</span><span class="token punctuation">,</span>    <span class="token literal-property property">borderRadius</span><span class="token operator">:</span> <span class="token string">"50%"</span><span class="token punctuation">,</span>    <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">"red"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span>style<span class="token punctuation">&#125;</span> ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>Animate <span class="token operator">/</span><span class="token operator">></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœï¼š</p><ul><li>ç”¨ useEffect æœ‰åŠ¨ç”»ï¼Œå…ˆæµè§ˆå™¨è¿›è¡Œæ¸²æŸ“ä¸€æ¬¡ï¼Œç„¶åå†æ‰§è¡Œ useEffect å‡½æ•°äºŒæ¬¡æ¸²æŸ“</li><li>ç”¨ useLayoutEffect æ— åŠ¨ç”»ï¼Œç„¶åå†æ‰§è¡Œ useLayoutEffect å‡½æ•°åˆå¹¶æ ·å¼æ›´æ–°ï¼Œå†è¿›è¡Œæ¸²æŸ“</li></ul><h3 id="å®ç°-4"><a href="#å®ç°-4" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> dependencies</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> currentIndex <span class="token operator">=</span> hookIndex  <span class="token keyword">if</span> <span class="token punctuation">(</span>hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> <span class="token punctuation">[</span>destroy<span class="token punctuation">,</span> lastDeps<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span>    <span class="token keyword">let</span> same <span class="token operator">=</span>      dependencies <span class="token operator">&amp;&amp;</span>      dependencies<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> item <span class="token operator">===</span> lastDeps<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>same<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      hookIndex<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      destroy <span class="token operator">&amp;&amp;</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dependencies<span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      hookIndex<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      hookStates<span class="token punctuation">[</span>currentIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dependencies<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    hookIndex<span class="token operator">++</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8-useRef"><a href="#8-useRef" class="headerlink" title="8. useRef"></a>8. useRef</h2><ul><li>å½“ä½ æ”¹å˜ <code>ref.current</code> å±æ€§æ—¶ï¼ŒReact ä¸ä¼šé‡æ–°æ¸²æŸ“ä½ çš„ç»„ä»¶ã€‚React ä¸çŸ¥é“ä½ ä½•æ—¶æ”¹å˜å®ƒï¼Œå› ä¸º ref æ˜¯ä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ã€‚</li></ul><h3 id="å®ç°-5"><a href="#å®ç°-5" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">current</span><span class="token operator">:</span> initialState <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> hookStates<span class="token punctuation">[</span>hookIndex<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="hooks-æ€ä¹ˆè·å–ä¸Šä¸€è½®çš„-state"><a href="#hooks-æ€ä¹ˆè·å–ä¸Šä¸€è½®çš„-state" class="headerlink" title="hooks æ€ä¹ˆè·å–ä¸Šä¸€è½®çš„ state"></a>hooks æ€ä¹ˆè·å–ä¸Šä¸€è½®çš„ state</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">usePrevious</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    ref<span class="token punctuation">.</span>current <span class="token operator">=</span> value  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å–æœ€æ–°å€¼"><a href="#å–æœ€æ–°å€¼" class="headerlink" title="å–æœ€æ–°å€¼"></a>å–æœ€æ–°å€¼</h3><ul><li>ä½¿ç”¨ useRefï¼Œæ¯æ¬¡å€¼æ›´æ–°çš„æ—¶å€™æŠŠæœ€æ–°çš„å€¼èµ‹ç»™ ref.current</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"./react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"./react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> valueRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> newValue <span class="token operator">=</span> state <span class="token operator">+</span> <span class="token number">1</span>    valueRef<span class="token punctuation">.</span>current <span class="token operator">=</span> newValue    <span class="token function">setState</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span>    <span class="token function">otherFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">otherFun</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> valueRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>div<span class="token operator">></span>      <span class="token operator">&lt;</span>p<span class="token operator">></span>state<span class="token operator">:</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span>      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token operator">+</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token operator">&lt;</span>Counter <span class="token operator">/</span><span class="token operator">></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="9-useImperativeHandle"><a href="#9-useImperativeHandle" class="headerlink" title="9. useImperativeHandle"></a>9. useImperativeHandle</h2><ul><li>forwardRef å°† ref ä»çˆ¶ç»„ä»¶ä¸­è½¬å‘åˆ°å­ç»„ä»¶ä¸­çš„ dom å…ƒç´ ä¸Š,å­ç»„ä»¶æ¥å— props å’Œ ref ä½œä¸ºå‚æ•°</li><li><code>useImperativeHandle</code> å¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼</li></ul><h3 id="æ¡ˆä¾‹-4"><a href="#æ¡ˆä¾‹-4" class="headerlink" title="æ¡ˆä¾‹"></a><strong>æ¡ˆä¾‹</strong></h3><p>ç‚¹å‡»çˆ¶ç»„ä»¶è·å–ç„¦ç‚¹æŒ‰é’® å­ç»„ä»¶è·å–ç„¦ç‚¹</p><p><strong>æ³¨æ„ï¼š</strong>é€šè¿‡ forwardRef è½¬å‘ç»™å­ç»„ä»¶çš„ inputa ç»‘å®š refï¼Œä½†æ˜¯æœ‰å±é™©ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ä»»æ„æ“ä½œå­ç»„ä»¶çš„å…ƒç´ ï¼Œæ‰€ä»¥é‡‡ç”¨ useImperativeHandleï¼Œå¯ä»¥è®©ä½ åœ¨ä½¿ç”¨ ref æ—¶è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom/client"</span><span class="token keyword">const</span> DOMRoot <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">Child</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  React<span class="token punctuation">.</span><span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> ForwardChild <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">forwardRef</span><span class="token punctuation">(</span>Child<span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">[</span>number<span class="token punctuation">,</span> setNumber<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">function</span> <span class="token function">getFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>inputRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span>    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">"focus"</span>    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ForwardChild</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>inputRef<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>getFocus<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">è·å¾—ç„¦ç‚¹</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>number<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>        <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">debugger</span>          <span class="token function">setNumber</span><span class="token punctuation">(</span>number <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>      <span class="token punctuation">></span></span><span class="token plain-text">        +      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Parent</span></span> <span class="token punctuation">/></span></span>DOMRoot<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-6"><a href="#å®ç°-6" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span><span class="token parameter">ref<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  ref<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue3-ace-editorçš„ä½¿ç”¨</title>
      <link href="/2023/07/19/vue3-ace-editor-de-shi-yong/"/>
      <url>/2023/07/19/vue3-ace-editor-de-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="å‚è€ƒæ–‡æ¡£"><a href="#å‚è€ƒæ–‡æ¡£" class="headerlink" title="å‚è€ƒæ–‡æ¡£"></a>å‚è€ƒæ–‡æ¡£</h2><p>npm åœ°å€ï¼š<a href="https://www.npmjs.com/package/vue3-ace-editor">https://www.npmjs.com/package/vue3-ace-editor</a></p><p>å®˜ç½‘åœ°å€ï¼š<a href="https://ace.c9.io/">Ace - The High Performance Code Editor for the Web</a><br>Github: <a href="https://github.com/ajaxorg/ace/">GitHub - ajaxorg/ace: Ace (Ajax.org Cloud9 Editor)</a><br>vue2 ç‰ˆï¼š<a href="https://github.com/chairuosen/vue2-ace-editor">GitHub - chairuosen/vue2-ace-editor</a><br>vue3 ç‰ˆï¼š<a href="https://github.com/CarterLi/vue3-ace-editor">GitHub - CarterLi/vue3-ace-editor</a></p><h2 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h2><p>å®‰è£…</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i vue3-ace-editor<span class="token function">npm</span> i ace-builds<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>æˆ–è€…</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i vue3-ace-editor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>.npmrc</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">shamefully<span class="token operator">-</span>hoist<span class="token operator">=</span><span class="token boolean">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>app.vue</p><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &lt;header&gt;    &lt;select v-model&#x3D;&quot;states.lang&quot;&gt;      &lt;option v-for&#x3D;&quot;lang of langs&quot; :value&#x3D;&quot;lang&quot;&gt;&#123;&#123; lang &#125;&#125;&lt;&#x2F;option&gt;    &lt;&#x2F;select&gt;    &lt;select v-model&#x3D;&quot;states.theme&quot;&gt;      &lt;option v-for&#x3D;&quot;theme of themes&quot; :value&#x3D;&quot;theme&quot;&gt;&#123;&#123; theme &#125;&#125;&lt;&#x2F;option&gt;    &lt;&#x2F;select&gt;  &lt;&#x2F;header&gt;  &lt;main style&#x3D;&quot;height: 0&quot;&gt;    &lt;VAceEditor      ref&#x3D;&quot;aceRef&quot;      v-model:value&#x3D;&quot;states.content&quot;      class&#x3D;&quot;vue-ace-editor&quot;      :lang&#x3D;&quot;states.lang&quot;      :theme&#x3D;&quot;states.theme&quot;      :options&#x3D;&quot;&#123;        useWorker: true,        enableBasicAutocompletion: true,        enableSnippets: true,        enableLiveAutocompletion: true,      &#125;&quot;    &#x2F;&gt;  &lt;&#x2F;main&gt;&lt;&#x2F;template&gt;&lt;script setup lang&#x3D;&quot;ts&quot;&gt;import &#123; reactive, watch &#125; from &quot;vue&quot;import &#123; VAceEditor &#125; from &quot;vue3-ace-editor&quot;import &quot;.&#x2F;ace-config&quot;const langs &#x3D; [&quot;json&quot;, &quot;javascript&quot;, &quot;html&quot;, &quot;yaml&quot;]const themes &#x3D; [&quot;github&quot;, &quot;chrome&quot;, &quot;monokai&quot;]const states &#x3D; reactive(&#123;  lang: &quot;yaml&quot;,  theme: &quot;github&quot;,  content: &quot;&quot;,&#125;)watch(  () &#x3D;&gt; states.lang,  async (lang) &#x3D;&gt; &#123;    states.content &#x3D; (      await &#123;        json: import(&quot;..&#x2F;package.json?raw&quot;),        javascript: import(&quot;.&#x2F;ace-config.js?raw&quot;),        html: import(&quot;..&#x2F;index.html?raw&quot;),        yaml: import(&quot;..&#x2F;pnpm-lock.yaml?raw&quot;),      &#125;[lang]    ).default  &#125;,  &#123; immediate: true &#125;)&lt;&#x2F;script&gt;&lt;style lang&#x3D;&quot;scss&quot; scoped&gt;header &#123;  display: flex;&#125;select &#123;  margin-right: 15px;&#125;main &#123;  flex: 1;  margin-top: 15px;  display: flex;&#125;.vue-ace-editor &#123;  font-size: 16px;  border: 1px solid;  flex: 1;&#125;.outline-tree &#123;  width: 500px;  margin-left: 15px;  border: 1px solid;  font-size: 16px;&#125;&lt;&#x2F;style&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ace-config.ts</p><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">import</span> ace <span class="token keyword">from</span> <span class="token string">"ace-builds"</span><span class="token keyword">import</span> modeJsonUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/mode-json?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/json"</span><span class="token punctuation">,</span> modeJsonUrl<span class="token punctuation">)</span><span class="token keyword">import</span> modeJavascriptUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/mode-javascript?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/javascript"</span><span class="token punctuation">,</span> modeJavascriptUrl<span class="token punctuation">)</span><span class="token keyword">import</span> modeHtmlUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/mode-html?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/html"</span><span class="token punctuation">,</span> modeHtmlUrl<span class="token punctuation">)</span><span class="token keyword">import</span> modeYamlUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/mode-yaml?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/yaml"</span><span class="token punctuation">,</span> modeYamlUrl<span class="token punctuation">)</span><span class="token keyword">import</span> themeGithubUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/theme-github?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/theme/github"</span><span class="token punctuation">,</span> themeGithubUrl<span class="token punctuation">)</span><span class="token keyword">import</span> themeChromeUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/theme-chrome?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/theme/chrome"</span><span class="token punctuation">,</span> themeChromeUrl<span class="token punctuation">)</span><span class="token keyword">import</span> themeMonokaiUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/theme-monokai?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/theme/monokai"</span><span class="token punctuation">,</span> themeMonokaiUrl<span class="token punctuation">)</span><span class="token keyword">import</span> workerBaseUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/worker-base?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/base"</span><span class="token punctuation">,</span> workerBaseUrl<span class="token punctuation">)</span><span class="token keyword">import</span> workerJsonUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/worker-json?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/json_worker"</span><span class="token punctuation">,</span> workerJsonUrl<span class="token punctuation">)</span><span class="token keyword">import</span> workerJavascriptUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/worker-javascript?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/javascript_worker"</span><span class="token punctuation">,</span> workerJavascriptUrl<span class="token punctuation">)</span><span class="token keyword">import</span> workerHtmlUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/worker-html?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/html_worker"</span><span class="token punctuation">,</span> workerHtmlUrl<span class="token punctuation">)</span><span class="token keyword">import</span> workerYamlUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/worker-yaml?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/mode/yaml_worker"</span><span class="token punctuation">,</span> workerYamlUrl<span class="token punctuation">)</span><span class="token keyword">import</span> snippetsHtmlUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/snippets/html?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/snippets/html"</span><span class="token punctuation">,</span> snippetsHtmlUrl<span class="token punctuation">)</span><span class="token keyword">import</span> snippetsJsUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/snippets/javascript?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/snippets/javascript"</span><span class="token punctuation">,</span> snippetsJsUrl<span class="token punctuation">)</span><span class="token keyword">import</span> snippetsYamlUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/snippets/yaml?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/snippets/javascript"</span><span class="token punctuation">,</span> snippetsYamlUrl<span class="token punctuation">)</span><span class="token keyword">import</span> snippetsJsonUrl <span class="token keyword">from</span> <span class="token string">"ace-builds/src-noconflict/snippets/json?url"</span>ace<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token function">setModuleUrl</span><span class="token punctuation">(</span><span class="token string">"ace/snippets/json"</span><span class="token punctuation">,</span> snippetsJsonUrl<span class="token punctuation">)</span><span class="token keyword">import</span> <span class="token string">"ace-builds/src-noconflict/ext-language_tools"</span>ace<span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">"ace/ext/language_tools"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™ä¸€ç»„å¯¼å…¥å’Œé…ç½®ä»£ç æ˜¯ç”¨äºè‡ªå®šä¹‰é…ç½® Ace ç¼–è¾‘å™¨çš„å„ä¸ªæ¨¡å—,ä¸»è¦åŒ…æ‹¬:</p><ol><li>å¯¼å…¥ä¸åŒè¯­è¨€çš„è¯­æ³•æ¨¡å¼æ¨¡å—,å¹¶è®¾ç½®å¯¹åº” URL:</li></ol><ul><li>json</li><li>javascript</li><li>html</li><li>yaml</li></ul><ol start="2"><li>å¯¼å…¥ä¸åŒçš„ä¸»é¢˜æ¨¡å—,å¹¶è®¾ç½®å¯¹åº” URL:</li></ol><ul><li>github</li><li>chrome</li><li>monokai</li></ul><ol start="3"><li>å¯¼å…¥åŸºç¡€ worker å’Œä¸åŒè¯­è¨€ worker,å¹¶è®¾ç½®å¯¹åº” URL:</li></ol><ul><li>base worker</li><li>json worker</li><li>javascript worker</li><li>html worker</li><li>yaml worker</li></ul><ol start="4"><li>å¯¼å…¥ä¸åŒè¯­è¨€çš„ä»£ç ç‰‡æ®µ,å¹¶è®¾ç½®å¯¹åº” URL:</li></ol><ul><li>html</li><li>javascript</li><li>yaml</li><li>json</li></ul><ol start="5"><li>å¯¼å…¥è¯­è¨€å·¥å…·æ‰©å±•æ¨¡å—é€šè¿‡è¿™ç§æ–¹å¼,å¯ä»¥ä» Ace æ„å»ºç‰ˆæœ¬ä¸­å¯¼å…¥æ‰€éœ€çš„æ¨¡å—,å¹¶é€šè¿‡ setModuleUrl æ–¹æ³•è‡ªå®šä¹‰å®ƒä»¬çš„åŠ è½½åœ°å€ã€‚</li></ol><p>è¿™æ ·åšçš„ä¸»è¦ä¼˜ç‚¹æ˜¯:</p><ul><li>å¯ä»¥å°†è¿™äº›æ¨¡å—å­˜å‚¨åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Š,è€Œä¸æ˜¯ä» Ace CDN åŠ è½½ã€‚</li><li>å¯ä»¥è‡ªå®šä¹‰éœ€è¦åŠ è½½çš„æ¨¡å—,åªå¯¼å…¥åº”ç”¨éœ€è¦çš„éƒ¨åˆ†ã€‚</li><li>å¯ä»¥é¿å…å’Œå…¶ä»–ç‰ˆæœ¬çš„ Ace å†²çªã€‚</li><li>å¯ä»¥è‡ªå®šä¹‰æ¨¡å—çš„è·¯å¾„å’Œåç§°ã€‚</li></ul><p>æ€»è€Œè¨€ä¹‹,è¿™äº›é…ç½®å¯ä»¥é«˜åº¦è‡ªå®šä¹‰ Ace åœ¨è¯¥åº”ç”¨ä¸­çš„èµ„æºåŠ è½½æ–¹å¼,åšåˆ°ç²¾ç®€ã€å»å†²çªå’Œå¯æ§ã€‚</p><h2 id="API-ä»‹ç»è¯´æ˜"><a href="#API-ä»‹ç»è¯´æ˜" class="headerlink" title="API ä»‹ç»è¯´æ˜"></a>API ä»‹ç»è¯´æ˜</h2><h3 id="è¯­æ³•æ¨¡å¼-mode-æ¨¡å—"><a href="#è¯­æ³•æ¨¡å¼-mode-æ¨¡å—" class="headerlink" title="è¯­æ³•æ¨¡å¼(mode)æ¨¡å—:"></a>è¯­æ³•æ¨¡å¼(mode)æ¨¡å—:</h3><p>è¯­æ³•æ¨¡å¼æ¨¡å—ç”¨äºå®šä¹‰ä¸åŒè¯­è¨€çš„è¯­æ³•è§„åˆ™,åŒ…æ‹¬è¯­æ³•é«˜äº®ã€ä»£ç æŠ˜å ã€ç¼©è¿›ç­‰ã€‚<br>å¯¼å…¥ä¸åŒè¯­è¨€çš„ mode æ¨¡å—å¯ä»¥è®© Ace ç¼–è¾‘å™¨æ”¯æŒå¯¹åº”çš„è¯­è¨€è¯­æ³•ã€‚æ¯”å¦‚å¯¼å…¥ json mode å¯ä»¥é«˜äº® JSON è¯­æ³•ã€‚</p><h3 id="Worker-æ¨¡å—"><a href="#Worker-æ¨¡å—" class="headerlink" title="Worker æ¨¡å—:"></a>Worker æ¨¡å—:</h3><p>Worker æ¨¡å—ç”¨äºå®Œæˆè¯­æ³•æ£€æŸ¥ã€ä»£ç æç¤ºã€è‡ªåŠ¨è¡¥å…¨ç­‰ä»£ç ç¼–è¾‘åŠŸèƒ½ã€‚<br>å…¶ä¸­:</p><ul><li>base worker æä¾›æœ€åŸºæœ¬çš„ç¼–è¾‘åŠŸèƒ½</li><li>è¯­è¨€ç‰¹å®šçš„ worker,å¦‚ json worker,å¯ä»¥æä¾›å¯¹åº”çš„æ™ºèƒ½è¯­æ³•åŠŸèƒ½<br>Worker æ¨¡å—éœ€è¦ç»“åˆå¯¹åº”çš„ mode æ¨¡å—æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚<br>ä¾‹å¦‚ json worker ç»“åˆ json mode æ‰èƒ½å®ç° JSON æ–‡ä»¶çš„æ™ºèƒ½æç¤ºã€è¯­æ³•æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚</li></ul><h3 id="ä»£ç ç‰‡æ®µ"><a href="#ä»£ç ç‰‡æ®µ" class="headerlink" title="ä»£ç ç‰‡æ®µ"></a>ä»£ç ç‰‡æ®µ</h3><p>åœ¨ Ace ç¼–è¾‘å™¨ä¸­,å¯¼å…¥ä¸åŒè¯­è¨€çš„ä»£ç ç‰‡æ®µ(snippets)çš„ä½œç”¨æ˜¯æä¾›ä»£ç è‡ªåŠ¨è¡¥å…¨å’Œä»£ç å—åŠŸèƒ½ã€‚<br>ä»£ç ç‰‡æ®µä¸ºä¸åŒè¯­è¨€æä¾›äº†å¸¸ç”¨ä»£ç å—,ç”¨æˆ·å¯ä»¥é€šè¿‡è§¦å‘å…³é”®å­—å¿«é€Ÿæ’å…¥é¢„å®šä¹‰çš„ä»£ç æ¨¡æ¿ã€‚<br>ä¾‹å¦‚åœ¨ JavaScript ä»£ç ä¸­è¾“å…¥ â€œforâ€ å¹¶è§¦å‘è¡¥å…¨,å¯ä»¥è‡ªåŠ¨æ’å…¥ä¸€ä¸ª for å¾ªç¯ä»£ç å—ã€‚<br>ä¸»è¦ä½œç”¨åŒ…æ‹¬:</p><ol><li>æé«˜ç¼–ç¨‹æ•ˆç‡,é€šè¿‡ä»£ç ç‰‡æ®µå¯ä»¥å¿«é€Ÿæ’å…¥å¸¸ç”¨ä»£ç å—,ä¸ç”¨æ¯æ¬¡éƒ½é‡æ–°ç¼–å†™é‡å¤ä»£ç ã€‚</li><li>å‡å°‘ç¼–ç é”™è¯¯,ä»£ç ç‰‡æ®µå·²å®šä¹‰å¥½è¯­æ³•ç»“æ„,ä½¿ç”¨åå¯ä»¥é¿å…è¯­æ³•é”™è¯¯ã€‚</li><li>æ ‡å‡†åŒ–ä»£ç é£æ ¼,å¼€å‘å›¢é˜Ÿå¯ä»¥å®šä¹‰ç»Ÿä¸€çš„ä»£ç ç‰‡æ®µ,ç»´æŒä¸€è‡´çš„ä»£ç é£æ ¼ã€‚</li><li>æ”¯æŒä¸åŒè¯­è¨€,å¯¼å…¥ htmlã€jsã€yaml ç­‰è¯­è¨€çš„ç‰‡æ®µå¯ä»¥åˆ†åˆ«ç¼–å†™å¯¹åº”çš„æ–‡ä»¶ç±»å‹ã€‚</li><li>æ–¹ä¾¿æ–°æ‰‹å­¦ä¹ ç¼–ç¨‹è¯­è¨€,å¯ä»¥é€šè¿‡ä»£ç ç‰‡æ®µæŸ¥çœ‹è¯­è¨€ä»£ç ç»“æ„å’Œè¯­æ³•æ ·ä¾‹ã€‚</li><li>å¯ä»¥è‡ªå®šä¹‰ä»£ç ç‰‡æ®µ,å¼€å‘è€…å¯ä»¥æ ¹æ®é¡¹ç›®éœ€è¦è‡ªè¡Œå®šä¹‰é¢å¤–çš„ä»£ç ç‰‡æ®µã€‚</li></ol><h3 id="ext-language-tools-æ¨¡å—"><a href="#ext-language-tools-æ¨¡å—" class="headerlink" title="ext-language_tools æ¨¡å—"></a>ext-language_tools æ¨¡å—</h3><p><strong>ext-language_tools æ¨¡å—:å¯ç”¨è‡ªåŠ¨è¡¥å…¨ç­‰é«˜çº§ç¼–è¾‘æ”¯æŒã€‚</strong></p><p>å®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯:</p><ul><li><p>è¯­æ³•æ¨¡å¼æ¨¡å—æä¾›åŸºç¡€çš„è¯­æ³•å’Œç¼–è¾‘èƒ½åŠ›ã€‚</p></li><li><p>Worker æ¨¡å—åŸºäºè¯­æ³•æ¨¡å¼å®ç°æ™ºèƒ½ç¼–è¾‘åŠŸèƒ½ã€‚</p></li><li><p>ext-language_tools æ¨¡å—åˆ©ç”¨è¯­æ³•æ¨¡å¼å’Œ Worker æä¾›çš„èƒ½åŠ›,å‘ˆç°è‡ªåŠ¨è¡¥å…¨ç­‰é«˜çº§åŠŸèƒ½ã€‚</p></li></ul><p>ä¹Ÿå°±æ˜¯è¯´,è¯­æ³•æ¨¡å¼å’Œ Worker æ¨¡å—ä¸º ext-language_tools æä¾›äº†å¿…è¦çš„è¯­æ³•æ ‘åˆ†æå’Œå¤„ç†èƒ½åŠ›ã€‚<br>è€Œ ext-language_tools åŸºäºå®ƒä»¬å±•ç¤ºå‡ºè‡ªåŠ¨è¡¥å…¨ã€æ„å»ºè¯­æ³•æ ‘ç­‰é«˜çº§åŠŸèƒ½ã€‚</p><h3 id="option-é…ç½®"><a href="#option-é…ç½®" class="headerlink" title="option é…ç½®"></a>option é…ç½®</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">options <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">useWorker</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">enableBasicAutocompletion</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">enableSnippets</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">enableLiveAutocompletion</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>useWorker æ˜¯å¦ä½¿ç”¨ Worker çº¿ç¨‹,å¯ç”¨è¯­æ³•æ£€æŸ¥å’Œè‡ªåŠ¨è¡¥å…¨ç­‰åŠŸèƒ½,é»˜è®¤ä¸º false,åº”è®¾ç½®ä¸º true ä»¥å¯ç”¨å¢å¼ºç¼–è¾‘åŠŸèƒ½ã€‚</li><li>enableBasicAutocompletion å¯ç”¨åŸºæœ¬è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½,æ’å…¥åŒ¹é…çš„å˜é‡ã€æ–¹æ³•åç­‰,é»˜è®¤ä¸º falseã€‚</li><li>enableSnippets å¯ç”¨ä»£ç æ®µ(snippets)è¡¥å…¨åŠŸèƒ½,å…è®¸æ’å…¥é¢„å®šä¹‰çš„ä»£ç ç‰‡æ®µ,é»˜è®¤ä¸º falseã€‚</li><li>enableLiveAutocompletion å®æ—¶è‡ªåŠ¨è¡¥å…¨,è¾“å…¥ä»£ç æ—¶å³æ—¶æ˜¾ç¤ºè¡¥å…¨å»ºè®®,é»˜è®¤ä¸º falseã€‚</li></ol><p>ç»¼åˆè€Œè¨€:</p><ul><li><p>useWorker å¯ç”¨è¯­æ³•æ£€æŸ¥å’Œç¼–è¾‘å¢å¼º-</p></li><li><p>enableBasicAutocompletion å’Œ enableSnippets å¯ç”¨åŸºæœ¬è¡¥å…¨å’Œä»£ç ç‰‡æ®µè¡¥å…¨</p></li><li><p>enableLiveAutocompletion å®æ—¶è¡¥å…¨,æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</p></li></ul><p>å»ºè®®éƒ½è®¾ç½®ä¸º true,å¯ç”¨ Ace ç¼–è¾‘å™¨çš„æ™ºèƒ½ç¼–è¾‘åŠŸèƒ½,åŒ…æ‹¬å®æ—¶è‡ªåŠ¨è¡¥å…¨ã€ä»£ç æ£€æŸ¥ã€ä»£ç æ®µæ’å…¥ç­‰,å¯ä»¥å¤§å¤§æé«˜å¼€å‘æ•ˆç‡ã€‚</p><p>éœ€è¦ä¸å¯¼å…¥ language_tools ç­‰æ¨¡å—é…åˆä½¿ç”¨,ä¸º Ace æä¾›å¿…è¦çš„è¯­æ³•åˆ†æå’Œå¤„ç†èƒ½åŠ›,æ‰èƒ½å‘æŒ¥æœ€å¤§æ•ˆæœ</p><h2 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"> <span class="token operator">&lt;</span>VAceEditor      ref<span class="token operator">=</span><span class="token string">"aceRef"</span>      v<span class="token operator">-</span>model<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"states.content"</span>      <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"vue-ace-editor"</span>      <span class="token operator">:</span>lang<span class="token operator">=</span><span class="token string">"states.lang"</span>      <span class="token operator">:</span>theme<span class="token operator">=</span><span class="token string">"states.theme"</span>      <span class="token operator">:</span>options<span class="token operator">=</span>"<span class="token punctuation">&#123;</span>        <span class="token literal-property property">enableBasicAutocompletion</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">enableSnippets</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">enableLiveAutocompletion</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span>"    <span class="token operator">/</span><span class="token operator">></span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> VAceEditor <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'vue3-ace-editor'</span><span class="token keyword">import</span> <span class="token string">'ace-builds'</span><span class="token keyword">import</span> <span class="token string">'ace-builds/src-noconflict/mode-json'</span><span class="token keyword">import</span> <span class="token string">'ace-builds/src-noconflict/theme-chrome'</span><span class="token keyword">import</span> <span class="token string">'ace-builds/src-noconflict/snippets/json'</span><span class="token keyword">import</span> <span class="token string">'ace-builds/src-noconflict/ext-language_tools'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitåˆ é™¤æœ¬åœ°æ— ç”¨åˆ†æ”¯</title>
      <link href="/2023/07/12/git-shan-chu-ben-di-wu-yong-fen-zhi/"/>
      <url>/2023/07/12/git-shan-chu-ben-di-wu-yong-fen-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="å•ä¸ªåˆ é™¤"><a href="#å•ä¸ªåˆ é™¤" class="headerlink" title="å•ä¸ªåˆ é™¤"></a>å•ä¸ªåˆ é™¤</h2><ol><li>é¦–å…ˆæŸ¥çœ‹æ‰€æœ‰æœ¬åœ°åˆ†æ”¯çš„ä¿¡æ¯:</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch <span class="token parameter variable">-vv</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™ä¼šåˆ—å‡ºæ¯ä¸ªæœ¬åœ°åˆ†æ”¯,ä»¥åŠå®ƒä»¬è·Ÿè¸ªçš„è¿œç«¯åˆ†æ”¯ã€‚</p><ol start="2"><li>ç„¶åä½¿ç”¨grepè¿‡æ»¤å‡ºæ²¡æœ‰è·Ÿè¸ªè¿œç«¯åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯:</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> fetch <span class="token parameter variable">-p</span><span class="token function">git</span> branch <span class="token parameter variable">-vv</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'origin/.*: gone]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol start="3"><li>æœ€ååˆ é™¤è¿™äº›æœ¬åœ°åˆ†æ”¯:</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch <span class="token parameter variable">-d</span> <span class="token operator">&lt;</span>branch-name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ¯”å¦‚:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch <span class="token parameter variable">-d</span> local-branch<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·å°±å¯ä»¥æ‰¹é‡åˆ é™¤é‚£äº›æ²¡æœ‰è·Ÿè¸ªä»»ä½•è¿œç«¯åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯äº†ã€‚å¦å¤–,å¦‚æœæœ¬åœ°åˆ†æ”¯æ›¾è·Ÿè¸ªä¸€ä¸ªå·²ç»è¢«åˆ é™¤çš„è¿œç«¯åˆ†æ”¯,ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–¹æ³•å°†å…¶åˆ é™¤ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼å¯ä»¥å®šæœŸæ¸…ç†æœ¬åœ°æ— ç”¨çš„åˆ†æ”¯,ä¿æŒä»“åº“çš„æ•´æ´</p><h2 id="æ‰¹é‡åˆ é™¤"><a href="#æ‰¹é‡åˆ é™¤" class="headerlink" title="æ‰¹é‡åˆ é™¤"></a>æ‰¹é‡åˆ é™¤</h2><p>å¯¹äºè¿™ä¸ªéœ€æ±‚,æˆ‘ä»¬å¯ä»¥é€šè¿‡ bash çš„å¾ªç¯è¯­å¥æ¥å®ç°æ‰¹é‡åˆ é™¤:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> branch <span class="token parameter variable">-vv</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'origin/.*: gone]'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">git</span> branch <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è§£æ:</p><ol><li><p>git branch -vv åˆ—å‡ºæ‰€æœ‰åˆ†æ”¯è¯¦æƒ…</p></li><li><p>grep è¿‡æ»¤å‡º gone çš„ç»“æœ</p></li><li><p>awk æ‰“å°å‡ºç¬¬1åˆ—,ä¹Ÿå°±æ˜¯åˆ†æ”¯å</p></li><li><p>xargs å°†åˆ†æ”¯åä½œä¸ºå‚æ•°ä¼ ç»™ git branch -D å‘½ä»¤è¿™æ ·å°±å¯ä»¥è‡ªåŠ¨éå†æ‰€æœ‰æ— æ•ˆåˆ†æ”¯å¹¶æ‰¹é‡åˆ é™¤äº†ã€‚</p></li></ol><p>æˆ–è€…ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„ <strong>for å¾ªç¯</strong>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">branch</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">git</span> branch <span class="token parameter variable">-vv</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'origin/.*: gone]'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'&#123;print $1&#125;'</span><span class="token variable">)</span></span><span class="token punctuation">;</span> <span class="token keyword">do</span>  <span class="token function">git</span> branch <span class="token parameter variable">-D</span> <span class="token variable">$branch</span><span class="token keyword">done</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯,è¿™ä¼šæ— å·®åˆ«åˆ é™¤æ‰€æœ‰æ— è¿œç¨‹å…³è”çš„æœ¬åœ°åˆ†æ”¯,è¯·æŒ‰éœ€æ±‚è°¨æ…æ“ä½œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>piniaæºç å®ç°</title>
      <link href="/2023/07/11/pinia-yuan-ma-shi-xian/"/>
      <url>/2023/07/11/pinia-yuan-ma-shi-xian/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç åœ°å€ï¼š</p><ul><li><p><a href="https://github.com/ghx9908/pinia">https://github.com/ghx9908/pinia</a></p></li><li><p><a href="https://pinia.vuejs.org/">https://pinia.vuejs.org/</a></p></li><li><p><a href="https://github.com/vuejs/pinia">https://github.com/vuejs/pinia</a></p></li></ul><h2 id="ä¸€ã€Pinia-çš„ä¼˜åŠ¿"><a href="#ä¸€ã€Pinia-çš„ä¼˜åŠ¿" class="headerlink" title="ä¸€ã€Pinia çš„ä¼˜åŠ¿"></a>ä¸€ã€Pinia çš„ä¼˜åŠ¿</h2><ol><li>æ›´ç®€å•çš„ä½¿ç”¨æ–¹å¼,é€šè¿‡ç»„åˆå¼å‡½æ•°(compose APIs)è½»æ¾åˆ›å»º storeã€‚</li><li>æ¨¡å—åŒ– stores,æ¯ä¸ªé¡µé¢ä¸€ä¸ª store,ä¸éœ€è¦æ‰‹åŠ¨æ³¨å†Œå’Œæ³¨å…¥ã€‚</li><li>å»ä¸­å¿ƒåŒ–çŠ¶æ€ç®¡ç†,ç»„ä»¶å¯ä»¥ç›´æ¥å¼•ç”¨éœ€è¦çš„ storeã€‚</li><li><a href="https://chrome.google.com/webstore/detail/vuejs-devtools/nhdogjmejiglipccpnnnanhbledajbpd">æ”¯æŒ Vue devtools</a>è°ƒè¯•</li><li>çµæ´»çš„ store ç»“æ„,state å¯ä»¥æ˜¯å‡½æ•°æˆ–è€…å¯¹è±¡ã€‚</li><li>åŒæ­¥æˆ–å¼‚æ­¥çš„ actionsã€‚</li><li>æ— éœ€æ‰‹åŠ¨æ·»åŠ æ¨¡å—,store è‡ªåŠ¨æ‹†åˆ†æˆå¤šä¸ªæ¨¡å—ã€‚</li><li>å®Œæ•´çš„ TypeScript æ”¯æŒã€‚</li></ol><h2 id="äºŒã€Pinia-çš„åŸºæœ¬ä½¿ç”¨"><a href="#äºŒã€Pinia-çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="äºŒã€Pinia çš„åŸºæœ¬ä½¿ç”¨"></a>äºŒã€Pinia çš„åŸºæœ¬ä½¿ç”¨</h2><h3 id="1-å®‰è£…-Pinia"><a href="#1-å®‰è£…-Pinia" class="headerlink" title="1.å®‰è£… Pinia"></a>1.å®‰è£… Pinia</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> pinia<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-ä½¿ç”¨æ’ä»¶"><a href="#2-ä½¿ç”¨æ’ä»¶" class="headerlink" title="2.ä½¿ç”¨æ’ä»¶"></a>2.ä½¿ç”¨æ’ä»¶</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> createPinia <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"pinia"</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">"#app"</span><span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨æ’ä»¶ç®¡ç†æ‰€æœ‰çŠ¶æ€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-å®šä¹‰-store"><a href="#3-å®šä¹‰-store" class="headerlink" title="3.å®šä¹‰ store"></a>3.å®šä¹‰ store</h3><blockquote><p>stores/counter.js</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> defineStore <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"pinia"</span><span class="token keyword">export</span> <span class="token keyword">const</span> useCounterStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å®¹å™¨ä¸­çš„çŠ¶æ€</span>  <span class="token literal-property property">actions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>count<span class="token operator">++</span> <span class="token comment">// actionä¸­æ›´æ”¹çŠ¶æ€</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-ç»„ä»¶ä½¿ç”¨"><a href="#4-ç»„ä»¶ä½¿ç”¨" class="headerlink" title="4.ç»„ä»¶ä½¿ç”¨"></a>4.ç»„ä»¶ä½¿ç”¨</h3><pre class="line-numbers language-vue" data-language="vue"><code class="language-vue">&lt;template&gt;  &#123;&#123; store.count &#125;&#125;  &lt;button @click&#x3D;&quot;handleClick&quot;&gt;ä¿®æ”¹çŠ¶æ€&lt;&#x2F;button&gt;&lt;&#x2F;template&gt;&lt;script setup&gt;import &#123; useCounterStore &#125; from &quot;@&#x2F;stores&#x2F;counter&quot;const store &#x3D; useCounterStore()const handleClick &#x3D; () &#x3D;&gt; &#123;  store.increment()&#125;&lt;&#x2F;script&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸‰ã€ç°æ ¸å¿ƒ-Pinia"><a href="#ä¸‰ã€ç°æ ¸å¿ƒ-Pinia" class="headerlink" title="ä¸‰ã€ç°æ ¸å¿ƒ Pinia"></a>ä¸‰ã€ç°æ ¸å¿ƒ Pinia</h2><blockquote><p>pinia/index.js</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> createPinia <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./createPinia"</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> defineStore <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./store"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="1-å®ç°-createPinia"><a href="#1-å®ç°-createPinia" class="headerlink" title="1.å®ç° createPinia"></a>1.å®ç° createPinia</h3><blockquote><p>è¿™æ˜¯ Pinia çš„æ ¸å¿ƒå®ç°,åˆ›å»º pinia å®ä¾‹,æä¾›å…¨å±€çŠ¶æ€å®¹å™¨å’Œæ–¹æ³•,ç”¨äºåç»­åˆ›å»ºå’Œç®¡ç† stores,å®ç°æ•´ä¸ªçŠ¶æ€ç®¡ç†</p></blockquote><ol><li>åˆ›å»ºä¸€ä¸ª effect ä½œç”¨åŸŸ scope,ç”¨äºå­˜å‚¨å…¨å±€çŠ¶æ€ã€‚</li><li>åœ¨ scope å†…ä½¿ç”¨ ref åˆ›å»ºä¸€ä¸ªç©ºçš„å…±äº«çŠ¶æ€ stateã€‚</li><li>åˆ›å»º pinia å®ä¾‹,åŒ…å«å¤šä¸ªå±æ€§å’Œæ–¹æ³•ã€‚</li><li>install æ–¹æ³•åœ¨ app ä¸­æ³¨å†Œ pinia,æä¾›å…¨å±€å®ä¾‹,å¹¶è®¾ç½®å½“å‰æ¿€æ´»çš„å®ä¾‹ã€‚</li><li>state ä¸ºå…¨å±€å…±äº«çš„ç©ºçŠ¶æ€ã€‚</li><li>use æ–¹æ³•ç”¨äºä½¿ç”¨æ’ä»¶ã€‚</li><li>_p å­˜å‚¨ä½¿ç”¨çš„æ’ä»¶åˆ—è¡¨ã€‚</li><li>_a å­˜å‚¨å½“å‰çš„åº”ç”¨å®ä¾‹ã€‚</li><li>_e å­˜å‚¨å…±äº«çš„ effect ä½œç”¨åŸŸã€‚</li><li>_s å­˜å‚¨æ³¨å†Œçš„ storesã€‚</li><li>é€šè¿‡ createPinia åˆ›å»ºå‡º pinia å®ä¾‹,å¹¶åœ¨ app ä¸­æ³¨å†Œä½¿ç”¨ã€‚</li><li>åç»­é€šè¿‡ defineStore æ³¨å†Œ store æ—¶ä¼šå¾€ state ä¸­æ·»åŠ æ•°æ®ã€‚</li><li>é€šè¿‡ provide/inject æ–¹å¼åœ¨å…¨å±€æä¾› pinia å®ä¾‹ã€‚</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> ref<span class="token punctuation">,</span> effectScope <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">export</span> <span class="token keyword">const</span> piniaSymbol <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">let</span> activePinia<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">setActivePinia</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">pinia</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>activePinia <span class="token operator">=</span> pinia<span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> scope <span class="token operator">=</span> <span class="token function">effectScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ç¨ådefineStoreçš„æ—¶å€™ å°±ä¼šåœ¨è¿™é‡Œå¢åŠ çŠ¶æ€</span>  <span class="token keyword">const</span> state <span class="token operator">=</span> scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> _p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      pinia<span class="token punctuation">.</span>_a <span class="token operator">=</span> app <span class="token comment">// å½“å‰åº”ç”¨</span>      <span class="token function">setActivePinia</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®æ¿€æ´»pinia</span>      <span class="token comment">// 1.åœ¨å½“å‰åº”ç”¨ä¸­æš´éœ²piniaå®ä¾‹</span>      app<span class="token punctuation">.</span><span class="token function">provide</span><span class="token punctuation">(</span>piniaSymbol<span class="token punctuation">,</span> pinia<span class="token punctuation">)</span>      <span class="token comment">// 2.optionsAPIå¯ä»¥é€šè¿‡thisè®¿é—®åˆ°å®ä¾‹</span>      app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>globalProperties<span class="token punctuation">.</span>$pinia <span class="token operator">=</span> pinia    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    state<span class="token punctuation">,</span>    <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//  ä½¿ç”¨æ’ä»¶</span>      _p<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token comment">//å¯ä»¥é“¾å¼è°ƒç”¨</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    _p<span class="token punctuation">,</span> <span class="token comment">//è®°å½•ä½¿ç”¨çš„æ’ä»¶</span>    <span class="token literal-property property">_a</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">//è®°å½•å½“å‰çš„app</span>    <span class="token literal-property property">_e</span><span class="token operator">:</span> scope<span class="token punctuation">,</span> <span class="token comment">// å½“å‰ä½œç”¨åŸŸ</span>    <span class="token literal-property property">_s</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// è®°å½•æœ‰å“ªäº›storeçš„</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> pinia<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-å®ç°-defineStore"><a href="#2-å®ç°-defineStore" class="headerlink" title="2.å®ç° defineStore"></a>2.å®ç° defineStore</h3><blockquote><p>defineStore æ˜¯ Pinia çš„æ ¸å¿ƒæ–¹æ³•ï¼Œç”¨æ¥å®šä¹‰ä¸€ä¸ªæ–°çš„ store å¹¶è¿”å›è·å–è¯¥ store çš„å‡½æ•°ã€‚å®ƒä¼šåœ¨ pinia ä¸­æ³¨å†Œè¯¥ storeï¼Œå¹¶ç®¡ç† store çš„åˆ›å»ºã€‚è°ƒç”¨ defineStore å¾—åˆ°çš„ useStore å‡½æ•°å¯ä»¥ç”¨æ¥åœ¨ç»„ä»¶ä¸­è·å–å¹¶ä½¿ç”¨è¯¥ storeã€‚</p><p>è¿™æ ·å®ç°äº†å­˜å‚¨çš„æ¨¡å—åŒ–æ³¨å†Œ,ä»¥åŠé€šè¿‡ useStore ç»„åˆå¼è·å– store å®ä¾‹ã€‚æ˜¯ Pinia çŠ¶æ€ç®¡ç†çš„å…³é”®ã€‚</p></blockquote><ol><li>ä»å‚æ•°ä¸­æå– store çš„ id å’Œ optionsã€‚</li><li>å®šä¹‰ useStore å‡½æ•°,ç”¨äºè·å– store å®ä¾‹ã€‚</li><li>åœ¨ useStore ä¸­,é€šè¿‡ pinia å®ä¾‹è·å– storeã€‚</li><li>å¦‚æœ store æœªåˆ›å»º,ä¼šæ ¹æ®ä¼ å…¥çš„ setup æˆ– options åˆ›å»ºæ–°çš„ storeã€‚</li><li>createSetupStore å’Œ createOptionsStore åˆ†åˆ«å¤„ç† setup store å’Œ options storeã€‚</li><li>åˆ›å»ºå¥½çš„ store ä¼šå­˜å…¥ pinia._s ä¸­ã€‚</li><li>useStore å‡½æ•°è¿”å›å·²ç»åˆ›å»ºçš„ store å®ä¾‹ã€‚</li><li>ç»™ useStore æ·»åŠ  $id å±æ€§,ç»‘å®š store idã€‚</li><li>defineStore è¿”å› useStore å‡½æ•°ã€‚</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token parameter">idOrOptions<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> setupOptions <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// idä»å­—ç¬¦ä¸²æˆ–é…ç½®å¯¹è±¡ä¸­æå–</span>  <span class="token keyword">let</span> id  <span class="token keyword">let</span> options  <span class="token keyword">const</span> isSetupStore <span class="token operator">=</span> <span class="token keyword">typeof</span> setup <span class="token operator">===</span> <span class="token string">"function"</span>  <span class="token comment">// æ ¹æ®æƒ…å†µåˆ†åˆ«è®¾ç½®idå’Œoptions</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> idOrOptions <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    id <span class="token operator">=</span> idOrOptions    options <span class="token operator">=</span> isSetupStore <span class="token operator">?</span> setupOptions <span class="token operator">:</span> setup  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    options <span class="token operator">=</span> idOrOptions    id <span class="token operator">=</span> idOrOptions<span class="token punctuation">.</span>id  <span class="token punctuation">&#125;</span>  <span class="token comment">// å®šä¹‰useStoreå‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨piniaä¸Šä¸‹æ–‡ç¯å¢ƒ</span>    <span class="token keyword">const</span> hasContext <span class="token operator">=</span> <span class="token function">hasInjectionContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ä»contextä¸­è¯»å– pinia å®ä¾‹</span>    <span class="token comment">// åªèƒ½åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span>    <span class="token keyword">let</span> pinia <span class="token operator">=</span> hasContext <span class="token operator">&amp;&amp;</span> <span class="token function">inject</span><span class="token punctuation">(</span>piniaSymbol<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pinia<span class="token punctuation">)</span> <span class="token function">setActivePinia</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span>    pinia <span class="token operator">=</span> activePinia    <span class="token comment">// å¦‚æœè¯¥storeå°šæœªåˆ›å»º</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ ¹æ®æƒ…å†µåˆ›å»ºstore,å­˜å‚¨åˆ°_sä¸­</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>isSetupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">createSetupStore</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºsetupStore</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">createOptionsStore</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºé€‰é¡¹store</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å–å‡ºå·²åˆ›å»ºçš„storeè¿”å›</span>    <span class="token keyword">const</span> store <span class="token operator">=</span> pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>    <span class="token keyword">return</span> store  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç»™å‡½æ•°ç»‘å®šstoreçš„id</span>  useStore<span class="token punctuation">.</span>$id <span class="token operator">=</span> id  <span class="token comment">// è¿”å›useStoreå‡½æ•°</span>  <span class="token keyword">return</span> useStore<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-åˆ›å»º-setupStore"><a href="#3-åˆ›å»º-setupStore" class="headerlink" title="3.åˆ›å»º setupStore"></a>3.åˆ›å»º setupStore</h3><blockquote><p>è¿™æ ·é€šè¿‡ effect ä½œç”¨åŸŸå’Œ reactive,å®ç°äº† setup è¯­æ³•çš„ Pinia store å®šä¹‰æ–¹å¼,åŒæ—¶æ·»åŠ äº† actions æ”¯æŒã€‚<br>å¹¶é€šè¿‡ pinia ç®¡ç†æ‰€æœ‰çš„ storesã€‚è¿™æ˜¯ Pinia ä¸­å®ç°ç»„ä»¶åŒ–çŠ¶æ€ç®¡ç†çš„æ ¸å¿ƒæœºåˆ¶ã€‚</p></blockquote><ol><li>åˆ›å»ºä¸€ä¸ªæ–°çš„ effect ä½œç”¨åŸŸ scope,ç”¨äºéš”ç¦»è¿™ä¸ª store çš„çŠ¶æ€ã€‚</li><li>å®šä¹‰ä¸€ä¸ª wrapAction æ–¹æ³•,ç”¨äºåŒ…è£… actions å‡½æ•°,æ”¹å˜ this æŒ‡å‘ store æœ¬èº«ã€‚</li><li>åˆ›å»ºä¸€ä¸ª partialStore å¯¹è±¡,åŒ…å« pinia å®ä¾‹å’Œ id ä¿¡æ¯ã€‚</li><li>ä½¿ç”¨ reactive å°† partialStore è½¬æ¢æˆå“åº”å¼ã€‚</li><li>åœ¨ pinia._e ä½œç”¨åŸŸå†…è¿è¡Œ setup å‡½æ•°,è¿”å›åˆå§‹åŒ–çš„çŠ¶æ€ã€‚</li><li>ä½¿ç”¨ for å¾ªç¯éå† setupStore,å¦‚æœæ˜¯å‡½æ•°å°±ç”¨ wrapAction åŒ…è£…æˆ actionã€‚</li><li>ä½¿ç”¨ Object.assign å°† setupStore åˆå¹¶åˆ° store ä¸­ã€‚</li><li>å°†å®šä¹‰å¥½çš„ store ä¿å­˜åˆ° pinia çš„ store å®¹å™¨ pinia._s ä¸­ã€‚</li><li>è¿”å›åˆ›å»ºå¥½çš„ store å®ä¾‹ã€‚</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createSetupStore</span><span class="token punctuation">(</span><span class="token parameter">$id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> scope  <span class="token keyword">if</span> <span class="token punctuation">(</span>isSetupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//å¤„ç†action ä¿®æ”¹thisæŒ‡å‘</span>  <span class="token keyword">function</span> <span class="token function">wrapAction</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// action</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token comment">// è®©thisæŒ‡å‘store</span>      <span class="token keyword">return</span> ret    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> partialStore <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">_p</span><span class="token operator">:</span> pinia<span class="token punctuation">,</span>    $id<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>partialStore<span class="token punctuation">)</span>  <span class="token keyword">const</span> setupStore <span class="token operator">=</span> pinia<span class="token punctuation">.</span>_e<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    scope <span class="token operator">=</span> <span class="token function">effectScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// éœ€è¦å¼€è¾Ÿä¸€ä¸ªç©ºé—´ï¼Œæ¥ç®¡ç†æ­¤storeä¸­çš„æ•°æ®</span>    <span class="token keyword">return</span> scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è¿™ä¸ªsetupæ–¹æ³•å°±æ˜¯ç”¨æ¥åˆå§‹åŒ–storeä¸­çš„çŠ¶æ€çš„</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">//overwrite existing actions to support $onAction</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> setupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> prop <span class="token operator">=</span> setupStore<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token comment">// pinia.state.value[$id] æå–state</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isComputed</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isReactive</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>isSetupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> prop      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prop <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¯¹actionè¿›è¡Œä¸€æ¬¡åŒ…è£…</span>      setupStore<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">wrapAction</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> setupStore<span class="token punctuation">)</span> <span class="token comment">// åˆå¹¶é€‰é¡¹</span>  pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>$id<span class="token punctuation">,</span> store<span class="token punctuation">)</span> <span class="token comment">// æ”¾å…¥åˆ°å®¹å™¨ä¸­</span>  <span class="token keyword">return</span> store<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-åˆ›å»º-optionsStore"><a href="#4-åˆ›å»º-optionsStore" class="headerlink" title="4.åˆ›å»º optionsStore"></a>4.åˆ›å»º optionsStore</h3><ol><li>æŒ‰ç…§ä¼ ç»Ÿçš„ options æ–¹å¼å®šä¹‰çŠ¶æ€ã€getterã€actionã€‚</li><li>åœ¨ setup ä¸­åˆå¹¶ä¸åŒé€‰é¡¹åˆ°ä¸€èµ·ã€‚</li><li>é€šè¿‡ createSetupStore æœ€ç»ˆåˆ›å»º storeã€‚</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createOptionsStore</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> store  <span class="token comment">//1. ä» options ä¸­è§£æ„å‡º stateã€gettersã€actionsã€‚</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> getters <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> actions <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> options  <span class="token comment">//2. å®šä¹‰ setup å‡½æ•°,ç”¨äºåˆå§‹åŒ– storeã€‚</span>  <span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//3. æŠŠçŠ¶æ€ state ä¿å­˜åˆ° pinia çš„å…±äº«çŠ¶æ€ä¸­ã€‚</span>    pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> state <span class="token operator">?</span> <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//4. ä½¿ç”¨ toRefs å°†stateå˜æˆå“åº”å¼</span>    <span class="token keyword">const</span> localState <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// 5. stateã€actionsã€getters åˆå¹¶åˆ°ä¸€èµ·è¿”å›ã€‚</span>    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>      localState<span class="token punctuation">,</span>      actions<span class="token punctuation">,</span>      <span class="token comment">//6. getters é€šè¿‡ computed è½¬æ¢æˆè®¡ç®—å±æ€§è®¿é—®ã€‚</span>      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>getters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">gettersObj<span class="token punctuation">,</span> getterName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        gettersObj<span class="token punctuation">[</span>getterName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> getters<span class="token punctuation">[</span>getterName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> gettersObj      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// 7. ä½¿ç”¨ createSetupStore åˆ›å»º store,ä¼ å…¥ setupã€‚</span>  store <span class="token operator">=</span> <span class="token function">createSetupStore</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore<span class="token punctuation">)</span>  <span class="token comment">//8. è¿”å›åˆ›å»ºçš„ storeã€‚</span>  <span class="token keyword">return</span> store<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››ã€æ ¸å¿ƒæ–¹æ³•å’Œå±æ€§"><a href="#å››ã€æ ¸å¿ƒæ–¹æ³•å’Œå±æ€§" class="headerlink" title="å››ã€æ ¸å¿ƒæ–¹æ³•å’Œå±æ€§"></a>å››ã€æ ¸å¿ƒæ–¹æ³•å’Œå±æ€§</h2><ul><li><code>$patch</code>:ä½¿ç”¨$patch æ–¹æ³•åŒæ—¶åº”ç”¨å¤šä¸ªä¿®æ”¹</li><li><code>$reset</code>: ä½¿ç”¨$reset() æ–¹æ³•å°† state é‡ç½®ä¸ºåˆå§‹å€¼</li><li><code>$subscribe</code>: é€šè¿‡ store çš„ $subscribe() æ–¹æ³•ä¾¦å¬ state åŠå…¶å˜åŒ–</li><li><code>$onActions</code>: é€šè¿‡ store.$onAction() æ¥ç›‘å¬ action å’Œå®ƒä»¬çš„ç»“æœ</li><li><code>$dispose</code>: åœæ­¢å“åº”</li><li><code>$state</code>: æ›¿æ¢ stateï¼Œé€šè¿‡å˜æ›´ pinia å®ä¾‹çš„ state æ¥è®¾ç½®æ•´ä¸ªåº”ç”¨çš„åˆå§‹ state</li></ul><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff"><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const partialStore = &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   _p: pinia,</span><span class="token prefix unchanged"> </span><span class="token line">   // _s: scope,</span><span class="token prefix unchanged"> </span><span class="token line">   $id,</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   $reset,</span><span class="token prefix inserted">+</span><span class="token line">   $patch,</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    $subscribe(callback, options = &#123;&#125;) &#123;</span><span class="token prefix inserted">+</span><span class="token line">      scope.run(() =></span><span class="token prefix inserted">+</span><span class="token line">        watch(</span><span class="token prefix inserted">+</span><span class="token line">          pinia.state.value[$id],</span><span class="token prefix inserted">+</span><span class="token line">         (state) => &#123;</span><span class="token prefix inserted">+</span><span class="token line">            callback(&#123; storeId: $id &#125;, state)</span><span class="token prefix inserted">+</span><span class="token line">          &#125;,</span><span class="token prefix inserted">+</span><span class="token line">          options</span><span class="token prefix inserted">+</span><span class="token line">        )</span><span class="token prefix inserted">+</span><span class="token line">      )</span><span class="token prefix inserted">+</span><span class="token line">    &#125;,</span><span class="token prefix inserted">+</span><span class="token line">    $onAction: addSubscription.bind(null, actionSubscriptions), // ç»‘å®šaction</span><span class="token prefix inserted">+</span><span class="token line">    $dispose() &#123;</span><span class="token prefix inserted">+</span><span class="token line">      scope.stop() // åœç”¨store</span><span class="token prefix inserted">+</span><span class="token line">      actionSubscriptions = []</span><span class="token prefix inserted">+</span><span class="token line">      pinia._s.delete($id)</span><span class="token prefix inserted">+</span><span class="token line">    &#125;,</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-patch"><a href="#1-patch" class="headerlink" title="1. $patch"></a>1. $patch</h3><blockquote><p>ä½¿ç”¨$patch æ–¹æ³•åŒæ—¶åº”ç”¨å¤šä¸ªä¿®æ”¹</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useCounterStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  store<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><blockquote><p>$patch å‡½æ•°åˆ©ç”¨è¿™ä¸ªå®ç°äº†å¯¹ pinia çŠ¶æ€çš„éƒ¨åˆ†æ›´æ–°ã€‚</p></blockquote><ol><li>å¦‚æœæ˜¯å‡½æ•°,ä¼ å…¥çŠ¶æ€æ‰§è¡Œã€‚</li><li>å¦‚æœæ˜¯å¯¹è±¡,è°ƒç”¨ mergeReactiveObjects åˆå¹¶ã€‚</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">$patch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">$patch</span><span class="token punctuation">(</span><span class="token parameter">partialStateOrMutator</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> partialStateOrMutator <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">partialStateOrMutator</span><span class="token punctuation">(</span>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">mergeReactiveObjects</span><span class="token punctuation">(</span>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">,</span> partialStateOrMutator<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>mergeReactiveObjects å‡½æ•°</strong></p><ol><li>å¦‚æœ target å’Œ patch éƒ½æ˜¯ Map,åˆ™ç”¨ patch çš„é”®å€¼æ›´æ–° targetã€‚</li><li>å¦‚æœ target å’Œ patch éƒ½æ˜¯ Set,åˆ™ç”¨ patch çš„å€¼æ‰©å±• targetã€‚</li><li>éå† patch çš„é”®å€¼ã€‚</li><li>å¦‚æœé”®å­˜åœ¨äº target,ä¸”éƒ½æ˜¯æ™®é€šå¯¹è±¡,è°ƒç”¨è‡ªèº«é€’å½’åˆå¹¶ã€‚</li><li>å¦åˆ™ç›´æ¥ç”¨ patch çš„é”®å€¼è¦†ç›– targetã€‚</li><li>è¿”å›åˆå¹¶åçš„ targetã€‚</li></ol><p>è¿™æ ·å¯ä»¥æ·±å±‚åˆå¹¶ä¸¤ä¸ªå“åº”å¼å¯¹è±¡,å¹¶ä¿æŒå“åº”æ€§ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    o <span class="token operator">&amp;&amp;</span>    <span class="token keyword">typeof</span> o <span class="token operator">===</span> <span class="token string">"object"</span> <span class="token operator">&amp;&amp;</span>    <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"[object Object]"</span> <span class="token operator">&amp;&amp;</span>    <span class="token keyword">typeof</span> o<span class="token punctuation">.</span>toJSON <span class="token operator">!==</span> <span class="token string">"function"</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mergeReactiveObjects</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> patchToApply</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// Handle Map instances</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">Map</span> <span class="token operator">&amp;&amp;</span> patchToApply <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    patchToApply<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> target<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// Handle Set instances</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">Set</span> <span class="token operator">&amp;&amp;</span> patchToApply <span class="token keyword">instanceof</span> <span class="token class-name">Set</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    patchToApply<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>add<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// no need to go through symbols because they cannot be serialized anyway</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> patchToApply<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>patchToApply<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>    <span class="token keyword">const</span> subPatch <span class="token operator">=</span> patchToApply<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">const</span> targetValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      <span class="token function">isPlainObject</span><span class="token punctuation">(</span>targetValue<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token function">isPlainObject</span><span class="token punctuation">(</span>subPatch<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      target<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token operator">!</span><span class="token function">isRef</span><span class="token punctuation">(</span>subPatch<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token operator">!</span><span class="token function">isReactive</span><span class="token punctuation">(</span>subPatch<span class="token punctuation">)</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mergeReactiveObjects</span><span class="token punctuation">(</span>targetValue<span class="token punctuation">,</span> subPatch<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> subPatch    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> target<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-reset"><a href="#2-reset" class="headerlink" title="2. $reset"></a>2. $reset</h3><blockquote><p>ä½¿ç”¨$reset() æ–¹æ³•å°† state é‡ç½®ä¸ºåˆå§‹å€¼</p><p>æ­¤æ–¹æ³•åªèƒ½åœ¨é setup è¯­æ³•ä¸­ä½¿ç”¨</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  store<span class="token punctuation">.</span><span class="token function">$reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ­¤æ–¹æ³•åªèƒ½åœ¨ésetupè¯­æ³•ä¸­ä½¿ç”¨</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> $reset <span class="token operator">=</span> <span class="token operator">!</span>isSetupStore  <span class="token operator">?</span> <span class="token keyword">function</span> <span class="token function">$reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state <span class="token punctuation">&#125;</span> <span class="token operator">=</span> options      <span class="token keyword">const</span> newState <span class="token operator">=</span> state <span class="token operator">?</span> <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>      <span class="token comment">// we use a patch to group all changes into one single subscription</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>$state<span class="token punctuation">,</span> newState<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>        <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ğŸ: Store "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>$id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" is built using the setup syntax and does not implement $reset().</span><span class="token template-punctuation string">`</span></span>      <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-subscribe"><a href="#3-subscribe" class="headerlink" title="3. $subscribe"></a>3. $subscribe</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">store<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> storeId <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>storeId<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>ç›‘å¬çŠ¶æ€å˜åŒ–ï¼ŒçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ä¼šæ‰§è¡Œè®¢é˜…çš„å‡½æ•°</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> partialStore <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  $patch<span class="token punctuation">,</span>  <span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>      <span class="token function">watch</span><span class="token punctuation">(</span>        pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">storeId</span><span class="token operator">:</span> $id <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        options      <span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-dispose"><a href="#4-dispose" class="headerlink" title="4. $dispose"></a>4. $dispose</h3><blockquote><p>åœæ­¢å“åº”</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> partialStore <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  $patch<span class="token punctuation">,</span>  <span class="token function">$dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    scope<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åœç”¨store</span>    actionSubscriptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>$id<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-state"><a href="#5-state" class="headerlink" title="5.$state"></a>5.$state</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> <span class="token string">"$state"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>$state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-onActions"><a href="#6-onActions" class="headerlink" title="6. $onActions"></a>6. $onActions</h3><blockquote><p>é€šè¿‡ store.$onAction() æ¥ç›‘å¬ action å’Œå®ƒä»¬çš„ç»“æœ</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">handleClick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  store<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>store<span class="token punctuation">.</span><span class="token function">$onAction</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>after<span class="token punctuation">,</span>onError<span class="token punctuation">,</span>name<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'action running~~~'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span> <span class="token comment">// actionæ‰§è¡Œå®Œæ¯•åè§¦å‘</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>  <span class="token comment">// actionå‡ºé”™æ—¶è°ƒç”¨</span>    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span>err<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç° ï¼šæ ¸å¿ƒå‘å¸ƒè®¢é˜…</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createSetupStore</span><span class="token punctuation">(</span><span class="token parameter">$id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> actionSubscriptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token comment">//å¤„ç†action ä¿®æ”¹thisæŒ‡å‘</span>  <span class="token keyword">function</span> <span class="token function">wrapAction</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// increment,action</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> afterCallbackList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// afterList</span>      <span class="token keyword">const</span> onErrorCallbackList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// errList</span>      <span class="token keyword">function</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        afterCallbackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">function</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        onErrorCallbackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>actionSubscriptions<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> store<span class="token punctuation">,</span> after<span class="token punctuation">,</span> onError <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> ret      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        ret <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token comment">// è®©thisæŒ‡å‘store</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>onErrorCallbackList<span class="token punctuation">,</span> error<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è¿”å›å€¼æ˜¯promise</span>        <span class="token keyword">return</span> ret          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>afterCallbackList<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">return</span> value <span class="token comment">// æˆåŠŸåè§¦å‘after</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¤±è´¥åˆ™è§¦å‘error</span>            <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>onErrorCallbackList<span class="token punctuation">,</span> error<span class="token punctuation">)</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> ret    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>     <span class="token keyword">const</span> partialStore <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">_p</span><span class="token operator">:</span> pinia<span class="token punctuation">,</span>    $reset<span class="token punctuation">,</span>    $patch<span class="token punctuation">,</span>    <span class="token literal-property property">$onAction</span><span class="token operator">:</span> <span class="token function">addSubscription</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> actionSubscriptions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ç»‘å®šaction</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å‘å¸ƒè®¢é˜…</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">addSubscription</span><span class="token punctuation">(</span><span class="token parameter">subscriptions<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ·»åŠ è®¢é˜…</span>  subscriptions<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token function-variable function">removeSubcription</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> idx <span class="token operator">=</span> subscriptions<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>idx <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      subscriptions<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> removeSubcription<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span><span class="token parameter">subscriptions<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è§¦å‘è®¢é˜…</span>  subscriptions<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a><strong>å®Œæ•´ä»£ç </strong></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>  inject<span class="token punctuation">,</span>  hasInjectionContext<span class="token punctuation">,</span>  effectScope<span class="token punctuation">,</span>  toRefs<span class="token punctuation">,</span>  computed<span class="token punctuation">,</span>  isRef<span class="token punctuation">,</span>  reactive<span class="token punctuation">,</span>  isReactive<span class="token punctuation">,</span>  watch<span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> piniaSymbol <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./rootStore"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> addSubscription<span class="token punctuation">,</span> triggerSubscriptions <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./subscriptions"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> setActivePinia<span class="token punctuation">,</span> activePinia <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./createPinia"</span><span class="token keyword">function</span> <span class="token function">isComputed</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> o<span class="token punctuation">.</span>effect<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    o <span class="token operator">&amp;&amp;</span>    <span class="token keyword">typeof</span> o <span class="token operator">===</span> <span class="token string">"object"</span> <span class="token operator">&amp;&amp;</span>    <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"[object Object]"</span> <span class="token operator">&amp;&amp;</span>    <span class="token keyword">typeof</span> o<span class="token punctuation">.</span>toJSON <span class="token operator">!==</span> <span class="token string">"function"</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mergeReactiveObjects</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> patchToApply</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// Handle Map instances</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">Map</span> <span class="token operator">&amp;&amp;</span> patchToApply <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    patchToApply<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> target<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// Handle Set instances</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>target <span class="token keyword">instanceof</span> <span class="token class-name">Set</span> <span class="token operator">&amp;&amp;</span> patchToApply <span class="token keyword">instanceof</span> <span class="token class-name">Set</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    patchToApply<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>add<span class="token punctuation">,</span> target<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// no need to go through symbols because they cannot be serialized anyway</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> patchToApply<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>patchToApply<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>    <span class="token keyword">const</span> subPatch <span class="token operator">=</span> patchToApply<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">const</span> targetValue <span class="token operator">=</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      <span class="token function">isPlainObject</span><span class="token punctuation">(</span>targetValue<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token function">isPlainObject</span><span class="token punctuation">(</span>subPatch<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      target<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token operator">!</span><span class="token function">isRef</span><span class="token punctuation">(</span>subPatch<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token operator">!</span><span class="token function">isReactive</span><span class="token punctuation">(</span>subPatch<span class="token punctuation">)</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">mergeReactiveObjects</span><span class="token punctuation">(</span>targetValue<span class="token punctuation">,</span> subPatch<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> subPatch    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> target<span class="token punctuation">&#125;</span><span class="token comment">// id + options</span><span class="token comment">// options =&#123;id:''&#125;</span><span class="token comment">// id + setup</span><span class="token comment">// å®šä¹‰ä¸€ä¸ª store å¹¶å¯¼å‡º useStore å‡½æ•°</span><span class="token comment">// useStore å‡½æ•°çš„ä½œç”¨æ˜¯:</span><span class="token comment">// - çœ‹æ˜¯å¦æœ‰piniaå®ä¾‹</span><span class="token comment">// - å¦‚æœè¯¥storeå°šæœªåˆ›å»º,åˆ™åˆ›å»º</span><span class="token comment">// - å–å‡ºå·²åˆ›å»ºçš„storeè¿”å›</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token parameter">idOrOptions<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> setupOptions <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// idä»å­—ç¬¦ä¸²æˆ–é…ç½®å¯¹è±¡ä¸­æå–</span>  <span class="token keyword">let</span> id  <span class="token keyword">let</span> options  <span class="token keyword">const</span> isSetupStore <span class="token operator">=</span> <span class="token keyword">typeof</span> setup <span class="token operator">===</span> <span class="token string">"function"</span>  <span class="token comment">// æ ¹æ®æƒ…å†µåˆ†åˆ«è®¾ç½®idå’Œoptions</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> idOrOptions <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    id <span class="token operator">=</span> idOrOptions    options <span class="token operator">=</span> isSetupStore <span class="token operator">?</span> setupOptions <span class="token operator">:</span> setup  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    options <span class="token operator">=</span> idOrOptions    id <span class="token operator">=</span> idOrOptions<span class="token punctuation">.</span>id  <span class="token punctuation">&#125;</span>  <span class="token comment">// å®šä¹‰useStoreå‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ¤æ–­æ˜¯å¦å­˜åœ¨piniaä¸Šä¸‹æ–‡ç¯å¢ƒ</span>    <span class="token keyword">const</span> hasContext <span class="token operator">=</span> <span class="token function">hasInjectionContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// ä»contextä¸­è¯»å– pinia å®ä¾‹</span>    <span class="token comment">// åªèƒ½åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span>    <span class="token keyword">let</span> pinia <span class="token operator">=</span> hasContext <span class="token operator">&amp;&amp;</span> <span class="token function">inject</span><span class="token punctuation">(</span>piniaSymbol<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>pinia<span class="token punctuation">)</span> <span class="token function">setActivePinia</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span>    pinia <span class="token operator">=</span> activePinia    <span class="token comment">// å¦‚æœè¯¥storeå°šæœªåˆ›å»º</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ ¹æ®æƒ…å†µåˆ›å»ºstore,å­˜å‚¨åˆ°_sä¸­</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>isSetupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">createSetupStore</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºsetupStore</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">createOptionsStore</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºé€‰é¡¹store</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å–å‡ºå·²åˆ›å»ºçš„storeè¿”å›</span>    <span class="token keyword">const</span> store <span class="token operator">=</span> pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>    <span class="token keyword">return</span> store  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç»™å‡½æ•°ç»‘å®šstoreçš„id</span>  useStore<span class="token punctuation">.</span>$id <span class="token operator">=</span> id  <span class="token comment">// è¿”å›useStoreå‡½æ•°</span>  <span class="token keyword">return</span> useStore<span class="token punctuation">&#125;</span><span class="token comment">// optionsapi</span><span class="token keyword">function</span> <span class="token function">createOptionsStore</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> store  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state<span class="token punctuation">,</span> getters <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> actions <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span> <span class="token operator">=</span> options  <span class="token keyword">function</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ ¹æ®ç”¨æˆ·çš„çŠ¶æ€å°†å…¶ä¿å­˜åˆ°piniaä¸­</span>    pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> state <span class="token operator">?</span> <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> localState <span class="token operator">=</span> <span class="token function">toRefs</span><span class="token punctuation">(</span>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>      localState<span class="token punctuation">,</span>      actions<span class="token punctuation">,</span>      Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>getters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">gettersObj<span class="token punctuation">,</span> getterName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        gettersObj<span class="token punctuation">[</span>getterName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> getters<span class="token punctuation">[</span>getterName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> gettersObj      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  store <span class="token operator">=</span> <span class="token function">createSetupStore</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore<span class="token punctuation">)</span>  <span class="token keyword">return</span> store<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">createSetupStore</span><span class="token punctuation">(</span><span class="token parameter">$id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> scope  <span class="token keyword">let</span> actionSubscriptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>isSetupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//å¤„ç†action ä¿®æ”¹thisæŒ‡å‘</span>  <span class="token keyword">function</span> <span class="token function">wrapAction</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// increment,action</span>    <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> afterCallbackList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// afterList</span>      <span class="token keyword">const</span> onErrorCallbackList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// errList</span>      <span class="token keyword">function</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        afterCallbackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">function</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        onErrorCallbackList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>actionSubscriptions<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> name<span class="token punctuation">,</span> store<span class="token punctuation">,</span> after<span class="token punctuation">,</span> onError <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> ret      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        ret <span class="token operator">=</span> <span class="token function">action</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span> <span class="token comment">// è®©thisæŒ‡å‘store</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>onErrorCallbackList<span class="token punctuation">,</span> error<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token keyword">instanceof</span> <span class="token class-name">Promise</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è¿”å›å€¼æ˜¯promise</span>        <span class="token keyword">return</span> ret          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>afterCallbackList<span class="token punctuation">,</span> value<span class="token punctuation">)</span>            <span class="token keyword">return</span> value <span class="token comment">// æˆåŠŸåè§¦å‘after</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token comment">// å¤±è´¥åˆ™è§¦å‘error</span>            <span class="token function">triggerSubscriptions</span><span class="token punctuation">(</span>onErrorCallbackList<span class="token punctuation">,</span> error<span class="token punctuation">)</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> ret    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> <span class="token function-variable function">$patch</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">$patch</span><span class="token punctuation">(</span><span class="token parameter">partialStateOrMutator</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> partialStateOrMutator <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">partialStateOrMutator</span><span class="token punctuation">(</span>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token function">mergeReactiveObjects</span><span class="token punctuation">(</span>pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">,</span> partialStateOrMutator<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> $reset <span class="token operator">=</span> <span class="token operator">!</span>isSetupStore    <span class="token operator">?</span> <span class="token keyword">function</span> <span class="token function">$reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> state <span class="token punctuation">&#125;</span> <span class="token operator">=</span> options        <span class="token keyword">const</span> newState <span class="token operator">=</span> state <span class="token operator">?</span> <span class="token function">state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"newState=>"</span><span class="token punctuation">,</span> newState<span class="token punctuation">)</span>        <span class="token comment">// we use a patch to group all changes into one single subscription</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>$state<span class="token punctuation">,</span> newState<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ğŸ: Store "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>$id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" is built using the setup syntax and does not implement $reset().</span><span class="token template-punctuation string">`</span></span>        <span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> partialStore <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">_p</span><span class="token operator">:</span> pinia<span class="token punctuation">,</span>    <span class="token comment">// _s: scope,</span>    $id<span class="token punctuation">,</span>    $reset<span class="token punctuation">,</span>    $patch<span class="token punctuation">,</span>    <span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>        <span class="token function">watch</span><span class="token punctuation">(</span>          pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">storeId</span><span class="token operator">:</span> $id <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> state<span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          options        <span class="token punctuation">)</span>      <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">$onAction</span><span class="token operator">:</span> <span class="token function">addSubscription</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> actionSubscriptions<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ç»‘å®šaction</span>    <span class="token function">$dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      scope<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åœç”¨store</span>      actionSubscriptions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>$id<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> store <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>partialStore<span class="token punctuation">)</span>  <span class="token keyword">const</span> setupStore <span class="token operator">=</span> pinia<span class="token punctuation">.</span>_e<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    scope <span class="token operator">=</span> <span class="token function">effectScope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// éœ€è¦å¼€è¾Ÿä¸€ä¸ªç©ºé—´ï¼Œæ¥ç®¡ç†æ­¤storeä¸­çš„æ•°æ®</span>    <span class="token keyword">return</span> scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// è¿™ä¸ªsetupæ–¹æ³•å°±æ˜¯ç”¨æ¥åˆå§‹åŒ–storeä¸­çš„çŠ¶æ€çš„</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">//overwrite existing actions to support $onAction</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> setupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> prop <span class="token operator">=</span> setupStore<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isComputed</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isReactive</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>isSetupStore<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> prop      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> prop <span class="token operator">===</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¯¹actionè¿›è¡Œä¸€æ¬¡åŒ…è£…</span>      setupStore<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">wrapAction</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> prop<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> setupStore<span class="token punctuation">)</span> <span class="token comment">// åˆå¹¶é€‰é¡¹</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> <span class="token string">"$state"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> pinia<span class="token punctuation">.</span>state<span class="token punctuation">.</span>value<span class="token punctuation">[</span>$id<span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">$state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>$state<span class="token punctuation">,</span> state<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  pinia<span class="token punctuation">.</span>_p<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">extender</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>      store<span class="token punctuation">,</span>      scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">extender</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> store<span class="token punctuation">,</span> <span class="token literal-property property">app</span><span class="token operator">:</span> pinia<span class="token punctuation">.</span>_a<span class="token punctuation">,</span> pinia <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  pinia<span class="token punctuation">.</span>_s<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>$id<span class="token punctuation">,</span> store<span class="token punctuation">)</span> <span class="token comment">// æ”¾å…¥åˆ°å®¹å™¨ä¸­</span>  <span class="token keyword">return</span> store<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äº”ã€Pluginæ’ä»¶å®ç°"><a href="#äº”ã€Pluginæ’ä»¶å®ç°" class="headerlink" title="äº”ã€Pluginæ’ä»¶å®ç°"></a>äº”ã€Pluginæ’ä»¶å®ç°</h2><p><strong>æ¡ˆä¾‹ ï¼š æŒä¹…åŒ–å­˜å‚¨æ’ä»¶</strong> <code>pinia-plugin-persistedstate</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//  import piniaPluginPersistedstate from "pinia-plugin-persistedstate"</span><span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> store <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> id <span class="token operator">=</span> store<span class="token punctuation">.</span>$id  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"store=>"</span><span class="token punctuation">,</span> store<span class="token punctuation">,</span> store<span class="token punctuation">.</span>$id<span class="token punctuation">)</span>  <span class="token comment">// ... æˆ‘è¦æ‹¿åˆ°æ‰€æœ‰çš„çŠ¶æ€ï¼Œ æ›¿æ¢æ‰é»˜è®¤çŠ¶æ€</span>  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>state<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    store<span class="token punctuation">.</span>$state <span class="token operator">=</span> state  <span class="token punctuation">&#125;</span>  store<span class="token punctuation">.</span><span class="token function">$subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> storeId <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ¯ä¸ªæ’ä»¶éƒ½ä¼šæ‰§è¡Œè®¢é˜…æ“ä½œ</span>    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>storeId<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>pinia<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å®ç°</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> _p <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> pinia <span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">plugin</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            _p<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>plugin<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token comment">//...</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> pinia<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">createSetupStore</span><span class="token punctuation">(</span><span class="token parameter">$id<span class="token punctuation">,</span> setup<span class="token punctuation">,</span> options<span class="token punctuation">,</span> pinia<span class="token punctuation">,</span> isSetupStore</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">//.....</span>    pinia<span class="token punctuation">.</span>_p<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">extender</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>      store<span class="token punctuation">,</span>      scope<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">extender</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> store<span class="token punctuation">,</span> <span class="token literal-property property">app</span><span class="token operator">:</span> pinia<span class="token punctuation">.</span>_a<span class="token punctuation">,</span> pinia <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">//.....</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…­ã€å…¶ä»–"><a href="#å…­ã€å…¶ä»–" class="headerlink" title="å…­ã€å…¶ä»–"></a>å…­ã€å…¶ä»–</h2><h3 id="1-storeToRefs"><a href="#1-storeToRefs" class="headerlink" title="1. storeToRefs"></a>1. storeToRefs</h3><p>ä» Store ä¸­æå–å±æ€§åŒæ—¶ä¿æŒå…¶å“åº”å¼ï¼Œéœ€è¦ä½¿ç”¨<code>storeToRefs()</code>ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> toRaw<span class="token punctuation">,</span> isRef<span class="token punctuation">,</span> isReactive<span class="token punctuation">,</span> toRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  store <span class="token operator">=</span> <span class="token function">toRaw</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span>  <span class="token keyword">const</span> refs <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> store<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> value <span class="token operator">=</span> store<span class="token punctuation">[</span>key<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isRef</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isReactive</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      refs<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>store<span class="token punctuation">,</span> key<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> refs<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-mapHelpers"><a href="#2-mapHelpers" class="headerlink" title="2. mapHelpers"></a>2. mapHelpers</h3><p>ç”¨æ³•</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// çŠ¶æ€</span>   <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">&#123;</span> <span class="token comment">// æ˜ å°„</span>      <span class="token literal-property property">myCount1</span><span class="token operator">:</span><span class="token string">'count'</span><span class="token punctuation">,</span>      <span class="token function-variable function">myCount2</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">store</span><span class="token punctuation">)</span><span class="token operator">=></span> store<span class="token punctuation">.</span>count    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'doubleCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">// getters</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token operator">...</span><span class="token function">mapWritableState</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'doubleCount'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'increment'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">...</span><span class="token function">mapActions</span><span class="token punctuation">(</span>useCounterStore<span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token literal-property property">myIncrement</span><span class="token operator">:</span><span class="token string">'increment'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å®ç°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mapState</span><span class="token punctuation">(</span><span class="token parameter">useStore<span class="token punctuation">,</span> keysOrMapper</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>keysOrMapper<span class="token punctuation">)</span>    <span class="token operator">?</span> keysOrMapper<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reduced<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ•°ç»„çš„å†™æ³•</span>        reduced<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> reduced      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>keysOrMapper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reduced<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¯¹è±¡çš„å†™æ³•</span>        reduced<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token keyword">const</span> storeKey <span class="token operator">=</span> keysOrMapper<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// è·å–storeä¸­çš„å€¼</span>          <span class="token comment">// å¯¹è±¡ä¸­å‡½æ•°çš„å†™æ³•</span>          <span class="token keyword">return</span> <span class="token keyword">typeof</span> storeKey <span class="token operator">===</span> <span class="token string">"function"</span>            <span class="token operator">?</span> <span class="token function">storeKey</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> store<span class="token punctuation">)</span>            <span class="token operator">:</span> store<span class="token punctuation">[</span>storeKey<span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> reduced      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> mapGetters <span class="token operator">=</span> mapState<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">mapActions</span><span class="token punctuation">(</span><span class="token parameter">useStore<span class="token punctuation">,</span> keysOrMapper</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>keysOrMapper<span class="token punctuation">)</span>    <span class="token operator">?</span> keysOrMapper<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reduced<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        reduced<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> reduced      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token operator">:</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>keysOrMapper<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">reduced<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// @ts-expect-error</span>        reduced<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>keysOrMapper<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> reduced      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><blockquote><p>æ€»å¾—æ¥è¯´ï¼ŒPinia å°±æ˜¯ Vuex çš„æ›¿ä»£ç‰ˆï¼Œå¯ä»¥æ›´å¥½çš„å…¼å®¹ Vue2ï¼ŒVue3ä»¥åŠTypeScriptã€‚åœ¨Vuexçš„åŸºç¡€ä¸Šå»æ‰äº† Mutationï¼Œåªä¿ç•™äº† state, getterå’Œactionã€‚Piniaæ‹¥æœ‰æ›´ç®€æ´çš„è¯­æ³•ï¼Œ æ‰å¹³åŒ–çš„ä»£ç ç¼–æ’ï¼Œç¬¦åˆVue3 çš„ Composition api</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npmå¸¸è§åŒ…</title>
      <link href="/2023/07/07/npm-chang-jian-bao/"/>
      <url>/2023/07/07/npm-chang-jian-bao/</url>
      
        <content type="html"><![CDATA[<p><strong>vue çš„æ‹–æ‹½åŒ…</strong>: <a href="https://www.npmjs.com/package/vuedraggable">https://www.npmjs.com/package/vuedraggable</a><br><strong>ä»£ç ç¼–è¾‘å™¨</strong>: <a href="https://www.npmjs.com/package/ace-builds">https://www.npmjs.com/package/ace-builds</a><br><strong>Vue3 ä»£ç ç¼–è¾‘å™¨</strong> : <a href="https://www.npmjs.com/package/vue3-ace-editor">https://www.npmjs.com/package/vue3-ace-editor</a><br><strong>Vue CodeDiff</strong> : <a href="https://www.npmjs.com/package/v-code-diff">https://www.npmjs.com/package/v-code-diff</a><br><strong>æ·±åº¦ json è§£æ</strong> : <a href="https://www.npmjs.com/package/deep-parse-json">https://www.npmjs.com/package/deep-parse-json</a><br><strong>sql æ ¼å¼åŒ–</strong> : <a href="https://www.npmjs.com/package/sql-formatter">https://www.npmjs.com/package/sql-formatter</a></p>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»£ç é£æ ¼é…ç½®</title>
      <link href="/2023/07/06/dai-ma-feng-ge-pei-zhi/"/>
      <url>/2023/07/06/dai-ma-feng-ge-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="ESLint"><a href="#ESLint" class="headerlink" title="ESLint"></a>ESLint</h2><p><a href="https://zh-hans.eslint.org/docs/latest/use/getting-started">https://zh-hans.eslint.org/docs/latest/use/getting-started</a></p><ul><li><a href="https://eslint.org/">ESLint</a>æ˜¯ä¸€ä¸ªæ’ä»¶åŒ–å¹¶ä¸”å¯é…ç½®çš„ JavaScript è¯­æ³•è§„åˆ™å’Œä»£ç é£æ ¼çš„æ£€æŸ¥å·¥å…·<ul><li>ä»£ç è´¨é‡é—®é¢˜ï¼šä½¿ç”¨æ–¹å¼æœ‰å¯èƒ½æœ‰é—®é¢˜</li><li>ä»£ç é£æ ¼é—®é¢˜ï¼šé£æ ¼ä¸ç¬¦åˆä¸€å®šè§„åˆ™</li></ul></li></ul><h3 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> init @eslint/config<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">install</span>  eslint  eslint-plugin-vue @typescript-eslint/parser @typescript-eslint/eslint-plugin  vue-eslint-parser eslint-define-config <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¸¸è§çš„åŒ…</p><table><thead><tr><th align="left">åç§°</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">eslint</td><td align="left">ESLint æ˜¯ä¸€ä¸ªç”¨äºè¯†åˆ«å’ŒæŠ¥å‘Šåœ¨ ECMAScript/JavaScript ä»£ç ä¸­å‘ç°çš„æ¨¡å¼çš„å·¥å…·</td></tr><tr><td align="left">eslint-plugin-vue</td><td align="left">Vue çš„å®˜æ–¹ ESLint æ’ä»¶</td></tr><tr><td align="left">@typescript-eslint/parser</td><td align="left">ä¸€ä¸ª ESLint è§£æå™¨ï¼Œå®ƒåˆ©ç”¨ TypeScript-ESTree å…è®¸ ESLint æ£€æŸ¥ TypeScript æºä»£ç </td></tr><tr><td align="left">@typescript-eslint/eslint-plugin</td><td align="left">ä¸€ä¸ª ESLint æ’ä»¶ï¼Œä¸º TypeScript ä»£ç åº“æä¾› lint è§„åˆ™</td></tr><tr><td align="left">@vue/eslint-config-typescript</td><td align="left">Vue çš„ eslint-config-typescript</td></tr></tbody></table><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p><strong>.eslintrc.js</strong></p><ol><li>æ¡ˆä¾‹ 1</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> defineConfig <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"eslint-define-config"</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span> <span class="token string">"plugin:@typescript-eslint/recommended"</span><span class="token punctuation">,</span> <span class="token string">"plugin:vue/vue3-essential"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"vue-eslint-parser"</span><span class="token punctuation">,</span>  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"@typescript-eslint/parser"</span><span class="token punctuation">,</span>    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token string">"latest"</span><span class="token punctuation">,</span>    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@typescript-eslint"</span><span class="token punctuation">,</span> <span class="token string">"vue"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// TS</span>    <span class="token string-property property">"@typescript-eslint/no-explicit-any"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"no-debugger"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/explicit-module-boundary-types"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/ban-types"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/ban-ts-comment"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-empty-function"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-non-null-assertion"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"@typescript-eslint/no-unused-vars"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">argsIgnorePattern</span><span class="token operator">:</span> <span class="token string">"^_"</span><span class="token punctuation">,</span>        <span class="token literal-property property">varsIgnorePattern</span><span class="token operator">:</span> <span class="token string">"^_"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"no-unused-vars"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">argsIgnorePattern</span><span class="token operator">:</span> <span class="token string">"^_"</span><span class="token punctuation">,</span>        <span class="token literal-property property">varsIgnorePattern</span><span class="token operator">:</span> <span class="token string">"^_"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// Vue</span>    <span class="token string-property property">"vue/no-v-html"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/require-default-prop"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/require-explicit-emits"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/multi-word-component-names"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>    <span class="token string-property property">"vue/html-self-closing"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"error"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">void</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>          <span class="token literal-property property">normal</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>          <span class="token literal-property property">component</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token literal-property property">svg</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>        <span class="token literal-property property">math</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// Prettier</span>    <span class="token string-property property">"prettier/prettier"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"warn"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>.eslintignore</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">*</span><span class="token punctuation">.</span>shnode_modules<span class="token operator">*</span><span class="token punctuation">.</span>md<span class="token operator">*</span><span class="token punctuation">.</span>woff<span class="token operator">*</span><span class="token punctuation">.</span>ttf<span class="token punctuation">.</span>vscode<span class="token punctuation">.</span>ideadist<span class="token operator">/</span><span class="token keyword">public</span><span class="token operator">/</span>docs<span class="token punctuation">.</span>husky<span class="token punctuation">.</span>local<span class="token operator">/</span>binDockerfilecomponents<span class="token punctuation">.</span>d<span class="token punctuation">.</span>tsauto<span class="token operator">-</span>imports<span class="token punctuation">.</span>d<span class="token punctuation">.</span>ts<span class="token operator">*</span><span class="token punctuation">.</span>min<span class="token punctuation">.</span>js<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>package.json</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">&#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   "scripts": &#123;</span><span class="token prefix unchanged"> </span><span class="token line">    "dev": "vite",</span><span class="token prefix unchanged"> </span><span class="token line">    "build": "vue-tsc --noEmit &amp;&amp; vite build",</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">     "lint:eslint": "eslint --cache --max-warnings 0 \"&#123;src,tests,types&#125;/**/*.&#123;vue,js,jsx,ts,tsx&#125;\" --fix",</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> &#125;,</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Prettier"><a href="#Prettier" class="headerlink" title="Prettier"></a>Prettier</h2><ul><li><p><a href="https://eslint.org/">ESLint</a> ä¸»è¦è§£å†³çš„æ˜¯ä»£ç è´¨é‡é—®é¢˜</p></li><li><p>ä»£ç è´¨é‡è§„åˆ™</p><ul><li>no-unused-vars ç¦æ­¢å‡ºç°æœªä½¿ç”¨è¿‡çš„å˜é‡</li><li>no-implicit-globals ç¦æ­¢åœ¨å…¨å±€èŒƒå›´å†…ä½¿ç”¨å˜é‡å£°æ˜å’Œ function å£°æ˜</li><li>prefer-promise-reject-errors è¦æ±‚ä½¿ç”¨ Error å¯¹è±¡ä½œä¸º Promise æ‹’ç»çš„åŸå› </li></ul></li><li><p><a href="https://prettier.io/">prettier </a>ä¸»è¦è§£å†³çš„æ˜¯ä»£ç é£æ ¼é—®é¢˜</p><ul><li>max-len æœ€å¤§é•¿åº¦</li><li>no-mixed-spaces-and-tabs ä¸å…è®¸ç©ºæ ¼å’Œ tab æ··åˆ</li><li>keyword-spacing å…³é”®å­—çš„ç©º</li><li>comma-style å†’å·é£æ ¼</li></ul></li></ul><h3 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1 å®‰è£…"></a>1 å®‰è£…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> prettier eslint-plugin-prettier  @vue/eslint-config-prettier pretty-quick <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th align="left">åç§°</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">prettier</td><td align="left">ä»£ç æ ¼å¼åŒ–</td></tr><tr><td align="left">eslint-plugin-prettier</td><td align="left">ä½œä¸º ESLint è§„åˆ™è¿è¡Œå¾— prettier</td></tr><tr><td align="left">@vue/eslint-config-prettier</td><td align="left">Vue çš„ eslint-config-prettier</td></tr></tbody></table><p>å…¶ä»– ï¼šå…³é—­æ‰€æœ‰ä¸å¿…è¦æˆ–å¯èƒ½ä¸ Prettier å†²çªçš„è§„åˆ™ã€‚</p><p>stylelint-config-prettier</p><h3 id="2-æ¡ˆä¾‹"><a href="#2-æ¡ˆä¾‹" class="headerlink" title="2. æ¡ˆä¾‹"></a>2. æ¡ˆä¾‹</h3><p>.eslintrc.cjs</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">module.exports = &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> root: true,</span><span class="token prefix unchanged"> </span><span class="token line"> env: &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   browser: true,</span><span class="token prefix unchanged"> </span><span class="token line">   es2021: true,</span><span class="token prefix unchanged"> </span><span class="token line">   node: true</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;,</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> extends: [</span><span class="token prefix unchanged"> </span><span class="token line">   "plugin:vue/vue3-recommended",</span><span class="token prefix unchanged"> </span><span class="token line">   "eslint:recommended",</span><span class="token prefix unchanged"> </span><span class="token line">   "@vue/typescript/recommended",</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  //æ·»åŠ ä¸¤ä¸ªæ’ä»¶</span><span class="token prefix inserted">+</span><span class="token line">   "prettier",</span><span class="token prefix inserted">+</span><span class="token line">   "@vue/eslint-config-prettier"</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> ],</span><span class="token prefix unchanged"> </span><span class="token line"> parserOptions: &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   parser: "@typescript-eslint/parser",</span><span class="token prefix unchanged"> </span><span class="token line">   ecmaVersion: 2021</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;,</span><span class="token prefix unchanged"> </span><span class="token line"> rules: &#123;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   //'prettier/prettier': "off",//å…³é—­è­¦å‘Š</span><span class="token prefix inserted">+</span><span class="token line">   // é…ç½®è§„åˆ™çº§åˆ«å’Œæ”¹æ­£è§„åˆ™</span><span class="token prefix inserted">+</span><span class="token line">   "prettier/prettier": [</span><span class="token prefix inserted">+</span><span class="token line">     "error",</span><span class="token prefix inserted">+</span><span class="token line">     &#123;</span><span class="token prefix inserted">+</span><span class="token line">       singleQuote: true,</span><span class="token prefix inserted">+</span><span class="token line">       tabWidth: 2,</span><span class="token prefix inserted">+</span><span class="token line">       indent: 2,</span><span class="token prefix inserted">+</span><span class="token line">       semi: false,</span><span class="token prefix inserted">+</span><span class="token line">       trailingComma: "none",</span><span class="token prefix inserted">+</span><span class="token line">       endOfLine: "auto"</span><span class="token prefix inserted">+</span><span class="token line">     &#125;</span><span class="token prefix inserted">+</span><span class="token line">   ],</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">  "no-unused-vars": "off",</span><span class="token prefix unchanged"> </span><span class="token line">  "vue/no-unused-vars": "off",</span><span class="token prefix unchanged"> </span><span class="token line">  "@typescript-eslint/no-unused-vars": "off"</span></span>&#125;,<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> globals: &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   defineProps: "readonly"</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>.prettierrc.cjs</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** é…ç½®é¡¹æ–‡æ¡£ï¼šhttps://prettier.io/docs/en/configuration.html */</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token comment">/** æ¯ä¸€è¡Œçš„å®½åº¦ */</span>  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span>  <span class="token comment">/** Tab é”®çš„ç©ºæ ¼æ•° */</span>  <span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token comment">/** åœ¨å¯¹è±¡ä¸­çš„æ‹¬å·ä¹‹é—´æ˜¯å¦ç”¨ç©ºæ ¼æ¥é—´éš” */</span>  <span class="token literal-property property">bracketSpacing</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">/** ç®­å¤´å‡½æ•°çš„å‚æ•°æ— è®ºæœ‰å‡ ä¸ªï¼Œéƒ½è¦æ‹¬å·åŒ…è£¹ */</span>  <span class="token literal-property property">arrowParens</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span>  <span class="token comment">/** æ¢è¡Œç¬¦çš„ä½¿ç”¨ */</span>  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>  <span class="token comment">/** æ˜¯å¦é‡‡ç”¨å•å¼•å· */</span>  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">/** å¯¹è±¡æˆ–è€…æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ åé¢ä¸è¦åŠ é€—å· */</span>  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span>  <span class="token comment">/** æ˜¯å¦åŠ åˆ†å· */</span>  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">/** æ˜¯å¦ä½¿ç”¨ Tab æ ¼å¼åŒ– */</span>  <span class="token literal-property property">useTabs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>.prettierignore</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">/</span>dist<span class="token comment">/*.local.output.js/node_modules/****/</span><span class="token operator">*</span><span class="token punctuation">.</span>svg<span class="token operator">**</span><span class="token comment">/*.sh/public/*.npmrcindex.htmlpnpm-lock.yamlcomponents.d.tsauto-imports.d.ts*.min.js</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>package.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"lint:prettier"</span><span class="token operator">:</span> <span class="token string">"prettier --write \"&#123;src,tests,types&#125;/**/*.&#123;vue,js,jsx,ts,tsx,json,css,less,scss,html,md&#125;\""</span><span class="token punctuation">,</span>  <span class="token property">"lint:pretty"</span><span class="token operator">:</span> <span class="token string">"pretty-quick --staged"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-è§„åˆ™"><a href="#3-è§„åˆ™" class="headerlink" title="3.è§„åˆ™"></a>3.è§„åˆ™</h3><p><a href="https://prettier.io/docs/en/options.html">https://prettier.io/docs/en/options.html</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">printWidth</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span> <span class="token comment">//æœ€å¤§åˆ—å®½ä¸º 120 å­—ç¬¦</span>  <span class="token literal-property property">tabWidth</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">//ä½¿ç”¨ 2 ä¸ªç©ºæ ¼ç¼©è¿›</span>  <span class="token literal-property property">useTabs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ä¸ä½¿ç”¨åˆ¶è¡¨ç¬¦ç¼©è¿›,ä½¿ç”¨ç©ºæ ¼</span>  <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ä¸ä½¿ç”¨åˆ†å·</span>  <span class="token literal-property property">singleQuote</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ä½¿ç”¨å•å¼•å·</span>  <span class="token literal-property property">vueIndentScriptAndStyle</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ä¸è¦åœ¨ Vue æ–‡ä»¶ä¸­ç¼©è¿›è„šæœ¬å’Œæ ·å¼æ ‡ç­¾ã€‚</span>  <span class="token literal-property property">quoteProps</span><span class="token operator">:</span> <span class="token string">"as-needed"</span><span class="token punctuation">,</span> <span class="token comment">//ä»…åœ¨éœ€è¦æ—¶åœ¨å¯¹è±¡å±æ€§å‘¨å›´æ·»åŠ å¼•å·ã€‚</span>  <span class="token literal-property property">bracketSpacing</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//å¯¹è±¡æ–‡å­—ä¸­æ‹¬å·ä¹‹é—´çš„ç©ºæ ¼ã€‚</span>  <span class="token literal-property property">trailingComma</span><span class="token operator">:</span> <span class="token string">"none"</span><span class="token punctuation">,</span> <span class="token comment">//ä¸ä½¿ç”¨å°¾éšé€—å·</span>  <span class="token literal-property property">jsxBracketSameLine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// åœ¨ jsx ä¸­å’Œåé¢çš„æ ‡ç­¾å¤„äºåŒä¸€è¡Œ</span>  <span class="token literal-property property">jsxSingleQuote</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//ä¸åœ¨ jsx ä¸­ä½¿ç”¨å•å¼•å·</span>  <span class="token literal-property property">arrowParens</span><span class="token operator">:</span> <span class="token string">"always"</span><span class="token punctuation">,</span> <span class="token comment">//åœ¨å”¯ä¸€çš„ç®­å¤´å‡½æ•°å‚æ•°å‘¨å›´åŒ…å«æ‹¬å·</span>  <span class="token literal-property property">insertPragma</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">requirePragma</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">proseWrap</span><span class="token operator">:</span> <span class="token string">"never"</span><span class="token punctuation">,</span>  <span class="token literal-property property">htmlWhitespaceSensitivity</span><span class="token operator">:</span> <span class="token string">"strict"</span><span class="token punctuation">,</span>  <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token comment">// è‡ªåŠ¨é€‰æ‹©è¡Œç»“æŸç¬¦</span>  <span class="token literal-property property">rangeStart</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token literal-property property">singleAttributePerLine</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//åœ¨ HTMLã€Vue å’Œ JSX ä¸­å¼ºåˆ¶æ¯è¡Œä½¿ç”¨å•ä¸€å±æ€§</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="editorconfig"><a href="#editorconfig" class="headerlink" title="editorconfig"></a>editorconfig</h2><ul><li><a href="https://editorconfig.org/">editorconfig</a>å¸®åŠ©å¼€å‘äººå‘˜åœ¨ä¸åŒçš„ç¼–è¾‘å™¨å’Œ IDE ä¹‹é—´å®šä¹‰å’Œç»´æŠ¤ä¸€è‡´çš„ç¼–ç æ ·å¼</li><li>ä¸åŒçš„å¼€å‘äººå‘˜ï¼Œä¸åŒçš„ç¼–è¾‘å™¨ï¼Œæœ‰ä¸åŒçš„ç¼–ç é£æ ¼ï¼Œè€Œ EditorConfig å°±æ˜¯ç”¨æ¥ååŒå›¢é˜Ÿå¼€å‘äººå‘˜ä¹‹é—´çš„ä»£ç çš„é£æ ¼åŠæ ·å¼è§„èŒƒåŒ–çš„ä¸€ä¸ªå·¥å…·ï¼Œè€Œ.editorconfig æ­£æ˜¯å®ƒçš„é»˜è®¤é…ç½®æ–‡ä»¶</li><li><a href="https://marketplace.visualstudio.com/items?itemName=EditorConfig.EditorConfig">EditorConfig</a></li><li>vscode è¿™ç±»ç¼–è¾‘å™¨ï¼Œéœ€è¦è‡ªè¡Œå®‰è£… editorconfig æ’ä»¶</li></ul><p>.editorconfig</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®é¡¹æ–‡æ¡£ï¼šhttps://editorconfig.org/</span><span class="token comment"># å‘ŠçŸ¥ EditorConfig æ’ä»¶ï¼Œå½“å‰å³æ˜¯æ ¹æ–‡ä»¶</span>root <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment"># é€‚ç”¨å…¨éƒ¨æ–‡ä»¶</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token comment">## è®¾ç½®å­—ç¬¦é›†</span>charset <span class="token operator">=</span> utf-8<span class="token comment">## ç¼©è¿›é£æ ¼ space | tabï¼Œå»ºè®® space</span>indent_style <span class="token operator">=</span> space<span class="token comment">## ç¼©è¿›çš„ç©ºæ ¼æ•°ï¼ˆä¿®æ”¹è¿™é‡Œçš„è¯éœ€è¦å°† prettier.config.js å’Œ .vscode -> settings.json ä¹ŸåŒæ­¥ä¿®æ”¹ï¼‰</span>indent_size <span class="token operator">=</span> <span class="token number">2</span><span class="token comment">## æ¢è¡Œç¬¦ç±»å‹ lf | cr | crlfï¼Œä¸€èˆ¬éƒ½æ˜¯è®¾ç½®ä¸º lf</span>end_of_line <span class="token operator">=</span> lf<span class="token comment">## æ˜¯å¦åœ¨æ–‡ä»¶æœ«å°¾æ’å…¥ç©ºç™½è¡Œ</span>insert_final_newline <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment">## æ˜¯å¦åˆ é™¤ä¸€è¡Œä¸­çš„å‰åç©ºæ ¼</span>trim_trailing_whitespace <span class="token operator">=</span> <span class="token boolean">true</span><span class="token comment"># é€‚ç”¨ .md æ–‡ä»¶</span><span class="token punctuation">[</span>*.md<span class="token punctuation">]</span>insert_final_newline <span class="token operator">=</span> <span class="token boolean">false</span>trim_trailing_whitespace <span class="token operator">=</span> <span class="token boolean">false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>.vscode/setting.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"editor.tabSize"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>  <span class="token property">"editor.codeActionsOnSave"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"source.fixAll.eslint"</span><span class="token operator">:</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[vue]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[javascript]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[typescript]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[json]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[jsonc]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[html]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[css]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token property">"[scss]"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"editor.defaultFormatter"</span><span class="token operator">:</span> <span class="token string">"esbenp.prettier-vscode"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>extensions.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"recommendations"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"editorconfig.editorconfig"</span><span class="token punctuation">,</span>    <span class="token string">"dbaeumer.vscode-eslint"</span><span class="token punctuation">,</span>    <span class="token string">"esbenp.prettier-vscode"</span><span class="token punctuation">,</span>    <span class="token string">"vue.vscode-typescript-vue-plugin"</span><span class="token punctuation">,</span>    <span class="token string">"vue.volar"</span><span class="token punctuation">,</span>    <span class="token string">"antfu.unocss"</span><span class="token punctuation">,</span>    <span class="token string">"zixuanchen.vitest-explorer"</span><span class="token punctuation">,</span>    <span class="token string">"wiensss.region-highlighter"</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="git-hooks"><a href="#git-hooks" class="headerlink" title="git hooks"></a>git hooks</h2><ul><li>å¯ä»¥åœ¨<code>git commit</code>ä¹‹å‰æ£€æŸ¥ä»£ç ï¼Œä¿è¯æ‰€æœ‰æäº¤åˆ°ç‰ˆæœ¬åº“ä¸­çš„ä»£ç éƒ½æ˜¯ç¬¦åˆè§„èŒƒçš„</li><li>å¯ä»¥åœ¨<code>git push</code>ä¹‹å‰æ‰§è¡Œå•å…ƒæµ‹è¯•,ä¿è¯æ‰€æœ‰çš„æäº¤çš„ä»£ç ç»è¿‡çš„å•å…ƒæµ‹è¯•</li><li><a href="https://github.com/typicode/husky">husky</a>å¯ä»¥è®©æˆ‘ä»¬å‘é¡¹ç›®ä¸­æ–¹ä¾¿æ·»åŠ <code>git hooks</code>,å®ƒä¼šè‡ªåŠ¨åœ¨ä»“åº“ä¸­çš„ <code>.git/</code> ç›®å½•ä¸‹å¢åŠ ç›¸åº”çš„é’©å­,æ¯”å¦‚ <code>pre-commit</code> é’©å­å°±ä¼šåœ¨ä½ æ‰§è¡Œ <code>git commit</code>å‘½ä»¤çš„æ—¶å€™çš„è§¦å‘</li><li><a href="https://www.npmjs.com/package/lint-staged">lint-staged</a>ç”¨äºå®ç°æ¯æ¬¡æäº¤åªæ£€æŸ¥æœ¬æ¬¡æäº¤æ‰€ä¿®æ”¹çš„æ–‡ä»¶</li><li>Commitlint å¯ä»¥è§„èŒƒ<code>git commit -m &quot;&quot;</code>ä¸­çš„æè¿°ä¿¡æ¯</li></ul><h3 id="gitignore"><a href="#gitignore" class="headerlink" title=".gitignore"></a>.gitignore</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">.DS_Storenode_modules/screenshots/distdist.zipdist_electron<span class="token comment"># local env files</span>.env.local.env.*.local<span class="token comment"># Log files</span>npm-debug.log*yarn-debug.log*yarn-error.log*pnpm-debug.log*<span class="token comment"># Editor directories and files</span>.idea<span class="token comment"># .vscode</span>*.suo*.ntvs**.njsproj*.sln*.sw?types/auto-imports.d.tstypes/components.d.ts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="husky"><a href="#husky" class="headerlink" title="husky"></a>husky</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> husky <span class="token parameter variable">-D</span><span class="token function">npm</span> pkg <span class="token builtin class-name">set</span> <span class="token assign-left variable">scripts.prepare</span><span class="token operator">=</span><span class="token string">"husky install"</span><span class="token function">npm</span> run prepare<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>Edit <code>package.json &gt; prepare</code> script and run it once:npm run prepare</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> pkg <span class="token builtin class-name">set</span> <span class="token assign-left variable">scripts.prepare</span><span class="token operator">=</span><span class="token string">"husky install"</span><span class="token function">npm</span> run prepare<span class="token comment"># `npm test` will run every time you commit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="LintStaged"><a href="#LintStaged" class="headerlink" title="LintStaged"></a>LintStaged</h3><p><a href="https://github.com/okonet/lint-staged">https://github.com/okonet/lint-staged</a></p><h4 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">npm install lint-staged -Dnpx husky add .husky&#x2F;pre-commit &quot;npx --no-install lint-staged&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Package-json"><a href="#Package-json" class="headerlink" title="Package.json"></a>Package.json</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string-property property">"lint-staged"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>  <span class="token string-property property">"*.&#123;vue,js,jsx,ts,tsx&#125;"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"eslint --fix"</span><span class="token punctuation">,</span>    <span class="token string">"prettier --write"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string-property property">"*.&#123;css,less,scss,html,md&#125;"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"prettier --write"</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string-property property">"package.json"</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token string">"prettier --write"</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-json" data-language="json"><code class="language-json"> <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>   <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"pnpm lint:eslint &amp;&amp; pnpm lint:prettier &amp;&amp; pnpm  lint:styleLint"</span><span class="token punctuation">,</span>   <span class="token property">"lint:eslint"</span><span class="token operator">:</span> <span class="token string">"eslint --max-warnings 0 \"&#123;src,tests,types&#125;/**/*.&#123;vue,js,jsx,ts,tsx&#125;\" --fix --cache --cache-location node_modules/.cache/eslint/"</span><span class="token punctuation">,</span>   <span class="token property">"lint:prettier"</span><span class="token operator">:</span> <span class="token string">"prettier --write \"&#123;src,tests,types&#125;/**/*.&#123;vue,js,jsx,ts,tsx,json,css,less,scss,html,md&#125;\""</span><span class="token punctuation">,</span>   <span class="token property">"lint:stylelint"</span><span class="token operator">:</span> <span class="token string">"stylelint --fix \"**/*.&#123;vue,less,postcss,css,scss&#125;\" --cache --cache-location node_modules/.cache/stylelint/"</span><span class="token punctuation">,</span>   <span class="token property">"lint:lint-staged"</span><span class="token operator">:</span> <span class="token string">"lint-staged"</span><span class="token punctuation">,</span>   <span class="token property">"prepare"</span><span class="token operator">:</span> <span class="token string">"husky install"</span><span class="token punctuation">,</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token property">"lint-staged"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>   <span class="token property">"*.&#123;js,jsx,ts,tsx&#125;"</span><span class="token operator">:</span> <span class="token punctuation">[</span>     <span class="token string">"eslint --fix"</span><span class="token punctuation">,</span>     <span class="token string">"prettier --write"</span>   <span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token property">"*.json"</span><span class="token operator">:</span> <span class="token punctuation">[</span>     <span class="token string">"prettier --write"</span>   <span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token property">"*.vue"</span><span class="token operator">:</span> <span class="token punctuation">[</span>     <span class="token string">"eslint --fix"</span><span class="token punctuation">,</span>     <span class="token string">"prettier --write"</span><span class="token punctuation">,</span>     <span class="token string">"stylelint --fix"</span>   <span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token property">"*.&#123;scss,less,styl,html&#125;"</span><span class="token operator">:</span> <span class="token punctuation">[</span>     <span class="token string">"stylelint --fix"</span><span class="token punctuation">,</span>     <span class="token string">"prettier --write"</span>   <span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token property">"*.md"</span><span class="token operator">:</span> <span class="token punctuation">[</span>     <span class="token string">"prettier --write"</span>   <span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="commitlint-é…ç½®"><a href="#commitlint-é…ç½®" class="headerlink" title="commitlint é…ç½®"></a>commitlint é…ç½®</h2><ul><li><p><a href="https://www.npmjs.com/package/@commitlint/cli">commitlint</a>æ¨èæˆ‘ä»¬ä½¿ç”¨<a href="https://www.npmjs.com/package/@commitlint/config-conventional">config-conventional</a>é…ç½®å»å†™ <code>commit</code></p></li><li><p>æäº¤æ ¼å¼</p><pre class="line-numbers language-none"><code class="language-none">git commit -m &lt;type&gt;[optional scope]: &lt;description&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>type</code> ï¼šç”¨äºè¡¨æ˜æˆ‘ä»¬è¿™æ¬¡æäº¤çš„æ”¹åŠ¨ç±»å‹ï¼Œæ˜¯æ–°å¢äº†åŠŸèƒ½ï¼Ÿè¿˜æ˜¯ä¿®æ”¹äº†æµ‹è¯•ä»£ç ï¼Ÿåˆæˆ–è€…æ˜¯æ›´æ–°äº†æ–‡æ¡£ï¼Ÿ</li><li><code>optional scope</code>ï¼šä¸€ä¸ªå¯é€‰çš„ä¿®æ”¹èŒƒå›´ã€‚ç”¨äºæ ‡è¯†æ­¤æ¬¡æäº¤ä¸»è¦æ¶‰åŠåˆ°ä»£ç ä¸­å“ªä¸ªæ¨¡å—</li><li><code>description</code>ï¼šä¸€å¥è¯æè¿°æ­¤æ¬¡æäº¤çš„ä¸»è¦å†…å®¹ï¼Œåšåˆ°è¨€ç®€æ„èµ…</li></ul></li></ul><h3 id="1-type"><a href="#1-type" class="headerlink" title="1. type"></a>1. type</h3><table><thead><tr><th align="left">ç±»å‹</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">build</td><td align="left">ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨</td></tr><tr><td align="left">chore</td><td align="left">å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰</td></tr><tr><td align="left">ci</td><td align="left">æŒç»­é›†æˆä¿®æ”¹</td></tr><tr><td align="left">docs</td><td align="left">æ–‡æ¡£ä¿®æ”¹</td></tr><tr><td align="left">feature</td><td align="left">æ–°ç‰¹æ€§ã€æ–°åŠŸèƒ½</td></tr><tr><td align="left">fix</td><td align="left">ä¿®æ”¹ bug</td></tr><tr><td align="left">perf</td><td align="left">ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ</td></tr><tr><td align="left">refactor</td><td align="left">ä»£ç é‡æ„</td></tr><tr><td align="left">revert</td><td align="left">å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</td></tr><tr><td align="left">style</td><td align="left">ä»£ç æ ¼å¼ä¿®æ”¹</td></tr><tr><td align="left">test</td><td align="left">æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹</td></tr></tbody></table><h3 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2. å®‰è£…"></a>2. å®‰è£…</h3><p><a href="https://commitlint.js.org/#/guides-local-setup?id=install-commitlint">https://commitlint.js.org/#/guides-local-setup?id=install-commitlint</a></p><h4 id="å®‰è£…-commitlint"><a href="#å®‰è£…-commitlint" class="headerlink" title="å®‰è£… commitlint"></a>å®‰è£… commitlint</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">install</span> @commitlint/cli @commitlint/config-conventional <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="å®‰è£…-husky"><a href="#å®‰è£…-husky" class="headerlink" title="å®‰è£… husky"></a>å®‰è£… husky</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Install Husky v6</span><span class="token function">npm</span> <span class="token function">install</span> husky --save-dev<span class="token comment"># or</span><span class="token function">yarn</span> <span class="token function">add</span> husky <span class="token parameter variable">--dev</span><span class="token comment"># Activate hooks</span>npx husky <span class="token function">install</span><span class="token comment"># or</span><span class="token function">yarn</span> husky <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Add-hook"><a href="#Add-hook" class="headerlink" title="Add hook"></a>Add hook</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx husky <span class="token function">add</span> .husky/commit-msg  <span class="token string">'npx --no-install commitlint --edit $&#123;1&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-é…ç½®"><a href="#3-é…ç½®" class="headerlink" title="3. é…ç½®"></a>3. é…ç½®</h3><p><a href="https://commitlint.js.org/#/reference-configuration">https://commitlint.js.org/#/reference-configuration</a></p><p>commitlint.config.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@commitlint/config-conventional"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"type-enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token string">"always"</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span><span class="token string">"build"</span><span class="token punctuation">,</span> <span class="token string">"chore"</span><span class="token punctuation">,</span> <span class="token string">"ci"</span><span class="token punctuation">,</span> <span class="token string">"docs"</span><span class="token punctuation">,</span> <span class="token string">"feature"</span><span class="token punctuation">,</span> <span class="token string">"fix"</span><span class="token punctuation">,</span> <span class="token string">"perf"</span><span class="token punctuation">,</span> <span class="token string">"refactor"</span><span class="token punctuation">,</span> <span class="token string">"revert"</span><span class="token punctuation">,</span> <span class="token string">"style"</span><span class="token punctuation">,</span> <span class="token string">"test"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-è¯¦ç»†æ¡ˆä¾‹"><a href="#4-è¯¦ç»†æ¡ˆä¾‹" class="headerlink" title="4. è¯¦ç»†æ¡ˆä¾‹"></a>4. è¯¦ç»†æ¡ˆä¾‹</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">ignores</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">commit</span><span class="token punctuation">)</span> <span class="token operator">=></span> commit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"init"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@commitlint/config-conventional"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">parserPreset</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">parserOpts</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">headerPattern</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(\w*|[\u4e00-\u9fa5]*)(?:[\(\ï¼ˆ](.*)[\)\ï¼‰])?[\:\ï¼š] (.*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>      <span class="token literal-property property">headerCorrespondence</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"scope"</span><span class="token punctuation">,</span> <span class="token string">"subject"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">referenceActions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"close"</span><span class="token punctuation">,</span> <span class="token string">"closes"</span><span class="token punctuation">,</span> <span class="token string">"closed"</span><span class="token punctuation">,</span> <span class="token string">"fix"</span><span class="token punctuation">,</span> <span class="token string">"fixes"</span><span class="token punctuation">,</span> <span class="token string">"fixed"</span><span class="token punctuation">,</span> <span class="token string">"resolve"</span><span class="token punctuation">,</span> <span class="token string">"resolves"</span><span class="token punctuation">,</span> <span class="token string">"resolved"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">issuePrefixes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"#"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">noteKeywords</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"BREAKING CHANGE"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">fieldPattern</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^-(.*?)-$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>      <span class="token literal-property property">revertPattern</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^Revert\s"([\s\S]*)"\s*This reverts commit (\w*)\.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>      <span class="token literal-property property">revertCorrespondence</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"header"</span><span class="token punctuation">,</span> <span class="token string">"hash"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token function">warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">mergePattern</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token literal-property property">mergeCorrespondence</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"body-leading-blank"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"always"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"footer-leading-blank"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"always"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"header-max-length"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"always"</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"subject-empty"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"never"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"type-empty"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"never"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"type-enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token string">"always"</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span>        <span class="token string">"feat"</span><span class="token punctuation">,</span> <span class="token comment">// æ–°ç‰¹æ€§</span>        <span class="token string">"fix"</span><span class="token punctuation">,</span> <span class="token comment">// ä¿®å¤bug</span>        <span class="token string">"perf"</span><span class="token punctuation">,</span> <span class="token comment">// ä¼˜åŒ–ï¼ˆæ€§èƒ½ï¼‰</span>        <span class="token string">"style"</span><span class="token punctuation">,</span> <span class="token comment">// æ ·å¼</span>        <span class="token string">"docs"</span><span class="token punctuation">,</span> <span class="token comment">// æ–‡æ¡£</span>        <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token comment">// å•å…ƒæµ‹è¯•</span>        <span class="token string">"refactor"</span><span class="token punctuation">,</span> <span class="token comment">// é‡æ„</span>        <span class="token string">"build"</span><span class="token punctuation">,</span> <span class="token comment">// ä¾èµ–æ‰“åŒ…ç›¸å…³</span>        <span class="token string">"ci"</span><span class="token punctuation">,</span> <span class="token comment">// æŒç»­é›†æˆ</span>        <span class="token string">"chore"</span><span class="token punctuation">,</span> <span class="token comment">// æ—¥å¸¸</span>        <span class="token string">"revert"</span><span class="token punctuation">,</span> <span class="token comment">// å›æ»š</span>        <span class="token string">"wip"</span><span class="token punctuation">,</span> <span class="token comment">// å¼€å‘ä¸­</span>        <span class="token string">"workflow"</span><span class="token punctuation">,</span> <span class="token comment">// å·¥ä½œæµ</span>        <span class="token string">"types"</span><span class="token punctuation">,</span> <span class="token comment">// ç±»å‹å®šä¹‰</span>        <span class="token string">"release"</span><span class="token punctuation">,</span> <span class="token comment">// å‘å¸ƒ</span>        <span class="token string">"improvement"</span><span class="token punctuation">,</span> <span class="token comment">// æ”¹è¿›</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-å¸¸è§é—®é¢˜"><a href="#5-å¸¸è§é—®é¢˜" class="headerlink" title="5. å¸¸è§é—®é¢˜"></a>5. å¸¸è§é—®é¢˜</h3><p><strong>é—®é¢˜ 1</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">hint</span><span class="token operator">:</span> The <span class="token string">'.husky/pre-commit'</span> hook was ignored because it's not <span class="token keyword">set</span> <span class="token keyword">as</span> executable<span class="token punctuation">.</span><span class="token literal-property property">hint</span><span class="token operator">:</span> You can disable <span class="token keyword">this</span> warning <span class="token keyword">with</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git config advice.ignoredHook false</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token literal-property property">hint</span><span class="token operator">:</span> The <span class="token string">'.husky/commit-msg'</span> hook was ignored because it's not <span class="token keyword">set</span> <span class="token keyword">as</span> executable<span class="token punctuation">.</span><span class="token literal-property property">hint</span><span class="token operator">:</span> You can disable <span class="token keyword">this</span> warning <span class="token keyword">with</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git config advice.ignoredHook false</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™äº›æç¤ºçš„æ„æ€æ˜¯ï¼šHusky é¢„æäº¤é’©å­å’Œæäº¤æ¶ˆæ¯é’©å­æ²¡æœ‰è¢«è®¾ç½®ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥ Git å¿½ç•¥äº†å®ƒä»¬ã€‚</p><p>å…·ä½“åŸå› æ˜¯:ä½¿ç”¨ Husky æ—¶ï¼Œå®ƒéœ€è¦åœ¨ .husky ç›®å½•ä¸‹åˆ›å»ºä¸€äº›é’©å­è„šæœ¬æ–‡ä»¶ï¼Œå¦‚:</p><ul><li><p>.husky/pre-commit</p></li><li><p>.husky/commit-msg</p></li></ul><p>ä½†è¿™äº›æ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯å¯æ‰§è¡Œçš„ã€‚éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ä¸ºå¯æ‰§è¡Œ:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®ä¸ºå¯æ‰§è¡Œ</span><span class="token function">chmod</span> +x .husky/pre-commit<span class="token function">chmod</span> +x .husky/commit-msg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ¯•ç«Ÿåªæœ‰å¯æ‰§è¡Œæ–‡ä»¶æ‰èƒ½è¢« Git ç”¨ä½œé’©å­æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>commitlinté…ç½®</title>
      <link href="/2023/07/05/commitlint-pei-zhi/"/>
      <url>/2023/07/05/commitlint-pei-zhi/</url>
      
        <content type="html"><![CDATA[<h1 id="commitlint-é…ç½®"><a href="#commitlint-é…ç½®" class="headerlink" title="commitlint é…ç½®"></a>commitlint é…ç½®</h1><ul><li><p><a href="https://www.npmjs.com/package/@commitlint/cli">commitlint</a>æ¨èæˆ‘ä»¬ä½¿ç”¨<a href="https://www.npmjs.com/package/@commitlint/config-conventional">config-conventional</a>é…ç½®å»å†™ <code>commit</code></p></li><li><p>æäº¤æ ¼å¼</p><pre class="line-numbers language-none"><code class="language-none">git commit -m &lt;type&gt;[optional scope]: &lt;description&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>type</code> ï¼šç”¨äºè¡¨æ˜æˆ‘ä»¬è¿™æ¬¡æäº¤çš„æ”¹åŠ¨ç±»å‹ï¼Œæ˜¯æ–°å¢äº†åŠŸèƒ½ï¼Ÿè¿˜æ˜¯ä¿®æ”¹äº†æµ‹è¯•ä»£ç ï¼Ÿåˆæˆ–è€…æ˜¯æ›´æ–°äº†æ–‡æ¡£ï¼Ÿ</li><li><code>optional scope</code>ï¼šä¸€ä¸ªå¯é€‰çš„ä¿®æ”¹èŒƒå›´ã€‚ç”¨äºæ ‡è¯†æ­¤æ¬¡æäº¤ä¸»è¦æ¶‰åŠåˆ°ä»£ç ä¸­å“ªä¸ªæ¨¡å—</li><li><code>description</code>ï¼šä¸€å¥è¯æè¿°æ­¤æ¬¡æäº¤çš„ä¸»è¦å†…å®¹ï¼Œåšåˆ°è¨€ç®€æ„èµ…</li></ul></li></ul><h2 id="1-type"><a href="#1-type" class="headerlink" title="1. type"></a>1. type</h2><table><thead><tr><th align="left">ç±»å‹</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left">build</td><td align="left">ç¼–è¯‘ç›¸å…³çš„ä¿®æ”¹ï¼Œä¾‹å¦‚å‘å¸ƒç‰ˆæœ¬ã€å¯¹é¡¹ç›®æ„å»ºæˆ–è€…ä¾èµ–çš„æ”¹åŠ¨</td></tr><tr><td align="left">chore</td><td align="left">å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ”¹å˜æ„å»ºæµç¨‹ã€æˆ–è€…å¢åŠ ä¾èµ–åº“ã€å·¥å…·ç­‰</td></tr><tr><td align="left">ci</td><td align="left">æŒç»­é›†æˆä¿®æ”¹</td></tr><tr><td align="left">docs</td><td align="left">æ–‡æ¡£ä¿®æ”¹</td></tr><tr><td align="left">feature</td><td align="left">æ–°ç‰¹æ€§ã€æ–°åŠŸèƒ½</td></tr><tr><td align="left">fix</td><td align="left">ä¿®æ”¹ bug</td></tr><tr><td align="left">perf</td><td align="left">ä¼˜åŒ–ç›¸å…³ï¼Œæ¯”å¦‚æå‡æ€§èƒ½ã€ä½“éªŒ</td></tr><tr><td align="left">refactor</td><td align="left">ä»£ç é‡æ„</td></tr><tr><td align="left">revert</td><td align="left">å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬</td></tr><tr><td align="left">style</td><td align="left">ä»£ç æ ¼å¼ä¿®æ”¹</td></tr><tr><td align="left">test</td><td align="left">æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹</td></tr></tbody></table><h2 id="2-å®‰è£…"><a href="#2-å®‰è£…" class="headerlink" title="2. å®‰è£…"></a>2. å®‰è£…</h2><p><a href="https://commitlint.js.org/#/guides-local-setup?id=install-commitlint">https://commitlint.js.org/#/guides-local-setup?id=install-commitlint</a></p><h4 id="å®‰è£…-commitlint"><a href="#å®‰è£…-commitlint" class="headerlink" title="å®‰è£… commitlint"></a>å®‰è£… commitlint</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">install</span> @commitlint/cli @commitlint/config-conventional <span class="token parameter variable">-D</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="å®‰è£…-husky"><a href="#å®‰è£…-husky" class="headerlink" title="å®‰è£… husky"></a>å®‰è£… husky</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Install Husky v6</span><span class="token function">npm</span> <span class="token function">install</span> husky --save-dev<span class="token comment"># or</span><span class="token function">yarn</span> <span class="token function">add</span> husky <span class="token parameter variable">--dev</span><span class="token comment"># Activate hooks</span>npx husky <span class="token function">install</span><span class="token comment"># or</span><span class="token function">yarn</span> husky <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Add-hook"><a href="#Add-hook" class="headerlink" title="Add hook"></a>Add hook</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">npx husky <span class="token function">add</span> .husky/commit-msg  <span class="token string">'npx --no-install commitlint --edit $&#123;1&#125;'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>8.2.3 é…ç½®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npx husky add <span class="token punctuation">.</span>husky<span class="token operator">/</span>commit<span class="token operator">-</span>msg <span class="token string">"npx --no-install commitlint --edit $1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-é…ç½®"><a href="#3-é…ç½®" class="headerlink" title="3. é…ç½®"></a>3. é…ç½®</h2><p><a href="https://commitlint.js.org/#/reference-configuration">https://commitlint.js.org/#/reference-configuration</a></p><p>commitlint.config.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@commitlint/config-conventional"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"type-enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token string">"always"</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span>        <span class="token string">"build"</span><span class="token punctuation">,</span>        <span class="token string">"chore"</span><span class="token punctuation">,</span>        <span class="token string">"ci"</span><span class="token punctuation">,</span>        <span class="token string">"docs"</span><span class="token punctuation">,</span>        <span class="token string">"feature"</span><span class="token punctuation">,</span>        <span class="token string">"fix"</span><span class="token punctuation">,</span>        <span class="token string">"perf"</span><span class="token punctuation">,</span>        <span class="token string">"refactor"</span><span class="token punctuation">,</span>        <span class="token string">"revert"</span><span class="token punctuation">,</span>        <span class="token string">"style"</span><span class="token punctuation">,</span>        <span class="token string">"test"</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-è¯¦ç»†æ¡ˆä¾‹"><a href="#4-è¯¦ç»†æ¡ˆä¾‹" class="headerlink" title="4. è¯¦ç»†æ¡ˆä¾‹"></a>4. è¯¦ç»†æ¡ˆä¾‹</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">ignores</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token parameter">commit</span><span class="token punctuation">)</span> <span class="token operator">=></span> commit<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">"init"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@commitlint/config-conventional"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token literal-property property">parserPreset</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">parserOpts</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">headerPattern</span><span class="token operator">:</span>        <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^(\w*|[\u4e00-\u9fa5]*)(?:[\(\ï¼ˆ](.*)[\)\ï¼‰])?[\:\ï¼š] (.*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>      <span class="token literal-property property">headerCorrespondence</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">,</span> <span class="token string">"scope"</span><span class="token punctuation">,</span> <span class="token string">"subject"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">referenceActions</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"close"</span><span class="token punctuation">,</span>        <span class="token string">"closes"</span><span class="token punctuation">,</span>        <span class="token string">"closed"</span><span class="token punctuation">,</span>        <span class="token string">"fix"</span><span class="token punctuation">,</span>        <span class="token string">"fixes"</span><span class="token punctuation">,</span>        <span class="token string">"fixed"</span><span class="token punctuation">,</span>        <span class="token string">"resolve"</span><span class="token punctuation">,</span>        <span class="token string">"resolves"</span><span class="token punctuation">,</span>        <span class="token string">"resolved"</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">issuePrefixes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"#"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">noteKeywords</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"BREAKING CHANGE"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token literal-property property">fieldPattern</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^-(.*?)-$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>      <span class="token literal-property property">revertPattern</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^Revert\s"([\s\S]*)"\s*This reverts commit (\w*)\.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>      <span class="token literal-property property">revertCorrespondence</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"header"</span><span class="token punctuation">,</span> <span class="token string">"hash"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token function">warn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">mergePattern</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token literal-property property">mergeCorrespondence</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"body-leading-blank"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"always"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"footer-leading-blank"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"always"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"header-max-length"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"always"</span><span class="token punctuation">,</span> <span class="token number">108</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"subject-empty"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"never"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"type-empty"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"never"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"type-enum"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token number">2</span><span class="token punctuation">,</span>      <span class="token string">"always"</span><span class="token punctuation">,</span>      <span class="token punctuation">[</span>        <span class="token string">"feat"</span><span class="token punctuation">,</span> <span class="token comment">// æ–°ç‰¹æ€§</span>        <span class="token string">"fix"</span><span class="token punctuation">,</span> <span class="token comment">// ä¿®å¤bug</span>        <span class="token string">"perf"</span><span class="token punctuation">,</span> <span class="token comment">// ä¼˜åŒ–ï¼ˆæ€§èƒ½ï¼‰</span>        <span class="token string">"style"</span><span class="token punctuation">,</span> <span class="token comment">// æ ·å¼</span>        <span class="token string">"docs"</span><span class="token punctuation">,</span> <span class="token comment">// æ–‡æ¡£</span>        <span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token comment">// å•å…ƒæµ‹è¯•</span>        <span class="token string">"refactor"</span><span class="token punctuation">,</span> <span class="token comment">// é‡æ„</span>        <span class="token string">"build"</span><span class="token punctuation">,</span> <span class="token comment">// ä¾èµ–æ‰“åŒ…ç›¸å…³</span>        <span class="token string">"ci"</span><span class="token punctuation">,</span> <span class="token comment">// æŒç»­é›†æˆ</span>        <span class="token string">"chore"</span><span class="token punctuation">,</span> <span class="token comment">// æ—¥å¸¸</span>        <span class="token string">"revert"</span><span class="token punctuation">,</span> <span class="token comment">// å›æ»š</span>        <span class="token string">"wip"</span><span class="token punctuation">,</span> <span class="token comment">// å¼€å‘ä¸­</span>        <span class="token string">"workflow"</span><span class="token punctuation">,</span> <span class="token comment">// å·¥ä½œæµ</span>        <span class="token string">"types"</span><span class="token punctuation">,</span> <span class="token comment">// ç±»å‹å®šä¹‰</span>        <span class="token string">"release"</span><span class="token punctuation">,</span> <span class="token comment">// å‘å¸ƒ</span>        <span class="token string">"improvement"</span><span class="token punctuation">,</span> <span class="token comment">// æ”¹è¿›</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-å¸¸è§é—®é¢˜"><a href="#5-å¸¸è§é—®é¢˜" class="headerlink" title="5. å¸¸è§é—®é¢˜"></a>5. å¸¸è§é—®é¢˜</h2><p><strong>é—®é¢˜ 1</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">hint</span><span class="token operator">:</span> The <span class="token string">'.husky/pre-commit'</span> hook was ignored because it's not <span class="token keyword">set</span> <span class="token keyword">as</span> executable<span class="token punctuation">.</span><span class="token literal-property property">hint</span><span class="token operator">:</span> You can disable <span class="token keyword">this</span> warning <span class="token keyword">with</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git config advice.ignoredHook false</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span class="token literal-property property">hint</span><span class="token operator">:</span> The <span class="token string">'.husky/commit-msg'</span> hook was ignored because it's not <span class="token keyword">set</span> <span class="token keyword">as</span> executable<span class="token punctuation">.</span><span class="token literal-property property">hint</span><span class="token operator">:</span> You can disable <span class="token keyword">this</span> warning <span class="token keyword">with</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">git config advice.ignoredHook false</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™äº›æç¤ºçš„æ„æ€æ˜¯ï¼šHusky é¢„æäº¤é’©å­å’Œæäº¤æ¶ˆæ¯é’©å­æ²¡æœ‰è¢«è®¾ç½®ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€ä»¥ Git å¿½ç•¥äº†å®ƒä»¬ã€‚</p><p>å…·ä½“åŸå› æ˜¯:ä½¿ç”¨ Husky æ—¶ï¼Œå®ƒéœ€è¦åœ¨ .husky ç›®å½•ä¸‹åˆ›å»ºä¸€äº›é’©å­è„šæœ¬æ–‡ä»¶ï¼Œå¦‚:</p><ul><li><p>.husky/pre-commit</p></li><li><p>.husky/commit-msg</p><p>ä½†è¿™äº›æ–‡ä»¶é»˜è®¤æƒ…å†µä¸‹ä¸æ˜¯å¯æ‰§è¡Œçš„ã€‚éœ€è¦ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è®¾ç½®ä¸ºå¯æ‰§è¡Œ:</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è®¾ç½®ä¸ºå¯æ‰§è¡Œ</span><span class="token function">chmod</span> +x .husky/pre-commit<span class="token function">chmod</span> +x .husky/commit-msg<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ¯•ç«Ÿåªæœ‰å¯æ‰§è¡Œæ–‡ä»¶æ‰èƒ½è¢« Git ç”¨ä½œé’©å­æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react-routeræºç æ·±åº¦è§£åˆ¨</title>
      <link href="/2023/07/01/react-router-yuan-ma-shi-xian/"/>
      <url>/2023/07/01/react-router-yuan-ma-shi-xian/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç åœ°å€ï¼š</p><ul><li><a href="https://github.com/ghx9908/react-router">https://github.com/ghx9908/react-router</a></li><li><a href="https://github.com/remix-run/react-router">https://github.com/remix-run/react-router</a></li><li><a href="https://create-react-app.dev/">https://create-react-app.dev/</a></li><li><a href="https://reactrouter.com/">https://reactrouter.com/</a></li></ul><h2 id="1-React-è·¯ç”±åŸç†"><a href="#1-React-è·¯ç”±åŸç†" class="headerlink" title="1. React è·¯ç”±åŸç†"></a>1. React è·¯ç”±åŸç†</h2><ul><li>ä¸åŒçš„è·¯å¾„æ¸²æŸ“ä¸åŒçš„ç»„ä»¶</li><li>æœ‰ä¸¤ç§å®ç°æ–¹å¼<ul><li>HashRouter:åˆ©ç”¨ hash å®ç°è·¯ç”±åˆ‡æ¢</li><li>BrowserRouter:å®ç° h5 Api å®ç°è·¯ç”±çš„åˆ‡æ¢</li></ul></li></ul><h3 id="1-1-HashRouter"><a href="#1-1-HashRouter" class="headerlink" title="1.1 HashRouter"></a>1.1 HashRouter</h3><ul><li>åˆ©ç”¨ hash å®ç°è·¯ç”±åˆ‡æ¢</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#/a<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>/a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#/b<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>/b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"hashchange"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">//æŠŠæœ€å‰é¢çš„é‚£ä¸ª# åˆ é™¤</span>      <span class="token keyword">let</span> pathname <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>      root<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> pathname    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-BrowserRouter"><a href="#1-2-BrowserRouter" class="headerlink" title="1.2 BrowserRouter"></a>1.2 BrowserRouter</h3><ul><li>åˆ©ç”¨ h5 Api å®ç°è·¯ç”±çš„åˆ‡æ¢</li></ul><h4 id="1-2-1-history"><a href="#1-2-1-history" class="headerlink" title="1.2.1 history"></a>1.2.1 history</h4><ul><li>HTML5 è§„èŒƒç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/history">history</a>æ¥å£</li><li>HTML5 History API åŒ…æ‹¬ 2 ä¸ªæ–¹æ³•ï¼š<code>history.pushState()</code>å’Œ<code>history.replaceState()</code>ï¼Œå’Œ 1 ä¸ªäº‹ä»¶<code>window.onpopstate</code></li></ul><h5 id="1-2-1-1-pushState"><a href="#1-2-1-1-pushState" class="headerlink" title="1.2.1.1 pushState"></a>1.2.1.1 pushState</h5><ul><li>history.pushState(stateObject, title, url)ï¼ŒåŒ…æ‹¬ä¸‰ä¸ªå‚æ•°<ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ç”¨äºå­˜å‚¨è¯¥ url å¯¹åº”çš„çŠ¶æ€å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯åœ¨ onpopstate äº‹ä»¶ä¸­è·å–ï¼Œä¹Ÿå¯åœ¨ history å¯¹è±¡ä¸­è·å–</li><li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ ‡é¢˜ï¼Œç›®å‰æµè§ˆå™¨å¹¶æœªå®ç°</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯è®¾å®šçš„ url</li></ul></li><li>pushState å‡½æ•°å‘æµè§ˆå™¨çš„å†å²å †æ ˆå‹å…¥ä¸€ä¸ª url ä¸ºè®¾å®šå€¼çš„è®°å½•ï¼Œå¹¶æ”¹å˜å†å²å †æ ˆçš„å½“å‰æŒ‡é’ˆè‡³æ ˆé¡¶</li></ul><h5 id="1-2-1-2-replaceState"><a href="#1-2-1-2-replaceState" class="headerlink" title="1.2.1.2 replaceState"></a>1.2.1.2 replaceState</h5><ul><li>è¯¥æ¥å£ä¸ pushState å‚æ•°ç›¸åŒï¼Œå«ä¹‰ä¹Ÿç›¸åŒ</li><li>å”¯ä¸€çš„åŒºåˆ«åœ¨äº<code>replaceState</code>æ˜¯æ›¿æ¢æµè§ˆå™¨å†å²å †æ ˆçš„å½“å‰å†å²è®°å½•ä¸ºè®¾å®šçš„ url</li><li>éœ€è¦æ³¨æ„çš„æ˜¯<code>replaceState</code>ä¸ä¼šæ”¹åŠ¨æµè§ˆå™¨å†å²å †æ ˆçš„å½“å‰æŒ‡é’ˆ</li></ul><h5 id="1-2-1-3-onpopstate"><a href="#1-2-1-3-onpopstate" class="headerlink" title="1.2.1.3 onpopstate"></a>1.2.1.3 onpopstate</h5><ul><li>è¯¥äº‹ä»¶æ˜¯ window çš„å±æ€§</li><li>è¯¥äº‹ä»¶ä¼šåœ¨è°ƒç”¨æµè§ˆå™¨çš„å‰è¿›ã€åé€€ä»¥åŠæ‰§è¡Œ<code>history.forward</code>ã€<code>history.back</code>ã€å’Œ<code>history.go</code>è§¦å‘ï¼Œå› ä¸ºè¿™äº›æ“ä½œæœ‰ä¸€ä¸ªå…±æ€§ï¼Œå³<strong>ä¿®æ”¹äº†å†å²å †æ ˆçš„å½“å‰æŒ‡é’ˆ</strong></li><li>åœ¨ä¸æ”¹å˜ document çš„å‰æä¸‹ï¼Œä¸€æ—¦å½“å‰æŒ‡é’ˆæ”¹å˜åˆ™ä¼šè§¦å‘<code>onpopstate</code>äº‹ä»¶</li></ul><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">'/a'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>/a<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">'/b'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>/b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">go</span><span class="token punctuation">(</span><span class="token string">'/c'</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>/c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>å‰è¿›<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">></span></span>åé€€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      root<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>pathname    <span class="token punctuation">&#125;</span>    <span class="token comment">//åªæœ‰å½“ä½ å‰è¿›åé€€çš„æ—¶å€™ä¼šè§¦å‘ï¼ŒpushStateä¸ä¼šè§¦å‘</span>    window<span class="token punctuation">.</span>onpopstate <span class="token operator">=</span> render    <span class="token keyword">let</span> historyObj <span class="token operator">=</span> window<span class="token punctuation">.</span>history    <span class="token keyword">let</span> oldPushState <span class="token operator">=</span> historyObj<span class="token punctuation">.</span>pushState    historyObj<span class="token punctuation">.</span><span class="token function-variable function">pushState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> title<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">oldPushState</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>history<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>      <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">go</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      historyObj<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> path<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      historyObj<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment">//historyObj.forward();</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      historyObj<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token comment">//historyObj.back();</span>    <span class="token punctuation">&#125;</span>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-ä½¿ç”¨åŸºæœ¬è·¯ç”±"><a href="#2-ä½¿ç”¨åŸºæœ¬è·¯ç”±" class="headerlink" title="2.ä½¿ç”¨åŸºæœ¬è·¯ç”±"></a>2.ä½¿ç”¨åŸºæœ¬è·¯ç”±</h2><ul><li><code>HashRouter</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ URL çš„å“ˆå¸Œéƒ¨åˆ†ï¼ˆ# ä¹‹åçš„éƒ¨åˆ†ï¼‰æ¥å®ç°å®¢æˆ·ç«¯è·¯ç”±çš„è·¯ç”±å™¨ã€‚å®ƒçš„ä¸»è¦ä¼˜åŠ¿æ˜¯å¯ä»¥åœ¨ä¸éœ€è¦æœåŠ¡å™¨ç«¯é…ç½®çš„æƒ…å†µä¸‹æ”¯æŒæµè§ˆå™¨çš„å†å²è®°å½•åŠŸèƒ½ã€‚è¿™åœ¨ä¸€äº›ç‰¹å®šåœºæ™¯ä¸‹ï¼ˆä¾‹å¦‚ GitHub Pagesï¼‰éå¸¸å®ç”¨</li><li><code>BrowserRouter</code> æ˜¯ä¸€ä¸ªä½¿ç”¨ HTML5 å†å²è®°å½• APIï¼ˆpushStateã€replaceState å’Œ popstate äº‹ä»¶ï¼‰çš„è·¯ç”±å™¨ã€‚å®ƒå¯ä»¥å¸®åŠ©ä½ åˆ›å»ºæ›´ç¾è§‚çš„ URLï¼ˆæ²¡æœ‰å“ˆå¸Œéƒ¨åˆ†ï¼‰ä»¥åŠæ›´å¥½åœ°æ”¯æŒæœåŠ¡å™¨ç«¯æ¸²æŸ“çš„å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰</li><li><code>Routes</code>ç»„ä»¶æ˜¯ä¸€ä¸ªé‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒè´Ÿè´£å®šä¹‰å’Œç»„ç»‡è·¯ç”±è§„åˆ™</li><li><code>Route</code> ç»„ä»¶ç”¨äºå®šä¹‰åº”ç”¨ç¨‹åºçš„è·¯ç”±è§„åˆ™ã€‚Route ç»„ä»¶éœ€è¦æŒ‡å®šä¸€ä¸ª URL è·¯å¾„ï¼ˆé€šè¿‡ path å±æ€§ï¼‰å’Œä¸è¯¥è·¯å¾„å…³è”çš„ç»„ä»¶ï¼ˆé€šè¿‡ element å±æ€§ï¼‰ã€‚å½“ç”¨æˆ·è®¿é—®ä¸æŸä¸ª Route å®šä¹‰çš„è·¯å¾„ç›¸åŒ¹é…çš„ URL æ—¶ï¼ŒReact Router ä¼šæ¸²æŸ“ä¸è¯¥è·¯å¾„å…³è”çš„ç»„ä»¶,å¦‚æœæ‚¨å¸Œæœ›ä¸ºåµŒå¥—è·¯ç”±æä¾›æ”¯æŒï¼Œå¯ä»¥åœ¨ Route çš„ element å±æ€§ä¸­ä½¿ç”¨ Outlet ç»„ä»¶ã€‚å½“å­è·¯ç”±åŒ¹é…æ—¶ï¼ŒOutlet ç»„ä»¶å°†è¢«æ›¿æ¢ä¸ºå¯¹åº”çš„å­è·¯ç”±ç»„ä»¶</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">User</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Routes</span></span><span class="token punctuation">></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-å®ç°åŸºæœ¬è·¯ç”±"><a href="#3-å®ç°åŸºæœ¬è·¯ç”±" class="headerlink" title="3.å®ç°åŸºæœ¬è·¯ç”±"></a>3.å®ç°åŸºæœ¬è·¯ç”±</h2><p>-</p><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img20230630164132.png"></p><h3 id="3-1BrowserRouterç»„ä»¶çš„å®ç°"><a href="#3-1BrowserRouterç»„ä»¶çš„å®ç°" class="headerlink" title="3.1BrowserRouterç»„ä»¶çš„å®ç°"></a>3.1<strong>BrowserRouter</strong>ç»„ä»¶çš„å®ç°</h3><ul><li>åˆ›å»ºä¸€ä¸ª history å¯¹è±¡ä¿å­˜è·¯ç”±å†å²è®°å½•</li><li>å­˜å‚¨ history çš„ location å’Œ action ä¿¡æ¯åˆ°çŠ¶æ€ state ä¸­</li><li>å½“ history å‘ç”Ÿå˜åŒ–æ—¶,ç›‘å¬æ›´æ–°çŠ¶æ€</li><li>æœ€ç»ˆå°†çŠ¶æ€ state å’Œ history ä½œä¸º props ä¼ é€’ç»™ <Router> ç»„ä»¶</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// ä½¿ç”¨ useRef ç¼“å­˜ history å¯¹è±¡,é¿å…é‡å¤åˆ›å»º</span><span class="token comment">// çŠ¶æ€ state å­˜å‚¨ location å’Œ action</span><span class="token comment">// åœ¨ useLayoutEffect ä¸­ç›‘å¬ history å˜åŒ–,å¹¶æ›´æ–°çŠ¶æ€</span><span class="token comment">// å°†çŠ¶æ€å’Œ history å¯¹è±¡ä½œä¸º Router ç»„ä»¶çš„ props ä¼ é€’</span><span class="token comment">// ä»¥è¾¾åˆ°ä¸ Router ç»„ä»¶é«˜æ•ˆåŒæ­¥çš„ç›®çš„</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">BrowserRouter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä½¿ç”¨ Ref å­˜å– history å¯¹è±¡,åªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶åˆ›å»º</span>  <span class="token keyword">const</span> historyRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>historyRef<span class="token punctuation">.</span>current <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    historyRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">createBrowserHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> history <span class="token operator">=</span> historyRef<span class="token punctuation">.</span>current  <span class="token comment">// çŠ¶æ€ state å­˜å‚¨ location å’Œ action ä¿¡æ¯</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">location</span><span class="token operator">:</span> history<span class="token punctuation">.</span>location<span class="token punctuation">,</span>    <span class="token literal-property property">action</span><span class="token operator">:</span> history<span class="token punctuation">.</span>action<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// åœ¨ useLayoutEffect ä¸­ç›‘å¬ history å˜åŒ–,å¹¶æ›´æ–°çŠ¶æ€</span>  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>setState<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>history<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// è¿”å› Router ç»„ä»¶,å¹¶ä½¿ç”¨çŠ¶æ€åŠ history å¯¹è±¡ä½œä¸º props</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span>      <span class="token attr-name">children</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span></span>      <span class="token attr-name">location</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>location<span class="token punctuation">&#125;</span></span>      <span class="token attr-name">navigator</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>history<span class="token punctuation">&#125;</span></span>      <span class="token attr-name">navigationType</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>action<span class="token punctuation">&#125;</span></span>    <span class="token punctuation">/></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2HashRouterç»„ä»¶çš„å®ç°"><a href="#3-2HashRouterç»„ä»¶çš„å®ç°" class="headerlink" title="3.2HashRouterç»„ä»¶çš„å®ç°"></a>3.2<strong>HashRouter</strong>ç»„ä»¶çš„å®ç°</h3><ul><li>é€šè¿‡ createHashHistory() åˆ›å»ºä¸€ä¸ªä¿å­˜ hash å˜åŒ–è®°å½•çš„ history å¯¹è±¡</li><li>ä½¿ç”¨ useRef æ¥ç¼“å­˜ history å¯¹è±¡,é¿å…é‡å¤åˆ›å»º</li><li>çŠ¶æ€ state ä¸­å­˜å‚¨ location å’Œ action ä¿¡æ¯</li><li>åœ¨ useLayoutEffect ä¸­ç›‘å¬ history å˜åŒ–,æ›´æ–°çŠ¶æ€</li><li>å°†çŠ¶æ€ state å’Œ history å¯¹è±¡ä½œä¸º props ä¼ ç»™ <Router/>ç»„ä»¶,ä»è€Œå®ç° hash è·¯ç”±åŠŸèƒ½</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">HashRouter</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//  ä½¿ç”¨ Ref ç¼“å­˜ history å¯¹è±¡,åªåœ¨ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶åˆ›å»º</span>  <span class="token keyword">const</span> historyRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>historyRef<span class="token punctuation">.</span>current <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    historyRef<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">createHashHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> history <span class="token operator">=</span> historyRef<span class="token punctuation">.</span>current  <span class="token comment">//   çŠ¶æ€ state å­˜å‚¨ location å’Œ action ä¿¡æ¯</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">location</span><span class="token operator">:</span> history<span class="token punctuation">.</span>location<span class="token punctuation">,</span>    <span class="token literal-property property">action</span><span class="token operator">:</span> history<span class="token punctuation">.</span>action<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">//   åœ¨ useLayoutEffect ä¸­ç›‘å¬ history å˜åŒ–,å¹¶æ›´æ–°çŠ¶æ€</span>  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    history<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>setState<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>history<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">//  è¿”å› Router ç»„ä»¶,å¹¶ä½¿ç”¨çŠ¶æ€åŠ history å¯¹è±¡ä½œä¸º props</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Router</span></span>      <span class="token attr-name">children</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span></span>      <span class="token attr-name">location</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>location<span class="token punctuation">&#125;</span></span>      <span class="token attr-name">navigator</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>history<span class="token punctuation">&#125;</span></span>      <span class="token attr-name">navigationType</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">.</span>action<span class="token punctuation">&#125;</span></span>    <span class="token punctuation">/></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// ä½¿ç”¨ useRef æ¥ç¼“å­˜ history å¯¹è±¡,é¿å…é‡å¤åˆ›å»º</span><span class="token comment">// çŠ¶æ€ state å­˜å‚¨ location å’Œ action ä¿å­˜å†å²è®°å½•ä¿¡æ¯</span><span class="token comment">// åœ¨ useLayoutEffect ä¸­ç›‘å¬ history å˜åŒ–,å¹¶æ›´æ–°çŠ¶æ€</span><span class="token comment">// å°†çŠ¶æ€å’Œ historyå¯¹è±¡ä½œä¸º props ä¼ é€’ç»™&lt;Router />ç»„ä»¶,å®ç°hashè·¯ç”±</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-Router-çš„å®ç°"><a href="#3-3-Router-çš„å®ç°" class="headerlink" title="3.3 Router çš„å®ç°"></a>3.3 Router çš„å®ç°</h3><p><strong>åˆ›å»ºä¸‰ä¸ªå…¨å±€ä¸Šä¸‹æ–‡:</strong></p><ol><li><p>NavigationContext : æä¾› history å¯¹è±¡</p></li><li><p>LocationContext : æä¾› location(åœ°å€)ä¿¡æ¯</p></li><li><p>RouteContext : æä¾›ä¸å½“å‰è·¯ç”±æœ‰å…³çš„ä¿¡æ¯</p></li></ol><p><strong>Router ç»„ä»¶:</strong></p><ul><li>ä» props ä¸­è·å– children(å­è·¯ç”±)ã€location å’Œ history</li><li>åˆ†åˆ«å°† history å’Œ location ä¿¡æ¯æ”¾å…¥ NavigationContext å’Œ LocationContext ä¸­</li><li>ä»è€Œè®©åä»£ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ context è·å–è¿™ä¸¤ä¸ªå˜é‡</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// åˆ›å»º NavigationContext,å­˜å‚¨ history å¯¹è±¡</span><span class="token keyword">export</span> <span class="token keyword">const</span> NavigationContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">// åˆ›å»º LocationContext,å­˜å‚¨ location ä¿¡æ¯</span><span class="token keyword">export</span> <span class="token keyword">const</span> LocationContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token comment">// åˆ›å»º RouteContext,å­˜å‚¨ä¸å½“å‰è·¯ç”±ç›¸å…³çš„ä¸Šä¸‹æ–‡</span><span class="token keyword">export</span> <span class="token keyword">const</span> RouteContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">outlet</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token literal-property property">matches</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">/** * è·¯ç”±å™¨ç»„ä»¶  @param &#123;&#125; children  å­è·¯ç”±ç»„ä»¶    @param &#123;&#125; location  å½“å‰åœ°å€  @param &#123;&#125; navigator history å¯¹è±¡ * @returns */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Router</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children<span class="token punctuation">,</span> location<span class="token punctuation">,</span> navigator<span class="token punctuation">,</span> navigationType <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¾€å…¨å±€ä¸Šä¸‹æ–‡ä¸­åˆ†åˆ«æä¾› history å¯¹è±¡å’Œ location ä¿¡æ¯</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavigationContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>navigator<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LocationContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>location<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">LocationContext.Provider</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavigationContext.Provider</span></span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-Routes-ç»„ä»¶çš„å®ç°"><a href="#3-4-Routes-ç»„ä»¶çš„å®ç°" class="headerlink" title="3.4 Routes ç»„ä»¶çš„å®ç°"></a>3.4 Routes ç»„ä»¶çš„å®ç°</h3><p>Routes ç»„ä»¶åšäº†ä»¥ä¸‹å·¥ä½œ:</p><ol><li>ä» children ä¸­éå†æ‰€æœ‰çš„ Route ç»„ä»¶</li><li>æ ¹æ®æ¯ä¸ª Route çš„ path å±æ€§,ç”Ÿæˆä¸€ä¸ªè·¯ç”±è¡¨ routes</li><li>è°ƒç”¨ useRoutes(routes) ,æ ¹æ®å½“å‰è·¯å¾„,åŒ¹é…å‡ºå¯¹åº”çš„ Route</li><li>æ¸²æŸ“åŒ¹é…çš„ Route ç»„ä»¶</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"> <span class="token comment">/** * è¯»å–å½“å‰çš„è·¯å¾„ï¼Œå’Œæ¯ä¸€ä¸ªå­©å­çš„pathåšåŒ¹é…ï¼Œæ¸²æŸ“åŒ¹é…çš„ç»„ä»¶ */</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Routes</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> children <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»å­èŠ‚ç‚¹ Route ä¸­åˆ›å»ºè·¯ç”±è¡¨</span>  <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token function">createRoutesFromChildren</span><span class="token punctuation">(</span>children<span class="token punctuation">)</span>  <span class="token comment">// è°ƒç”¨ useRoutes,æ ¹æ®å½“å‰è·¯å¾„åŒ¹é…è·¯ç”±</span>  <span class="token comment">// æ ¸å¿ƒ</span>  <span class="token keyword">return</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Route</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">createRoutesFromChildren</span><span class="token punctuation">(</span><span class="token parameter">children</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  React<span class="token punctuation">.</span>Children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>children<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> route <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">path</span><span class="token operator">:</span> element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>path<span class="token punctuation">,</span>      <span class="token literal-property property">element</span><span class="token operator">:</span> element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>element<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœæœ‰å­èŠ‚ç‚¹ Route,åˆ™é€’å½’åˆ›å»ºè·¯ç”±</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      route<span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token function">createRoutesFromChildren</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>props<span class="token punctuation">.</span>children<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    routes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>route<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> routes<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-5-useRoutesç®€å•ç‰ˆçš„å®ç°"><a href="#3-5-useRoutesç®€å•ç‰ˆçš„å®ç°" class="headerlink" title="3.5 useRoutesç®€å•ç‰ˆçš„å®ç°"></a>3.5 <strong>useRoutes</strong>ç®€å•ç‰ˆçš„å®ç°</h3><p><strong>useRoutes å‡½æ•°çš„ä½œç”¨æ˜¯:</strong></p><ol><li>è·å–å½“å‰ URL åœ°å€</li><li>éå†è·¯ç”±è¡¨ routes</li><li>å¦‚æœæœ‰åŒ¹é…çš„è·¯ç”±,åˆ™æ¸²æŸ“è¯¥è·¯ç”±å¯¹åº”çš„ç»„ä»¶</li></ol><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// ä» LocationContext ä¸­è·å–å½“å‰åœ°å€</span>  <span class="token keyword">let</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è·å– pathname</span>  <span class="token keyword">let</span> pathname <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname <span class="token operator">||</span> <span class="token string">"/"</span><span class="token punctuation">;</span><span class="token comment">// éå†è·¯ç”±è¡¨</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> routes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">let</span> route <span class="token operator">=</span> routes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// å¦‚æœå½“å‰è·¯å¾„åŒ¹é…è·¯ç”±</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>path <span class="token operator">===</span> pathname<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// æ¸²æŸ“è¯¥è·¯ç”±çš„ç»„ä»¶</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>           route<span class="token punctuation">.</span>element        <span class="token punctuation">)</span>     <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-6-useLocation-çš„å®ç°"><a href="#3-6-useLocation-çš„å®ç°" class="headerlink" title="3.6 useLocation çš„å®ç°"></a>3.6 useLocation çš„å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// è·å– LocationContext ä¸­çš„ location å¯¹è±¡</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> location <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>LocationContext<span class="token punctuation">)</span>  <span class="token keyword">return</span> location<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-å®ç°-history"><a href="#4-å®ç°-history" class="headerlink" title="4.å®ç° history"></a>4.å®ç° history</h2><h3 id="4-1-createBrowserHistory-çš„å®ç°"><a href="#4-1-createBrowserHistory-çš„å®ç°" class="headerlink" title="4.1 createBrowserHistory çš„å®ç°"></a>4.1 createBrowserHistory çš„å®ç°</h3><ol><li>å®šä¹‰äº†è·å– location ä¿¡æ¯çš„å‡½æ•° getBrowserLocation()</li><li>å®šä¹‰åˆ›å»ºè·¯ç”± href çš„å‡½æ•° createBrowserHref()</li><li>è°ƒç”¨ getUrlBashHistory() æ¥å®ç°å…·ä½“çš„ history å¯¹è±¡</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createBrowserHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è·å–å½“å‰ location ä¿¡æ¯çš„å‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">getBrowserLocation</span><span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> globalHistory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> pathname <span class="token punctuation">&#125;</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>location    <span class="token keyword">const</span> state <span class="token operator">=</span> globalHistory<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> pathname<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> state<span class="token punctuation">.</span>usr <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆ›å»ºå…·ä½“ href çš„å‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">createBrowserHref</span><span class="token punctuation">(</span><span class="token parameter">to</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> to  <span class="token punctuation">&#125;</span>  <span class="token comment">// è°ƒç”¨å°è£…å‡½æ•°åˆ›å»º history å¯¹è±¡</span>  <span class="token keyword">return</span> <span class="token function">getUrlBashHistory</span><span class="token punctuation">(</span>getBrowserLocation<span class="token punctuation">,</span> createBrowserHref<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-createHashHistory-çš„å®ç°"><a href="#4-2-createHashHistory-çš„å®ç°" class="headerlink" title="4.2 createHashHistory çš„å®ç°"></a>4.2 createHashHistory çš„å®ç°</h3><ol><li>å¦‚æœæ²¡æœ‰ hash åˆå§‹ä¸º</li><li>å®šä¹‰äº†è·å– location ä¿¡æ¯çš„å‡½æ•° getHashLocation()</li><li>å®šä¹‰åˆ›å»ºè·¯ç”± href çš„å‡½æ•° createHashHref(). è°ƒç”¨ getUrlBashHistory() æ¥å®ç°å…·ä½“çš„ history å¯¹è±¡</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createHashHistory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¦‚æœæ²¡æœ‰hash,åˆå§‹åŒ–ä¸º#/</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">=</span> <span class="token string">"/"</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è·å–å½“å‰ hash ä¿¡æ¯çš„å‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">getHashLocation</span><span class="token punctuation">(</span><span class="token parameter">window<span class="token punctuation">,</span> globalHistory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> pathname <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> state <span class="token operator">=</span> globalHistory<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> pathname<span class="token punctuation">,</span> <span class="token literal-property property">state</span><span class="token operator">:</span> state<span class="token punctuation">.</span>usr <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆ›å»ºå…·ä½“hash hrefçš„å‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">createHashHref</span><span class="token punctuation">(</span><span class="token parameter">to</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href    <span class="token keyword">let</span> hashIndex <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span>    <span class="token comment">// å¯¹urlåšå¤„ç†,è·å¾—#ä¹‹å‰çš„éƒ¨åˆ†</span>    <span class="token keyword">let</span> href <span class="token operator">=</span> hashIndex <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> url <span class="token operator">:</span> url<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> hashIndex<span class="token punctuation">)</span>    <span class="token comment">// ç„¶åæ·»åŠ #</span>    <span class="token keyword">return</span> href <span class="token operator">+</span> <span class="token string">"#"</span> <span class="token operator">+</span> to  <span class="token punctuation">&#125;</span>  <span class="token comment">// è°ƒç”¨å°è£…å‡½æ•°åˆ›å»º history å¯¹è±¡</span>  <span class="token keyword">return</span> <span class="token function">getUrlBashHistory</span><span class="token punctuation">(</span>getHashLocation<span class="token punctuation">,</span> createHashHref<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-3-getUrlBashHistory-çš„å®ç°"><a href="#4-3-getUrlBashHistory-çš„å®ç°" class="headerlink" title="4.3 getUrlBashHistory çš„å®ç°"></a>4.3 getUrlBashHistory çš„å®ç°</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * åˆ›å»ºè·¯ç”±history * @param &#123;*&#125; getLocation  è·å–å½“å‰ location ä¿¡æ¯çš„å‡½æ•° * @param &#123;*&#125; createHarf åˆ›å»ºå…·ä½“ href çš„å‡½æ•° * @returns */</span><span class="token keyword">function</span> <span class="token function">getUrlBashHistory</span><span class="token punctuation">(</span><span class="token parameter">getLocation<span class="token punctuation">,</span> createHarf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è·å–å…¨å±€historyå¯¹è±¡</span>  <span class="token keyword">const</span> globalHistory <span class="token operator">=</span> window<span class="token punctuation">.</span>history  <span class="token comment">// å­˜å‚¨ç›‘å¬å‡½æ•°</span>  <span class="token keyword">let</span> listener <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token comment">// å½“å‰ç´¢å¼•</span>  <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœindexä¸ºç©º,åˆå§‹åŒ–ä¸º0</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    index <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">// ä½¿ç”¨replaceStateåˆå§‹åŒ–</span>    globalHistory<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">usr</span><span class="token operator">:</span> globalHistory<span class="token punctuation">.</span>state<span class="token punctuation">,</span>        <span class="token literal-property property">idx</span><span class="token operator">:</span> index<span class="token punctuation">,</span> <span class="token comment">// åœ¨åŸæ¥çš„åŸºç¡€ä¸Šæ·»åŠ ä¸€ä¸ªç´¢å¼•</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token string">""</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è·å–ç´¢å¼•çš„å‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> state <span class="token operator">=</span> globalHistory<span class="token punctuation">.</span>state <span class="token operator">||</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">idx</span><span class="token operator">:</span> <span class="token keyword">null</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> state<span class="token punctuation">.</span>idx  <span class="token punctuation">&#125;</span>  <span class="token comment">// popstateäº‹ä»¶(ä¹Ÿå°±æ˜¯è·¯ç”±å˜åŒ–)æ—¶è°ƒç”¨ç›‘å¬å‡½æ•°</span>  <span class="token keyword">function</span> <span class="token function">handlePop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è®¾ç½®actionç±»å‹ä¸º Pop</span>    action <span class="token operator">=</span> Action<span class="token punctuation">.</span>Pop    <span class="token comment">// è·å–æœ€æ–°ç´¢å¼•</span>    <span class="token keyword">let</span> nextIndex <span class="token operator">=</span> <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// è®¡ç®—ç´¢å¼•å˜åŒ–é‡</span>    <span class="token keyword">let</span> delta <span class="token operator">=</span> nextIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> nextIndex <span class="token operator">-</span> index    <span class="token comment">// æ›´æ–°ç´¢å¼•</span>    index <span class="token operator">=</span> nextIndex    <span class="token comment">// è°ƒç”¨ç›‘å¬å‡½æ•°,ä¼ é€’actionã€locationå’Œç´¢å¼•å˜åŒ–é‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        action<span class="token punctuation">,</span>        <span class="token literal-property property">location</span><span class="token operator">:</span> history<span class="token punctuation">.</span>location<span class="token punctuation">,</span>        delta<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">/**   *  é€šè¿‡pushState()æ–¹æ³•æ”¹å˜è·¯ç”±å†å²è®°å½• è°ƒç”¨ç›‘å¬å‡½æ•°,ä¼ å…¥å˜æ›´ä¿¡æ¯   * @param &#123;*&#125; to   * @param &#123;*&#125; state   */</span>  <span class="token keyword">function</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°†ç´¢å¼• +1</span>    index <span class="token operator">=</span> <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment">// è®¾ç½®actionä¸ºPushç±»å‹</span>    action <span class="token operator">=</span> Action<span class="token punctuation">.</span>Push    <span class="token comment">// æ ¹æ®è·¯å¾„åˆ›å»ºurl</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token function">createHarf</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>    <span class="token comment">// ä½¿ç”¨pushStateæ–¹æ³•æ”¹å˜å†å²</span>    globalHistory<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">idx</span><span class="token operator">:</span> index<span class="token punctuation">,</span> <span class="token literal-property property">usr</span><span class="token operator">:</span> state <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è°ƒç”¨ç›‘å¬å‡½æ•°,ä¼ é€’actionã€locationå’Œå˜æ›´ç´¢å¼•(deltaä¸º1)</span>      <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> action<span class="token punctuation">,</span> <span class="token literal-property property">location</span><span class="token operator">:</span> history<span class="token punctuation">.</span>location<span class="token punctuation">,</span> <span class="token literal-property property">delta</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">replace</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è®¾ç½®actionä¸ºReplaceç±»å‹</span>    action <span class="token operator">=</span> Action<span class="token punctuation">.</span>Replace    <span class="token comment">// è·å–å½“å‰ç´¢å¼•</span>    index <span class="token operator">=</span> <span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// æ ¹æ®è·¯å¾„åˆ›å»ºURL</span>    <span class="token keyword">let</span> url <span class="token operator">=</span> history<span class="token punctuation">.</span><span class="token function">createHref</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span>    <span class="token comment">// ä½¿ç”¨replaceState()æ›¿æ¢å†å²è®°å½•</span>    globalHistory<span class="token punctuation">.</span><span class="token function">replaceState</span><span class="token punctuation">(</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">idx</span><span class="token operator">:</span> index<span class="token punctuation">,</span>        <span class="token literal-property property">usr</span><span class="token operator">:</span> state<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token string">""</span><span class="token punctuation">,</span>      url    <span class="token punctuation">)</span>    <span class="token comment">// å¦‚æœæœ‰ç›‘å¬å‡½æ•°</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>listener<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ä¼ é€’å˜æ›´ä¿¡æ¯ç»™ç›‘å¬å‡½æ•°</span>      <span class="token function">listener</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        action<span class="token punctuation">,</span>        <span class="token literal-property property">location</span><span class="token operator">:</span> history<span class="token punctuation">.</span>location<span class="token punctuation">,</span>        <span class="token literal-property property">delta</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> history <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">get</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> index    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token keyword">get</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> action    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token keyword">get</span> <span class="token function">location</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token function">getLocation</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> globalHistory<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    push<span class="token punctuation">,</span>    replace<span class="token punctuation">,</span>    <span class="token function">listen</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è®¢é˜…popstateäº‹ä»¶</span>      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>PopstateEventType<span class="token punctuation">,</span> handlePop<span class="token punctuation">)</span>      <span class="token comment">// å­˜å‚¨ç›‘å¬å‡½æ•°</span>      listener <span class="token operator">=</span> fn      <span class="token comment">// è¿”å›ç§»é™¤ç›‘å¬åŠŸèƒ½çš„å‡½æ•°</span>      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ç§»é™¤äº‹ä»¶ç›‘å¬</span>        window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span>PopstateEventType<span class="token punctuation">,</span> handlePop<span class="token punctuation">)</span>        <span class="token comment">// æ¸…ç©ºç›‘å¬å‡½æ•°</span>        listener <span class="token operator">=</span> <span class="token keyword">null</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">go</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> globalHistory<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> history<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="push-å‡½æ•°"><a href="#push-å‡½æ•°" class="headerlink" title="push()å‡½æ•°:"></a><strong>push()å‡½æ•°</strong>:</h4><ul><li>é€šè¿‡ pushState()æ–¹æ³•æ”¹å˜è·¯ç”±å†å²è®°å½•</li><li>è°ƒç”¨ç›‘å¬å‡½æ•°,ä¼ å…¥å˜æ›´ä¿¡æ¯<ul><li>action ç±»å‹</li><li>æœ€æ–° location ä¿¡æ¯</li><li>ç´¢å¼•å˜åŒ–é‡(delta ä¸º 1)</li></ul></li></ul><p>å½“è°ƒç”¨ push()æ–¹æ³•å¯¼èˆªåˆ°æ–°çš„è·¯ç”±æ—¶,ä¼šè§¦å‘ç›‘å¬å‡½æ•°,æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å†…è¿›è¡Œç›¸å…³çš„è·¯ç”±åˆ‡æ¢æ“ä½œã€‚</p><h4 id="replace-å‡½æ•°"><a href="#replace-å‡½æ•°" class="headerlink" title="replace()å‡½æ•°"></a><strong>replace()å‡½æ•°</strong></h4><ul><li><p>é€šè¿‡ replaceState()æ–¹æ³•æ›¿æ¢è·¯ç”±å†å²è®°å½•</p></li><li><p>è°ƒç”¨ç›‘å¬å‡½æ•°,ä¼ å…¥å˜æ›´ä¿¡æ¯</p><ul><li><p>action ç±»å‹</p></li><li><p>æœ€æ–° location ä¿¡æ¯</p></li><li><p>ç´¢å¼•å˜åŒ–é‡(delta ä¸º 0)</p></li></ul></li></ul><p>å½“è°ƒç”¨ replace()æ–¹æ³•å¯¼èˆªåˆ°æ–°çš„è·¯ç”±æ—¶,ä¼šè§¦å‘ç›‘å¬å‡½æ•°,æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å†…è¿›è¡Œç›¸å…³çš„è·¯ç”±åˆ‡æ¢æ“ä½œã€‚</p><h4 id="listen-æ–¹æ³•"><a href="#listen-æ–¹æ³•" class="headerlink" title="listen()æ–¹æ³•"></a><strong>listen()æ–¹æ³•</strong></h4><p>ä½œç”¨</p><ul><li>è®¢é˜… popstate äº‹ä»¶,ç›‘å¬è·¯ç”±å˜åŒ–</li><li>æ¥æ”¶ä¸€ä¸ªå›è°ƒå‡½æ•° fn ,ç”¨ä½œç›‘å¬å‡½æ•°</li><li>è¿”å›ä¸€ä¸ªé”€æ¯ç›‘å¬å™¨çš„å‡½æ•°</li></ul><p>æ•´ä½“æµç¨‹æ˜¯ï¼š</p><ol><li>è°ƒç”¨ listen() è®¢é˜…äº‹ä»¶</li><li>å°è£… fn å‡½æ•°æ¥å¤„ç†è·¯ç”±å˜åŒ–é€»è¾‘</li><li>è°ƒç”¨ remover() ç§»é™¤äº‹ä»¶ç›‘å¬</li></ol><h2 id="5-è·¯å¾„å‚æ•°"><a href="#5-è·¯å¾„å‚æ•°" class="headerlink" title="5. è·¯å¾„å‚æ•°"></a>5. è·¯å¾„å‚æ•°</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/post/:id<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Post</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-1useRoutes"><a href="#5-1useRoutes" class="headerlink" title="5.1useRoutes"></a>5.1useRoutes</h3><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">// æ ¹æ® routes é…ç½®çš„è·¯ç”±è¡¨åŒ¹é…å½“å‰ location,å¹¶æ¸²æŸ“åŒ¹é…çš„è·¯ç”±å…ƒç´ export function useRoutes(routes) &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const location = useLocation() // è·å–å½“å‰ location å¯¹è±¡</span><span class="token prefix unchanged"> </span><span class="token line"> let pathname = location.pathname || "/" // å– pathname,å¦‚æœä¸å­˜åœ¨åˆ™é»˜è®¤ä¸º /</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> let matches = matchRoutes(routes, &#123; pathname &#125;) // ä½¿ç”¨ pathname åŒ¹é… routes è·¯ç”±è¡¨</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> console.log("matches=>", matches)</span><span class="token prefix unchanged"> </span><span class="token line"> if (matches) return match.route.element // åŒ¹é…æˆåŠŸåˆ™æ¸²æŸ“è·¯ç”±ç»„ä»¶</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-2matchRoutes"><a href="#5-2matchRoutes" class="headerlink" title="5.2matchRoutes"></a>5.2matchRoutes</h3><ul><li>æ ¹æ® location å’Œ routes è·å–å½“å‰åº”è¯¥åŒ¹é…çš„å…·ä½“è·¯ç”±</li></ul><p>åŒ¹é…ä¿¡æ¯åŒ…å«:</p><ul><li>è·¯å¾„åŒ¹é…çš„å‚æ•°å€¼</li><li>åŒ¹é…æˆåŠŸçš„å…·ä½“è·¯ç”±</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">//æ ¹æ® location å’Œ routesè·å–å½“å‰åº”è¯¥åŒ¹é…çš„å…·ä½“è·¯ç”±</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">matchRoutes</span><span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> location</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è·å–åœ°å€ä¸­çš„è·¯å¾„</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> pathname <span class="token punctuation">&#125;</span> <span class="token operator">=</span> location  <span class="token comment">// æœ€ç»ˆåŒ¹é…ç»“æœ</span>  <span class="token keyword">let</span> match <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token comment">// éå†è·¯ç”±è¡¨</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> routes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°è¯•ä½¿ç”¨ matchPath åŒ¹é…è·¯å¾„</span>    match <span class="token operator">=</span> <span class="token function">matchPath</span><span class="token punctuation">(</span>routes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>path<span class="token punctuation">,</span> pathname<span class="token punctuation">)</span>    <span class="token comment">// å¦‚æœåŒ¹é…æˆåŠŸ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è®¾ç½®åŒ¹é…çš„è·¯ç”±ä¿¡æ¯</span>      match<span class="token punctuation">.</span>route <span class="token operator">=</span> routes<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      <span class="token comment">// è¿”å›åŒ¹é…ç»“æœ</span>      <span class="token keyword">return</span> match    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ ¹æ®æä¾›çš„è·¯ç”±æ¨¡å¼å’Œè·¯å¾„å°è¯•åŒ¹é…è·¯å¾„,</span><span class="token comment">//å¦‚æœåŒ¹é…æˆåŠŸåˆ™è¿”å›:åŒ¹é…è·¯ç”±çš„å‚æ•°å¯¹è±¡ params</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">matchPath</span><span class="token punctuation">(</span><span class="token parameter">pattern<span class="token punctuation">,</span> pathname</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä½¿ç”¨ compilePath è§£æè·¯ç”±æ¨¡å¼</span>  <span class="token keyword">let</span> <span class="token punctuation">[</span>matcher<span class="token punctuation">,</span> paramNames<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">compilePath</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token comment">// ä½¿ç”¨ matcher å°è¯•åŒ¹é…è·¯å¾„</span>  <span class="token keyword">let</span> match <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœä¸åŒ¹é…åˆ™è¿”å› null</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>  <span class="token comment">// è·å–åŒ¹é…åçš„ç»„å›¢</span>  <span class="token keyword">let</span> captureGroups <span class="token operator">=</span> match<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// åˆ›å»ºparamså¯¹è±¡</span>  <span class="token keyword">let</span> params <span class="token operator">=</span> paramNames<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span> paramName<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    memo<span class="token punctuation">[</span>paramName<span class="token punctuation">]</span> <span class="token operator">=</span> captureGroups<span class="token punctuation">[</span>index<span class="token punctuation">]</span>    <span class="token keyword">return</span> memo  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// è¿”å›åŒ¹é…ç»“æœ,åŒ…æ‹¬params</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    params<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// æ ¹æ®ä¸€ä¸ªè·¯å¾„å­—ç¬¦ä¸²,æ„å»ºä¸€ä¸ªåŒ¹é…è¯¥è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</span><span class="token comment">// åŒæ—¶è®°å½•è·¯å¾„å®šä¹‰çš„å‚æ•°åç§°</span><span class="token keyword">function</span> <span class="token function">compilePath</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> end</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// paramNames ç”¨äºå­˜å‚¨åŒ¹é…çš„å‚æ•°</span>  <span class="token keyword">let</span> paramNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">//  æ„å»ºæ­£åˆ™è¡¨è¾¾å¼çš„æºç  regexpSource</span>  <span class="token comment">// é€šè¿‡è°ƒç”¨ .replace() å¤„ç† path</span>  <span class="token keyword">let</span> regexpSource <span class="token operator">=</span>    <span class="token string">"^"</span> <span class="token operator">+</span>    path      <span class="token comment">// å¤„ç†path</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/\?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/:(\w+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> paramName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å½“åŒ¹é…åˆ° :param æ—¶,å°†å…¶æ›¿æ¢ä¸ºæ•è·ç»„</span>        <span class="token comment">// åŒæ—¶ push åˆ° paramNames</span>        paramNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>paramName<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"/([^\\/]+)"</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœæ˜¯å®Œæ•´åŒ¹é…</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    regexpSource <span class="token operator">+=</span> <span class="token string">"$"</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç¼–è¯‘ regexpSource æˆRegExpå¯¹è±¡</span>  <span class="token keyword">let</span> matcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>regexpSource<span class="token punctuation">)</span>  <span class="token comment">// è¿”å›åŒ¹é…å™¨å’Œå‚æ•°ålist</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span>matcher<span class="token punctuation">,</span> paramNames<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="matchPath-å‡½æ•°"><a href="#matchPath-å‡½æ•°" class="headerlink" title="matchPath å‡½æ•°"></a>matchPath å‡½æ•°</h4><p>æ ¹æ®æä¾›çš„è·¯ç”±æ¨¡å¼å’Œè·¯å¾„å°è¯•åŒ¹é…è·¯å¾„,å¦‚æœåŒ¹é…æˆåŠŸåˆ™è¿”å›:</p><ul><li>åŒ¹é…è·¯ç”±çš„å‚æ•°å¯¹è±¡ params</li></ul><p>params å¯¹è±¡åŒ…å«:</p><ul><li>è·¯ç”±è·¯å¾„ä¸­å®šä¹‰çš„å‚æ•°çš„å€¼</li></ul><p>æ‰€ä»¥,é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°,æˆ‘ä»¬å¯ä»¥è·å¾—:</p><ul><li>è·¯å¾„æ˜¯å¦åŒ¹é…</li><li>åŒ¹é…è·¯ç”±çš„å‚æ•°</li></ul><p>ä»è€Œå¯ä»¥æå–åŒ¹é…åˆ°çš„è·¯ç”±çš„å‚æ•°,ç”¨äºåç»­æ“ä½œã€‚</p><h4 id="compilePath-å‡½æ•°"><a href="#compilePath-å‡½æ•°" class="headerlink" title="compilePath å‡½æ•°"></a>compilePath å‡½æ•°</h4><p>é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°,æˆ‘ä»¬å¯ä»¥è·å¾—: <strong>[matcher, paramNames]</strong></p><ul><li><p>matcher:åŒ¹é…è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼</p></li><li><p>paramNames:è·¯å¾„å®šä¹‰çš„å‚æ•°åç§°åˆ—è¡¨</p></li></ul><p>ä»è€Œæˆ‘ä»¬å¯ä»¥æ ¹æ® matcher æ¥åŒ¹é…è·¯å¾„,æ ¹æ® paramNames æ¥æå–åŒ¹é…åˆ°çš„å‚æ•°ã€‚</p><h2 id="6-Link-å¯¼èˆª"><a href="#6-Link-å¯¼èˆª" class="headerlink" title="6. Link å¯¼èˆª"></a>6. Link å¯¼èˆª</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">é¦–é¡µ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">ç”¨æˆ·ç®¡ç†</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">ä¸ªäººä¸­å¿ƒ</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-1-Link-ç»„ä»¶çš„å®ç°"><a href="#6-1-Link-ç»„ä»¶çš„å®ç°" class="headerlink" title="6.1 Link ç»„ä»¶çš„å®ç°"></a>6.1 Link ç»„ä»¶çš„å®ç°</h3><p>Link ç»„ä»¶å°±æ˜¯ä¸€ä¸ªåŒ…è£…å¥½ç‚¹å‡»è·³è½¬è¡Œä¸ºçš„ a æ ‡ç­¾ã€‚</p><ul><li>æ•è·ç‚¹å‡»äº‹ä»¶</li><li>é˜»æ­¢é»˜è®¤è¡Œä¸º</li><li>è°ƒç”¨ navigate(to, state)è·³è½¬åˆ°æŒ‡å®šè·¯ç”±</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">Link</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æå– to å’Œ state å±æ€§</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> to<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token operator">...</span>rest <span class="token punctuation">&#125;</span> <span class="token operator">=</span> props  <span class="token comment">//ä½¿ç”¨useNavigateè·å–navigateå‡½æ•°</span>  <span class="token keyword">const</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// ç‚¹å‡»æ—¶è§¦å‘ navigate</span>  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token function">navigate</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> state<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›aæ ‡ç­¾,ç»‘å®šç‚¹å‡»äº‹ä»¶</span>  <span class="token keyword">return</span> <span class="token operator">&lt;</span>a <span class="token punctuation">&#123;</span><span class="token operator">...</span>rest<span class="token punctuation">&#125;</span> onClick<span class="token operator">=</span><span class="token punctuation">&#123;</span>handleClick<span class="token punctuation">&#125;</span> <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-2-useNavigate-çš„å®ç°"><a href="#6-2-useNavigate-çš„å®ç°" class="headerlink" title="6.2 useNavigate çš„å®ç°"></a>6.2 useNavigate çš„å®ç°</h3><p>è¿”å›ä¸€ä¸ª navigate() å‡½æ•°</p><p>navigate() å†…éƒ¨ä¼šè°ƒç”¨ <code>navigator.push()</code>æ¥å®ç°è·¯ç”±è·³è½¬</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä» NavigationContextä¸­è¯»å–è·¯ç”±å¯¼èˆªå™¨</span>  <span class="token keyword">let</span> navigator <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>NavigationContext<span class="token punctuation">)</span>  <span class="token comment">// å®šä¹‰navigateå‡½æ•°</span>  <span class="token keyword">let</span> navigate <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useCallback</span><span class="token punctuation">(</span>    <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è°ƒç”¨navigatorçš„pushæ–¹æ³•</span>      navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> state<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token comment">// ä½¿navigateä¾èµ–navigator,åªåœ¨å®ƒæ”¹å˜æ—¶æ›´æ–°</span>    <span class="token punctuation">[</span>navigator<span class="token punctuation">]</span>  <span class="token punctuation">)</span>  <span class="token comment">// è¿”å›navigateå‡½æ•°</span>  <span class="token keyword">return</span> navigate<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-åµŒå¥—è·¯ç”±ï¼ˆæ ¸å¿ƒï¼‰"><a href="#7-åµŒå¥—è·¯ç”±ï¼ˆæ ¸å¿ƒï¼‰" class="headerlink" title="7. åµŒå¥—è·¯ç”±ï¼ˆæ ¸å¿ƒï¼‰"></a>7. åµŒå¥—è·¯ç”±ï¼ˆæ ¸å¿ƒï¼‰</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">User</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAdd</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserList</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>detail/:id<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserDetail</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Route</span></span><span class="token punctuation">></span></span><span class="token comment">//User -----</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/list<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">ç”¨æˆ·åˆ—è¡¨</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/add<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">æ·»åŠ ç”¨æˆ·</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Outlet</span></span> <span class="token punctuation">/></span></span><span class="token plain-text"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-1-æ•°æ®ç»“æ„"><a href="#7-1-æ•°æ®ç»“æ„" class="headerlink" title="7.1 æ•°æ®ç»“æ„"></a>7.1 æ•°æ®ç»“æ„</h3><h4 id="7-1-1-routes"><a href="#7-1-1-routes" class="headerlink" title="7.1.1 routes"></a>7.1.1 routes</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Home <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>User <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span>    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>UserAdd <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>UserList <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>UserDetail <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token operator">&lt;</span>NotFound <span class="token operator">/</span><span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7-1-1branches"><a href="#7-1-1branches" class="headerlink" title="7.1.1branches"></a>7.1.1branches</h4><p>ç®€ä»‹ç‰ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> branches <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/*/add"</span><span class="token punctuation">,</span> <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>user <span class="token operator">*</span> Meta<span class="token punctuation">,</span> addMeta<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/*/list"</span><span class="token punctuation">,</span> <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>user <span class="token operator">*</span> Meta<span class="token punctuation">,</span> listMeta<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/*/detail"</span><span class="token punctuation">,</span> <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>user <span class="token operator">*</span> Meta<span class="token punctuation">,</span> detailMeta<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/*"</span><span class="token punctuation">,</span> <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>user <span class="token operator">*</span> Meta<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¤æ‚ç‰ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> branches <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/detail/:id"</span><span class="token punctuation">,</span>    <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/add"</span><span class="token punctuation">,</span>    <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user/list"</span><span class="token punctuation">,</span>    <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">24</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>    <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#123;</span>              <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span>              <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>                <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">13</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>    <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/*"</span><span class="token punctuation">,</span>    <span class="token literal-property property">routesMeta</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">relativePath</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>        <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span>          <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token literal-property property">type</span><span class="token operator">:</span> Profile<span class="token punctuation">,</span>            <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7-1-2-matches"><a href="#7-1-2-matches" class="headerlink" title="7.1.2 matches"></a>7.1.2 matches</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> matches <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>    <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> User<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">"/user/list"</span><span class="token punctuation">,</span>    <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> UserList<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="7-1-3-renderMatches"><a href="#7-1-3-renderMatches" class="headerlink" title="7.1.3 renderMatches"></a>7.1.3 renderMatches</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> element <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">outlet</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>provider<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">outlet</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>            <span class="token literal-property property">matches</span><span class="token operator">:</span> <span class="token punctuation">[</span>              <span class="token punctuation">&#123;</span>                <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>                <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                  <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token literal-property property">type</span><span class="token operator">:</span> User<span class="token punctuation">,</span>                    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#123;</span>                <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">"/user/list"</span><span class="token punctuation">,</span>                <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                  <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token literal-property property">type</span><span class="token operator">:</span> User<span class="token punctuation">,</span>                    <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>                  <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token literal-property property">matches</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>          <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>          <span class="token literal-property property">route</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>              $$<span class="token keyword">typeof</span><span class="token operator">:</span> <span class="token function">Symbol</span><span class="token punctuation">(</span>react<span class="token punctuation">.</span>element<span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token literal-property property">type</span><span class="token operator">:</span> User<span class="token punctuation">,</span>              <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-2useRoutesï¼ˆå®Œæ•´ç‰ˆï¼‰"><a href="#7-2useRoutesï¼ˆå®Œæ•´ç‰ˆï¼‰" class="headerlink" title="7.2useRoutesï¼ˆå®Œæ•´ç‰ˆï¼‰"></a>7.2useRoutesï¼ˆå®Œæ•´ç‰ˆï¼‰</h3><ul><li>æ ¹æ®å½“å‰åœ°å€</li><li>ä»è·¯ç”±è¡¨ä¸­åŒ¹é…è·¯å¾„</li><li>å¦‚æœåŒ¹é…æˆåŠŸåˆ™æ¸²æŸ“åŒ¹é…çš„è·¯ç”±</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useRoutes</span><span class="token punctuation">(</span><span class="token parameter">routes</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä» LocationContext ä¸­è¯»å–åœ°å€</span>  <span class="token keyword">let</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// è·å–è·¯å¾„</span>  <span class="token keyword">let</span> pathname <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname <span class="token operator">||</span> <span class="token string">"/"</span>  <span class="token comment">// è°ƒç”¨matchRoutesåŒ¹é…è·¯å¾„</span>  <span class="token keyword">let</span> matches <span class="token operator">=</span> <span class="token function">matchRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> pathname <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœåŒ¹é…æˆåŠŸ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>matches<span class="token punctuation">)</span>    <span class="token comment">// æ¸²æŸ“åŒ¹é…ç»“æœ</span>    <span class="token keyword">return</span> <span class="token function">renderMatches</span><span class="token punctuation">(</span>matches<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="matchRoutes"><a href="#matchRoutes" class="headerlink" title="matchRoutes"></a>matchRoutes</h4><blockquote><p>æ ¹æ®æä¾›çš„ location å’Œ routesï¼Œå°†è·¯ç”±æ‰å¹³åŒ–å¹¶åˆ†çº§ä¸ºå¤šä¸ªåˆ†æ”¯ï¼Œéå†æ¯ä¸ªåˆ†æ”¯å°è¯•åŒ¹é…ï¼Œè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…æˆåŠŸçš„ç»“æœ</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">matchRoutes</span><span class="token punctuation">(</span><span class="token parameter">routes<span class="token punctuation">,</span> location</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»åœ°å€ä¸­è·å–è·¯å¾„</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> pathname <span class="token punctuation">&#125;</span> <span class="token operator">=</span> location  <span class="token comment">// å°†åµŒå¥—è·¯ç”±æ‰å¹³åŒ–ä¸ºä¸€ä¸ªæ•°ç»„</span>  <span class="token keyword">let</span> branches <span class="token operator">=</span> <span class="token function">flattenRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span>  <span class="token comment">// ç»™è·¯ç”±åˆ†çº§</span>  <span class="token function">rankRouteBranches</span><span class="token punctuation">(</span>branches<span class="token punctuation">)</span>  <span class="token comment">// åˆå§‹åŒ–matchesä¸ºnull</span>  <span class="token keyword">let</span> matches <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token comment">// éå†æ‰å¹³åçš„è·¯ç”±æ•°ç»„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> matches <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> branches<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°è¯•åŒ¹é…å½“å‰åˆ†æ”¯</span>    matches <span class="token operator">=</span> <span class="token function">matchRouteBranch</span><span class="token punctuation">(</span>branches<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> pathname<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›åŒ¹é…ç»“æœ</span>  <span class="token keyword">return</span> matches<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-3flattenRoutes"><a href="#7-3flattenRoutes" class="headerlink" title="7.3flattenRoutes"></a>7.3flattenRoutes</h3><ul><li>å°†ä¸€ä¸ªåµŒå¥—çš„è·¯ç”±æ•°ç»„:æ‰å¹³åŒ–ä¸ºä¸€ä¸ªå•å±‚çš„è·¯ç”±æ•°ç»„,åŒæ—¶è®°å½•æ¯ä¸ªè·¯ç”±çš„å…ƒæ•°æ®(å­è·¯ç”±ç´¢å¼•ã€å®Œæ•´è·¯å¾„ç­‰)</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">joinPaths</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">paths</span><span class="token punctuation">)</span> <span class="token operator">=></span> paths<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/\/+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œå°†åµŒå¥—çš„è·¯ç”±æ•°ç»„æ‰å¹³åŒ–</span><span class="token keyword">function</span> <span class="token function">flattenRoutes</span><span class="token punctuation">(</span>  routes<span class="token punctuation">,</span>  branches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  parentsMeta <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  parentPath <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œå¤„ç†å•ä¸ªè·¯ç”±å¯¹è±¡</span>  <span class="token keyword">let</span> <span class="token function-variable function">flattenRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">route<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å®šä¹‰ä¸€ä¸ªå…ƒæ•°æ®å¯¹è±¡ï¼Œå­˜å‚¨è·¯ç”±ç›¸å…³ä¿¡æ¯</span>    <span class="token keyword">let</span> meta <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">relativePath</span><span class="token operator">:</span> route<span class="token punctuation">.</span>path<span class="token punctuation">,</span>      <span class="token literal-property property">childrenIndex</span><span class="token operator">:</span> index<span class="token punctuation">,</span>      route<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// ä½¿ç”¨ joinPaths å‡½æ•°å°†çˆ¶è·¯å¾„ä¸å½“å‰ç›¸å¯¹è·¯å¾„ç»„åˆï¼Œç”Ÿæˆå®Œæ•´è·¯å¾„</span>    <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">joinPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span>parentPath<span class="token punctuation">,</span> meta<span class="token punctuation">.</span>relativePath<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token comment">// å°†å½“å‰è·¯ç”±å…ƒæ•°æ®æ·»åŠ åˆ°çˆ¶çº§å…ƒæ•°æ®æ•°ç»„ä¸­</span>    <span class="token keyword">let</span> routesMeta <span class="token operator">=</span> parentsMeta<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>meta<span class="token punctuation">)</span>    <span class="token comment">// å¦‚æœå½“å‰è·¯ç”±å¯¹è±¡æœ‰å­è·¯ç”±ï¼Œåˆ™é€’å½’å¤„ç†</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>route<span class="token punctuation">.</span>children <span class="token operator">&amp;&amp;</span> route<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">flattenRoutes</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>children<span class="token punctuation">,</span> branches<span class="token punctuation">,</span> routesMeta<span class="token punctuation">,</span> path<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å°†è·¯å¾„å’Œå…ƒæ•°æ®å¯¹è±¡æ·»åŠ åˆ°ç»“æœæ•°ç»„ä¸­</span>    branches<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> path<span class="token punctuation">,</span> routesMeta<span class="token punctuation">,</span> <span class="token literal-property property">score</span><span class="token operator">:</span> <span class="token function">computeScore</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> route<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// éå†è·¯ç”±æ•°ç»„ï¼Œè°ƒç”¨å†…éƒ¨å‡½æ•°å¤„ç†æ¯ä¸ªè·¯ç”±å¯¹è±¡</span>  routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">route<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">flattenRoute</span><span class="token punctuation">(</span>route<span class="token punctuation">,</span> index<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// è¿”å›æ‰å¹³åŒ–åçš„è·¯ç”±æ•°ç»„</span>  <span class="token keyword">return</span> branches<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="computeScore"><a href="#computeScore" class="headerlink" title="computeScore"></a>computeScore</h4><p>æ ¹æ® path è®¡ç®—ä¸€ä¸ªåˆ†æ•°ä¸»è¦æ ¹æ®è·¯å¾„ä¸­çš„é™æ€ç‰‡æ–­ã€å‚æ•°ã€é€šé…ç¬¦ç­‰æ ¹æ®è¿™äº›ç‰¹å¾æ¥ç»™äºˆä¸åŒçš„â€åˆ†æ•°â€åˆ†æ•°è¾ƒé«˜çš„è·¯å¾„åŒ¹é…ç¨‹åº¦è¾ƒå¥½</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// å¦‚æœè·¯å¾„ä¸­æœ‰é€šé…ç¬¦*å°±å‡å°‘2åˆ†</span><span class="token keyword">const</span> splatPenalty <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span><span class="token comment">// ä½œä¸ºindexRouteå¢åŠ 2åˆ†</span><span class="token keyword">const</span> indexRouteValue <span class="token operator">=</span> <span class="token number">2</span><span class="token comment">// å®šä¹‰å‚æ•°æ­£åˆ™</span><span class="token keyword">const</span> paramRegexp <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^:\w+$</span><span class="token regex-delimiter">/</span></span><span class="token comment">// åŠ¨æ€ç‰‡æ–­å¢åŠ 3åˆ†</span><span class="token keyword">const</span> dynamicSegmentValue <span class="token operator">=</span> <span class="token number">3</span><span class="token comment">// ç©ºç‰‡æ–­å¢åŠ 1åˆ†</span><span class="token keyword">const</span> emptySegmentValue <span class="token operator">=</span> <span class="token number">1</span><span class="token comment">// é™æ€ç‰‡æ–­å¢åŠ 10åˆ†</span><span class="token keyword">const</span> staticSegmentValue <span class="token operator">=</span> <span class="token number">10</span><span class="token comment">// åˆ¤æ–­æ˜¯å¦æœ‰*</span><span class="token keyword">const</span> <span class="token function-variable function">isSplat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> s <span class="token operator">===</span> <span class="token string">"*"</span><span class="token keyword">function</span> <span class="token function">computeScore</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åˆ†æ•°</span>  <span class="token keyword">let</span> initialScore <span class="token operator">=</span> segments<span class="token punctuation">.</span>length  <span class="token comment">// å¦‚æœæœ‰*,å‡å°‘2åˆ†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>segments<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>isSplat<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    initialScore <span class="token operator">+=</span> splatPenalty  <span class="token punctuation">&#125;</span>  <span class="token comment">// å¦‚æœæ˜¯indexRoute,å¢åŠ 2åˆ†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> index <span class="token operator">!==</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    initialScore <span class="token operator">+=</span> indexRouteValue  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›æ¯ä¸ªç‰‡æ–­è®¡ç®—åçš„åˆ†æ•°</span>  <span class="token keyword">return</span> segments<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isSplat<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">score<span class="token punctuation">,</span> segment</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å½“å‰ç‰‡æ–­çš„åˆ†æ•°</span>    <span class="token keyword">let</span> currentScope <span class="token operator">=</span> <span class="token number">0</span>    <span class="token comment">// å¦‚æœæ˜¯è·¯å¾„å‚æ•°,å¢åŠ 3åˆ†</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>paramRegexp<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>segment<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      currentScope <span class="token operator">+=</span> dynamicSegmentValue    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœæ˜¯ç©ºç‰‡æ–­,å¢åŠ 1åˆ†</span>    <span class="token comment">// å¦‚æœæ˜¯é™æ€ç‰‡æ–­,å¢åŠ 10åˆ†</span>    <span class="token comment">// ...</span>    <span class="token comment">// æ€»åˆ†+å½“å‰ç‰‡æ–­çš„åˆ†æ•°</span>    score <span class="token operator">+=</span> currentScope    <span class="token comment">// è¿”å›æ€»åˆ†</span>    <span class="token keyword">return</span> score  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> initialScore<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="rankRouteBranches"><a href="#rankRouteBranches" class="headerlink" title="rankRouteBranches"></a>rankRouteBranches</h4><p>å°†è·¯ç”±æ•°ç»„æ ¹æ® score è¿›è¡Œæ’åºï¼Œscore é«˜çš„åˆ†æ”¯æ’åœ¨å‰é¢ï¼Œå¦‚æœ score ç›¸åŒåˆ™æ ¹æ®å­è·¯ç”± index æ’åº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">rankRouteBranches</span><span class="token punctuation">(</span><span class="token parameter">branches</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æ ¹æ® score æ’åº branches</span>  branches<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ¯”è¾ƒ score</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>score <span class="token operator">!==</span> b<span class="token punctuation">.</span>score<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> b<span class="token punctuation">.</span>score <span class="token operator">-</span> a<span class="token punctuation">.</span>score    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœ score ç›¸åŒ</span>    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ¯”è¾ƒå­è·¯ç”±çš„ index</span>      <span class="token keyword">return</span> <span class="token function">compareIndexes</span><span class="token punctuation">(</span>        a<span class="token punctuation">.</span>routesMeta<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">meta</span><span class="token punctuation">)</span> <span class="token operator">=></span> meta<span class="token punctuation">.</span>childrenIndex<span class="token punctuation">)</span><span class="token punctuation">,</span>        b<span class="token punctuation">.</span>routesMeta<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">meta</span><span class="token punctuation">)</span> <span class="token operator">=></span> meta<span class="token punctuation">.</span>childrenIndex<span class="token punctuation">)</span>      <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-4-matchRouteBranch"><a href="#7-4-matchRouteBranch" class="headerlink" title="7.4 matchRouteBranch"></a>7.4 matchRouteBranch</h3><blockquote><p>æ ¹æ®æä¾›çš„ branch å’Œ pathnameï¼Œéå† branch ä¸­çš„è·¯ç”±å…ƒæ•°æ®ï¼Œå°è¯•åŒ¹é…æ¯ä¸ªè·¯ç”±è·¯å¾„ï¼Œå¦‚æœåŒ¹é…æˆåŠŸåˆ™æ”¶é›†åŒ¹é…ä¿¡æ¯ï¼Œæœ€ç»ˆè¿”å›æ‰€æœ‰åŒ¹é…æˆåŠŸçš„ç»“æœ</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">/** * å®šä¹‰matchRouteBranchå‡½æ•°ï¼Œç”¨äºåŒ¹é…è·¯ç”±åˆ†æ”¯å’Œè·¯å¾„å * @param &#123;*&#125; branch åˆ†æ”¯ * @param &#123;*&#125; pathname è·¯å¾„å * @returns */</span><span class="token keyword">function</span> <span class="token function">matchRouteBranch</span><span class="token punctuation">(</span><span class="token parameter">branch<span class="token punctuation">,</span> pathname</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»branchä¸­è§£æ„routesMeta</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> routesMeta <span class="token punctuation">&#125;</span> <span class="token operator">=</span> branch  <span class="token comment">// åˆå§‹åŒ–åŒ¹é…å‚æ•°ã€åŒ¹é…è·¯å¾„åã€åŒ¹é…æ•°ç»„</span>  <span class="token keyword">let</span> matchedParams <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> matchedPathname <span class="token operator">=</span> <span class="token string">"/"</span>  <span class="token keyword">let</span> matches <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// éå†routesMeta</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> routesMeta<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è·å–å½“å‰å…ƒç´ çš„meta</span>    <span class="token keyword">let</span> meta <span class="token operator">=</span> routesMeta<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸ºæœ€åä¸€ä¸ªå…ƒç´ </span>    <span class="token keyword">let</span> end <span class="token operator">=</span> i <span class="token operator">===</span> routesMeta<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>    <span class="token comment">// è·å–å‰©ä½™è·¯å¾„å</span>    <span class="token keyword">let</span> remainingPathname <span class="token operator">=</span>      matchedPathname <span class="token operator">===</span> <span class="token string">"/"</span>        <span class="token operator">?</span> pathname        <span class="token operator">:</span> pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>matchedPathname<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">"/"</span>    <span class="token comment">// è·å–å½“å‰è·¯å¾„åŒ¹é…ç»“æœ</span>    <span class="token keyword">let</span> match <span class="token operator">=</span> <span class="token function">matchPath</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> meta<span class="token punctuation">.</span>relativePath<span class="token punctuation">,</span> end <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> remainingPathname<span class="token punctuation">)</span>    <span class="token comment">// è‹¥æ²¡æœ‰åŒ¹é…ç»“æœï¼Œè¿”å›null</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>    <span class="token comment">// å°†å½“å‰åŒ¹é…å‚æ•°åˆå¹¶åˆ°matchedParams</span>    Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>matchedParams<span class="token punctuation">,</span> match<span class="token punctuation">.</span>params<span class="token punctuation">)</span>    <span class="token comment">// è·å–å½“å‰è·¯ç”±</span>    <span class="token keyword">let</span> route <span class="token operator">=</span> meta<span class="token punctuation">.</span>route    <span class="token comment">// å°†åŒ¹é…ç»“æœæ·»åŠ åˆ°matchesæ•°ç»„</span>    matches<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>      <span class="token literal-property property">params</span><span class="token operator">:</span> matchedParams<span class="token punctuation">,</span>      <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token function">joinPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span>matchedPathname<span class="token punctuation">,</span> match<span class="token punctuation">.</span>pathname<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      route<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">// æ›´æ–°åŒ¹é…è·¯å¾„å</span>    matchedPathname <span class="token operator">=</span> <span class="token function">joinPaths</span><span class="token punctuation">(</span><span class="token punctuation">[</span>matchedPathname<span class="token punctuation">,</span> match<span class="token punctuation">.</span>pathname<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›åŒ¹é…ç»“æœæ•°ç»„</span>  <span class="token keyword">return</span> matches<span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">joinPaths</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">paths</span><span class="token punctuation">)</span> <span class="token operator">=></span> paths<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/\/+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="matchPath"><a href="#matchPath" class="headerlink" title="matchPath"></a>matchPath</h4><h5 id="matchPath-å‡½æ•°-1"><a href="#matchPath-å‡½æ•°-1" class="headerlink" title="matchPath å‡½æ•°"></a>matchPath å‡½æ•°</h5><p>æ ¹æ®æä¾›çš„è·¯ç”±æ¨¡å¼å’Œè·¯å¾„å°è¯•åŒ¹é…è·¯å¾„,å¦‚æœåŒ¹é…æˆåŠŸåˆ™è¿”å›:</p><ul><li>åŒ¹é…è·¯ç”±çš„å‚æ•°å¯¹è±¡ params</li></ul><p>params å¯¹è±¡åŒ…å«:</p><ul><li>è·¯ç”±è·¯å¾„ä¸­å®šä¹‰çš„å‚æ•°çš„å€¼</li></ul><p>æ‰€ä»¥,é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°,æˆ‘ä»¬å¯ä»¥è·å¾—:</p><ul><li>è·¯å¾„æ˜¯å¦åŒ¹é…</li><li>åŒ¹é…è·¯ç”±çš„å‚æ•°</li></ul><p>ä»è€Œå¯ä»¥æå–åŒ¹é…åˆ°çš„è·¯ç”±çš„å‚æ•°,ç”¨äºåç»­æ“ä½œã€‚</p><h5 id="compilePath-å‡½æ•°-1"><a href="#compilePath-å‡½æ•°-1" class="headerlink" title="compilePath å‡½æ•°"></a>compilePath å‡½æ•°</h5><p>é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°,æˆ‘ä»¬å¯ä»¥è·å¾—: <strong>[matcher, paramNames]</strong></p><ul><li><p>matcher:åŒ¹é…è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼</p></li><li><p>paramNames:è·¯å¾„å®šä¹‰çš„å‚æ•°åç§°åˆ—è¡¨</p></li></ul><p>ä»è€Œæˆ‘ä»¬å¯ä»¥æ ¹æ® matcher æ¥åŒ¹é…è·¯å¾„,æ ¹æ® paramNames æ¥æå–åŒ¹é…åˆ°çš„å‚æ•°ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//æ ¹æ®æä¾›çš„è·¯ç”±æ¨¡å¼å’Œè·¯å¾„å°è¯•åŒ¹é…è·¯å¾„,</span><span class="token comment">//å¦‚æœåŒ¹é…æˆåŠŸåˆ™è¿”å›:åŒ¹é…è·¯ç”±çš„å‚æ•°å¯¹è±¡ params</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">matchPath</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> path<span class="token punctuation">,</span> end <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> pathname</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è°ƒç”¨compilePathè§£æè·¯ç”±</span>  <span class="token keyword">let</span> <span class="token punctuation">[</span>matcher<span class="token punctuation">,</span> paramNames<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">compilePath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> end<span class="token punctuation">)</span>  <span class="token comment">// ä½¿ç”¨ matcher å°è¯•åŒ¹é…è·¯å¾„</span>  <span class="token keyword">let</span> match <span class="token operator">=</span> pathname<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>matcher<span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœä¸åŒ¹é…åˆ™è¿”å›null</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>match<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>  <span class="token comment">// è·å–å·²åŒ¹é…çš„è·¯å¾„</span>  <span class="token keyword">let</span> matchedPathname <span class="token operator">=</span> match<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">// è·å–åŒ¹é…ç»„å›¢</span>  <span class="token keyword">let</span> captureGroups <span class="token operator">=</span> match<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// åˆ›å»ºparamså¯¹è±¡</span>  <span class="token keyword">let</span> params <span class="token operator">=</span> paramNames<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">memo<span class="token punctuation">,</span> paramName<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    memo<span class="token punctuation">[</span>paramName<span class="token punctuation">]</span> <span class="token operator">=</span> captureGroups<span class="token punctuation">[</span>index<span class="token punctuation">]</span>    <span class="token keyword">return</span> memo  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// è¿”å›åŒ¹é…ç»“æœ</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    params<span class="token punctuation">,</span>    <span class="token literal-property property">pathname</span><span class="token operator">:</span> matchedPathname<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">compilePath</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä¿å­˜è·¯å¾„å‚æ•°åç§°</span>  <span class="token keyword">let</span> paramNames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ä¿å­˜æ­£åˆ™è¡¨è¾¾å¼æºç </span>  <span class="token keyword">let</span> regexpSource <span class="token operator">=</span>    <span class="token string">"^"</span> <span class="token operator">+</span>    path      <span class="token comment">// å»æ‰è·¯å¾„æœ«å°¾çš„ *ã€**</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/\?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>      <span class="token comment">// ç¡®ä¿è·¯å¾„ä»¥/å¼€å§‹</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\/*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span>      <span class="token comment">// å½“åŒ¹é… :param æ—¶,å°†å…¶æ›¿æ¢ä¸ºæ•è·ç»„</span>      <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/:(\w+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> paramName</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        paramNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>paramName<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token string">"/([^\\/]+)"</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// å¦‚æœè·¯å¾„ä¸º*æ—¶,å°†*åŠ å…¥åç§°åˆ—è¡¨,å¹¶ä½¿æ­£åˆ™åŒ¹é…ä»»æ„å†…å®¹</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>path <span class="token operator">===</span> <span class="token string">"*"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    paramNames<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span>    regexpSource <span class="token operator">+=</span> <span class="token string">"(.*)$"</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å¦‚æœéœ€è¦å®Œæ•´åŒ¹é…,æ·»åŠ $</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>end<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    regexpSource <span class="token operator">+=</span> <span class="token string">"$"</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼</span>  <span class="token keyword">let</span> matcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span>regexpSource<span class="token punctuation">)</span>  <span class="token comment">// è¿”å›åŒ¹é…å™¨å’Œå‚æ•°åç§°</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span>matcher<span class="token punctuation">,</span> paramNames<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-5renderMatches-å‡½æ•°çš„å®ç°"><a href="#7-5renderMatches-å‡½æ•°çš„å®ç°" class="headerlink" title="7.5renderMatches å‡½æ•°çš„å®ç°"></a>7.5renderMatches å‡½æ•°çš„å®ç°</h3><ol><li>åˆ›å»ºäº†ä¸€ä¸ª RouteContext</li><li>renderMatches å‡½æ•°çš„ä½œç”¨æ˜¯:</li></ol><p>å°†åŒ¹é…ç»“æœæ•°ç»„ä»å³å‘å·¦æ¸²æŸ“ï¼Œä¸º æ¯ä¸ª match æ¸²æŸ“å¯¹åº”è·¯ç”±æ—¶ï¼Œé€šè¿‡ RouteContext.Provider æä¾›å®Œæ•´çš„ matches åŠ outlet ç»™ä¸‹çº§ç»„ä»¶ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸‹ä¸€çº§ç»„ä»¶å°±å¯ä»¥è®¿é—®å®Œæ•´çš„ matches æ•°ç»„å’Œ outletã€‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token comment">// åˆ›å»ºRouteContextè¿™ä¸ªcontext</span><span class="token keyword">export</span> <span class="token keyword">const</span> RouteContext <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">createContext</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">outlet</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>  <span class="token literal-property property">matches</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// å®šä¹‰æ¸²æŸ“åŒ¹é…ç»“æœçš„å‡½æ•°</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">renderMatches</span><span class="token punctuation">(</span><span class="token parameter">renderedMatches</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä½¿ç”¨ reduceRight ä»å³å‘å·¦éå†æ•°ç»„</span>  <span class="token keyword">return</span> renderedMatches<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">outlet<span class="token punctuation">,</span> match<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è·å–å½“å‰å…ƒç´ åŒ¹é…ç»“æœä¹‹å‰çš„æ•°ç»„</span>    <span class="token keyword">let</span> matches <span class="token operator">=</span> renderedMatches<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">// è¿”å›RouteContext.Providerç»„ä»¶</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RouteContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> outlet<span class="token punctuation">,</span> matches <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        // æ¸²æŸ“å½“å‰matchå¯¹åº”çš„route        </span><span class="token punctuation">&#123;</span>match<span class="token punctuation">.</span>route<span class="token punctuation">.</span>element<span class="token punctuation">&#125;</span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">RouteContext.Provider</span></span><span class="token punctuation">></span></span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-6-useOutlet-çš„å®ç°"><a href="#7-6-useOutlet-çš„å®ç°" class="headerlink" title="7.6 useOutlet çš„å®ç°"></a>7.6 useOutlet çš„å®ç°</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useOutlet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> outlet <span class="token punctuation">&#125;</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>RouteContext<span class="token punctuation">)</span>  <span class="token keyword">return</span> outlet<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="7-7-useParams-çš„å®ç°"><a href="#7-7-useParams-çš„å®ç°" class="headerlink" title="7.7 useParams çš„å®ç°"></a>7.7 useParams çš„å®ç°</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> matches <span class="token punctuation">&#125;</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>RouteContext<span class="token punctuation">)</span>  <span class="token keyword">let</span> routeMatch <span class="token operator">=</span> matches<span class="token punctuation">[</span>matches<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token keyword">return</span> routeMatch <span class="token operator">?</span> routeMatch<span class="token punctuation">.</span>params <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="8-å®ç°-NavLink"><a href="#8-å®ç°-NavLink" class="headerlink" title="8. å®ç° NavLink"></a>8. å®ç° NavLink</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> activeStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">'green'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">const</span> activeClassName <span class="token operator">=</span> <span class="token string">'active'</span><span class="token punctuation">;</span><span class="token keyword">const</span> activeNavProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isActive <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> isActive <span class="token operator">?</span> activeStyle <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">className</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isActive <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> isActive <span class="token operator">?</span> activeClassName <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>NavLink end<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span> to<span class="token operator">=</span><span class="token string">"/"</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span><span class="token operator">></span>é¦–é¡µ<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">"/user/list"</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span><span class="token operator">></span>ç”¨æˆ·ç®¡ç†<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span class="token operator">&lt;</span>li<span class="token operator">></span><span class="token operator">&lt;</span>NavLink to<span class="token operator">=</span><span class="token string">"/profile"</span> <span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span><span class="token operator">></span>ä¸ªäººä¸­å¿ƒ<span class="token operator">&lt;</span><span class="token operator">/</span>NavLink<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>li<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é«˜äº®çš„é“¾æ¥ç»„ä»¶ï¼Œå½“è¢«ç‚¹å‡»ä¸”åŒ¹é…è·¯å¾„æ—¶,ä¼šè‡ªåŠ¨æ·»åŠ  active ç±»å</p></blockquote><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">NavLink</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token comment">// æ ·å¼å</span>  <span class="token literal-property property">className</span><span class="token operator">:</span> classNameProp <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">,</span>  <span class="token comment">// æ˜¯å¦å®Œæ•´åŒ¹é…</span>  end <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// æ ·å¼å¯¹è±¡</span>  <span class="token literal-property property">style</span><span class="token operator">:</span> styleProp <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token comment">// è·³è½¬è·¯å¾„</span>  to<span class="token punctuation">,</span>  <span class="token comment">// å­å…ƒç´ </span>  children<span class="token punctuation">,</span>  <span class="token operator">...</span>rest<span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ä»contextè·å–location</span>  <span class="token keyword">let</span> location <span class="token operator">=</span> <span class="token function">useLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// éœ€è¦è·³è½¬çš„è·¯å¾„</span>  <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">pathname</span><span class="token operator">:</span> to <span class="token punctuation">&#125;</span>  <span class="token comment">// å½“å‰çš„è·¯å¾„</span>  <span class="token keyword">let</span> locationPathname <span class="token operator">=</span> location<span class="token punctuation">.</span>pathname  <span class="token comment">// è·³è½¬çš„è·¯å¾„</span>  <span class="token keyword">let</span> toPathname <span class="token operator">=</span> path<span class="token punctuation">.</span>pathname  <span class="token comment">// åˆ¤æ–­æ˜¯å¦é«˜äº®</span>  <span class="token keyword">let</span> isActive <span class="token operator">=</span>    locationPathname <span class="token operator">===</span> toPathname <span class="token operator">||</span>    <span class="token punctuation">(</span><span class="token operator">!</span>end <span class="token operator">&amp;&amp;</span>      locationPathname<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>toPathname<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      locationPathname<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>toPathname<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"/"</span><span class="token punctuation">)</span>  <span class="token comment">// æ ¹æ®æ ·å¼å å‚æ•°è·å–æœ€ç»ˆçš„ className</span>  <span class="token keyword">let</span> className  <span class="token comment">// æ ¹æ®æ ·å¼å¯¹è±¡(å‡½æ•°|å¯¹è±¡)è·å–æœ€ç»ˆçš„ style</span>  <span class="token keyword">let</span> style  <span class="token comment">// è¿”å›Linkç»„ä»¶,ç»‘å®šclassNameå’Œstyle</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Link</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>rest<span class="token punctuation">&#125;</span></span> <span class="token attr-name">to</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>to<span class="token punctuation">&#125;</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>className<span class="token punctuation">&#125;</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>style<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token punctuation">&#123;</span>children<span class="token punctuation">&#125;</span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Link</span></span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="9-å®ç°-Navigate"><a href="#9-å®ç°-Navigate" class="headerlink" title="9.å®ç° Navigate"></a>9.å®ç° Navigate</h2><p><strong>å®ç°è·¯ç”±è·³è½¬å’Œé‡å®šå‘</strong></p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>*<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">Navigate</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> to<span class="token punctuation">,</span> state <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> navigate <span class="token operator">=</span> <span class="token function">useNavigate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  React<span class="token punctuation">.</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">navigate</span><span class="token punctuation">(</span>to<span class="token punctuation">,</span> state<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="10-å—ä¿æŠ¤è·¯ç”±ï¼ˆæƒé™ï¼‰"><a href="#10-å—ä¿æŠ¤è·¯ç”±ï¼ˆæƒé™ï¼‰" class="headerlink" title="10. å—ä¿æŠ¤è·¯ç”±ï¼ˆæƒé™ï¼‰"></a>10. å—ä¿æŠ¤è·¯ç”±ï¼ˆæƒé™ï¼‰</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Protected</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>Profile<span class="token punctuation">&#125;</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Route</span></span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span> <span class="token attr-name">element</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Login</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Protected</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Navigate <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"../react-router-dom"</span><span class="token keyword">function</span> <span class="token function">Protected</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">component</span><span class="token operator">:</span> RouteComponent<span class="token punctuation">,</span> path <span class="token punctuation">&#125;</span> <span class="token operator">=</span> props  <span class="token keyword">return</span> localStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">"login"</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RouteComponent</span></span> <span class="token punctuation">/></span></span>  <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Navigate</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login<span class="token punctuation">"</span></span> <span class="token attr-name">state</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">from</span><span class="token operator">:</span> path <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> Protected<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="13-é…ç½®å¼è·¯ç”±å’Œæ‡’åŠ è½½"><a href="#13-é…ç½®å¼è·¯ç”±å’Œæ‡’åŠ è½½" class="headerlink" title="13. é…ç½®å¼è·¯ç”±å’Œæ‡’åŠ è½½"></a>13. é…ç½®å¼è·¯ç”±å’Œæ‡’åŠ è½½</h2><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom/client"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span>  BrowserRouter<span class="token punctuation">,</span>  Routes<span class="token punctuation">,</span>  Route<span class="token punctuation">,</span>  NavLink<span class="token punctuation">,</span>  Navigate<span class="token punctuation">,</span>  useRoutes<span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./react-router-dom"</span><span class="token keyword">import</span> routesConfig <span class="token keyword">from</span> <span class="token string">"./routesConfig"</span><span class="token keyword">const</span> LazyPost <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./components/Post"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> <span class="token punctuation">[</span>routes<span class="token punctuation">,</span> setRoutes<span class="token punctuation">]</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useState</span><span class="token punctuation">(</span>routesConfig<span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token function-variable function">addRoute</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setRoutes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>      <span class="token operator">...</span>routes<span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/post"</span><span class="token punctuation">,</span>        <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token punctuation">(</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">React.Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LazyPost</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">React.Suspense</span></span><span class="token punctuation">></span></span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token punctuation">&#123;</span><span class="token function">useRoutes</span><span class="token punctuation">(</span>routes<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>addRoute<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">addRoute</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> activeStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">backgroundColor</span><span class="token operator">:</span> <span class="token string">"green"</span> <span class="token punctuation">&#125;</span><span class="token keyword">const</span> activeClassName <span class="token operator">=</span> <span class="token string">"active"</span><span class="token keyword">const</span> activeNavProps <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">style</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isActive <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>isActive <span class="token operator">?</span> activeStyle <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function-variable function">className</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> isActive <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>isActive <span class="token operator">?</span> activeClassName <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">end</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          é¦–é¡µ        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/list<span class="token punctuation">"</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          ç”¨æˆ·ç®¡ç†        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/profile<span class="token punctuation">"</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          ä¸ªäººä¸­å¿ƒ        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NavLink</span></span> <span class="token attr-name">to</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/post<span class="token punctuation">"</span></span> <span class="token spread"><span class="token punctuation">&#123;</span><span class="token operator">...</span>activeNavProps<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          post        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">NavLink</span></span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">BrowserRouter</span></span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src\routesConfig.js</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">"./components/Home"</span><span class="token keyword">import</span> User <span class="token keyword">from</span> <span class="token string">"./components/User"</span><span class="token keyword">import</span> Profile <span class="token keyword">from</span> <span class="token string">"./components/Profile"</span><span class="token keyword">import</span> UserAdd <span class="token keyword">from</span> <span class="token string">"./components/UserAdd"</span><span class="token keyword">import</span> UserDetail <span class="token keyword">from</span> <span class="token string">"./components/UserDetail"</span><span class="token keyword">import</span> UserList <span class="token keyword">from</span> <span class="token string">"./components/UserList"</span><span class="token keyword">import</span> NotFound <span class="token keyword">from</span> <span class="token string">"./components/NotFound"</span><span class="token keyword">import</span> Login <span class="token keyword">from</span> <span class="token string">"./components/Login"</span><span class="token keyword">import</span> Protected <span class="token keyword">from</span> <span class="token string">"./components/Protected"</span><span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Home</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/profile"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Profile</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span>    <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">User</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">,</span>    <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"add"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserAdd</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserList</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"detail/:id"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">UserDetail</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/profile"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Protected</span></span> <span class="token attr-name">component</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>Profile<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"/login"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Login</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token literal-property property">element</span><span class="token operator">:</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">NotFound</span></span> <span class="token punctuation">/></span></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token keyword">export</span> <span class="token keyword">default</span> routes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> React </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é‡æ–°å®‰æ’è¡Œç¨‹-332</title>
      <link href="/2023/06/19/chong-xin-an-pai-xing-cheng-332/"/>
      <url>/2023/06/19/chong-xin-an-pai-xing-cheng-332/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combination-sum/">https://leetcode.cn/problems/combination-sum/</a></p><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;string[][]&#125; tickets * @return &#123;string[]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">findItinerary</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tickets</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'JFK'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token comment">//è·å¾—map</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> ticket <span class="token keyword">of</span> tickets<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> <span class="token punctuation">[</span>from<span class="token punctuation">,</span> to<span class="token punctuation">]</span> <span class="token operator">=</span> ticket<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            map<span class="token punctuation">[</span>from<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        map<span class="token punctuation">[</span>from<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>to<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å¯¹åˆ°è¾¾åœ°è¿›è¡Œå­—å…¸æ’åº</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> city <span class="token keyword">in</span> map<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        map<span class="token punctuation">[</span>city<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> <span class="token function-variable function">backtracking</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//resultå…ƒç´ æ•°é‡ä¸æœºç¥¨æ•°åŠ 1ç›¸ç­‰è¡¨ç¤ºæ‰¾åˆ°æœ‰æ•ˆè¡Œç¨‹</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>length <span class="token operator">===</span> tickets<span class="token punctuation">.</span>length <span class="token operator">+</span>ã€€<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">//æ²¡æœ‰ä»result[result.length - 1]å‡ºå‘çš„æœºç¥¨</span>        <span class="token comment">//æˆ–è€…ä»result[result.length - 1]å‡ºå‘çš„æœºç¥¨å·²è¢«ä½¿ç”¨è¿‡</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">[</span>result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">||</span> map<span class="token punctuation">[</span>result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> map<span class="token punctuation">[</span>result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">const</span> city <span class="token operator">=</span> map<span class="token punctuation">[</span>result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">//åˆ é™¤å·²è¢«è·å–çš„åˆ°è¾¾åœ°</span>            map<span class="token punctuation">[</span>result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>city<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">backtracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token comment">//å›æº¯</span>            result<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">[</span>result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">backtracking</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> result<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…¨æ’åˆ—-46</title>
      <link href="/2023/06/19/quan-pai-lie-46/"/>
      <url>/2023/06/19/quan-pai-lie-46/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/permutations/">https://leetcode.cn/problems/permutations/</a></p><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums * @return &#123;number[][]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">permute</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">set1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>length <span class="token operator">===</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">continue</span>      <span class="token punctuation">&#125;</span>      set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>set1<span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span>set<span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">debugger</span><span class="token function">permute</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»„åˆæ€»å’Œ-39</title>
      <link href="/2023/06/15/zu-he-zong-he-39/"/>
      <url>/2023/06/15/zu-he-zong-he-39/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combination-sum/">https://leetcode.cn/problems/combination-sum/</a></p><h2 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; candidates * @param &#123;number&#125; target * @return &#123;number[][]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">combinationSum</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">candidates<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  candidates<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span>  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> sum</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">===</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>      <span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span>      i <span class="token operator">&lt;</span> candidates<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> target <span class="token operator">-</span> sum <span class="token operator">>=</span> candidates<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">;</span>      i<span class="token operator">++</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> sum <span class="token operator">+</span> candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><p><strong>å¦‚æœä¸ç»™ start å¼€å§‹ç´¢å¼•ä¼šæ€ä¹ˆæ ·ï¼Ÿ</strong></p><p>ä¼šå‡ºç°é‡å¤æ•°æ®</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">combinationSum</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">candidates<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  candidates<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span>  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">sum</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">===</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>      <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      i <span class="token operator">&lt;</span> candidates<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> target <span class="token operator">-</span> sum <span class="token operator">>=</span> candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>      i<span class="token operator">++</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> sum <span class="token operator">+</span> candidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span class="token function">combinationSum</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token comment">// é”™è¯¯ç­”æ¡ˆ  [[2,2,3],[3,2,2],[7]]</span><span class="token comment">// æ­£ç¡®ç­”æ¡ˆ  [[2,2,3],[7]]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”µè¯å·ç çš„å­—æ¯ç»„åˆ-17</title>
      <link href="/2023/06/14/dian-hua-hao-ma-de-zi-mu-zu-he-17/"/>
      <url>/2023/06/14/dian-hua-hao-ma-de-zi-mu-zu-he-17/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/letter-combinations-of-a-phone-number/">https://leetcode.cn/problems/letter-combinations-of-a-phone-number/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;string&#125; digits * @return &#123;string[]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">letterCombinations</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">digits</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token number">2</span><span class="token operator">:</span> <span class="token string">"abc"</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token operator">:</span> <span class="token string">"def"</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token operator">:</span> <span class="token string">"ghi"</span><span class="token punctuation">,</span>    <span class="token number">5</span><span class="token operator">:</span> <span class="token string">"jkl"</span><span class="token punctuation">,</span>    <span class="token number">6</span><span class="token operator">:</span> <span class="token string">"mno"</span><span class="token punctuation">,</span>    <span class="token number">7</span><span class="token operator">:</span> <span class="token string">"pqrs"</span><span class="token punctuation">,</span>    <span class="token number">8</span><span class="token operator">:</span> <span class="token string">"tuv"</span><span class="token punctuation">,</span>    <span class="token number">9</span><span class="token operator">:</span> <span class="token string">"wxyz"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>digits<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> res  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">start</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>length <span class="token operator">===</span> digits<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> curStr <span class="token operator">=</span> map<span class="token punctuation">[</span>digits<span class="token punctuation">[</span>start<span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> curStr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curStr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>start <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»„åˆæ€»å’Œ-216</title>
      <link href="/2023/06/13/zu-he-zong-he-iii-216/"/>
      <url>/2023/06/13/zu-he-zong-he-iii-216/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combination-sum-iii/">https://leetcode.cn/problems/combination-sum-iii/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number&#125; k * @param &#123;number&#125; n * @return &#123;number[][]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">combinationSum3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">k<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">start<span class="token punctuation">,</span> sum</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">===</span> n <span class="token operator">&amp;&amp;</span> path<span class="token punctuation">.</span>length <span class="token operator">===</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> n <span class="token operator">-</span> sum <span class="token operator">>=</span> i <span class="token operator">&amp;&amp;</span> <span class="token number">9</span> <span class="token operator">-</span> <span class="token punctuation">(</span>k <span class="token operator">-</span> path<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">>=</span> i<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> sum <span class="token operator">+</span> i<span class="token punctuation">)</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›æº¯ç®—æ³•æ€è·¯</title>
      <link href="/2023/06/12/hui-su-suan-fa-si-lu/"/>
      <url>/2023/06/12/hui-su-suan-fa-si-lu/</url>
      
        <content type="html"><![CDATA[<h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul><li>é€’å½’å‡½æ•°çš„è¿”å›å€¼ä»¥åŠå‚æ•°</li><li>å›æº¯å‡½æ•°ç»ˆæ­¢æ¡ä»¶</li><li>å•å±‚æœç´¢çš„è¿‡ç¨‹</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">combine</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">start</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//ç»ˆæ­¢æ¡ä»¶</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ç»ˆæ­¢æ¡ä»¶<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//å•å±‚çš„æ¯”éå†</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// å¤„ç†èŠ‚ç‚¹</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// é€’å½’å¤„ç†</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å›æº¯ï¼Œæ’¤é”€å¤„ç†çš„èŠ‚ç‚¹</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">void</span> <span class="token function">backtracking</span><span class="token punctuation">(</span><span class="token parameter">å‚æ•°</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ç»ˆæ­¢æ¡ä»¶<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        å­˜æ”¾ç»“æœ<span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        å¤„ç†èŠ‚ç‚¹<span class="token punctuation">;</span>        <span class="token function">backtracking</span><span class="token punctuation">(</span>è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€’å½’</span>        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»„åˆ-77</title>
      <link href="/2023/06/12/zu-he-77/"/>
      <url>/2023/06/12/zu-he-77/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/combinations/discussion/">https://leetcode.cn/problems/combinations/discussion/</a></p><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><ul><li>é€’å½’å‡½æ•°çš„è¿”å›å€¼ä»¥åŠå‚æ•°</li><li>å›æº¯å‡½æ•°ç»ˆæ­¢æ¡ä»¶</li><li>å•å±‚æœç´¢çš„è¿‡ç¨‹</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">void</span> <span class="token function">backtracking</span><span class="token punctuation">(</span><span class="token parameter">å‚æ•°</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>ç»ˆæ­¢æ¡ä»¶<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        å­˜æ”¾ç»“æœ<span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span>é€‰æ‹©ï¼šæœ¬å±‚é›†åˆä¸­å…ƒç´ ï¼ˆæ ‘ä¸­èŠ‚ç‚¹å­©å­çš„æ•°é‡å°±æ˜¯é›†åˆçš„å¤§å°ï¼‰<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        å¤„ç†èŠ‚ç‚¹<span class="token punctuation">;</span>        <span class="token function">backtracking</span><span class="token punctuation">(</span>è·¯å¾„ï¼Œé€‰æ‹©åˆ—è¡¨<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// é€’å½’</span>        å›æº¯ï¼Œæ’¤é”€å¤„ç†ç»“æœ    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number&#125; n * @param &#123;number&#125; k * @return &#123;number[][]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">combine</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">function</span> <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token parameter">start</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>length <span class="token operator">===</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token operator">...</span>path<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> start<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n <span class="token operator">-</span> <span class="token punctuation">(</span>k <span class="token operator">-</span> path<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// å¤„ç†èŠ‚ç‚¹</span>      <span class="token function">bfs</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// é€’å½’å¤„ç†</span>      path<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å›æº¯ï¼Œæ’¤é”€å¤„ç†çš„èŠ‚ç‚¹</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">bfs</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æŸ±çŠ¶å›¾ä¸­æœ€å¤§çš„çŸ©å½¢-84</title>
      <link href="/2023/06/06/zhu-zhuang-tu-zhong-zui-da-de-ju-xing-84/"/>
      <url>/2023/06/06/zhu-zhuang-tu-zhong-zui-da-de-ju-xing-84/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/largest-rectangle-in-histogram/">https://leetcode.cn/problems/largest-rectangle-in-histogram/</a></p><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; heights * @return &#123;number&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">largestRectangleArea</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">heights</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> maxArea <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  heights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">...</span>heights<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// æ•°ç»„å¤´éƒ¨åŠ å…¥å…ƒç´ 0 æ•°ç»„å°¾éƒ¨åŠ å…¥å…ƒç´ 0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> heights<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>heights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> heights<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>heights<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> heights<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å½“å‰baræ¯”æ ˆé¡¶barçŸ®</span>        <span class="token keyword">const</span> stackTopIndex <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ ˆé¡¶å…ƒç´ å‡ºæ ˆï¼Œå¹¶ä¿å­˜æ ˆé¡¶barçš„ç´¢å¼•</span>        <span class="token keyword">let</span> w <span class="token operator">=</span> i <span class="token operator">-</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>        <span class="token keyword">let</span> h <span class="token operator">=</span> heights<span class="token punctuation">[</span>stackTopIndex<span class="token punctuation">]</span>        <span class="token comment">// è®¡ç®—é¢ç§¯ï¼Œå¹¶å–æœ€å¤§é¢ç§¯</span>        maxArea <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxArea<span class="token punctuation">,</span> w <span class="token operator">*</span> h<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// å½“å‰baræ¯”æ ˆé¡¶baré«˜äº†ï¼Œå…¥æ ˆ</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> maxArea<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒæ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¥é›¨æ°´-42</title>
      <link href="/2023/06/05/jie-yu-shui-42/"/>
      <url>/2023/06/05/jie-yu-shui-42/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/trapping-rain-water/">https://leetcode.cn/problems/trapping-rain-water/</a></p><h2 id="è¯¦ç»†ç‰ˆæœ¬"><a href="#è¯¦ç»†ç‰ˆæœ¬" class="headerlink" title="è¯¦ç»†ç‰ˆæœ¬"></a>è¯¦ç»†ç‰ˆæœ¬</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; height * @return &#123;number&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">trap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> height<span class="token punctuation">.</span>length  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>height<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> height<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>height<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> height<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> height<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> mid <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">let</span> h <span class="token operator">=</span>            Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>height<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> height<span class="token punctuation">[</span>mid<span class="token punctuation">]</span>          <span class="token keyword">let</span> w <span class="token operator">=</span> i <span class="token operator">-</span> stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span>          res <span class="token operator">+=</span> h <span class="token operator">*</span> w        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç®€åŒ–ç‰ˆ"><a href="#ç®€åŒ–ç‰ˆ" class="headerlink" title="ç®€åŒ–ç‰ˆ"></a>ç®€åŒ–ç‰ˆ</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//å•è°ƒæ ˆ ç®€æ´ç‰ˆæœ¬ åªå¤„ç†æƒ…å†µä¸‰</span><span class="token keyword">var</span> <span class="token function-variable function">trap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> height<span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span> <span class="token comment">// å¯ä»¥ä¸åŠ </span>  <span class="token keyword">const</span> st <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// å­˜ç€ä¸‹æ ‡ï¼Œè®¡ç®—çš„æ—¶å€™ç”¨ä¸‹æ ‡å¯¹åº”çš„æŸ±å­é«˜åº¦</span>  st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åªå¤„ç†çš„æƒ…å†µä¸‰ï¼Œå…¶å®æ˜¯æŠŠæƒ…å†µä¸€å’Œæƒ…å†µäºŒèåˆäº†</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> height<span class="token punctuation">[</span>st<span class="token punctuation">[</span>st<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ³¨æ„è¿™é‡Œæ˜¯while</span>      <span class="token keyword">let</span> mid <span class="token operator">=</span> st<span class="token punctuation">[</span>st<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>      st<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>st<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> h <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>height<span class="token punctuation">[</span>st<span class="token punctuation">[</span>st<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> height<span class="token punctuation">[</span>mid<span class="token punctuation">]</span>        <span class="token keyword">let</span> w <span class="token operator">=</span> i <span class="token operator">-</span> st<span class="token punctuation">[</span>st<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// æ³¨æ„å‡ä¸€ï¼Œåªæ±‚ä¸­é—´å®½åº¦</span>        sum <span class="token operator">+=</span> h <span class="token operator">*</span> w      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    st<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> sum<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æš´åŠ›è§£æ³•"><a href="#æš´åŠ›è§£æ³•" class="headerlink" title="æš´åŠ›è§£æ³•"></a>æš´åŠ›è§£æ³•</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">trap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> height<span class="token punctuation">.</span>length  <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç¬¬ä¸€ä¸ªæŸ±å­å’Œæœ€åä¸€ä¸ªæŸ±å­ä¸æ¥é›¨æ°´</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> i <span class="token operator">==</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>    <span class="token keyword">let</span> rHeight <span class="token operator">=</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// è®°å½•å³è¾¹æŸ±å­çš„æœ€é«˜é«˜åº¦</span>    <span class="token keyword">let</span> lHeight <span class="token operator">=</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">// è®°å½•å·¦è¾¹æŸ±å­çš„æœ€é«˜é«˜åº¦</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> r <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> r <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> r<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>height<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">></span> rHeight<span class="token punctuation">)</span> rHeight <span class="token operator">=</span> height<span class="token punctuation">[</span>r<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> l <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> l <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> l<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>height<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> lHeight<span class="token punctuation">)</span> lHeight <span class="token operator">=</span> height<span class="token punctuation">[</span>l<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> h <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>lHeight<span class="token punctuation">,</span> rHeight<span class="token punctuation">)</span> <span class="token operator">-</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> sum <span class="token operator">+=</span> h  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> sum<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">trap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">height</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> height<span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token keyword">const</span> maxLeft <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> maxRight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// è®°å½•æ¯ä¸ªæŸ±å­å·¦è¾¹æŸ±å­æœ€å¤§é«˜åº¦</span>  maxLeft<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> height<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    maxLeft<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>height<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> maxLeft<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è®°å½•æ¯ä¸ªæŸ±å­å³è¾¹æŸ±å­æœ€å¤§é«˜åº¦</span>  maxRight<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> height<span class="token punctuation">[</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    maxRight<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>height<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> maxRight<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// æ±‚å’Œ</span>  <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> count <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>maxLeft<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> maxRight<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> height<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> sum <span class="token operator">+=</span> count  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> sum<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒæ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ II-503</title>
      <link href="/2023/06/05/xia-yi-ge-geng-da-yuan-su-ii-503/"/>
      <url>/2023/06/05/xia-yi-ge-geng-da-yuan-su-ii-503/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/next-greater-element-ii/">https://leetcode.cn/problems/next-greater-element-ii/</a></p><h2 id="æ™®é€šæ‹¼æ¥-nums"><a href="#æ™®é€šæ‹¼æ¥-nums" class="headerlink" title="æ™®é€šæ‹¼æ¥ nums"></a>æ™®é€šæ‹¼æ¥ nums</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; temperatures * @return &#123;number[]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">dailyTemperatures</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">temperatures</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> length <span class="token operator">=</span> temperatures<span class="token punctuation">.</span>length  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>temperatures<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> temperatures<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>        stack<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>        temperatures<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> temperatures<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>      <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> resIndex <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        res<span class="token punctuation">[</span>resIndex<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">-</span> resIndex      <span class="token punctuation">&#125;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¸æ‰©å……-nums-æ¨¡æ‹Ÿéå†"><a href="#ä¸æ‰©å……-nums-æ¨¡æ‹Ÿéå†" class="headerlink" title="ä¸æ‰©å…… nums,æ¨¡æ‹Ÿéå†"></a>ä¸æ‰©å…… nums,æ¨¡æ‹Ÿéå†</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums * @return &#123;number[]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">nextGreaterElements</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>i <span class="token operator">%</span> len<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> curIndex <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      res<span class="token punctuation">[</span>curIndex<span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>i <span class="token operator">%</span> len<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i <span class="token operator">%</span> len<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token function">nextGreaterElements</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒæ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸‹ä¸€ä¸ªæ›´å¤§å…ƒç´ I-496</title>
      <link href="/2023/06/01/xia-yi-ge-geng-da-yuan-su-496/"/>
      <url>/2023/06/01/xia-yi-ge-geng-da-yuan-su-496/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/next-greater-element-i/">https://leetcode.cn/problems/next-greater-element-i/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums1 * @param &#123;number[]&#125; nums2 * @return &#123;number[]&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">nextGreaterElement</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums1<span class="token punctuation">,</span> nums2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len1 <span class="token operator">=</span> nums1<span class="token punctuation">.</span>length  <span class="token keyword">const</span> len2 <span class="token operator">=</span> nums2<span class="token punctuation">.</span>length  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>len1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len2<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span> nums2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> nums2<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> nums2<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> nums2<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> curIndex <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>nums2<span class="token punctuation">[</span>curIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> nums2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums1<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>nums1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token function">nextGreaterElement</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> arr2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒæ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¯æ—¥æ¸©åº¦-739</title>
      <link href="/2023/05/30/mei-ri-wen-du-739/"/>
      <url>/2023/05/30/mei-ri-wen-du-739/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/daily-temperatures/">https://leetcode.cn/problems/daily-temperatures/</a></p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p><strong>é€šå¸¸æ˜¯ä¸€ç»´æ•°ç»„ï¼Œè¦å¯»æ‰¾ä»»ä¸€ä¸ªå…ƒç´ çš„å³è¾¹æˆ–è€…å·¦è¾¹ç¬¬ä¸€ä¸ªæ¯”è‡ªå·±å¤§æˆ–è€…å°çš„å…ƒç´ çš„ä½ç½®ï¼Œæ­¤æ—¶æˆ‘ä»¬å°±è¦æƒ³åˆ°å¯ä»¥ç”¨å•è°ƒæ ˆäº†ã€‚</strong>æ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚</p><ol><li>å•è°ƒæ ˆé‡Œå­˜æ”¾çš„å…ƒç´ æ˜¯ä»€ä¹ˆï¼Ÿ</li></ol><p>å•è°ƒæ ˆé‡Œåªéœ€è¦å­˜æ”¾å…ƒç´ çš„ä¸‹æ ‡ i å°±å¯ä»¥äº†ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨å¯¹åº”çš„å…ƒç´ ï¼Œç›´æ¥ T[i]å°±å¯ä»¥è·å–ã€‚</p><ol start="2"><li>å•è°ƒæ ˆé‡Œå…ƒç´ æ˜¯é€’å¢å‘¢ï¼Ÿ è¿˜æ˜¯é€’å‡å‘¢ï¼Ÿ</li></ol><p>è¿™é‡Œæˆ‘ä»¬è¦ä½¿ç”¨é€’å¢å¾ªåºï¼ˆå†å¼ºè°ƒä¸€ä¸‹æ˜¯æŒ‡ä»<strong>æ ˆå¤´åˆ°æ ˆåº•çš„é¡ºåº</strong>ï¼‰ï¼Œå› ä¸ºåªæœ‰é€’å¢çš„æ—¶å€™ï¼Œæ ˆé‡Œè¦åŠ å…¥ä¸€ä¸ªå…ƒç´  i çš„æ—¶å€™ï¼Œæ‰çŸ¥é“æ ˆé¡¶å…ƒç´ åœ¨æ•°ç»„ä¸­å³é¢ç¬¬ä¸€ä¸ªæ¯”æ ˆé¡¶å…ƒç´ å¤§çš„å…ƒç´ æ˜¯ iã€‚</p><p>å³ï¼š<strong>å¦‚æœæ±‚ä¸€ä¸ªå…ƒç´ å³è¾¹ç¬¬ä¸€ä¸ªæ›´å¤§å…ƒç´ ï¼Œå•è°ƒæ ˆå°±æ˜¯é€’å¢çš„ï¼Œå¦‚æœæ±‚ä¸€ä¸ªå…ƒç´ å³è¾¹ç¬¬ä¸€ä¸ªæ›´å°å…ƒç´ ï¼Œå•è°ƒæ ˆå°±æ˜¯é€’å‡çš„ã€‚</strong></p><p>ä½¿ç”¨å•è°ƒæ ˆä¸»è¦æœ‰ä¸‰ä¸ªåˆ¤æ–­æ¡ä»¶ã€‚</p><ul><li><p>å½“å‰éå†çš„å…ƒç´  T[i]å¤§äºæ ˆé¡¶å…ƒç´  T[st.top()]çš„æƒ…å†µ</p><p>æˆ‘ä»¬è¦ä¿æŒä¸€ä¸ªé€’å¢å•è°ƒæ ˆï¼ˆä»æ ˆå¤´åˆ°æ ˆåº•ï¼‰ï¼Œæ‰€ä»¥å°† T[st.top()]å¼¹å‡ºï¼ŒT[i]åŠ å…¥ï¼Œæ­¤æ—¶ result æ•°ç»„å¯ä»¥è®°å½•äº†ï¼Œresult[st.top()] = i- st.top()</p></li><li><p>å½“å‰éå†çš„å…ƒç´  T[i]ç­‰äºæ ˆé¡¶å…ƒç´  T[st.top()]çš„æƒ…å†µ</p><p>å°† T[i]åŠ å…¥å•è°ƒæ ˆ <code> st.push(i)</code></p></li><li><p>å½“å‰éå†çš„å…ƒç´  T[i]å¤§äºæ ˆé¡¶å…ƒç´  T[st.top()]çš„æƒ…å†µ</p><p>å°† T[i]åŠ å…¥å•è°ƒæ ˆ <code> st.push(i)</code></p></li></ul><h3 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ç‰ˆæœ¬ä¸€</span><span class="token keyword">var</span> <span class="token function-variable function">dailyTemperatures</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">temperatures</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> length <span class="token operator">=</span> temperatures<span class="token punctuation">.</span>length  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      stack<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">||</span>      temperatures<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> temperatures<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>        stack<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>        temperatures<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> temperatures<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>      <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> resIndex <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        res<span class="token punctuation">[</span>resIndex<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">-</span> resIndex      <span class="token punctuation">&#125;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span class="token comment">// ç‰ˆæœ¬äºŒ</span><span class="token keyword">var</span> <span class="token function-variable function">dailyTemperatures</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">temperatures</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> n <span class="token operator">=</span> temperatures<span class="token punctuation">.</span>length  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// é€’å¢æ ˆï¼šç”¨äºå­˜å‚¨å…ƒç´ å³é¢ç¬¬ä¸€ä¸ªæ¯”ä»–å¤§çš„å…ƒç´ ä¸‹æ ‡</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>      stack<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span>      temperatures<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> temperatures<span class="token punctuation">[</span>stack<span class="token punctuation">[</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> top <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      res<span class="token punctuation">[</span>top<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">-</span> top    <span class="token punctuation">&#125;</span>    stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å•è°ƒæ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ES2023,å­¦ä¹ èµ°èµ·</title>
      <link href="/2023/05/29/es2023-xue-xi-zou-qi/"/>
      <url>/2023/05/29/es2023-xue-xi-zou-qi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ES6 æ˜¯ 2015 å¹´æå‡ºçš„ï¼ŒæŒ‰ç…§è¿™ä¸ªé€»è¾‘ ES2023 åº”è¯¥å«åš ES14ï¼Œä¸ºäº†é¿å…æ··æ·†ï¼Œæˆ‘ä»¬å°±ç”¨å¹´ä»½æ¥å‘½åã€‚ä¸ºäº†èµ¶ä¸Š ES æ ‡å‡†è¿­ä»£çš„æ­¥ä¼ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ 2023 å¹´åˆåŠ å…¥äº†å“ªäº›æ–°ç‰¹æ€§ã€‚</p></blockquote><h2 id="ä¸€ã€ä»å°¾éƒ¨æŸ¥æ‰¾"><a href="#ä¸€ã€ä»å°¾éƒ¨æŸ¥æ‰¾" class="headerlink" title="ä¸€ã€ä»å°¾éƒ¨æŸ¥æ‰¾"></a>ä¸€ã€ä»å°¾éƒ¨æŸ¥æ‰¾</h2><blockquote><p>æ¶‰åŠåˆ°ä¸¤ä¸ªå‡½æ•° <code>findLast / findLastIndex</code></p></blockquote><p><strong>findLast / findLastIndex åŸºæœ¬ç”¨æ³•</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token comment">// findLast</span>array<span class="token punctuation">.</span><span class="token function">findLast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// &#123; value: 3 &#125;</span><span class="token comment">// findLastIndex</span>array<span class="token punctuation">.</span><span class="token function">findLastIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>array<span class="token punctuation">.</span><span class="token function">findLastIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token number">42</span><span class="token punctuation">)</span> <span class="token comment">// -1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>find å’Œ findIndex çš„åŸºæœ¬ç”¨æ³•</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token comment">//findå’ŒfindIndexçš„åŸºæœ¬ç”¨æ³•</span>array<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// &#123; value: 1 &#125;</span>array<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä»¥å‰çš„æƒ³è¦ä»åå¾€å‰æŸ¥çš„æ–¹æ¡ˆå’Œç—›ç‚¹</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token comment">// find</span><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token operator">...</span>array<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// &#123; value: 3 &#125;</span><span class="token comment">// findIndex</span>array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token operator">...</span>array<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>array<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token operator">...</span>array<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token operator">=></span> n<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token number">42</span><span class="token punctuation">)</span> <span class="token comment">// should be -1, but 4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒã€Hashbang-è¯­æ³•"><a href="#äºŒã€Hashbang-è¯­æ³•" class="headerlink" title="äºŒã€Hashbang è¯­æ³•"></a>äºŒã€Hashbang è¯­æ³•</h2><p>Hashbang ä¹Ÿå« Shebangï¼Œæ˜¯ä¸€ä¸ªç”±äº•å·å’Œå¹å·æ„æˆçš„å­—ç¬¦åºåˆ— #!ï¼Œç”¨æ¥æŒ‡å®šä½¿ç”¨å“ªç§è§£é‡Šå™¨æ‰§è¡Œæ­¤æ–‡ä»¶ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token hashbang comment">#!/usr/bin/env node</span><span class="token string">"use strict"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ç»ˆç«¯æ‰§è¡Œï¼Œæ²¡æœ‰ <strong>Hashbang</strong> æ—¶ï¼Œéœ€è¦ä½¿ç”¨ <strong>node</strong> æŒ‡ä»¤æ‰èƒ½æ‰§è¡Œ<code>node xxx</code></p><p>æœ‰ <strong>Hashbang</strong> æ—¶ï¼Œå¯ä»¥ç›´æ¥<code>./xxxxx</code>æ‰§è¡Œ</p><h2 id="ä¸‰ã€WeakMap-æ”¯æŒ-Symbol-ä½œä¸º-key"><a href="#ä¸‰ã€WeakMap-æ”¯æŒ-Symbol-ä½œä¸º-key" class="headerlink" title="ä¸‰ã€WeakMap æ”¯æŒ Symbol ä½œä¸º key"></a>ä¸‰ã€WeakMap æ”¯æŒ Symbol ä½œä¸º key</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> weak <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// Pun not intended: being a symbol makes it become a more symbolic key</span><span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"my ref"</span><span class="token punctuation">)</span><span class="token keyword">const</span> someObject <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token comment">/* data data data */</span><span class="token punctuation">&#125;</span>weak<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> someObject<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å››ã€é€šè¿‡å¤åˆ¶æ›´æ”¹-Array"><a href="#å››ã€é€šè¿‡å¤åˆ¶æ›´æ”¹-Array" class="headerlink" title="å››ã€é€šè¿‡å¤åˆ¶æ›´æ”¹ Array"></a>å››ã€é€šè¿‡å¤åˆ¶æ›´æ”¹ Array</h2><ul><li><code>Array.prototype.toReversed() -&gt; Array</code></li><li><code>Array.prototype.toSorted(compareFn) -&gt; Array</code></li><li><code>Array.prototype.toSpliced(start, deleteCount, ...items) -&gt; Array</code></li><li><code>Array.prototype.with(index, value) -&gt; Array</code></li></ul><h4 id="toSorted"><a href="#toSorted" class="headerlink" title="toSorted"></a>toSorted</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code></a> å®ä¾‹çš„ <strong><code>toSorted()</code></strong> æ–¹æ³•æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/sort"><code>sort()</code></a> æ–¹æ³•çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array#%E5%A4%8D%E5%88%B6%E6%96%B9%E6%B3%95%E5%92%8C%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95">å¤åˆ¶æ–¹æ³•</a>ç‰ˆæœ¬ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶å…ƒç´ æŒ‰å‡åºæ’åˆ—ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Mar"</span><span class="token punctuation">,</span> <span class="token string">"Jan"</span><span class="token punctuation">,</span> <span class="token string">"Feb"</span><span class="token punctuation">,</span> <span class="token string">"Dec"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> sortedMonths <span class="token operator">=</span> months<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sortedMonths<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['Dec', 'Feb', 'Jan', 'Mar']</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ['Mar', 'Jan', 'Feb', 'Dec']</span><span class="token keyword">const</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">const</span> sortedValues <span class="token operator">=</span> values<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> a <span class="token operator">-</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sortedValues<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 2, 10, 21]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [1, 10, 21, 2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', 'c', undefined]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// ["a", "b", undefined, undefined]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token literal-property property">unrelated</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toSorted</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// [4, 5, undefined]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="toSpliced"><a href="#toSpliced" class="headerlink" title="toSpliced()"></a>toSpliced()</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code></a> å®ä¾‹çš„ <strong><code>toSpliced()</code></strong> æ–¹æ³•æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/splice"><code>splice()</code></a> æ–¹æ³•çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array#%E5%A4%8D%E5%88%B6%E6%96%B9%E6%B3%95%E5%92%8C%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95">å¤åˆ¶</a>ç‰ˆæœ¬ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå¹¶åœ¨ç»™å®šçš„ç´¢å¼•å¤„åˆ é™¤å’Œ/æˆ–æ›¿æ¢äº†ä¸€äº›å…ƒç´ ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">toSpliced</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token function">toSpliced</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> deleteCount<span class="token punctuation">)</span><span class="token function">toSpliced</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> deleteCount<span class="token punctuation">,</span> item1<span class="token punctuation">)</span><span class="token function">toSpliced</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> deleteCount<span class="token punctuation">,</span> item1<span class="token punctuation">,</span> item2<span class="token punctuation">,</span> itemN<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Jan"</span><span class="token punctuation">,</span> <span class="token string">"Mar"</span><span class="token punctuation">,</span> <span class="token string">"Apr"</span><span class="token punctuation">,</span> <span class="token string">"May"</span><span class="token punctuation">]</span><span class="token comment">// åœ¨ç´¢å¼• 1 å¤„æ·»åŠ ä¸€ä¸ªå…ƒç´ </span><span class="token keyword">const</span> months2 <span class="token operator">=</span> months<span class="token punctuation">.</span><span class="token function">toSpliced</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Feb"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months2<span class="token punctuation">)</span> <span class="token comment">// ["Jan", "Feb", "Mar", "Apr", "May"]</span><span class="token comment">// ä»ç¬¬ 2 ä¸ªç´¢å¼•å¼€å§‹åˆ é™¤ä¸¤ä¸ªå…ƒç´ </span><span class="token keyword">const</span> months3 <span class="token operator">=</span> months2<span class="token punctuation">.</span><span class="token function">toSpliced</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months3<span class="token punctuation">)</span> <span class="token comment">// ["Jan", "Feb", "May"]</span><span class="token comment">// åœ¨ç´¢å¼• 1 å¤„ç”¨ä¸¤ä¸ªæ–°å…ƒç´ æ›¿æ¢ä¸€ä¸ªå…ƒç´ </span><span class="token keyword">const</span> months4 <span class="token operator">=</span> months3<span class="token punctuation">.</span><span class="token function">toSpliced</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Feb"</span><span class="token punctuation">,</span> <span class="token string">"Mar"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months4<span class="token punctuation">)</span> <span class="token comment">// ["Jan", "Feb", "Mar", "May"]</span><span class="token comment">// åŸæ•°ç»„ä¸ä¼šè¢«ä¿®æ”¹</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months<span class="token punctuation">)</span> <span class="token comment">// ["Jan", "Mar", "Apr", "May"]</span><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">toSpliced</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 4, undefined, 6]</span><span class="token keyword">const</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token literal-property property">unrelated</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toSpliced</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// [2, 3, undefined, 4]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="toReversed"><a href="#toReversed" class="headerlink" title="toReversed"></a>toReversed</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code></a> å®ä¾‹çš„ <strong><code>toReversed()</code></strong> æ–¹æ³•æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/reverse"><code>reverse()</code></a> æ–¹æ³•å¯¹åº”çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array#%E5%A4%8D%E5%88%B6%E6%96%B9%E6%B3%95%E5%92%8C%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95">å¤åˆ¶</a>ç‰ˆæœ¬ã€‚å®ƒè¿”å›ä¸€ä¸ªå…ƒç´ é¡ºåºç›¸åçš„æ–°æ•°ç»„ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3]</span><span class="token keyword">const</span> reversedItems <span class="token operator">=</span> items<span class="token punctuation">.</span><span class="token function">toReversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reversedItems<span class="token punctuation">)</span> <span class="token comment">// [3, 2, 1]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toReversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [3, undefined, 1]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toReversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [4, 3, undefined, 1]</span><span class="token keyword">const</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token literal-property property">unrelated</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toReversed</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// [4, undefined, undefined]</span><span class="token comment">// '0' å’Œ '1' ä¸¤ä¸ªç´¢å¼•ä¸å­˜åœ¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¼šå˜æˆ undefined</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="with"><a href="#with" class="headerlink" title="with()"></a>with()</h4><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array"><code>Array</code></a> å®ä¾‹çš„ <strong><code>with()</code></strong> æ–¹æ³•æ˜¯ä½¿ç”¨<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Property_accessors#%E6%96%B9%E6%8B%AC%E5%8F%B7%E8%A1%A8%E7%A4%BA%E6%B3%95">æ–¹æ‹¬å·è¡¨ç¤ºæ³•</a>ä¿®æ”¹æŒ‡å®šç´¢å¼•å€¼çš„<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array#%E5%A4%8D%E5%88%B6%E6%96%B9%E6%B3%95%E5%92%8C%E4%BF%AE%E6%94%B9%E6%96%B9%E6%B3%95">å¤åˆ¶æ–¹æ³•</a>ç‰ˆæœ¬ã€‚å®ƒä¼šè¿”å›ä¸€ä¸ªæ–°æ•°ç»„ï¼Œå…¶æŒ‡å®šç´¢å¼•å¤„çš„å€¼ä¼šè¢«æ–°å€¼æ›¿æ¢ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 2, 6, 4, 5]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// [1, 2, 3, 4, 5]</span><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token operator">=></span> x <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [1, 4, 36, 16, 25]</span><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [2, undefined, 3, 4, undefined, 6]</span><span class="token keyword">const</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>  <span class="token literal-property property">unrelated</span><span class="token operator">:</span> <span class="token string">"foo"</span><span class="token punctuation">,</span>  <span class="token number">0</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>  <span class="token number">2</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// [ 1, undefined, 4 ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ³¨æ„ï¼š</strong></p><ul><li><p>æ­¤æ¬¡å‘å¸ƒçš„æ–°æ–¹æ³•ä¸ä»…é€‚ç”¨äºå¸¸è§„çš„æ•°ç»„å¯¹è±¡ã€‚å¯ä»¥åœ¨ä»»æ„ TypedArray ä¸Šä½¿ç”¨ toSortedã€toReversed å’Œ with æ–¹æ³•ï¼ŒåŒ…æ‹¬ Int8Array åˆ° BigUint64Array ç­‰å„ç§ç±»å‹ã€‚ä½†å› ä¸º TypedArrays æ²¡æœ‰ splice æ–¹æ³•ï¼Œå› æ­¤æ— æ³•ä½¿ç”¨ toSpliced æ–¹æ³•ã€‚</p></li><li><p>Array çš„ mapã€filter å’Œ concat ç­‰æ–¹æ³•ä¹Ÿéƒ½é‡‡å–å…ˆå¤åˆ¶å†æ›´æ”¹çš„æ€è·¯ï¼Œä½†è¿™äº›æ–¹æ³•ä¸æ–°çš„å¤åˆ¶æ–¹æ³•é—´ä»æœ‰ä¸åŒã€‚å¦‚æœå¯¹å†…ç½®çš„ Array å¯¹è±¡è¿›è¡Œæ‰©å±•ï¼Œå¹¶åœ¨å®ä¾‹ä¸Šä½¿ç”¨ mapã€flatMapã€filter æˆ– concatï¼Œåˆ™ä¼šè¿”å›ç›¸åŒç±»å‹çš„æ–°å®ä¾‹ã€‚ä½†å¦‚æœæ‚¨æ‰©å±•ä¸€ä¸ª Array å¹¶ä½¿ç”¨ toSortedã€toReversedã€toSpliced æˆ–è€… withï¼Œåˆ™è¿”å›çš„ä»æ˜¯æ™®é€š Arrayã€‚</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> languages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyArray</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">,</span> <span class="token string">"TypeScript"</span><span class="token punctuation">,</span> <span class="token string">"CoffeeScript"</span><span class="token punctuation">)</span><span class="token keyword">const</span> upcase <span class="token operator">=</span> languages<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">language</span><span class="token punctuation">)</span> <span class="token operator">=></span> language<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>upcase <span class="token keyword">instanceof</span> <span class="token class-name">MyArray</span><span class="token punctuation">)</span><span class="token comment">// => true</span><span class="token keyword">const</span> reversed <span class="token operator">=</span> languages<span class="token punctuation">.</span><span class="token function">toReversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reversed <span class="token keyword">instanceof</span> <span class="token class-name">MyArray</span><span class="token punctuation">)</span><span class="token comment">// => false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥ä½¿ç”¨ MyArray.from å°†å…¶è½¬å›æ‚¨çš„è‡ªå®šä¹‰ Arrayï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyArray</span> <span class="token keyword">extends</span> <span class="token class-name">Array</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> languages <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyArray</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">,</span> <span class="token string">"TypeScript"</span><span class="token punctuation">,</span> <span class="token string">"CoffeeScript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> reversed <span class="token operator">=</span> MyArray<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>languages<span class="token punctuation">.</span><span class="token function">toReversed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>reversed instance <span class="token keyword">of</span> MyArray<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// => true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://github.com/tc39/proposals/blob/HEAD/finished-proposals.md">https://github.com/tc39/proposals/blob/HEAD/finished-proposals.md</a></p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yamlçš„ä½¿ç”¨</title>
      <link href="/2023/05/26/yaml/"/>
      <url>/2023/05/26/yaml/</url>
      
        <content type="html"><![CDATA[<h2 id="1-YAML"><a href="#1-YAML" class="headerlink" title="1.YAML"></a>1.YAML</h2><ul><li>YAML æ˜¯ä¸“é—¨ç”¨æ¥å†™é…ç½®æ–‡ä»¶çš„è¯­è¨€ï¼Œéå¸¸ç®€æ´å’Œå¼ºå¤§ï¼Œè¿œæ¯” JSON æ ¼å¼æ–¹ä¾¿</li><li><a href="http://nodeca.github.io/js-yaml/">JS åœ¨çº¿éªŒè¯å™¨</a></li></ul><h2 id="2-åŸºæœ¬è§„åˆ™"><a href="#2-åŸºæœ¬è§„åˆ™" class="headerlink" title="2.åŸºæœ¬è§„åˆ™"></a>2.åŸºæœ¬è§„åˆ™</h2><ul><li>å¤§å°å†™æ•æ„Ÿ</li><li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li><li>ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨ Tab é”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ã€‚</li><li>ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯</li><li>äº•å·è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥ã€‚</li></ul><h2 id="3-YAML-æ”¯æŒçš„æ•°æ®ç»“æ„"><a href="#3-YAML-æ”¯æŒçš„æ•°æ®ç»“æ„" class="headerlink" title="3. YAML æ”¯æŒçš„æ•°æ®ç»“æ„"></a>3. YAML æ”¯æŒçš„æ•°æ®ç»“æ„</h2><ul><li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashesï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰</li><li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰</li><li>çº¯é‡ï¼ˆscalarsï¼‰ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</li></ul><h3 id="3-1-å¯¹è±¡"><a href="#3-1-å¯¹è±¡" class="headerlink" title="3.1 å¯¹è±¡"></a>3.1 å¯¹è±¡</h3><p>å¯¹è±¡çš„ä¸€ç»„é”®å€¼å¯¹ï¼Œä½¿ç”¨å†’å·ç»“æ„è¡¨ç¤ºã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> ghx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è½¬ä¸º JavaScript å¦‚ä¸‹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"ghx"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-2-æ•°ç»„"><a href="#3-2-æ•°ç»„" class="headerlink" title="3.2 æ•°ç»„"></a>3.2 æ•°ç»„</h3><p>ä¸€ç»„è¿è¯çº¿å¼€å¤´çš„è¡Œï¼Œæ„æˆä¸€ä¸ªæ•°ç»„ã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span> apple<span class="token punctuation">-</span> banana<span class="token punctuation">-</span> orange<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è½¬ä¸º JavaScript å¦‚ä¸‹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-3-å¤åˆç»“æ„"><a href="#3-3-å¤åˆç»“æ„" class="headerlink" title="3.3 å¤åˆç»“æ„"></a>3.3 å¤åˆç»“æ„</h3><p>å¯¹è±¡å’Œæ•°ç»„å¯ä»¥ç»“åˆä½¿ç”¨ï¼Œå½¢æˆå¤åˆç»“æ„ã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"ghx"</span><span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token key atrule">score</span><span class="token punctuation">:</span>  <span class="token key atrule">chinese</span><span class="token punctuation">:</span> <span class="token number">80</span>  <span class="token key atrule">math</span><span class="token punctuation">:</span> <span class="token number">90</span>  <span class="token key atrule">english</span><span class="token punctuation">:</span> <span class="token number">100</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ghx'</span><span class="token punctuation">,</span>    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>    <span class="token literal-property property">score</span><span class="token operator">:</span>    <span class="token punctuation">&#123;</span>        <span class="token literal-property property">chinese</span><span class="token operator">:</span><span class="token number">80</span><span class="token punctuation">,</span>        <span class="token literal-property property">math</span><span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">,</span>        <span class="token literal-property property">english</span><span class="token operator">:</span><span class="token number">100</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-4-çº¯é‡"><a href="#3-4-çº¯é‡" class="headerlink" title="3.4 çº¯é‡"></a>3.4 çº¯é‡</h3><p>çº¯é‡æ˜¯æœ€åŸºæœ¬çš„ã€ä¸å¯å†åˆ†çš„å€¼ã€‚ä»¥ä¸‹æ•°æ®ç±»å‹éƒ½å±äº JavaScript çš„çº¯é‡ã€‚</p><ul><li>å­—ç¬¦ä¸²</li><li>å¸ƒå°”å€¼</li><li>æ•´æ•°</li><li>æµ®ç‚¹æ•°</li><li>Null</li><li>æ—¶é—´</li><li>æ—¥æœŸ</li></ul><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"ghx"</span><span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token key atrule">score</span><span class="token punctuation">:</span> <span class="token number">99.99</span><span class="token key atrule">married</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span class="token key atrule">parent</span><span class="token punctuation">:</span> <span class="token null important">~</span><span class="token key atrule">now</span><span class="token punctuation">:</span> <span class="token datetime number">1982-09-03T22:22:22.10-09:00</span><span class="token key atrule">birthday</span><span class="token punctuation">:</span> <span class="token datetime number">1982-09-03</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ul><li><a href="https://github.com/nodeca/js-yaml">js-yaml</a></li><li><a href="http://nodeca.github.io/js-yaml/">åœ¨çº¿ DEMO</a></li><li><a href="http://www.ruanyifeng.com/blog/2016/07/yaml.html">yaml</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«æ’</title>
      <link href="/2023/05/25/kuai-pai/"/>
      <url>/2023/05/25/kuai-pai/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">>=</span> right<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token keyword">const</span> index <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>  <span class="token function">fn</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token function">fn</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> left<span class="token punctuation">,</span>    j <span class="token operator">=</span> right  <span class="token keyword">let</span> base <span class="token operator">=</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">>=</span> base <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> j<span class="token operator">--</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> base <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> i<span class="token operator">++</span>    <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token keyword">return</span> i<span class="token punctuation">&#125;</span><span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res=>"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ€è€ƒï¼šä¸ºä»€ä¹ˆå…ˆç§»åŠ¨å³æŒ‡é’ˆ</p><ul><li>ä¸ºäº†åé¢äº¤æ¢ä½ç½®ï¼Œä½¿ arr[i]å°äº arr[left]</li></ul><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å¿«é€Ÿæ’åºå…¥å£</span><span class="token keyword">function</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰é€’å½’è¾¹ç•Œï¼Œè‹¥æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æ²¡æœ‰æ’åºå¿…è¦</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// lineIndexè¡¨ç¤ºä¸‹ä¸€æ¬¡åˆ’åˆ†å·¦å³å­æ•°ç»„çš„ç´¢å¼•ä½</span>    <span class="token keyword">const</span> lineIndex <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right<span class="token punctuation">)</span>    <span class="token comment">// å¦‚æœå·¦è¾¹å­æ•°ç»„çš„é•¿åº¦ä¸å°äº1ï¼Œåˆ™é€’å½’å¿«æ’è¿™ä¸ªå­æ•°ç»„</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> lineIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å·¦å­æ•°ç»„ä»¥ lineIndex-1 ä¸ºå³è¾¹ç•Œ</span>      <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> lineIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœå³è¾¹å­æ•°ç»„çš„é•¿åº¦ä¸å°äº1ï¼Œåˆ™é€’å½’å¿«æ’è¿™ä¸ªå­æ•°ç»„</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>lineIndex <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å³å­æ•°ç»„ä»¥ lineIndex ä¸ºå·¦è¾¹ç•Œ</span>      <span class="token function">quickSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> lineIndex<span class="token punctuation">,</span> right<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span class="token comment">// ä»¥åŸºå‡†å€¼ä¸ºè½´å¿ƒï¼Œåˆ’åˆ†å·¦å³å­æ•°ç»„çš„è¿‡ç¨‹</span><span class="token keyword">function</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> right</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åŸºå‡†å€¼é»˜è®¤å–ä¸­é—´ä½ç½®çš„å…ƒç´ </span>  <span class="token keyword">let</span> pivotValue <span class="token operator">=</span> arr<span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>left <span class="token operator">+</span> <span class="token punctuation">(</span>right <span class="token operator">-</span> left<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment">// åˆå§‹åŒ–å·¦å³æŒ‡é’ˆ</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> left  <span class="token keyword">let</span> j <span class="token operator">=</span> right  <span class="token comment">// å½“å·¦å³æŒ‡é’ˆä¸è¶Šç•Œæ—¶ï¼Œå¾ªç¯æ‰§è¡Œä»¥ä¸‹é€»è¾‘</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å·¦æŒ‡é’ˆæ‰€æŒ‡å…ƒç´ è‹¥å°äºåŸºå‡†å€¼ï¼Œåˆ™å³ç§»å·¦æŒ‡é’ˆ</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivotValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å³æŒ‡é’ˆæ‰€æŒ‡å…ƒç´ å¤§äºåŸºå‡†å€¼ï¼Œåˆ™å·¦ç§»å³æŒ‡é’ˆ</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> pivotValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      j<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è‹¥i&lt;=jï¼Œåˆ™æ„å‘³ç€åŸºå‡†å€¼å·¦è¾¹å­˜åœ¨è¾ƒå¤§å…ƒç´ æˆ–å³è¾¹å­˜åœ¨è¾ƒå°å…ƒç´ ï¼Œäº¤æ¢ä¸¤ä¸ªå…ƒç´ ç¡®ä¿å·¦å³ä¸¤ä¾§æœ‰åº</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">swap</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">)</span>      i<span class="token operator">++</span>      j<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›å·¦æŒ‡é’ˆç´¢å¼•ä½œä¸ºä¸‹ä¸€æ¬¡åˆ’åˆ†å·¦å³å­æ•°ç»„çš„ä¾æ®</span>  <span class="token keyword">return</span> i<span class="token punctuation">&#125;</span><span class="token comment">// å¿«é€Ÿæ’åºä¸­ä½¿ç”¨ swap çš„åœ°æ–¹æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬æå–æˆä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°</span><span class="token keyword">function</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å½’å¹¶æ’åº</title>
      <link href="/2023/05/25/gui-bing-pai-xu/"/>
      <url>/2023/05/25/gui-bing-pai-xu/</url>
      
        <content type="html"><![CDATA[<h2 id="è§£æ"><a href="#è§£æ" class="headerlink" title="è§£æ"></a>è§£æ</h2><ul><li>åˆ†è§£å­é—®é¢˜ï¼šå°†éœ€è¦è¢«æ’åºçš„æ•°ç»„ä»ä¸­é—´åˆ†å‰²ä¸ºä¸¤åŠï¼Œç„¶åå†å°†åˆ†å‰²å‡ºæ¥çš„æ¯ä¸ªå­æ•°ç»„å„åˆ†å‰²ä¸ºä¸¤åŠï¼Œé‡å¤ä»¥ä¸Šæ“ä½œï¼Œç›´åˆ°å•ä¸ªå­æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ä¸ºæ­¢ã€‚</li><li>æ±‚è§£æ¯ä¸ªå­é—®é¢˜ï¼šä»ç²’åº¦æœ€å°çš„å­æ•°ç»„å¼€å§‹ï¼Œä¸¤ä¸¤åˆå¹¶ã€ç¡®ä¿æ¯æ¬¡åˆå¹¶å‡ºæ¥çš„æ•°</li></ul><h2 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token comment">// å¤„ç†è¾¹ç•Œæƒ…å†µ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arr  <span class="token punctuation">&#125;</span>  <span class="token comment">// è®¡ç®—åˆ†å‰²ç‚¹</span>  <span class="token keyword">const</span> mid <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>len <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// é€’å½’åˆ†å‰²å·¦å­æ•°ç»„ï¼Œç„¶ååˆå¹¶ä¸ºæœ‰åºæ•°ç»„</span>  <span class="token keyword">const</span> leftArr <span class="token operator">=</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// é€’å½’åˆ†å‰²å³å­æ•°ç»„ï¼Œç„¶ååˆå¹¶ä¸ºæœ‰åºæ•°ç»„</span>  <span class="token keyword">const</span> rightArr <span class="token operator">=</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// åˆå¹¶å·¦å³ä¸¤ä¸ªæœ‰åºæ•°ç»„</span>  arr <span class="token operator">=</span> <span class="token function">mergeArr</span><span class="token punctuation">(</span>leftArr<span class="token punctuation">,</span> rightArr<span class="token punctuation">)</span>  <span class="token comment">// è¿”å›åˆå¹¶åçš„ç»“æœ</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mergeArr</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ arr1 å’Œ arr2</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// åˆå§‹åŒ–ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ç¼“å­˜arr1çš„é•¿åº¦</span>  <span class="token keyword">const</span> len1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span>length  <span class="token comment">// ç¼“å­˜arr2çš„é•¿åº¦</span>  <span class="token keyword">const</span> len2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span>length  <span class="token comment">// åˆå¹¶ä¸¤ä¸ªå­æ•°ç»„</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1 <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>      j<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„é¦–å…ˆè¢«åˆå¹¶å®Œå…¨ï¼Œåˆ™ç›´æ¥æ‹¼æ¥å¦ä¸€ä¸ªå­æ•°ç»„çš„å‰©ä½™éƒ¨åˆ†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤æ‚åº¦"><a href="#å¤æ‚åº¦" class="headerlink" title="å¤æ‚åº¦"></a>å¤æ‚åº¦</h2><ul><li>æˆ‘ä»¬æŠŠæ¯ä¸€æ¬¡åˆ‡åˆ†+å½’å¹¶çœ‹åšæ˜¯ä¸€è½®ã€‚å¯¹äºè§„æ¨¡ä¸º n çš„æ•°ç»„æ¥è¯´ï¼Œéœ€è¦åˆ‡åˆ† log(n) æ¬¡ï¼Œå› æ­¤å°±æœ‰ log(n) è½®ã€‚</li><li>å•æ¬¡åˆå¹¶çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)</li><li>log(n) è½®å¯¹åº” log(n) æ¬¡åˆå¹¶æ“ä½œï¼Œå› æ­¤å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(nlog(n))ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„-88</title>
      <link href="/2023/05/25/he-bing-liang-ge-you-xu-shu-zu-88/"/>
      <url>/2023/05/25/he-bing-liang-ge-you-xu-shu-zu-88/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/merge-sorted-array/description/">https://leetcode.cn/problems/merge-sorted-array/description/</a></p><h2 id="ç©ºé—´å¤æ‚åº¦-Oï¼ˆ1ï¼‰"><a href="#ç©ºé—´å¤æ‚åº¦-Oï¼ˆ1ï¼‰" class="headerlink" title="ç©ºé—´å¤æ‚åº¦ Oï¼ˆ1ï¼‰"></a>ç©ºé—´å¤æ‚åº¦ Oï¼ˆ1ï¼‰</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">merge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums1<span class="token punctuation">,</span> m<span class="token punctuation">,</span> nums2<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> l <span class="token operator">=</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>    r <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span>  <span class="token keyword">let</span> tail <span class="token operator">=</span> n <span class="token operator">+</span> m <span class="token operator">-</span> <span class="token number">1</span>  <span class="token keyword">let</span> cur  <span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">||</span> r <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      cur <span class="token operator">=</span> nums2<span class="token punctuation">[</span>r<span class="token operator">--</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      cur <span class="token operator">=</span> nums1<span class="token punctuation">[</span>l<span class="token operator">--</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nums1<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> nums2<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      cur <span class="token operator">=</span> nums1<span class="token punctuation">[</span>l<span class="token operator">--</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      cur <span class="token operator">=</span> nums2<span class="token punctuation">[</span>r<span class="token operator">--</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    nums1<span class="token punctuation">[</span>tail<span class="token operator">--</span><span class="token punctuation">]</span> <span class="token operator">=</span> cur  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é¢å¤–ç©ºé—´"><a href="#é¢å¤–ç©ºé—´" class="headerlink" title="é¢å¤–ç©ºé—´"></a>é¢å¤–ç©ºé—´</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">merge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums1<span class="token punctuation">,</span> m<span class="token punctuation">,</span> nums2<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> cur  <span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    r <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> m <span class="token operator">&amp;&amp;</span> r <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums1<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">></span> nums2<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      cur <span class="token operator">=</span> nums2<span class="token punctuation">[</span>r<span class="token operator">++</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      cur <span class="token operator">=</span> nums1<span class="token punctuation">[</span>l<span class="token operator">++</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">&lt;</span> m<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>nums1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">&lt;</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    res <span class="token operator">=</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>nums2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    nums1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆå¹¶ä¸¤ä¸ªæ•°ç»„"><a href="#åˆå¹¶ä¸¤ä¸ªæ•°ç»„" class="headerlink" title="åˆå¹¶ä¸¤ä¸ªæ•°ç»„"></a>åˆå¹¶ä¸¤ä¸ªæ•°ç»„</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergeArr</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ arr1 å’Œ arr2</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// åˆå§‹åŒ–ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ç¼“å­˜arr1çš„é•¿åº¦</span>  <span class="token keyword">const</span> len1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span>length  <span class="token comment">// ç¼“å­˜arr2çš„é•¿åº¦</span>  <span class="token keyword">const</span> len2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span>length  <span class="token comment">// åˆå¹¶ä¸¤ä¸ªå­æ•°ç»„</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1 <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>      j<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„é¦–å…ˆè¢«åˆå¹¶å®Œå…¨ï¼Œåˆ™ç›´æ¥æ‹¼æ¥å¦ä¸€ä¸ªå­æ•°ç»„çš„å‰©ä½™éƒ¨åˆ†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å’Œä¸ºsçš„ä¸¤ä¸ªæ•°å­—</title>
      <link href="/2023/05/24/he-wei-s-de-liang-ge-shu-zi/"/>
      <url>/2023/05/24/he-wei-s-de-liang-ge-shu-zi/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>è¾“å…¥ä¸€ä¸ªé€’å¢æ’åºçš„æ•°ç»„å’Œä¸€ä¸ªæ•°å­— sï¼Œåœ¨æ•°ç»„ä¸­æŸ¥æ‰¾ä¸¤ä¸ªæ•°ï¼Œä½¿å¾—å®ƒä»¬çš„å’Œæ­£å¥½æ˜¯ sã€‚å¦‚æœæœ‰å¤šå¯¹æ•°å­—çš„å’Œç­‰äº sï¼Œåˆ™è¾“å‡ºä»»æ„ä¸€å¯¹å³å¯ã€‚</p><h2 id="è§£é¢˜"><a href="#è§£é¢˜" class="headerlink" title="è§£é¢˜"></a>è§£é¢˜</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// é€šè¿‡åŒæŒ‡é’ˆè§£å†³</span><span class="token keyword">function</span> <span class="token function">twoSum</span><span class="token punctuation">(</span><span class="token parameter">nums<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> right <span class="token operator">=</span> nums<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>left <span class="token operator">&lt;</span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> sum <span class="token operator">=</span> nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">===</span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token punctuation">[</span>nums<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>right<span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">></span> target<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      right<span class="token operator">--</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      left<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬Nä¸ªèŠ‚ç‚¹-19</title>
      <link href="/2023/05/24/shan-chu-lian-biao-de-dao-shu-di-n-ge-jie-dian-19/"/>
      <url>/2023/05/24/shan-chu-lian-biao-de-dao-shu-di-n-ge-jie-dian-19/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/remove-nth-node-from-end-of-list/discussion/">https://leetcode.cn/problems/remove-nth-node-from-end-of-list/discussion/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">removeNthFromEnd</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> dummy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> head<span class="token punctuation">)</span>  <span class="token keyword">let</span> slow <span class="token operator">=</span> dummy  <span class="token keyword">let</span> fast <span class="token operator">=</span> dummy  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next    fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  slow<span class="token punctuation">.</span>next <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next  <span class="token keyword">return</span> dummy<span class="token punctuation">.</span>next<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é“¾è¡¨çš„ä¸­é—´ç»“ç‚¹-876</title>
      <link href="/2023/05/24/lian-biao-de-zhong-jian-jie-dian-876/"/>
      <url>/2023/05/24/lian-biao-de-zhong-jian-jie-dian-876/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/middle-of-the-linked-list/discussion/">https://leetcode.cn/problems/middle-of-the-linked-list/discussion/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">middleNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> slow <span class="token operator">=</span> head  <span class="token keyword">let</span> fast <span class="token operator">=</span> head  <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> fast<span class="token punctuation">.</span>next <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next    fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> slow<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ é™¤æ•°ç»„ä¸­çš„é‡å¤é¡¹-26</title>
      <link href="/2023/05/24/shan-chu-shu-zu-zhong-de-chong-fu-xiang/"/>
      <url>/2023/05/24/shan-chu-shu-zu-zhong-de-chong-fu-xiang/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/discussion/">https://leetcode.cn/problems/remove-duplicates-from-sorted-array/discussion/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">removeDuplicates</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> slow <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> fast <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span> <span class="token operator">!==</span> nums<span class="token punctuation">[</span>slow<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      slow<span class="token operator">++</span>      nums<span class="token punctuation">[</span>slow<span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    fast<span class="token operator">++</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> slow <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç§»åŠ¨é›¶</title>
      <link href="/2023/05/24/yi-dong-ling/"/>
      <url>/2023/05/24/yi-dong-ling/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/move-zeroes/">https://leetcode.cn/problems/move-zeroes/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">moveZeroes</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> slow <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> fast <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      nums<span class="token punctuation">[</span>slow<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    fast<span class="token operator">++</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>slow <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    nums<span class="token punctuation">[</span>slow<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> nums<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç§»åŠ¨å…ƒç´ -283</title>
      <link href="/2023/05/24/yi-dong-yuan-su/"/>
      <url>/2023/05/24/yi-dong-yuan-su/</url>
      
        <content type="html"><![CDATA[<p>åŠ›æ‰£ï¼ˆLeetCodeï¼‰ é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/remove-element/">https://leetcode.cn/problems/remove-element/</a></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">removeElement</span><span class="token punctuation">(</span><span class="token parameter">nums<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> slow <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> fast <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>fast <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å½“å¿«æŒ‡é’ˆç­‰äºå¯¹åº”å€¼æ—¶ï¼Œåˆ™è·³è¿‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span> <span class="token operator">!=</span> val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      nums<span class="token punctuation">[</span>slow<span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>fast<span class="token punctuation">]</span>      slow<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¿«æŒ‡é’ˆæ¯æ¬¡éƒ½å‰è¿›ä¸€æ­¥</span>    fast<span class="token operator">++</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> slow<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
            <tag> æ•°ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSè¾“å‡º</title>
      <link href="/2023/05/10/js-shu-chu/"/>
      <url>/2023/05/10/js-shu-chu/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a><strong>é¢˜ç›®</strong></h3><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> rej</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æˆ‘æ˜¯å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°"</span><span class="token punctuation">)</span>      <span class="token function">res</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> arr1 <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">await</span> <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>  <span class="token keyword">return</span> item <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"arr1=>"</span><span class="token punctuation">,</span> arr1<span class="token punctuation">)</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è€ƒå¯Ÿç‚¹ï¼š"><a href="#è€ƒå¯Ÿç‚¹ï¼š" class="headerlink" title="è€ƒå¯Ÿç‚¹ï¼š"></a>è€ƒå¯Ÿç‚¹ï¼š</h3><p>è¿™æ®µä»£ç è€ƒå¯Ÿäº†JavaScriptä¸­å¼‚æ­¥ç¼–ç¨‹çš„æ¦‚å¿µï¼ŒåŒæ—¶æ¶‰åŠåˆ°äº†å¼‚æ­¥å‡½æ•°å’ŒPromiseå¯¹è±¡çš„ä½¿ç”¨ã€‚</p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>åœ¨ä»£ç ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå¸¸é‡<code>arr</code>ï¼Œè¡¨ç¤ºä¸€ä¸ªæ•´æ•°æ•°ç»„ï¼›å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°<code>wait</code>ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°<code>time</code>ï¼Œè¡¨ç¤ºç­‰å¾…æ—¶é—´ï¼Œç„¶åè¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œåœ¨ç­‰å¾…æ—¶é—´ç»“æŸåresolveè¯¥Promiseå¯¹è±¡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¸¸é‡<code>arr1</code>ï¼Œä½¿ç”¨<code>Array.map</code>æ–¹æ³•å¯¹<code>arr</code>è¿›è¡Œäº†éå†ï¼Œå¯¹æ¯ä¸€ä¸ªå…ƒç´ éƒ½è°ƒç”¨äº†å¼‚æ­¥å‡½æ•°<code>wait</code>ã€‚åœ¨å¼‚æ­¥å‡½æ•°ä¸­ï¼Œä½¿ç”¨<code>await</code>ç­‰å¾…<code>wait</code>å‡½æ•°è¿”å›çš„Promiseå¯¹è±¡ï¼Œç„¶åæ‰“å°å½“å‰å…ƒç´ å¹¶è¿”å›å…¶ä¹˜ä»¥2çš„ç»“æœã€‚</p><p>æœ€åï¼Œä½¿ç”¨<code>console.dir</code>æ–¹æ³•æ‰“å°<code>arr1</code>ã€‚</p><p>ç”±äº<code>wait</code>å‡½æ•°æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå› æ­¤æ‰“å°<code>arr1</code>æ—¶ï¼Œ<code>arr1</code>ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ã€‚è¿™äº›Promiseå¯¹è±¡çš„çŠ¶æ€å¯èƒ½æ˜¯pendingï¼Œä¹Ÿå¯èƒ½æ˜¯fulfilledã€‚å¦‚æœå½“å‰è¿è¡Œç¯å¢ƒï¼ˆä¾‹å¦‚æµè§ˆå™¨æˆ–Node.jsç¯å¢ƒï¼‰æ”¯æŒå¼‚æ­¥å‡½æ•°å’ŒPromiseå¯¹è±¡ï¼Œé‚£ä¹ˆåœ¨ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œä¼šåˆ†åˆ«æ‰“å°æ¯ä¸€ä¸ªå…ƒç´ çš„å€¼ï¼Œä»¥åŠä¸€æ¡æ¶ˆæ¯â€æˆ‘æ˜¯å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°â€ã€‚</p><h3 id="æ ¸å¿ƒï¼š"><a href="#æ ¸å¿ƒï¼š" class="headerlink" title="æ ¸å¿ƒï¼š"></a><strong>æ ¸å¿ƒï¼š</strong></h3><ul><li>await åé¢çš„åŒæ­¥ä»£ç ä¼šç«‹å³æ‰§è¡Œ</li><li>forEachå’Œmapçš„æºç ä¸­å®é™…ä¸Šæ ¸å¿ƒåŠŸèƒ½æ˜¯ä¾èµ–çš„ä¸€ä¸ªwhileå¾ªç¯ï¼Œæ²¡æœ‰å¯¹å¼‚æ­¥åšå¤„ç†</li></ul><h3 id="è¾“å‡ºç»“æœï¼š"><a href="#è¾“å‡ºç»“æœï¼š" class="headerlink" title="è¾“å‡ºç»“æœï¼š"></a>è¾“å‡ºç»“æœï¼š</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">[</span>  Promise <span class="token punctuation">&#123;</span> <span class="token operator">&lt;</span>pending<span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  Promise <span class="token punctuation">&#123;</span> <span class="token operator">&lt;</span>pending<span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  Promise <span class="token punctuation">&#123;</span> <span class="token operator">&lt;</span>pending<span class="token operator">></span> <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åï¼Œä¸€ç§’é’Ÿåï¼Œä¾æ¬¡è¾“å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">æˆ‘æ˜¯å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°<span class="token number">1</span>æˆ‘æ˜¯å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°<span class="token number">2</span>æˆ‘æ˜¯å¼‚æ­¥æ‰§è¡Œçš„å‡½æ•°<span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å››ç§’å</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"> <span class="token punctuation">[</span>  Promise <span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>fulfilled<span class="token operator">></span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>Promise <span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>fulfilled<span class="token operator">></span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>Promise <span class="token punctuation">&#123;</span><span class="token operator">&lt;</span>fulfilled<span class="token operator">></span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeré•œåƒå’Œå®¹å™¨</title>
      <link href="/2023/05/09/docker-jing-xiang-he-rong-qi/"/>
      <url>/2023/05/09/docker-jing-xiang-he-rong-qi/</url>
      
        <content type="html"><![CDATA[<h2 id="1-image-é•œåƒ"><a href="#1-image-é•œåƒ" class="headerlink" title="1. image é•œåƒ"></a>1. image é•œåƒ</h2><table><thead><tr><th align="left">å‘½ä»¤</th><th align="left">å«ä¹‰</th><th align="left">è¯­æ³•</th><th align="left">æ¡ˆä¾‹</th></tr></thead><tbody><tr><td align="left">ls</td><td align="left">æŸ¥çœ‹å…¨éƒ¨é•œåƒ</td><td align="left">docker image ls</td><td align="left"></td></tr><tr><td align="left">search</td><td align="left">æŸ¥æ‰¾é•œåƒ</td><td align="left">docker search [imageName]</td><td align="left"></td></tr><tr><td align="left">history</td><td align="left">æŸ¥çœ‹é•œåƒå†å²</td><td align="left">docker history [imageName]</td><td align="left"></td></tr><tr><td align="left">inspect</td><td align="left">æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒè¯¦ç»†ä¿¡æ¯</td><td align="left">docker inspect [imageName]</td><td align="left"></td></tr><tr><td align="left">pull</td><td align="left">æ‹‰å–é•œåƒ</td><td align="left">docker pull [imageName]</td><td align="left"></td></tr><tr><td align="left">push</td><td align="left">æ¨é€ä¸€ä¸ªé•œåƒåˆ°é•œåƒä»“åº“</td><td align="left">docker push [imageName]</td><td align="left"></td></tr><tr><td align="left">rmi</td><td align="left">åˆ é™¤é•œåƒ</td><td align="left">docker rmi [imageName] docker image rmi 2</td><td align="left"></td></tr><tr><td align="left">prune</td><td align="left">ç§»é™¤æœªä½¿ç”¨çš„é•œåƒï¼Œæ²¡æœ‰æ ‡è®°æˆ–è¡¥ä»»ä½•å®¹å™¨å¼•ç”¨</td><td align="left">docker image prune</td><td align="left">docker image prune</td></tr><tr><td align="left">tag</td><td align="left">æ ‡è®°æœ¬åœ°é•œåƒï¼Œå°†å…¶å½’å…¥æŸä¸€ä»“åº“</td><td align="left">docker tag [OPTIONS] IMAGE[:TAG] [REGISTRYHOST/][USERNAME/]NAME[:TAG]</td><td align="left">docker tag centos:7 zhangrenyang/centos:v1</td></tr><tr><td align="left">export</td><td align="left">å°†å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶å¯¼å‡ºåˆ° STDOUT</td><td align="left">docker export [OPTIONS] CONTAINER</td><td align="left">docker export -o hello-world.tar b2712f1067a3</td></tr><tr><td align="left">import</td><td align="left">å¯¼å…¥å®¹å™¨å¿«ç…§æ–‡ä»¶ç³»ç»Ÿ tar å½’æ¡£æ–‡ä»¶å¹¶åˆ›å»ºé•œåƒ</td><td align="left">docker import [OPTIONS] file/URL/- [REPOSITORY[:TAG]]</td><td align="left">docker import hello-world.tar</td></tr><tr><td align="left">save</td><td align="left">å°†æŒ‡å®šé•œåƒä¿å­˜æˆ<code>tar</code>æ–‡ä»¶</td><td align="left">docker save [OPTIONS] IMAGE [IMAGEâ€¦]</td><td align="left">docker save -o hello-world.tar hello-world:latest</td></tr><tr><td align="left">load</td><td align="left">åŠ è½½ tar æ–‡ä»¶å¹¶åˆ›å»ºé•œåƒ</td><td align="left"></td><td align="left">docker load -i hello-world.tar</td></tr><tr><td align="left">build</td><td align="left">æ ¹æ® Dockerfile æ„å»ºé•œåƒ</td><td align="left">docker build [OPTIONS] PATH / URL / -</td><td align="left">docker build -t zf/ubuntu:v1 .</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> image <span class="token function">ls</span> <span class="token comment">#æŸ¥çœ‹é•œåƒ</span><span class="token function">docker</span> search ubuntu <span class="token comment">#æŸ¥æ‰¾é•œåƒ</span><span class="token function">docker</span>  pull docker.io/hello-world <span class="token comment"># æ‹‰å–é•œåƒ</span><span class="token function">docker</span> image pull  docker.io/hello-world <span class="token comment"># æ‹‰å–é•œåƒ</span><span class="token function">docker</span> rmi  hello-world <span class="token comment">#  åˆ é™¤é•œåƒ</span><span class="token function">docker</span> <span class="token builtin class-name">export</span> <span class="token parameter variable">-o</span> <span class="token punctuation">[</span>æ–°è¾“å…¥é•œåƒçš„åç§°<span class="token punctuation">]</span> <span class="token punctuation">[</span>å®¹å™¨ID<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-container-å®¹å™¨"><a href="#2-container-å®¹å™¨" class="headerlink" title="2. container å®¹å™¨"></a>2. container å®¹å™¨</h2><h3 id="å¸¸ç”¨å‘½ä»¤"><a href="#å¸¸ç”¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å‘½ä»¤"></a>å¸¸ç”¨å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> <span class="token parameter variable">--help</span><span class="token comment"># å¯åŠ¨å®¹å™¨</span><span class="token comment"># -i --interactiveäº¤äº’å¼</span><span class="token comment"># -t --ttyåˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</span><span class="token comment"># -d --detachè¿è¡Œå®¹å™¨åˆ°åå°</span><span class="token comment"># -a --attach listé™„åŠ åˆ°è¿è¡Œçš„å®¹å™¨</span><span class="token comment"># -e --env listè®¾ç½®ç¯å¢ƒå˜é‡</span><span class="token comment"># -p --publish listå‘å¸ƒå®¹å™¨ç«¯å£åˆ°ä¸»æœº</span><span class="token comment"># -P--publish-all è‡ªå·±åˆ†é…ç«¯å£</span><span class="token comment"># --name Assign a name to the container</span><span class="token function">docker</span> run ubuntu /bin/echo <span class="token string">"Hello world"</span># Dockerä»¥ubuntué•œåƒåˆ›å»ºä¸€ä¸ªæ–°å®¹å™¨ï¼Œç„¶ååœ¨å®¹å™¨é‡Œæ‰§è¡Œ bin/echo <span class="token string">"Hello world"</span>ï¼Œç„¶åè¾“å‡ºç»“æœ<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">1010</span>:80 <span class="token parameter variable">-e</span> <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"ghx"</span> <span class="token parameter variable">--name</span> ghx-nginx nginx<span class="token function">docker</span> container <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> 3695dc5b9c2d /bin/bash <span class="token comment">#è¿›å…¥å®¹å™¨ </span><span class="token comment"># æŸ¥çœ‹å®¹å™¨</span><span class="token comment">## -q, --quiet        Only display container IDs</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token comment"># æŸ¥çœ‹å½“å‰è¿è¡Œçš„å®¹å™¨</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token comment">#æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ï¼ŒåŒ…æ‹¬å·²åœæ­¢çš„</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-l</span> <span class="token comment">#æ˜¾ç¤ºæœ€æ–°çš„é‚£ä¸ªå®¹å™¨</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span> <span class="token comment">#æ˜¾ç¤ºæ‰€æœ‰çš„å®¹å™¨ID</span><span class="token function">docker</span> inspect <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span> <span class="token comment">#æ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨è¯¦ç»†ä¿¡æ¯</span><span class="token comment"># è¿è¡Œäº¤äº’å¼çš„å®¹å™¨</span><span class="token comment">## -t, --tty åœ¨æ–°å®¹å™¨å†…æŒ‡å®šä¸€ä¸ªä¼ªç»ˆç«¯æˆ–ç»ˆç«¯ã€‚</span><span class="token comment">## -i, --interactive å…è®¸ä½ å¯¹å®¹å™¨å†…çš„æ ‡å‡†è¾“å…¥ (STDIN) è¿›è¡Œäº¤äº’ã€‚</span><span class="token comment">## -p --port ç«¯å£æ˜ å°„</span><span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> ubuntu /bin/bash<span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:80 nginx <span class="token builtin class-name">exit</span><span class="token comment"># åå°è¿è¡Œå®¹å™¨</span><span class="token comment">## -d, --detach Run container in background and print container ID</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> centos <span class="token function">ping</span> www.baidu.com<span class="token function">docker</span> logs <span class="token parameter variable">--follow</span> <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span class="token comment"># æ€æ­»å®¹å™¨</span><span class="token comment">## killæ˜¯ä¸ç®¡å®¹å™¨åŒä¸åŒæ„ï¼Œç›´æ¥æ‰§è¡Œkillï¼Œå¼ºè¡Œç»ˆæ­¢ï¼›</span><span class="token function">docker</span> <span class="token function">kill</span> <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span class="token comment"># #åˆ é™¤å®¹å™¨</span><span class="token function">docker</span> <span class="token function">rm</span>  <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span> <span class="token comment">#åˆ é™¤å®¹å™¨</span><span class="token function">docker</span> rmi <span class="token punctuation">[</span>imageId<span class="token punctuation">]</span>  <span class="token comment">#åˆ é™¤é•œåƒ</span><span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token parameter variable">-a</span> <span class="token parameter variable">-q</span><span class="token variable">)</span></span> <span class="token comment"># åˆ é™¤æ‰€æœ‰å®¹å™¨</span><span class="token comment">#å¯åŠ¨å®¹å™¨</span><span class="token function">docker</span> start <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span class="token comment"># åœæ­¢å®¹å™¨</span><span class="token comment">## stopï¼Œé¦–å…ˆç»™å®¹å™¨å‘é€ä¸€ä¸ªTERMä¿¡å·ï¼Œè®©å®¹å™¨åšä¸€äº›é€€å‡ºå‰å¿…é¡»çš„ä¿æŠ¤æ€§ã€å®‰å…¨æ€§æ“ä½œï¼Œç„¶åè®©å®¹å™¨è‡ªåŠ¨åœæ­¢è¿è¡Œï¼Œå¦‚æœåœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œå®¹å™¨è¿˜æ˜¯æ²¡æœ‰åœæ­¢ï¼Œå†è¿›è¡Œkillï¼Œå¼ºè¡Œç»ˆæ­¢</span><span class="token function">docker</span> stop <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span class="token comment"># è¿›å…¥ä¸€ä¸ªå®¹å™¨</span><span class="token function">docker</span> attach <span class="token punctuation">[</span>containerID<span class="token punctuation">]</span> <span class="token comment"># è¦attachä¸Šå»çš„å®¹å™¨å¿…é¡»æ­£åœ¨è¿è¡Œï¼Œå¯ä»¥åŒæ—¶è¿æ¥ä¸ŠåŒä¸€ä¸ªcontaineræ¥å…±äº«å±å¹•</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token punctuation">[</span>containerID<span class="token punctuation">]</span> /bin/bash <span class="token comment">#è¿›å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œä¸­çš„å®¹å™¨</span><span class="token comment">#æ‹·è´æ–‡ä»¶</span><span class="token comment">##ä»æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨é‡Œé¢ï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°æœ¬æœº</span><span class="token function">docker</span> container <span class="token function">cp</span> f6a53629488b:/root/root.txt <span class="token builtin class-name">.</span><span class="token comment">#è‡ªåŠ¨åˆ é™¤</span><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> ubuntu /bin/bash<span class="token function">docker</span> container stats<span class="token comment">#æ˜¾ç¤ºä¸€ä¸ªå®¹å™¨è¿è¡Œçš„è¿›ç¨‹</span><span class="token function">docker</span> update <span class="token parameter variable">-m</span> 500m  <span class="token punctuation">[</span>containerID<span class="token punctuation">]</span> <span class="token comment">#æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨é…ç½®</span><span class="token comment">#ç«¯å£æ˜ å°„</span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">8080</span>:80 nginx <span class="token function">docker</span> container port containerID<span class="token comment"># æŸ¥çœ‹ docker å®¹å™¨çš„è¾“å‡º</span><span class="token comment">## -f, --follow         Follow log outpu</span><span class="token function">docker</span> logs <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span class="token function">docker</span> logs <span class="token parameter variable">-f</span> <span class="token punctuation">[</span>containerId<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSè¾“å‡º</title>
      <link href="/2023/05/08/js-shu-chu-1/"/>
      <url>/2023/05/08/js-shu-chu-1/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a><strong>é¢˜ç›®</strong></h3><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// 1.</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">// 1</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token comment">// 2.</span><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è€ƒå¯Ÿç‚¹ï¼š"><a href="#è€ƒå¯Ÿç‚¹ï¼š" class="headerlink" title="è€ƒå¯Ÿç‚¹ï¼š"></a>è€ƒå¯Ÿç‚¹ï¼š</h3><ul><li>å˜é‡æå‡</li><li>æš‚æ—¶æ€§æ­»åŒº</li><li>å—çº§ä½œç”¨åŸŸ</li></ul><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p><strong>ç¬¬ä¸€é¢˜æå‡åçš„ä»£ç ä¸º</strong></p><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">var aa&#x3D; 1;if (true) &#123;    console.log(a);    a &#x3D; 2;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å˜é‡æå‡ä¼šæå‡åˆ°æœ€è¿‘çš„å‡½æ•°çš„ä½œç”¨åŸŸå†…è€Œéæœ€è¿‘çš„å—çº§ if ä½œç”¨åŸŸå†…</p><p><strong>ç¬¬äºŒé¢˜</strong></p><p>å› ä¸ºå­˜åœ¨å—çº§ä½œç”¨åŸŸå’Œ let è¯­æ³•ï¼Œæå‰è°ƒç”¨äº† let å£°æ˜å˜é‡è§¦å‘æš‚æ—¶æ€§æ­»åŒºï¼Œæ‰€ä»¥æŠ¥é”™</p><h3 id="æ ¸å¿ƒï¼š"><a href="#æ ¸å¿ƒï¼š" class="headerlink" title="æ ¸å¿ƒï¼š"></a><strong>æ ¸å¿ƒï¼š</strong></h3><ol><li><p>å˜é‡æå‡æå‡åˆ°å“ª</p><p>å‡½æ•°é¡¶å±‚è€Œéå—çº§ä½œç”¨åŸŸé¡¶å±‚</p></li><li><p>æš‚æ—¶æ€§æ­»åŒºçš„çœŸæ­£ç†è§£ï¼Œ</p><p>å¦‚æœå†…éƒ¨å—çº§ä½œç”¨åŸŸå†…ä½¿ç”¨äº† letï¼Œå³ä½¿å¤–éƒ¨ä½œç”¨åŸŸä¹Ÿå£°æ˜äº†è¯¥å˜é‡ä¹Ÿä¸èƒ½æå‰ä½¿ç”¨è¯¥å˜é‡</p></li></ol><h3 id="è¾“å‡ºç»“æœï¼š"><a href="#è¾“å‡ºç»“æœï¼š" class="headerlink" title="è¾“å‡ºç»“æœï¼š"></a>è¾“å‡ºç»“æœï¼š</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token number">1</span>Uncaught ReferenceError<span class="token operator">:</span> Cannot access <span class="token string">'a'</span> before initialization<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSè¾“å‡º</title>
      <link href="/2023/05/08/js-shu-chu/"/>
      <url>/2023/05/08/js-shu-chu/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a><strong>é¢˜ç›®</strong></h3><p>è¾“å‡ºæ˜¯ä»€ä¹ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token keyword">var</span> b <span class="token operator">=</span> aa<span class="token punctuation">.</span>x <span class="token operator">=</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>n<span class="token punctuation">,</span> b<span class="token punctuation">.</span>n<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>x<span class="token punctuation">,</span> b<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è€ƒå¯Ÿç‚¹ï¼š"><a href="#è€ƒå¯Ÿç‚¹ï¼š" class="headerlink" title="è€ƒå¯Ÿç‚¹ï¼š"></a>è€ƒå¯Ÿç‚¹ï¼š</h3><p><strong>åœ¨æµè§ˆå™¨ä¸­ï¼Œå¯¹è±¡å±æ€§çš„èµ‹å€¼æ“ä½œä¼šå…ˆäºå˜é‡èµ‹å€¼æ“ä½œæ‰§è¡Œ</strong></p><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><ol><li>é¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ aï¼Œå…¶ n å±æ€§å€¼ä¸º 1ã€‚</li><li>å˜é‡ b è¢«èµ‹å€¼ä¸ºå¯¹è±¡ a çš„å¼•ç”¨ã€‚</li><li>æ‰§è¡Œ <code>a.x = (a = &#123; n: 2 &#125;)</code> æ—¶ï¼Œä¼šå…ˆå°† <code>a</code> çš„å±æ€§ <code>x</code> èµ‹å€¼ä¸º <code>undefined</code>ï¼Œç„¶åå†å°† <code>a</code> çš„å€¼æ›´æ–°ä¸º <code>&#123; n: 2 &#125;</code>ã€‚æ­¤æ—¶å˜é‡ a æŒ‡å‘æ–°çš„å¯¹è±¡<code> &#123; n: 2 &#125;</code>ï¼Œä½† b ä»ç„¶æŒ‡å‘æ—§çš„å¯¹è±¡ <code>&#123; n: 1 ,x:&#123;n:2&#125;&#125;</code>ã€‚</li></ol><h3 id="æ ¸å¿ƒï¼š"><a href="#æ ¸å¿ƒï¼š" class="headerlink" title="æ ¸å¿ƒï¼š"></a><strong>æ ¸å¿ƒï¼š</strong></h3><p>a.x = (a = { n: 2 })å…ˆå°† a.x èµ‹å€¼ä¸º undefinedï¼Œå†ä»å³å‘å·¦æ‰§è¡Œä»£ç ã€‚</p><h3 id="è¾“å‡ºç»“æœï¼š"><a href="#è¾“å‡ºç»“æœï¼š" class="headerlink" title="è¾“å‡ºç»“æœï¼š"></a>è¾“å‡ºç»“æœï¼š</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token number">2</span> <span class="token number">1</span><span class="token keyword">undefined</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">n</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ¶ä½œDockerfile</title>
      <link href="/2023/05/06/zhi-zuo-dockerfile/"/>
      <url>/2023/05/06/zhi-zuo-dockerfile/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆ¶ä½œ-Dockerfile"><a href="#åˆ¶ä½œ-Dockerfile" class="headerlink" title="åˆ¶ä½œ Dockerfile"></a>åˆ¶ä½œ Dockerfile</h2><p><a href="https://docs.docker.com/engine/reference/commandline/build/">https://docs.docker.com/engine/reference/commandline/build/</a></p><ul><li>Docker çš„é•œåƒæ˜¯ç”¨ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç»„æˆçš„</li><li>Layers å°±æ˜¯é•œåƒçš„å±‚æ–‡ä»¶ï¼Œåªè¯»ä¸èƒ½ä¿®æ”¹ã€‚åŸºäºé•œåƒåˆ›å»ºçš„å®¹å™¨ä¼šå…±äº«è¿™äº›æ–‡ä»¶å±‚</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> image <span class="token function">ls</span> <span class="token comment"># åˆ—å‡ºæ‰€æœ‰é•œåƒ</span><span class="token function">docker</span> inspect centos <span class="token operator">|</span>  <span class="token function">docker</span> image inspect centos <span class="token comment"># æŸ¥çœ‹é•œåƒæˆ–è€…å®¹å™¨è¯¦ç»†ä¿¡æ¯</span><span class="token function">docker</span> build <span class="token parameter variable">-t</span> express-demo:1.0.0 <span class="token builtin class-name">.</span> <span class="token comment"># åˆ›å»ºé•œåƒ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="1-ç¼–å†™-Dockerfile"><a href="#1-ç¼–å†™-Dockerfile" class="headerlink" title="1 ç¼–å†™ Dockerfile"></a>1 ç¼–å†™ Dockerfile</h3><p><a href="https://docs.docker.com/engine/reference/builder">https://docs.docker.com/engine/reference/builder</a></p><table><thead><tr><th align="left">æŒ‡ä»¤</th><th align="left">å«ä¹‰</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left">FROM</td><td align="left">æ„å»ºçš„æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒ</td><td align="left">FROM centos:6</td></tr><tr><td align="left">MAINTAINER(åºŸå¼ƒ)</td><td align="left">é•œåƒç»´æŠ¤è€…å§“åæˆ–é‚®ç®±åœ°å€</td><td align="left">MAINTAINER zhufengjiagou</td></tr><tr><td align="left">RUN</td><td align="left">æ„å»ºé•œåƒæ—¶è¿è¡Œçš„ shell å‘½ä»¤</td><td align="left">RUN yum install httpd</td></tr><tr><td align="left">CMD</td><td align="left">CMD è®¾ç½®å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤åŠå…¶å‚æ•°ï¼Œä½† CMD èƒ½å¤Ÿè¢« docker run åé¢è·Ÿçš„å‘½ä»¤è¡Œå‚æ•°æ›¿æ¢</td><td align="left">CMD /usr/sbin/sshd -D</td></tr><tr><td align="left">EXPOSE</td><td align="left">å£°æ˜å®¹å™¨è¿è¡Œçš„æœåŠ¡å™¨ç«¯å£</td><td align="left">EXPOSE 80 443</td></tr><tr><td align="left">ENV</td><td align="left">è®¾ç½®å®¹å™¨å†…çš„ç¯å¢ƒå˜é‡</td><td align="left">ENV MYSQL_ROOT_PASSWORD 123456</td></tr><tr><td align="left">ADD</td><td align="left">æ‹·è´æ–‡ä»¶æˆ–ç›®å½•åˆ°é•œåƒä¸­ï¼Œå¦‚æœæ˜¯ URL æˆ–è€…å‹ç¼©åŒ…ä¼šè‡ªåŠ¨ä¸‹è½½å’Œè§£å‹</td><td align="left">ADD ,ADD <a href="https://xxx.com/html.tar.gz">https://xxx.com/html.tar.gz</a> /var/<a href="http://www.html/">www.html</a>, ADD html.tar.gz /var/www/html</td></tr><tr><td align="left">COPY</td><td align="left">æ‹·è´æ–‡ä»¶æˆ–ç›®å½•åˆ°é•œåƒ</td><td align="left">COPY ./start.sh /start.sh</td></tr><tr><td align="left">ENTRYPOINT</td><td align="left">é…ç½®å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤</td><td align="left">ENTRYPOINT /bin/bash -c â€˜/start.shâ€™</td></tr><tr><td align="left">VOLUME</td><td align="left">æŒ‡å®šå®¹å™¨æŒ‚è½½ç‚¹åˆ°å®¿ä¸»è‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•æˆ–å…¶å®ƒå®¹å™¨</td><td align="left">VOLUME [â€œ/var/lib/mysqlâ€]</td></tr><tr><td align="left">USER</td><td align="left">ä¸º RUN CMD å’Œ ENTRYPOINT æ‰§è¡Œå‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·</td><td align="left">USER zhufengjiagou</td></tr><tr><td align="left">WORKDIR</td><td align="left">ä¸º RUN CMD ENTRYPOINT COPY ADD è®¾ç½®å·¥ä½œç›®å½•</td><td align="left">WORKDIR /data</td></tr><tr><td align="left">HEALTHCHECK</td><td align="left">å¥åº·æ£€æŸ¥</td><td align="left">HEALTHCHECK â€“interval=5m â€“timeout=3s â€“retries=3 CMS curl -f htp://localhost</td></tr><tr><td align="left">ARG</td><td align="left">åœ¨æ„å»ºé•œåƒæ—¶æŒ‡å®šä¸€äº›å‚æ•°</td><td align="left">ARG user</td></tr></tbody></table><ul><li>cmd ç»™å‡ºçš„æ˜¯ä¸€ä¸ªå®¹å™¨çš„é»˜è®¤çš„å¯æ‰§è¡Œä½“ã€‚ä¹Ÿå°±æ˜¯å®¹å™¨å¯åŠ¨ä»¥åï¼Œé»˜è®¤çš„æ‰§è¡Œçš„å‘½ä»¤ã€‚é‡ç‚¹å°±æ˜¯è¿™ä¸ªâ€é»˜è®¤â€ã€‚æ„å‘³ç€ï¼Œå¦‚æœ<code>docker run</code>æ²¡æœ‰æŒ‡å®šä»»ä½•çš„æ‰§è¡Œå‘½ä»¤æˆ–è€…<code>dockerfile</code>é‡Œé¢ä¹Ÿæ²¡æœ‰<code>entrypoint</code>ï¼Œé‚£ä¹ˆï¼Œå°±ä¼šä½¿ç”¨ cmd æŒ‡å®šçš„é»˜è®¤çš„æ‰§è¡Œå‘½ä»¤æ‰§è¡Œã€‚åŒæ—¶ä¹Ÿä»ä¾§é¢è¯´æ˜äº†<code>entrypoint</code>çš„å«ä¹‰ï¼Œå®ƒæ‰æ˜¯çœŸæ­£çš„å®¹å™¨å¯åŠ¨ä»¥åè¦æ‰§è¡Œå‘½ä»¤</li></ul><h3 id="2-dockerignore"><a href="#2-dockerignore" class="headerlink" title="2 .dockerignore"></a>2 .dockerignore</h3><p>è¡¨ç¤ºè¦æ’é™¤ï¼Œä¸è¦æ‰“åŒ…åˆ° image ä¸­çš„æ–‡ä»¶è·¯å¾„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">.</span>gitnode_modules<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="3-Dockerfile"><a href="#3-Dockerfile" class="headerlink" title="3 Dockerfile"></a>3 Dockerfile</h3><h4 id="3-1-å®‰è£…-node"><a href="#3-1-å®‰è£…-node" class="headerlink" title="3.1 å®‰è£… node"></a>3.1 <a href="https://cloud.tencent.com/developer/beta/article/1886344">å®‰è£… node</a></h4><h4 id="2-å®‰è£…-express-é¡¹ç›®ç”Ÿæˆå™¨"><a href="#2-å®‰è£…-express-é¡¹ç›®ç”Ÿæˆå™¨" class="headerlink" title="2 å®‰è£… express é¡¹ç›®ç”Ÿæˆå™¨"></a>2 å®‰è£… express é¡¹ç›®ç”Ÿæˆå™¨</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm install express<span class="token operator">-</span>generator <span class="token operator">-</span>gexpress app<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="3-Dockerfile-1"><a href="#3-Dockerfile-1" class="headerlink" title="3 Dockerfile"></a>3 Dockerfile</h4><ul><li><code>vi Dockerfile</code></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token constant">FROM</span> node<span class="token constant">COPY</span> <span class="token punctuation">.</span><span class="token operator">/</span>app <span class="token operator">/</span>app<span class="token constant">WORKDIR</span> <span class="token operator">/</span>app<span class="token constant">RUN</span> npm install<span class="token constant">EXPOSE</span> <span class="token number">3000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>FROM è¡¨ç¤ºè¯¥é•œåƒç»§æ‰¿çš„é•œåƒ :è¡¨ç¤ºæ ‡ç­¾</li><li>COPY æ˜¯å°†å½“å‰ç›®å½•ä¸‹çš„ app ç›®å½•ä¸‹é¢çš„æ–‡ä»¶éƒ½æ‹·è´åˆ° image é‡Œçš„/app ç›®å½•ä¸­</li><li>WORKDIR æŒ‡å®šå·¥ä½œè·¯å¾„ï¼Œç±»ä¼¼äºæ‰§è¡Œ <code>cd</code> å‘½ä»¤</li><li>RUN npm install åœ¨/app ç›®å½•ä¸‹å®‰è£…ä¾èµ–ï¼Œå®‰è£…åçš„ä¾èµ–ä¹Ÿä¼šæ‰“åŒ…åˆ° image ç›®å½•ä¸­</li><li>EXPOSE æš´éœ² 3000 ç«¯å£ï¼Œå…è®¸å¤–éƒ¨è¿æ¥è¿™ä¸ªç«¯å£</li></ul><h3 id="4-åˆ›å»º-image"><a href="#4-åˆ›å»º-image" class="headerlink" title="4 åˆ›å»º image"></a>4 åˆ›å»º image</h3><ul><li>-t â€“tag list é•œåƒåç§°</li><li>-f â€“file string æŒ‡å®š Dockerfile æ–‡ä»¶çš„ä½ç½®</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> express-demo <span class="token builtin class-name">.</span><span class="token function">docker</span> build <span class="token parameter variable">-t</span> express-demo:1.0.0 <span class="token builtin class-name">.</span><span class="token function">docker</span> build <span class="token parameter variable">-t</span> express-demo:1.0.0 <span class="token parameter variable">-f</span> ./Dockerfile <span class="token builtin class-name">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>-t ç”¨æ¥æŒ‡å®š image é•œåƒçš„åç§°ï¼Œåé¢è¿˜å¯ä»¥åŠ å†’å·æŒ‡å®šæ ‡ç­¾ï¼Œå¦‚æœä¸æŒ‡å®šé»˜è®¤å°±æ˜¯ latest</li><li><code>.</code>å°±è¡¨ç¤ºå½“å‰è·¯å¾„</li></ul><h3 id="5-ä½¿ç”¨æ–°çš„é•œåƒè¿è¡Œå®¹å™¨"><a href="#5-ä½¿ç”¨æ–°çš„é•œåƒè¿è¡Œå®¹å™¨" class="headerlink" title="5 ä½¿ç”¨æ–°çš„é•œåƒè¿è¡Œå®¹å™¨"></a>5 ä½¿ç”¨æ–°çš„é•œåƒè¿è¡Œå®¹å™¨</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> container run <span class="token parameter variable">-p</span> <span class="token number">3333</span>:3000 <span class="token parameter variable">-it</span> express-demo /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> start<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><code>-p</code> å‚æ•°æ˜¯å°†å®¹å™¨çš„3000ç«¯å£æ˜ å°„ä¸ºæœ¬æœºçš„3333ç«¯å£</li><li><code>-it</code> å‚æ•°æ˜¯å°†å®¹å™¨çš„shellå®¹å™¨æ˜ å°„ä¸ºå½“å‰çš„shell,åœ¨æœ¬æœºå®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤éƒ½ä¼šå‘é€åˆ°å®¹å™¨å½“ä¸­æ‰§è¡Œ</li><li><code>express-demo</code> imageçš„åç§°</li><li>/bin/bash å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‘½ä»¤,è¿™é‡Œæ˜¯å¯åŠ¨äº†bashå®¹å™¨ä»¥ä¾¿æ‰§è¡Œè„šæœ¬</li><li><code>--rm</code> åœ¨å®¹å™¨ç»ˆæ­¢è¿è¡Œåè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶</li></ul><h3 id="6-CMD"><a href="#6-CMD" class="headerlink" title="6 CMD"></a>6 CMD</h3><p>Dockerfile</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> CMD npm start</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é‡æ–°åˆ¶ä½œé•œåƒ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">docker build <span class="token operator">-</span>t express<span class="token operator">-</span>demo <span class="token punctuation">.</span>docker container run <span class="token operator">-</span>p <span class="token number">3333</span><span class="token operator">:</span><span class="token number">3000</span> express<span class="token operator">-</span>demo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>RUNå‘½ä»¤åœ¨ image æ–‡ä»¶çš„æ„å»ºé˜¶æ®µæ‰§è¡Œï¼Œæ‰§è¡Œç»“æœéƒ½ä¼šæ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ï¼›CMDå‘½ä»¤åˆ™æ˜¯åœ¨å®¹å™¨å¯åŠ¨åæ‰§è¡Œ</li><li>ä¸€ä¸ª Dockerfile å¯ä»¥åŒ…å«å¤šä¸ªRUNå‘½ä»¤ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ªCMDå‘½ä»¤</li><li>æŒ‡å®šäº†CMDå‘½ä»¤ä»¥åï¼Œdocker container runå‘½ä»¤å°±ä¸èƒ½é™„åŠ å‘½ä»¤äº†ï¼ˆæ¯”å¦‚å‰é¢çš„/bin/bashï¼‰ï¼Œå¦åˆ™å®ƒä¼šè¦†ç›–CMDå‘½ä»¤</li></ul><h3 id="7-å‘å¸ƒimage"><a href="#7-å‘å¸ƒimage" class="headerlink" title="7 å‘å¸ƒimage"></a>7 å‘å¸ƒimage</h3><ul><li><a href="https://hub.docker.com/">æ³¨å†Œè´¦æˆ·</a></li><li>docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># ç™»é™†</span><span class="token function">docker</span> login<span class="token comment"># ç”Ÿæˆé•œåƒ</span><span class="token function">docker</span> image tag <span class="token punctuation">[</span>imageName<span class="token punctuation">]</span> <span class="token punctuation">[</span>username<span class="token punctuation">]</span>/<span class="token punctuation">[</span>repository<span class="token punctuation">]</span>:<span class="token punctuation">[</span>tag<span class="token punctuation">]</span><span class="token function">docker</span> image build <span class="token parameter variable">-t</span> <span class="token punctuation">[</span>username<span class="token punctuation">]</span>/<span class="token punctuation">[</span>repository<span class="token punctuation">]</span>:<span class="token punctuation">[</span>tag<span class="token punctuation">]</span> <span class="token builtin class-name">.</span><span class="token function">docker</span> image tag  hello-world:latest gaohongxiangi/hello-world:1.0.1<span class="token comment"># æ¨é€</span><span class="token function">docker</span> push gaohongxiangi/hello-world:1.0.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxé…ç½®æ¡ˆä¾‹</title>
      <link href="/2023/04/25/nginx-pei-zhi-an-li/"/>
      <url>/2023/04/25/nginx-pei-zhi-an-li/</url>
      
        <content type="html"><![CDATA[<h1 id="nginx-é…ç½®æ¡ˆä¾‹"><a href="#nginx-é…ç½®æ¡ˆä¾‹" class="headerlink" title="nginx é…ç½®æ¡ˆä¾‹"></a>nginx é…ç½®æ¡ˆä¾‹</h1><p><strong>æ¡ˆä¾‹ 1</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#user  nobody; # è¿è¡Œç”¨æˆ·ï¼ˆå¯åŠ¨è€…ç”¨æˆ·åï¼‰ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®</span>worker_processes  <span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">#å·¥ä½œè¿›ç¨‹æ•°,ä¸€èˆ¬å’ŒCPUæ•°é‡ç›¸åŒ</span>worker_rlimit_nofile <span class="token number">10240</span><span class="token punctuation">;</span> <span class="token comment">#é…ç½®Nginx workerè¿›ç¨‹æœ€å¤§æ‰“å¼€æ–‡ä»¶æ•°</span>error_log  /home/work/nginx/logs/error_log  notice<span class="token punctuation">;</span> <span class="token comment"># Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•</span>pid        /home/work/nginx/var/nginx.pid<span class="token punctuation">;</span> <span class="token comment"># Nginx æœåŠ¡å¯åŠ¨æ—¶çš„ pid å­˜æ”¾ä½ç½®</span>events <span class="token punctuation">&#123;</span>    use epoll<span class="token punctuation">;</span><span class="token comment"># å·¥ä½œæ¨¡å‹ï¼šä½¿ç”¨epollçš„I/Oæ¨¡å‹(å¦‚æœä½ ä¸è®¾ç½®ã€ä¸çŸ¥é“Nginxè¯¥ä½¿ç”¨å“ªç§è½®è¯¢æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„)</span>    worker_connections  <span class="token number">10240</span><span class="token punctuation">;</span>  <span class="token comment">#å•ä¸ªè¿›ç¨‹å…è®¸çš„å®¢æˆ·ç«¯æœ€å¤§è¿æ¥æ•° | å¹¶å‘æ•°ï¼ˆæ‰“å¼€çš„æ–‡ä»¶æ•°é™åˆ¶ï¼‰</span><span class="token punctuation">&#125;</span><span class="token comment"># é…ç½®ä½¿ç”¨æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œè®¾ç½®</span>http <span class="token punctuation">&#123;</span>    include       mime.types<span class="token punctuation">;</span> <span class="token comment"># æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span>    default_type  application/octet-stream<span class="token punctuation">;</span>  <span class="token comment"># é»˜è®¤æ–‡ä»¶ç±»å‹  äºŒè¿›åˆ¶æµ</span>    ignore_invalid_headers  off<span class="token punctuation">;</span><span class="token comment"># å¿½ç•¥ä¸åˆæ³•çš„httpå¤´éƒ¨</span>    <span class="token comment"># è®¾ç½®æ—¥å¿—æ¨¡å¼</span>    log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>            <span class="token string">'$status $body_bytes_sent "$http_referer" "$http_user_agent" '</span>            <span class="token string">'$request_time $http_x_bd_logid $http_x_bd_routerip $server_addr $upstream_addr $host '</span>            <span class="token string">'"$http_x_forwarded_for" $msec'</span><span class="token punctuation">;</span>    access_log  <span class="token string">"/home/work/nginx/logs/access_log"</span>  main<span class="token punctuation">;</span> <span class="token comment"># æŒ‡å®šå†™å…¥çš„æ–‡ä»¶åå’Œæ—¥å¿—æ ¼å¼</span>    client_body_temp_path /home/work/nginx/cache/client_body<span class="token punctuation">;</span><span class="token comment"># è®¾ç½®ç”¨äºå­˜å‚¨åŒ…å«å®¢æˆ·ç«¯è¯·æ±‚æ­£æ–‡çš„ä¸´æ—¶æ–‡ä»¶çš„ç›®å½•</span>    proxy_temp_path /home/work/nginx/cache/proxy<span class="token punctuation">;</span> <span class="token comment"># å®šä¹‰proxyçš„ä¸´æ—¶æ–‡ä»¶å­˜åœ¨ç›®å½•ä»¥åŠç›®å½•çš„å±‚çº§ã€‚</span>    uwsgi_temp_path /home/work/nginx/cache/uwsgi<span class="token punctuation">;</span><span class="token comment"># ç”¨äºå­˜å‚¨å¸¦æœ‰ä» uwsgi æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®çš„ä¸´æ—¶æ–‡ä»¶</span>    scgi_temp_path /home/work/nginx/cache/scgi<span class="token punctuation">;</span><span class="token comment">#å­˜å‚¨åŒ…å«ä» SCGI æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ•°æ®çš„ä¸´æ—¶æ–‡ä»¶</span>    fastcgi_temp_path /home/work/nginx/cache/fastcgi<span class="token punctuation">;</span> <span class="token comment">#fastcgiä¸´æ—¶æ–‡ä»¶å­˜æ”¾è·¯å¾„</span><span class="token comment">#ç”¨äºè®¾ç½®æœåŠ¡å™¨åçš„å“ˆå¸Œæ¡¶å¤§å°ï¼Œç”¨äºæé«˜æœåŠ¡å™¨åçš„æŸ¥æ‰¾é€Ÿåº¦ã€‚è¯¥å‚æ•°çš„å€¼è¶Šå¤§ï¼Œå“ˆå¸Œæ¡¶çš„æ•°é‡è¶Šå¤šï¼ŒæŸ¥æ‰¾é€Ÿåº¦ä¹Ÿè¶Šå¿«ï¼Œä½†æ˜¯éœ€è¦æ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚é»˜è®¤å€¼ä¸º 32ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‚å½“è°ƒæ•´ã€‚</span>    server_names_hash_bucket_size <span class="token number">128</span><span class="token punctuation">;</span>    client_header_buffer_size 4k<span class="token punctuation">;</span><span class="token comment">#å®¢æˆ·ç«¯è¯·æ±‚å¤´ç¼“å†²åŒºçš„å¤§å°</span>    large_client_header_buffers <span class="token number">4</span> 32k<span class="token punctuation">;</span>    client_max_body_size 4m<span class="token punctuation">;</span> <span class="token comment">#é™åˆ¶è¯·æ±‚ä½“çš„å¤§å°ï¼Œè‹¥è¶…è¿‡æ‰€è®¾å®šçš„å¤§å°ï¼Œè¿”å›413é”™è¯¯ã€‚</span>    client_body_buffer_size 513k<span class="token punctuation">;</span> <span class="token comment">#è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“ç¼“å†²åŒºçš„å¤§å°</span>    client_body_timeout <span class="token number">15</span><span class="token punctuation">;</span><span class="token comment">#ç”¨äºè®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“ï¼ˆå³è¯·æ±‚çš„æ•°æ®ï¼‰è¶…æ—¶æ—¶é—´</span>    client_header_timeout <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment"># ç”¨äºç­‰å¾…å®¢æˆ·ç«¯å‘é€HTTPè¯·æ±‚å¤´çš„æ—¶é—´</span>    send_timeout <span class="token number">240</span><span class="token punctuation">;</span> <span class="token comment">#å®¢æˆ·ç«¯çš„å“åº”è¶…æ—¶æ—¶é—´</span>    resolver xx.xxx.xxx.xxx<span class="token punctuation">;</span> <span class="token comment">#è®¾ç½®å…¬å…±çš„DNSæˆ–è€…å…¬å¸å†…éƒ¨çš„DNSéƒ½å¯ä»¥</span>    sendfile        on<span class="token punctuation">;</span><span class="token comment"># å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span>    <span class="token comment"># å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡</span>    tcp_nopush      on<span class="token punctuation">;</span>    tcp_nodelay     on<span class="token punctuation">;</span>    fastcgi_connect_timeout <span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">#è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤60ç§’</span>    fastcgi_send_timeout <span class="token number">10</span><span class="token punctuation">;</span> <span class="token comment">#nginx è¿›ç¨‹å‘ fastcgi è¿›ç¨‹å‘é€è¯·æ±‚è¿‡ç¨‹çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼60ç§’</span>    fastcgi_read_timeout <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">#  nginx è¿›ç¨‹å‘ fastcgi è¿›ç¨‹è¯»å–è¾“å‡ºè¿‡ç¨‹çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼60ç§’</span>    <span class="token comment">#è¯»å–fastcgiåº”ç­”ç¬¬ä¸€éƒ¨åˆ†éœ€è¦å¤šå¤§ç¼“å†²åŒºï¼Œè¯¥å€¼è¡¨ç¤ºä½¿ç”¨1ä¸ª64kbçš„ç¼“å†²åŒºè¯»å–åº”ç­”ç¬¬ä¸€éƒ¨åˆ†(åº”ç­”å¤´),å¯ä»¥è®¾ç½®ä¸ºfastcgi_buffersé€‰é¡¹ç¼“å†²åŒºå¤§å°</span>    fastcgi_buffer_size 64k<span class="token punctuation">;</span>    <span class="token comment">#æŒ‡å®šæœ¬åœ°éœ€è¦å¤šå°‘å’Œå¤šå¤§çš„ç¼“å†²åŒºæ¥ç¼“å†²fastcgiåº”ç­”è¯·æ±‚ï¼Œå‡è®¾ä¸€ä¸ªphpæˆ–javaè„šæœ¬æ‰€äº§ç”Ÿé¡µé¢å¤§å°ä¸º256kb,é‚£ä¹ˆä¼šä¸ºå…¶åˆ†é…4ä¸ª64kbçš„ç¼“å†²æ¥ç¼“å­˜ï¼›è‹¥é¡µé¢å¤§äº256kb,é‚£ä¹ˆå¤§äºçš„256kbçš„éƒ¨åˆ†ä¼šç¼“å­˜åˆ°fastcgi_tempæŒ‡å®šè·¯å¾„ä¸­ï¼Œè¿™å¹¶éæ˜¯ä¸ªå¥½åŠæ³•ï¼Œå†…å­˜æ•°æ®å¤„ç†å¿«äºç¡¬ç›˜ï¼Œä¸€èˆ¬è¯¥å€¼åº”è¯¥ä¸ºç«™ç‚¹ä¸­php/javaè„šæœ¬æ‰€äº§ç”Ÿé¡µé¢å¤§å°ä¸­é—´å€¼ï¼Œå¦‚æœç«™ç‚¹å¤§éƒ¨åˆ†è„šæœ¬æ‰€äº§ç”Ÿçš„é¡µé¢å¤§å°ä¸º256kbï¼Œé‚£ä¹ˆå¯æŠŠå€¼è®¾ç½®ä¸º16 16k,4 64kç­‰</span>    fastcgi_buffers <span class="token number">4</span> 64k<span class="token punctuation">;</span>    <span class="token comment"># æŒ‡å®šæœ¬åœ°éœ€è¦ç”¨å¤šå°‘å’Œå¤šå¤§çš„ç¼“å†²åŒºæ¥ç¼“å†²FastCGIçš„åº”ç­”ã€‚é»˜è®¤å€¼æ˜¯fastcgi_bufferçš„2å€</span>    fastcgi_busy_buffers_size 128k<span class="token punctuation">;</span>    <span class="token comment">#å†™å…¥ç¼“å­˜æ–‡ä»¶ä½¿ç”¨å¤šå¤§çš„æ•°æ®å—ï¼Œé»˜è®¤å€¼æ˜¯fastcgi_bufferçš„2å€</span>    fastcgi_temp_file_write_size 128k<span class="token punctuation">;</span>    <span class="token comment">#æ˜¯å¦ä¼ é€’4xxå’Œ5xxé”™è¯¯ä¿¡æ¯åˆ°å®¢æˆ·ç«¯</span>    fastcgi_intercept_errors on<span class="token punctuation">;</span>    keepalive_timeout  <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment"># ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span>    <span class="token comment">#keepalive_timeout  65;</span><span class="token comment">#å‹ç¼©æ–‡ä»¶å¯ä»¥èŠ‚çº¦å¸¦å®½å’Œæé«˜ç½‘ç»œä¼ è¾“æ•ˆç‡</span>    <span class="token function">gzip</span> on<span class="token punctuation">;</span> <span class="token comment">#å¼€å¯gzipå‹ç¼©</span>    gzip_min_length 10k<span class="token punctuation">;</span>  <span class="token comment">#åªå‹ç¼©è¶…è¿‡10Kçš„æ–‡ä»¶</span>    gzip_buffers <span class="token number">4</span> 16k<span class="token punctuation">;</span> <span class="token comment">#è®¾ç½®Gzipå‹ç¼©æ–‡ä»¶ä½¿ç”¨ç¼“å­˜ç©ºé—´çš„å¤§å°</span>    gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span><span class="token comment">#å¯ç”¨gzipå‹ç¼©æ‰€éœ€çš„HTTPæœ€ä½ç‰ˆæœ¬</span>    gzip_comp_level <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">#å‹ç¼©çº§åˆ«ï¼Œå‹ç¼©æ¯”ç‡è¶Šé«˜æ–‡ä»¶è¢«å‹ç¼©çš„ä½“ç§¯è¶Šå° åŒ…æ‹¬çº§åˆ«1åˆ°çº§åˆ«9</span>    gzip_types text/plain application/x-javascript text/css application/xml<span class="token punctuation">;</span><span class="token comment">#è¿›è¡Œå‹ç¼©çš„æ–‡ä»¶ç±»å‹</span>    gzip_vary on<span class="token punctuation">;</span><span class="token comment"># å¼€å¯åçš„æ•ˆæœæ˜¯åœ¨å“åº”å¤´éƒ¨æ·»åŠ äº†Accept-Encoding: gzip</span>    proxy_connect_timeout 15s<span class="token punctuation">;</span><span class="token comment">#é»˜è®¤è¶…æ—¶æ—¶é—´</span>    proxy_read_timeout 24s<span class="token punctuation">;</span> <span class="token comment"># è¯»å–è¶…æ—¶</span>    proxy_send_timeout 10s<span class="token punctuation">;</span><span class="token comment"># å‘é€è¶…æ—¶</span>    <span class="token comment">#Nginxä½¿ç”¨è¯¥å¤§å°ç”³è¯·read_bufï¼Œç”¨æ¥å­˜å‚¨upstreamç«¯responseçš„headerã€‚ å³å¤§å°æŒ‡å®šäº† upstream header æœ€å¤§é•¿åº¦ï¼Œå¦‚æœå“åº”å¤´è¶…è¿‡äº†è¿™ä¸ªé•¿åº¦ï¼ŒNginxä¼šæŠ¥upstream sent too big headeré”™è¯¯ï¼Œç„¶åclientæ”¶åˆ°çš„æ˜¯502ã€‚</span>    proxy_buffer_size 64k<span class="token punctuation">;</span>    <span class="token comment">#è®¾ç½®å­˜å‚¨è¢«ä»£ç†æœåŠ¡å™¨å“åº”çš„bodyæ‰€å ç”¨çš„bufferä¸ªæ•°å’Œæ¯ä¸ªbufferå¤§å°ã€‚ã€‚æ€»çš„å¤§å°ä¸ºnumber*size</span>    proxy_buffers <span class="token number">4</span> 64k<span class="token punctuation">;</span>    <span class="token comment"># proxy_busy_buffers_sizeä¸æ˜¯ç‹¬ç«‹çš„ç©ºé—´ï¼Œä»–æ˜¯proxy_bufferså’Œproxy_buffer_sizeçš„ä¸€éƒ¨åˆ†ã€‚</span>    <span class="token comment"># å¦‚æœå®Œæ•´æ•°æ®å¤§å°ä¸å°äºbusy_bufferå¤§å°ï¼Œåˆ™è£…æ»¡busy_bufferåï¼Œé©¬ä¸Šä¼ ç»™å®¢æˆ·ç«¯ï¼›</span>    proxy_busy_buffers_size 128k<span class="token punctuation">;</span>    <span class="token comment">#è®¾ç½®åŒæ—¶å†™å…¥ä¸´æ—¶æ–‡ä»¶çš„æ•°æ®é‡çš„æ€»å¤§å°ã€‚é€šå¸¸è®¾ç½®ä¸º8kæˆ–è€…16kã€‚</span>    proxy_temp_file_write_size 128k<span class="token punctuation">;</span>    proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span><span class="token comment">#charset GBK;</span>    uninitialized_variable_warn off<span class="token punctuation">;</span> <span class="token comment">#æ§åˆ¶æ˜¯å¦è®°å½• æœ‰å…³æœªåˆå§‹åŒ–å˜é‡çš„è­¦å‘Šã€‚</span>    server <span class="token punctuation">&#123;</span>        <span class="token comment"># List port</span>        listen <span class="token number">8080</span><span class="token punctuation">;</span>        server_name baidu.com<span class="token punctuation">;</span>        proxy_next_upstream_tries <span class="token number">2</span><span class="token punctuation">;</span><span class="token comment">#é‡è¯•æ¬¡æ•°</span>        proxy_redirect off<span class="token punctuation">;</span> <span class="token comment">#é‡å®šå‘</span>        location /service/    <span class="token punctuation">&#123;</span>            <span class="token builtin class-name">set</span> <span class="token variable">$upstream</span> <span class="token string">'baidu.com:8080'</span><span class="token punctuation">;</span>            proxy_pass http://<span class="token variable">$upstream</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        location /sTokenBackendValidate    <span class="token punctuation">&#123;</span>            <span class="token builtin class-name">set</span> <span class="token variable">$upstream</span> <span class="token string">'baidu.com:8080'</span><span class="token punctuation">;</span>            proxy_pass http://<span class="token variable">$upstream</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        location / <span class="token punctuation">&#123;</span>            root /home/work/webroot/<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ¡ˆä¾‹äºŒ</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#COPY ./nginx.conf /etc/nginx/conf.d/</span><span class="token function">gzip</span> on<span class="token punctuation">;</span>gzip_min_length  1k<span class="token punctuation">;</span>gzip_buffers     <span class="token number">4</span> 16k<span class="token punctuation">;</span>gzip_http_version <span class="token number">1.1</span><span class="token punctuation">;</span>gzip_comp_level <span class="token number">2</span><span class="token punctuation">;</span>gzip_types     text/plain application/javascript application/x-javascript text/javascript text/css application/xml application/xml+rss<span class="token punctuation">;</span>gzip_vary on<span class="token punctuation">;</span>gzip_proxied   expired no-cache no-store private auth<span class="token punctuation">;</span><span class="token comment">#Nginxåšä¸ºåå‘ä»£ç†çš„æ—¶å€™å¯ç”¨ï¼š</span>gzip_disable   <span class="token string">"MSIE [1-6]\."</span><span class="token punctuation">;</span> <span class="token comment">#é€šè¿‡è¡¨è¾¾å¼ï¼Œè¡¨æ˜å“ªäº›UAå¤´ä¸ä½¿ç”¨gzipå‹ç¼©</span>server    <span class="token punctuation">&#123;</span>        listen <span class="token number">8080</span><span class="token punctuation">;</span>        <span class="token comment">#listen [::]:8080;</span>        index index.html<span class="token punctuation">;</span>        root  /opt/run/dist<span class="token punctuation">;</span>        location / <span class="token punctuation">&#123;</span>            try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token comment"># é™æ€èµ„æºå¼ºç¼“å­˜</span>        location ~.*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>css<span class="token operator">|</span>js<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>gif<span class="token operator">|</span>woff<span class="token operator">|</span>woff2<span class="token operator">|</span>eot<span class="token operator">|</span>svg<span class="token operator">|</span>ttf<span class="token operator">|</span>otf<span class="token operator">|</span>mp3<span class="token operator">|</span>m4a<span class="token operator">|</span>aac<span class="token punctuation">)</span>$ <span class="token punctuation">&#123;</span>        expires 15d<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>client_body_buffer_size</strong></li></ul><p>client_body_buffer_size æ˜¯ Nginx é…ç½®æŒ‡ä»¤ä¹‹ä¸€ï¼Œç”¨äºè®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“ç¼“å†²åŒºçš„å¤§å°ã€‚å½“å®¢æˆ·ç«¯å‘ Nginx å‘é€è¯·æ±‚æ—¶ï¼Œè¯·æ±‚ä½“ï¼ˆä¾‹å¦‚ POST è¯·æ±‚ä¸­çš„è¡¨å•æ•°æ®ï¼‰ä¼šè¢«å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œç„¶åå†ä¼ é€’ç»™åç«¯æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚é€šè¿‡è®¾ç½® client_body_buffer_sizeï¼Œå¯ä»¥æ§åˆ¶ç¼“å†²åŒºçš„å¤§å°ï¼Œä»è€Œå½±å“ Nginx çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œclient_body_buffer_size çš„å€¼ä¸º 8kã€‚</p><ul><li><strong>client_body_timeout</strong></li></ul><p>è¿™æ˜¯ä¸€ä¸ªé…ç½® nginx çš„æŒ‡ä»¤ï¼Œç”¨äºè®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“ï¼ˆå³è¯·æ±‚çš„æ•°æ®ï¼‰è¶…æ—¶æ—¶é—´ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„ä¼ è¾“æ—¶é—´è¶…è¿‡è®¾å®šçš„è¶…æ—¶æ—¶é—´æ—¶ï¼Œnginx ä¼šè‡ªåŠ¨å…³é—­è¿æ¥ã€‚</p><ul><li><strong>client_header_timeout</strong></li></ul><p>Client_header_timeout é€šå¸¸æ˜¯ä¸€ä¸ª HTTP æœåŠ¡å™¨è®¾ç½®çš„è¶…æ—¶æ—¶é—´ï¼Œç”¨äºç­‰å¾…å®¢æˆ·ç«¯å‘é€ HTTP è¯·æ±‚å¤´çš„æ—¶é—´ã€‚å¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°è¯·æ±‚å¤´ï¼ŒHTTP æœåŠ¡å™¨å°†ä¼šå…³é—­ä¸å®¢æˆ·ç«¯çš„è¿æ¥ã€‚è¿™ä¸ªè¶…æ—¶æ—¶é—´å¯ä»¥è®¾ç½®ä¸ºä¸åŒçš„å€¼æ¥é€‚åº”ä¸åŒçš„æƒ…å†µã€‚</p><ul><li><strong>gzip_proxied</strong></li></ul><p>Nginx åšä¸ºåå‘ä»£ç†çš„æ—¶å€™å¯ç”¨ï¼š</p><ul><li><p>off â€“ å…³é—­æ‰€æœ‰çš„ä»£ç†ç»“æœæ•°æ®å‹ç¼©</p></li><li><p>expired â€“ å¦‚æœ header ä¸­åŒ…å«â€Expiresâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>no-cache â€“ å¦‚æœ header ä¸­åŒ…å«â€Cache-Control:no-cacheâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>no-store â€“ å¦‚æœ header ä¸­åŒ…å«â€Cache-Control:no-storeâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>private â€“ å¦‚æœ header ä¸­åŒ…å«â€Cache-Control:privateâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>no_last_modified â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœ header ä¸­åŒ…å«â€Last_Modifiedâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>no_etag â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœ header ä¸­åŒ…å«â€œETagâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>auth â€“ å¯ç”¨å‹ç¼©ï¼Œå¦‚æœ header ä¸­åŒ…å«â€œAuthorizationâ€å¤´ä¿¡æ¯ï¼Œå¯ç”¨å‹ç¼©</p></li><li><p>any â€“ æ— æ¡ä»¶å‹ç¼©æ‰€æœ‰ç»“æœæ•°æ®</p></li><li><p><a href="https://www.cnblogs.com/Renyi-Fan/p/11047490.html#_label4_3">nginx ä¸­å¦‚ä½•è®¾ç½® gzip æ€»ç»“</a></p></li><li><p><a href="https://www.cnblogs.com/wshenjin/p/11608744.html">Nginx çš„ proxy buffer å‚æ•°æ€»ç»“</a></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxæ•´ä½“å…¥é—¨</title>
      <link href="/2023/04/25/nginx-zheng-ti-ru-men/"/>
      <url>/2023/04/25/nginx-zheng-ti-ru-men/</url>
      
        <content type="html"><![CDATA[<h1 id="nginx-å¸¸ç”¨å‘½ä»¤"><a href="#nginx-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="nginx å¸¸ç”¨å‘½ä»¤"></a>nginx å¸¸ç”¨å‘½ä»¤</h1><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nginx <span class="token parameter variable">-s</span> reload  <span class="token comment"># å‘ä¸»è¿›ç¨‹å‘é€ä¿¡å·ï¼Œé‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼Œçƒ­é‡å¯</span>nginx <span class="token parameter variable">-s</span> reopen <span class="token comment"># é‡å¯ Nginx</span>nginx <span class="token parameter variable">-s</span> stop    <span class="token comment"># å¿«é€Ÿå…³é—­</span>nginx <span class="token parameter variable">-s</span> quit    <span class="token comment"># ç­‰å¾…å·¥ä½œè¿›ç¨‹å¤„ç†å®Œæˆåå…³é—­</span>nginx <span class="token parameter variable">-T</span>         <span class="token comment"># æŸ¥çœ‹å½“å‰ Nginx æœ€ç»ˆçš„é…ç½®</span>nginx <span class="token parameter variable">-t</span> <span class="token parameter variable">-c</span> <span class="token operator">&lt;</span>é…ç½®è·¯å¾„<span class="token operator">></span>    <span class="token comment"># æ£€æŸ¥é…ç½®æ˜¯å¦æœ‰é—®é¢˜ï¼Œå¦‚æœå·²ç»åœ¨é…ç½®ç›®å½•ï¼Œåˆ™ä¸éœ€è¦-c</span><span class="token comment">####################################################################</span>systemctl start nginx    <span class="token comment"># å¯åŠ¨ Nginx</span>systemctl stop nginx     <span class="token comment"># åœæ­¢ Nginx</span>systemctl restart nginx  <span class="token comment"># é‡å¯ Nginx</span>systemctl reload nginx   <span class="token comment"># é‡æ–°åŠ è½½ Nginxï¼Œç”¨äºä¿®æ”¹é…ç½®å</span>systemctl <span class="token builtin class-name">enable</span> nginx   <span class="token comment"># è®¾ç½®å¼€æœºå¯åŠ¨ Nginx</span>systemctl disable nginx  <span class="token comment"># å…³é—­å¼€æœºå¯åŠ¨ Nginx</span>systemctl status nginx   <span class="token comment"># æŸ¥çœ‹ Nginx è¿è¡ŒçŠ¶æ€</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="nginx-é…ç½®æ–‡ä»¶"><a href="#nginx-é…ç½®æ–‡ä»¶" class="headerlink" title="nginx é…ç½®æ–‡ä»¶"></a>nginx é…ç½®æ–‡ä»¶</h1><ul><li>ç›®å½•ç»“æ„</li></ul><pre class="line-numbers language-ABAP" data-language="ABAP"><code class="language-ABAP">main        # å…¨å±€é…ç½®ï¼Œå¯¹å…¨å±€ç”Ÿæ•ˆâ”œâ”€â”€ events  # å·¥ä½œæ¨¡å¼ï¼Œé…ç½®å½±å“ Nginx æœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥â”œâ”€â”€ http    # é…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®â”‚   â”œâ”€â”€ upstream # è´Ÿè½½å‡è¡¡æœåŠ¡å™¨è®¾ç½®ï¼Œé…ç½®åç«¯æœåŠ¡å™¨å…·ä½“åœ°å€ï¼Œè´Ÿè½½å‡è¡¡é…ç½®ä¸å¯æˆ–ç¼ºçš„éƒ¨åˆ†â”‚   â”œâ”€â”€ server   # é…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ª http å—ä¸­å¯ä»¥æœ‰å¤šä¸ª server å—â”‚   â”œâ”€â”€ serverâ”‚   â”‚   â”œâ”€â”€ location  # server å—å¯ä»¥åŒ…å«å¤šä¸ª location å—ï¼Œlocation æŒ‡ä»¤ç”¨äºåŒ¹é… uriâ”‚   â”‚   â”œâ”€â”€ locationâ”‚   â”‚   â””â”€â”€ ...â”‚   â””â”€â”€ ...â””â”€â”€ ...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å…¸å‹é…ç½®</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿è¡Œç”¨æˆ·ï¼ˆå¯åŠ¨è€…ç”¨æˆ·åï¼‰ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®</span>user  nginx<span class="token punctuation">;</span><span class="token comment"># Nginx è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’Œ CPU æ ¸å¿ƒæ•°äºŒå€</span>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment"># Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•</span>error_log  logs/error.log warn<span class="token punctuation">;</span><span class="token comment"># Nginx æœåŠ¡å¯åŠ¨æ—¶çš„ pid å­˜æ”¾ä½ç½®</span>pid        logs/nginx.pid<span class="token punctuation">;</span>events <span class="token punctuation">&#123;</span><span class="token comment"># å·¥ä½œæ¨¡å‹ï¼šä½¿ç”¨epollçš„I/Oæ¨¡å‹(å¦‚æœä½ ä¸è®¾ç½®ã€ä¸çŸ¥é“Nginxè¯¥ä½¿ç”¨å“ªç§è½®è¯¢æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„)</span>    use epoll<span class="token punctuation">;</span>    <span class="token comment"># æ¯ä¸ªè¿›ç¨‹å…è®¸æœ€å¤§å¹¶å‘æ•°ï¼ˆæ‰“å¼€çš„æ–‡ä»¶æ•°é™åˆ¶ï¼‰</span>    worker_connections <span class="token number">1024</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># é…ç½®ä½¿ç”¨æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œè®¾ç½®</span>http <span class="token punctuation">&#123;</span>    <span class="token comment"># è®¾ç½®æ—¥å¿—æ¨¡å¼</span>    log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>                      <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>                      <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span><span class="token comment"># Nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®</span>    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span><span class="token comment"># å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span>    sendfile            on<span class="token punctuation">;</span>    <span class="token comment"># å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡</span>    tcp_nopush          on<span class="token punctuation">;</span>    tcp_nodelay         on<span class="token punctuation">;</span>    <span class="token comment"># ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span>    keepalive_timeout   <span class="token number">65</span><span class="token punctuation">;</span>    types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment"># æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span>    include             /etc/nginx/mime.types<span class="token punctuation">;</span>    <span class="token comment"># é»˜è®¤æ–‡ä»¶ç±»å‹</span>    default_type        application/octet-stream<span class="token punctuation">;</span><span class="token comment"># åŠ è½½å­é…ç½®é¡¹</span>    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>    <span class="token comment"># é…ç½®åç«¯æœåŠ¡å™¨ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡é…ç½®ï¼Œå¯ä»¥å¤šä¸ªupstream</span>    upstrean houduan <span class="token punctuation">&#123;</span>    server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    server <span class="token punctuation">&#123;</span>    <span class="token comment"># é…ç½®ç›‘å¬çš„ç«¯å£</span>        listen       <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token comment"># é…ç½®çš„åŸŸå</span>        server_name  localhost<span class="token punctuation">;</span>        location / <span class="token punctuation">&#123;</span>       <span class="token comment"># ç½‘ç«™æ ¹ç›®å½•</span>            root   /usr/share/nginx/html<span class="token punctuation">;</span>            <span class="token comment"># é»˜è®¤é¦–é¡µæ–‡ä»¶</span>            index  index.html index.htm<span class="token punctuation">;</span>            <span class="token comment"># ç¦æ­¢è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>            deny <span class="token number">172.168</span>.22.11<span class="token punctuation">;</span>            <span class="token comment"># å…è®¸è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>            allow <span class="token number">172.168</span>.33.44<span class="token punctuation">;</span>            <span class="token comment"># è¯·æ±‚çš„åç«¯ä»£ç†ï¼Œå®é™…åœ°å€ä½äºupstream</span>            proxy_pass http:houduan<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢</span>    error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>    <span class="token comment"># åŒä¸Š</span>    error_page <span class="token number">400</span> <span class="token number">404</span> error.html<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="nginx-ä»£ç†å’Œä¸‹Â·è´Ÿè½½å‡è¡¡"><a href="#nginx-ä»£ç†å’Œä¸‹Â·è´Ÿè½½å‡è¡¡" class="headerlink" title="nginx ä»£ç†å’Œä¸‹Â·è´Ÿè½½å‡è¡¡"></a>nginx ä»£ç†å’Œä¸‹Â·è´Ÿè½½å‡è¡¡</h1><p>upstream è¿›è¡Œè®¾ç½®ä»£ç†</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">upstrean houduan <span class="token punctuation">&#123;</span>      <span class="token comment"># é…ç½®åç«¯æœåŠ¡å™¨ï¼Œè¿›è¡Œæ­£åå‘ä»£ç†ï¼Œå¯ä»¥å¤šä¸ªupstream</span>    server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>    server <span class="token number">127.0</span>.0.1:8081<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>è´Ÿè½½å‡è¡¡æ–¹å¼</p><pre class="line-numbers language-apl" data-language="apl"><code class="language-apl"><span class="token number">1</span><span class="token dyadic-operator operator">.</span>é»˜è®¤ï¼šè½®è¯¢upstrean houduan <span class="token dfn builtin">&#123;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8080</span><span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8081</span><span class="token punctuation">;</span><span class="token dfn builtin">&#125;</span><span class="token number">2</span><span class="token dyadic-operator operator">.</span>æƒé‡upstrean houduan <span class="token dfn builtin">&#123;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8080</span> wight<span class="token function">=</span><span class="token number">3</span><span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8081</span> wight<span class="token function">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token dfn builtin">&#125;</span><span class="token number">3</span><span class="token dyadic-operator operator">.</span>iphashupstrean houduan <span class="token dfn builtin">&#123;</span>ip_hash<span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8080</span><span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8081</span><span class="token punctuation">;</span><span class="token dfn builtin">&#125;</span><span class="token number">4</span><span class="token dyadic-operator operator">.</span>æœ€å°è¿æ¥æ•°upstrean houduan <span class="token dfn builtin">&#123;</span>least_conn<span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8080</span><span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8081</span><span class="token punctuation">;</span><span class="token dfn builtin">&#125;</span><span class="token number">5</span><span class="token dyadic-operator operator">.</span>fairä¼˜å…ˆåˆ†é…è¿æ¥æ—¶é—´çŸ­çš„upstrean houduan <span class="token dfn builtin">&#123;</span>fair<span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8080</span><span class="token punctuation">;</span>    server <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token dfn builtin">:</span><span class="token number">8081</span><span class="token punctuation">;</span><span class="token dfn builtin">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="nginx-é™æµ"><a href="#nginx-é™æµ" class="headerlink" title="nginx é™æµ"></a>nginx é™æµ</h1><p>ä¸»æµçš„é™æµç®—æ³•ï¼šæ¼æ¡¶ã€ä»¤ç‰Œæ¡¶ã€è®¡æ•°å™¨ã€æ»‘åŠ¨çª—å£</p><p>nginx ä½¿ç”¨çš„é™æµç®—æ³•ï¼š</p><ul><li><p>ä»¤ç‰Œæ¡¶</p><p>ä»¤ç‰Œä»¥å›ºå®šçš„é¢‘ç‡äº§ç”Ÿï¼Œå¹¶ç¼“å­˜åˆ°ä»¤ç‰Œæ¡¶ä¸­ï¼›</p><p>ä»¤ç‰Œæ¡¶æ»¡æ—¶ï¼Œå¤šä½™çš„ä»¤ç‰Œè¢«ä¸¢å¼ƒï¼›</p><p>è¯·æ±‚è¦æ¶ˆè€—ç­‰æ¯”ä¾‹çš„ä»¤ç‰Œæ‰èƒ½è¢«å¤„ç†ï¼›</p><p>ä»¤ç‰Œä¸å¤Ÿæ—¶ï¼Œè¯·æ±‚è¢«ç¼“å­˜ï¼›</p></li><li><p>æ¼æ¡¶</p><p>è¯·æ±‚è¢«ç¼“å­˜åˆ°æ¡¶ä¸­ï¼Œæ¡¶æ»¡æ—¶ï¼Œè¯·æ±‚ä¼šè¢«ä¸¢å¼ƒï¼›</p><p>åŒ€é€Ÿå¤„ç†è¯·æ±‚ï¼›</p></li><li><p>ä»¤ç‰Œæ¡¶ä¸æ¼æ¡¶å¯¹æ¯”</p><p>ä»¤ç‰Œæ¡¶æœ‰ä¸€ä¸ªç¼“å­˜æ¡¶å’Œä¸€ä¸ªé˜Ÿåˆ—(å­˜æ”¾è¿‡å¤šçš„è¯·æ±‚)ï¼›æ¼æ¡¶åªæœ‰ç¼“å­˜æ¡¶ï¼Œè¯·æ±‚è¿‡å¤šä¼šè¢«ä¸¢å¼ƒã€‚</p></li></ul><p>å¸¸ç”¨ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é™åˆ¶è®¿é—®é€Ÿç‡---æ¼æ¡¶--åŒ€é€Ÿå¤„ç†</span>limit_req_zone  <span class="token variable">$binary_remote_addr</span>  <span class="token assign-left variable">zone</span><span class="token operator">=</span>one:10m   <span class="token assign-left variable">rate</span><span class="token operator">=</span>1r/s<span class="token punctuation">;</span> server <span class="token punctuation">&#123;</span>     location /search/ <span class="token punctuation">&#123;</span>     limit_req   <span class="token assign-left variable">zone</span><span class="token operator">=</span>one<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">## è®¾ç½®æ¡¶å¤§å°</span><span class="token comment"># é™åˆ¶è®¿é—®é€Ÿç‡---æ¼æ¡¶--åŒ€é€Ÿå¤„ç†</span>limit_req_zone  <span class="token variable">$binary_remote_addr</span>  <span class="token assign-left variable">zone</span><span class="token operator">=</span>one:10m   <span class="token assign-left variable">rate</span><span class="token operator">=</span>1r/s<span class="token punctuation">;</span> server <span class="token punctuation">&#123;</span>     location /search/ <span class="token punctuation">&#123;</span>     limit_req   <span class="token assign-left variable">zone</span><span class="token operator">=</span>one  <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span> <span class="token comment"># 5è¡¨ç¤º0-5å¯ä»¥å¤„ç†6ä¸ªè¯·æ±‚</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">## è®¾ç½®æ¡¶å¤§å°+è¿›ç¼“å­˜ç›´æ¥å¤„ç†ï¼Œä¸ç­‰å¾…</span><span class="token comment"># é™åˆ¶è®¿é—®é€Ÿç‡---æ¼æ¡¶--åŒ€é€Ÿå¤„ç†</span>limit_req_zone  <span class="token variable">$binary_remote_addr</span>  <span class="token assign-left variable">zone</span><span class="token operator">=</span>one:10m   <span class="token assign-left variable">rate</span><span class="token operator">=</span>1r/s<span class="token punctuation">;</span> server <span class="token punctuation">&#123;</span>     location /search/ <span class="token punctuation">&#123;</span>     limit_req   <span class="token assign-left variable">zone</span><span class="token operator">=</span>one  <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span> nodelay<span class="token punctuation">;</span> <span class="token comment"># 5è¡¨ç¤º0-5å¯ä»¥å¤„ç†6ä¸ªè¯·æ±‚</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">## è®¾ç½®æ¡¶å¤§å°+è¿›ç¼“å­˜ç›´æ¥å¤„ç†ï¼Œä¸ç­‰å¾…+ç»™ä¸€ä¸ªå¤±è´¥è¿”å›ç </span><span class="token comment"># é™åˆ¶è®¿é—®é€Ÿç‡---æ¼æ¡¶--åŒ€é€Ÿå¤„ç†</span>limit_req_zone  <span class="token variable">$binary_remote_addr</span>  <span class="token assign-left variable">zone</span><span class="token operator">=</span>one:10m   <span class="token assign-left variable">rate</span><span class="token operator">=</span>1r/s<span class="token punctuation">;</span> server <span class="token punctuation">&#123;</span>     location /search/ <span class="token punctuation">&#123;</span>     limit_req   <span class="token assign-left variable">zone</span><span class="token operator">=</span>one  <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span> nodelay<span class="token punctuation">;</span> <span class="token comment"># 5è¡¨ç¤º0-5å¯ä»¥å¤„ç†6ä¸ªè¯·æ±‚</span>  limit_req_status <span class="token number">598</span><span class="token punctuation">;</span>   <span class="token comment"># è­¦å‘Šè¯·æ±‚çš„è¿”å›å€¼é™æµäº†</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="ngnix-åŠ¨é™åˆ†ç¦»"><a href="#ngnix-åŠ¨é™åˆ†ç¦»" class="headerlink" title="ngnix åŠ¨é™åˆ†ç¦»"></a>ngnix åŠ¨é™åˆ†ç¦»</h1><pre class="line-numbers language-ABAP" data-language="ABAP"><code class="language-ABAP">&#x3D; ï¼šè¿›è¡Œæ™®é€šå­—ç¬¦ç²¾ç¡®åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯å®Œå…¨åŒ¹é…ã€‚^~ ï¼šè¡¨ç¤ºæ™®é€šå­—ç¬¦åŒ¹é…ã€‚ä½¿ç”¨å‰ç¼€åŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™ä¸å†åŒ¹é…å…¶å®ƒ locationã€‚~ ï¼šåŒºåˆ†å¤§å°å†™çš„åŒ¹é…ã€‚~* ï¼šä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…ã€‚!~ ï¼šåŒºåˆ†å¤§å°å†™çš„åŒ¹é…å–éã€‚!~* ï¼šä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…å–é<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginx è°ƒä¼˜</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># è¿è¡Œç”¨æˆ·ï¼ˆå¯åŠ¨è€…ç”¨æˆ·åï¼‰ï¼Œé»˜è®¤å³æ˜¯nginxï¼Œå¯ä»¥ä¸è¿›è¡Œè®¾ç½®</span>user  nginx<span class="token punctuation">;</span><span class="token comment"># Nginx è¿›ç¨‹æ•°ï¼Œä¸€èˆ¬è®¾ç½®ä¸ºå’Œ CPU æ ¸å¿ƒæ•°äºŒå€</span>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment"># Nginx çš„é”™è¯¯æ—¥å¿—å­˜æ”¾ç›®å½•</span>error_log  logs/error.log warn<span class="token punctuation">;</span><span class="token comment"># Nginx æœåŠ¡å¯åŠ¨æ—¶çš„ pid å­˜æ”¾ä½ç½®</span>pid        logs/nginx.pid<span class="token punctuation">;</span>events <span class="token punctuation">&#123;</span><span class="token comment"># å·¥ä½œæ¨¡å‹ï¼šä½¿ç”¨epollçš„I/Oæ¨¡å‹(å¦‚æœä½ ä¸è®¾ç½®ã€ä¸çŸ¥é“Nginxè¯¥ä½¿ç”¨å“ªç§è½®è¯¢æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆä½ æ“ä½œç³»ç»Ÿçš„)</span>    use epoll<span class="token punctuation">;</span>    <span class="token comment"># æ¯ä¸ªè¿›ç¨‹å…è®¸æœ€å¤§å¹¶å‘æ•°ï¼ˆæ‰“å¼€çš„æ–‡ä»¶æ•°é™åˆ¶ï¼‰éœ€è¦è®¾ç½®"ulimit -n 65536"</span>    worker_connections <span class="token number">1024</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># é…ç½®ä½¿ç”¨æœ€é¢‘ç¹çš„éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®éƒ½åœ¨è¿™é‡Œè®¾ç½®</span>http <span class="token punctuation">&#123;</span>    <span class="token comment"># è®¾ç½®æ—¥å¿—æ¨¡å¼</span>    log_format  main  <span class="token string">'$remote_addr - $remote_user [$time_local] "$request" '</span>                      <span class="token string">'$status $body_bytes_sent "$http_referer" '</span>                      <span class="token string">'"$http_user_agent" "$http_x_forwarded_for"'</span><span class="token punctuation">;</span><span class="token comment"># Nginxè®¿é—®æ—¥å¿—å­˜æ”¾ä½ç½®</span>    access_log  /var/log/nginx/access.log  main<span class="token punctuation">;</span><span class="token comment"># å¼€å¯é«˜æ•ˆä¼ è¾“æ¨¡å¼</span>    sendfile            on<span class="token punctuation">;</span>    <span class="token comment"># å‡å°‘ç½‘ç»œæŠ¥æ–‡æ®µçš„æ•°é‡</span>    tcp_nopush          on<span class="token punctuation">;</span>    tcp_nodelay         on<span class="token punctuation">;</span>    <span class="token comment"># ä¿æŒè¿æ¥çš„æ—¶é—´ï¼Œä¹Ÿå«è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’</span>    keepalive_timeout   <span class="token number">65</span><span class="token punctuation">;</span>    types_hash_max_size <span class="token number">2048</span><span class="token punctuation">;</span><span class="token comment"># æ–‡ä»¶æ‰©å±•åä¸ç±»å‹æ˜ å°„è¡¨</span>    include             /etc/nginx/mime.types<span class="token punctuation">;</span>    <span class="token comment"># é»˜è®¤æ–‡ä»¶ç±»å‹</span>    default_type        application/octet-stream<span class="token punctuation">;</span><span class="token comment"># åŠ è½½å­é…ç½®é¡¹</span>    include /etc/nginx/conf.d/*.conf<span class="token punctuation">;</span>    <span class="token comment"># é…ç½®åç«¯æœåŠ¡å™¨ï¼Œè¿›è¡Œè´Ÿè½½å‡è¡¡é…ç½®ï¼Œå¯ä»¥å¤šä¸ªupstream</span>    upstrean houduan <span class="token punctuation">&#123;</span>    server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    server <span class="token punctuation">&#123;</span>    <span class="token comment"># é…ç½®ç›‘å¬çš„ç«¯å£</span>        listen       <span class="token number">80</span><span class="token punctuation">;</span>        <span class="token comment"># é…ç½®çš„åŸŸå</span>        server_name  localhost<span class="token punctuation">;</span>        location / <span class="token punctuation">&#123;</span>       <span class="token comment"># ç½‘ç«™æ ¹ç›®å½•</span>            root   /usr/share/nginx/html<span class="token punctuation">;</span>            <span class="token comment"># é»˜è®¤é¦–é¡µæ–‡ä»¶</span>            index  index.html index.htm<span class="token punctuation">;</span>            <span class="token comment"># ç¦æ­¢è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>            deny <span class="token number">172.168</span>.22.11<span class="token punctuation">;</span>            <span class="token comment"># å…è®¸è®¿é—®çš„ipåœ°å€ï¼Œå¯ä»¥ä¸ºall</span>            allow <span class="token number">172.168</span>.33.44<span class="token punctuation">;</span>            <span class="token comment"># è¯·æ±‚çš„åç«¯ä»£ç†ï¼Œå®é™…åœ°å€ä½äºupstream</span>            proxy_pass http:houduan<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment"># é»˜è®¤50xå¯¹åº”çš„è®¿é—®é¡µé¢</span>    error_page <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html<span class="token punctuation">;</span>    <span class="token comment"># åŒä¸Š</span>    error_page <span class="token number">400</span> <span class="token number">404</span> error.html<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="nginx-å°†åŠ¨æ€èµ„æºä¸é™æ€èµ„æºè¯·æ±‚åˆ†ç¦»"><a href="#nginx-å°†åŠ¨æ€èµ„æºä¸é™æ€èµ„æºè¯·æ±‚åˆ†ç¦»" class="headerlink" title="nginx å°†åŠ¨æ€èµ„æºä¸é™æ€èµ„æºè¯·æ±‚åˆ†ç¦»"></a>nginx å°†åŠ¨æ€èµ„æºä¸é™æ€èµ„æºè¯·æ±‚åˆ†ç¦»</h2><p>ç›¸å…³é…ç½®å‚æ•°</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯ç”¨ç¼“å­˜åˆ°æœ¬åœ°çš„åŠŸèƒ½</span>proxy_store on<span class="token punctuation">;</span><span class="token comment"># ç”¨æˆ·è¯»å†™æƒé™</span>proxy_store_access user:rw group:rw all:rw<span class="token comment"># æ–‡ä»¶ç¼“å­˜è·¯å¾„ï¼Œä¸urlä¸€è‡´</span>proxy_temp_path ç¼“å­˜ç›®å½•<span class="token punctuation">;</span><span class="token comment"># æœ¬åœ°ç¼“å­˜æ–‡ä»¶é…ç½®åï¼Œè¿˜éœ€è¦ä»¥ä¸‹é…ç½®æ‰èƒ½é¿å…è¯·æ±‚å»è¿œç«¯å–æ–‡ä»¶</span>if<span class="token punctuation">(</span> <span class="token operator">!</span>e <span class="token variable">$request_filename</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment"># åˆ¤æ–­æœ¬åœ°ç¼“å­˜æ˜¯å¦å­˜åœ¨è¯¥èµ„æº</span>proxy_pass http://ip<span class="token punctuation">;</span><span class="token comment"># æºæœåŠ¡å™¨çš„åœ°å€ï¼Œé»˜è®¤ç«¯å£80ï¼Œå¦‚æœä¸æ˜¯80éœ€è¦æŒ‡æ˜</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>nginx ä¸­å…·ä½“é…ç½®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">location ~*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>gif<span class="token operator">|</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>bmp<span class="token operator">|</span>jpeg<span class="token punctuation">)</span>$ <span class="token punctuation">&#123;</span><span class="token comment"># ä»£ç†è¯·æ±‚é™æ€èµ„æºçš„æ­£åˆ™åŒ¹é…è¯·æ±‚</span>       <span class="token comment"># æµè§ˆå™¨ç¼“å­˜è¿‡æœŸæ—¶é—´</span>       expires 3d<span class="token punctuation">;</span>       proxy_set_header Accept-Encoding <span class="token string">''</span><span class="token punctuation">;</span>       <span class="token comment"># æœåŠ¡å™¨çš„èµ„æºæ–‡ä»¶ç›®å½•</span>            root   /home/images/nginx<span class="token punctuation">;</span>            <span class="token comment"># å¯ç”¨ç¼“å­˜åˆ°æœ¬åœ°çš„åŠŸèƒ½</span>proxy_store on<span class="token punctuation">;</span><span class="token comment"># ç”¨æˆ·è¯»å†™æƒé™</span>proxy_store_access user:rw group:rw all:rw<span class="token comment"># æ–‡ä»¶ç¼“å­˜è·¯å¾„ï¼Œä¸urlä¸€è‡´</span>proxy_temp_path /home/images/nginx<span class="token punctuation">;</span>            <span class="token comment"># æœ¬åœ°ç¼“å­˜æ–‡ä»¶é…ç½®åï¼Œè¿˜éœ€è¦ä»¥ä¸‹é…ç½®æ‰èƒ½é¿å…è¯·æ±‚å»è¿œç«¯å–æ–‡ä»¶</span>            if<span class="token punctuation">(</span> <span class="token operator">!</span>e <span class="token variable">$request_filename</span> <span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token comment"># åˆ¤æ–­æœ¬åœ°ç¼“å­˜æ˜¯å¦å­˜åœ¨è¯¥èµ„æº</span>                proxy_pass http://ip<span class="token punctuation">;</span><span class="token comment"># æºæœåŠ¡å™¨çš„åœ°å€ï¼Œé»˜è®¤ç«¯å£80ï¼Œå¦‚æœä¸æ˜¯80éœ€è¦æŒ‡æ˜</span>            <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="nginx-çƒ­å¤‡"><a href="#nginx-çƒ­å¤‡" class="headerlink" title="nginx çƒ­å¤‡"></a>nginx çƒ­å¤‡</h1><ol><li><p>å®‰è£… keepalived</p><p><code> yum install nginx keepalived pcre-devel -y</code></p></li><li><p><code> vim keepalived.conf</code> é…ç½® nginx åŒæ´»çƒ­å¤‡ï¼ˆåŒä¸€ç½‘æ®µï¼‰</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">global_defs <span class="token punctuation">&#123;</span>vrrp_grap_interval <span class="token number">0</span>vrrp_gna_interval <span class="token number">0</span><span class="token punctuation">&#125;</span>vrrp_instance VI_1 <span class="token punctuation">&#123;</span><span class="token comment">#VI_1 vrrpå®ä¾‹ç»„ç»„å(masterå’Œslaveä¿æŒä¸€è‡´)</span>state MASTER    <span class="token comment"># å¤‡ç”¨æœºå†™BACKUP</span>interface ens33 <span class="token comment">#ç½‘å¡åç§°</span>virtual_router_id <span class="token number">50</span> <span class="token comment">#50ï¼švrrpç»„çš„ç¼–å·(masterå’Œslaveä¿æŒä¸€è‡´)</span>priority <span class="token number">100</span> <span class="token comment"># å‚æ•° å¤‡ç”¨æœºè®¾ç½®ä¸ºæ¯”ä¸»æœºä½å°±å¯ä»¥</span>advert_int <span class="token number">1</span>authentication <span class="token punctuation">&#123;</span>auth_type PASS<span class="token comment">#æˆæƒç±»å‹(pass</span>auth_pass <span class="token number">1111</span><span class="token comment">#ç»„å¯†ç (ç»„ä»¶é›†ç¾¤æ—¶ï¼Œå¯†ç å¿…é¡»ä¸€è‡´)</span><span class="token punctuation">&#125;</span>virtual_ipaddress <span class="token punctuation">&#123;</span>è™šæ‹Ÿä¸€ä¸ªåŒç½‘æ®µip,å¦‚192.168.56.120<span class="token comment">#VIPï¼Œè™šæ‹Ÿçš„IPåœ°å€ï¼Œéœ€è¦ä¸é›†ç¾¤ä¸­çš„ç½‘æ®µä¿æŒä¸€è‡´</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code> vim nginx.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># é…ç½®æœåŠ¡å™¨çš„çƒ­å¤‡</span>upstrean houduan <span class="token punctuation">&#123;</span>    server <span class="token number">127.0</span>.0.1:8080<span class="token punctuation">;</span>    server <span class="token number">127.0</span>.0.1:8080 backup<span class="token punctuation">;</span><span class="token comment"># 8080å®•æœºï¼Œè¯¥æœåŠ¡ä¼šå……å½“ä¸»æœº</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h1 id="nginx-å®‰å…¨è®¤è¯"><a href="#nginx-å®‰å…¨è®¤è¯" class="headerlink" title="nginx å®‰å…¨è®¤è¯"></a>nginx å®‰å…¨è®¤è¯</h1><p><a href="https://blog.redis.com.cn/doc/standard/httpauthbasic.html">nginx å®‰å…¨è®¤è¯ä¸­æ–‡ä»‹ç»</a></p><p><a href="https://www.cnblogs.com/Chilam007/p/16900400.html">htpasswd ç›¸å…³ä»‹ç»</a></p><ol><li><p>htpasswd ç”Ÿæˆå¯†ç æ–‡ä»¶</p><p><code> yum install httpd-tools -y</code></p></li><li><p>htpasswd ç”Ÿæˆ nginx å¯†ç æ–‡ä»¶(ç”¨æˆ·åä¸è¦ä½¿ç”¨ user_password)</p><p><code> htpasswd -bc /usr/local/nginx/nginx-1.18.0/conf/nginxpasswd test 123123</code></p><p>è‹¥è¦åœ¨å·²æœ‰ nginx å¯†ç æ–‡ä»¶è¿½åŠ ç”¨æˆ·</p><p><code> htpasswd -b /usr/local/nginx/nginx-1.18.0/conf/nginxpasswd test1 123123</code></p></li><li><p>nginx é…ç½®</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">location / <span class="token punctuation">&#123;</span><span class="token comment"># æ·»åŠ ä»¥ä¸‹ä¸¤è¡Œ</span>    auth_basic <span class="token string">"Restricted"</span><span class="token punctuation">;</span>    auth_basic_user_file /usr/local/nginx/nginx-1.18.0/conf/nginxpasswd<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯è¿ç»´ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Monorepo ç®¡ç†é¡¹ç›®ï¼ˆä»¥Vueä¸ºä¾‹ï¼‰</title>
      <link href="/2023/04/24/monorepo-guan-li-xiang/"/>
      <url>/2023/04/24/monorepo-guan-li-xiang/</url>
      
        <content type="html"><![CDATA[<p>Monorepo æ˜¯ç®¡ç†é¡¹ç›®ä»£ç çš„ä¸€ä¸ªæ–¹å¼ï¼ŒæŒ‡åœ¨ä¸€ä¸ªé¡¹ç›®ä»“åº“(repo)ä¸­ç®¡ç†å¤šä¸ªæ¨¡å—/åŒ…(package)ã€‚ Vue3æºç é‡‡ç”¨ monorepo æ–¹å¼è¿›è¡Œç®¡ç†ï¼Œå°†æ¨¡å—æ‹†åˆ†åˆ°packageç›®å½•ä¸­ã€‚</p><ul><li>ä¸€ä¸ªä»“åº“å¯ç»´æŠ¤å¤šä¸ªæ¨¡å—ï¼Œä¸ç”¨åˆ°å¤„æ‰¾ä»“åº“</li><li>æ–¹ä¾¿ç‰ˆæœ¬ç®¡ç†å’Œä¾èµ–ç®¡ç†ï¼Œæ¨¡å—ä¹‹é—´çš„å¼•ç”¨ï¼Œè°ƒç”¨éƒ½éå¸¸æ–¹ä¾¿</li></ul><h2 id="æ­å»ºMonorepoç¯å¢ƒ"><a href="#æ­å»ºMonorepoç¯å¢ƒ" class="headerlink" title="æ­å»ºMonorepoç¯å¢ƒ"></a>æ­å»ºMonorepoç¯å¢ƒ</h2><p>Vue3ä¸­ä½¿ç”¨<code>pnpm</code> <code>workspace</code>æ¥å®ç°<code>monorepo</code> (<a href="https://pnpm.io/">pnpm</a>æ˜¯å¿«é€Ÿã€èŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å™¨ã€‚ä¸»è¦é‡‡ç”¨ç¬¦å·é“¾æ¥çš„æ–¹å¼ç®¡ç†æ¨¡å—)</p><h3 id="å…¨å±€å®‰è£…pnpm"><a href="#å…¨å±€å®‰è£…pnpm" class="headerlink" title="å…¨å±€å®‰è£…pnpm"></a>å…¨å±€å®‰è£…pnpm</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> <span class="token function">pnpm</span> <span class="token parameter variable">-g</span> <span class="token comment"># å…¨å±€å®‰è£…pnpm</span><span class="token function">pnpm</span> init <span class="token comment"># åˆå§‹åŒ–é…ç½®æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åˆ›å»º-npmrcæ–‡ä»¶"><a href="#åˆ›å»º-npmrcæ–‡ä»¶" class="headerlink" title="åˆ›å»º.npmrcæ–‡ä»¶"></a>åˆ›å»º.npmrcæ–‡ä»¶</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">shamefully-hoist <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment"># å°†æ¨¡å—æ‰€ä¾èµ–çš„åŒ…æå‡åˆ°node_modulesä¸­</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>è¿™é‡Œæ‚¨å¯ä»¥å°è¯•ä¸€ä¸‹å®‰è£…<code>Vue3</code>, <code>pnpm install vue@next</code>æ­¤æ—¶é»˜è®¤æƒ…å†µä¸‹<code>vue3</code>ä¸­ä¾èµ–çš„æ¨¡å—ä¸ä¼šè¢«æå‡åˆ°<code>node_modules</code>ä¸‹ã€‚ æ·»åŠ <strong>ç¾è€»çš„æå‡</strong>å¯ä»¥å°†Vue3ï¼Œæ‰€ä¾èµ–çš„æ¨¡å—æå‡åˆ°<code>node_modules</code>ä¸­</p></blockquote><h3 id="é…ç½®workspace"><a href="#é…ç½®workspace" class="headerlink" title="é…ç½®workspace"></a>é…ç½®workspace</h3><p>æ–°å»º <strong>pnpm-workspace.yaml</strong></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">packages</span><span class="token punctuation">:</span>  <span class="token punctuation">-</span> <span class="token string">'packages/*'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><blockquote><p>å°†packagesä¸‹æ‰€æœ‰çš„ç›®å½•éƒ½ä½œä¸ºåŒ…è¿›è¡Œç®¡ç†ã€‚è¿™æ ·æˆ‘ä»¬çš„Monorepoå°±æ­å»ºå¥½äº†ã€‚ç¡®å®æ¯”<code>lerna + yarn workspace</code>æ›´å¿«æ·</p></blockquote><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><blockquote><p>æ‰“åŒ…é¡¹ç›®Vue3é‡‡ç”¨rollupè¿›è¡Œæ‰“åŒ…ä»£ç ï¼Œå®‰è£…æ‰“åŒ…æ‰€éœ€è¦çš„ä¾èµ–</p></blockquote><table><thead><tr><th>ä¾èµ–</th><th></th></tr></thead><tbody><tr><td>typescript</td><td>åœ¨é¡¹ç›®ä¸­æ”¯æŒTypescript</td></tr><tr><td>rollup</td><td>æ‰“åŒ…å·¥å…·</td></tr><tr><td>rollup-plugin-typescript2</td><td>rollup å’Œ tsçš„ æ¡¥æ¢</td></tr><tr><td>@rollup/plugin-json</td><td>æ”¯æŒå¼•å…¥json</td></tr><tr><td>@rollup/plugin-node-resolve</td><td>è§£ænodeç¬¬ä¸‰æ–¹æ¨¡å—</td></tr><tr><td>@rollup/plugin-commonjs</td><td>å°†CommonJSè½¬åŒ–ä¸ºES6Module</td></tr><tr><td>minimist</td><td>å‘½ä»¤è¡Œå‚æ•°è§£æ</td></tr><tr><td>execa@4</td><td>å¼€å¯å­è¿›ç¨‹</td></tr></tbody></table><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">install</span> typescript rollup rollup-plugin-typescript2 @rollup/plugin-json @rollup/plugin-node-resolve @rollup/plugin-commonjs minimist execa@4 esbuild@0.15.18   <span class="token parameter variable">-D</span> <span class="token parameter variable">-w</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="åˆå§‹åŒ–TS"><a href="#åˆå§‹åŒ–TS" class="headerlink" title="åˆå§‹åŒ–TS"></a>åˆå§‹åŒ–TS</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> tsc <span class="token parameter variable">--init</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å…ˆæ·»åŠ äº›å¸¸ç”¨çš„<code>ts-config</code>é…ç½®ï¼Œåç»­éœ€è¦å…¶ä»–çš„åœ¨ç»§ç»­å¢åŠ </p></blockquote><ul><li>tsconfig.json</li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"outDir"</span><span class="token operator">:</span> <span class="token string">"dist"</span><span class="token punctuation">,</span> <span class="token comment">// è¾“å‡ºçš„ç›®å½•</span>    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// é‡‡ç”¨sourcemap</span>    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"es2016"</span><span class="token punctuation">,</span> <span class="token comment">// ç›®æ ‡è¯­æ³•</span>    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span> <span class="token comment">// æ¨¡å—æ ¼å¼</span>    <span class="token property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span> <span class="token comment">// æ¨¡å—è§£ææ–¹å¼</span>    <span class="token property">"strict"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// ä¸¥æ ¼æ¨¡å¼</span>    <span class="token property">"resolveJsonModule"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// è§£æjsonæ¨¡å—</span>    <span class="token property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// å…è®¸é€šè¿‡es6è¯­æ³•å¼•å…¥commonjsæ¨¡å—</span>    <span class="token property">"jsx"</span><span class="token operator">:</span> <span class="token string">"preserve"</span><span class="token punctuation">,</span> <span class="token comment">// jsx ä¸è½¬ä¹‰</span>    <span class="token property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"esnext"</span><span class="token punctuation">,</span> <span class="token string">"dom"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æ”¯æŒçš„ç±»åº“ esnextåŠdom</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ›å»ºæ¨¡å—"><a href="#åˆ›å»ºæ¨¡å—" class="headerlink" title="åˆ›å»ºæ¨¡å—"></a>åˆ›å»ºæ¨¡å—</h3><blockquote><p>æˆ‘ä»¬ç°åœ¨<code>packages</code>ç›®å½•ä¸‹æ–°å»ºä¸¤ä¸ªpackage</p></blockquote><ul><li>reactivity å“åº”å¼æ¨¡å—</li><li>shared å…±äº«æ¨¡å—</li></ul><p><strong>æ‰€æœ‰åŒ…çš„å…¥å£å‡ä¸º<code>src/index.ts</code> è¿™æ ·å¯ä»¥å®ç°ç»Ÿä¸€æ‰“åŒ…</strong></p><ul><li><p>æ¯ä¸ªåŒ…ä¸‹æ‰§è¡Œ<code>pnpm init</code></p></li><li><p>reactivity/package.json</p></li></ul><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"@vue/reactivity"</span><span class="token punctuation">,</span>  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>  <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>  <span class="token property">"module"</span><span class="token operator">:</span><span class="token string">"dist/reactivity.esm-bundler.js"</span><span class="token punctuation">,</span>  <span class="token property">"unpkg"</span><span class="token operator">:</span> <span class="token string">"dist/reactivity.global.js"</span><span class="token punctuation">,</span>  <span class="token property">"buildOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"VueReactivity"</span><span class="token punctuation">,</span>    <span class="token property">"formats"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token string">"esm-bundler"</span><span class="token punctuation">,</span>      <span class="token string">"cjs"</span><span class="token punctuation">,</span>      <span class="token string">"global"</span>    <span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>shared/package.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"@vue/shared"</span><span class="token punctuation">,</span>    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>    <span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"dist/shared.esm-bundler.js"</span><span class="token punctuation">,</span>    <span class="token property">"buildOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"formats"</span><span class="token operator">:</span> <span class="token punctuation">[</span>            <span class="token string">"esm-bundler"</span><span class="token punctuation">,</span>            <span class="token string">"cjs"</span>        <span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>formats</strong>ä¸ºè‡ªå®šä¹‰çš„æ‰“åŒ…æ ¼å¼ï¼Œæœ‰<code>esm-bundler</code>åœ¨æ„å»ºå·¥å…·ä¸­ä½¿ç”¨çš„æ ¼å¼ã€<code>esm-browser</code>åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨çš„æ ¼å¼ã€<code>cjs</code>åœ¨nodeä¸­ä½¿ç”¨çš„æ ¼å¼ã€<code>global</code>ç«‹å³æ‰§è¡Œå‡½æ•°çš„æ ¼å¼</p></blockquote><p><strong>é…ç½®<code>ts</code>å¼•ç”¨å…³ç³»</strong></p><ul><li><p>tsconfig.json</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span> <span class="token comment">//ä»¥å½“å‰é¡¹ç›®ä¸ºæ ¹ç›®å½•</span>    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token property">"@vue/*"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"packages/*/src"</span><span class="token punctuation">]</span>  <span class="token comment">//ç›®å½•åŒ¹é…</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p><strong>ç‹¬ç«‹å®‰è£…ä¾èµ–</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">pnpm</span> <span class="token function">install</span> @vue/shared@workspace <span class="token parameter variable">--filter</span> @vue/reactivity<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™è¡Œä»£ç æ˜¯ä¸€ä¸ª <code>pnpm</code> å‘½ä»¤ï¼Œç”¨äºåœ¨æŒ‡å®šå·¥ä½œåŒºä¸­å®‰è£… <code>@vue/reactivity</code> çš„ä¾èµ–ã€‚ä»¥ä¸‹æ˜¯å„å‚æ•°çš„è§£é‡Šï¼š</p><ul><li><code>pnpm</code>: åŒ…ç®¡ç†å™¨ <code>pnpm</code> çš„å‘½ä»¤è¡Œå·¥å…·ã€‚</li><li><code>install</code>: å®‰è£…ä¾èµ–ã€‚</li><li><code>@vue/shared@workspace</code>: å®‰è£… <code>@vue/shared</code> çš„å·¥ä½œåŒºç‰ˆæœ¬ã€‚</li><li><code>--filter @vue/reactivity</code>: è¿‡æ»¤å‡º <code>@vue/reactivity</code> çš„ä¾èµ–å¹¶å®‰è£…ã€‚</li></ul><p>æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå‘½ä»¤å°†åœ¨ <code>@vue/shared</code> çš„å·¥ä½œåŒºä¸­ï¼Œåªå®‰è£… <code>@vue/reactivity</code> çš„ä¾èµ–ã€‚</p><h3 id="å¼€å‘ç¯å¢ƒesbuildæ‰“åŒ…"><a href="#å¼€å‘ç¯å¢ƒesbuildæ‰“åŒ…" class="headerlink" title="å¼€å‘ç¯å¢ƒesbuildæ‰“åŒ…"></a>å¼€å‘ç¯å¢ƒ<code>esbuild</code>æ‰“åŒ…</h3><p>åˆ›å»ºå¼€å‘æ—¶æ‰§è¡Œè„šæœ¬ï¼Œ å‚æ•°ä¸ºè¦æ‰“åŒ…çš„æ¨¡å—</p><p><strong>è§£æç”¨æˆ·å‚æ•°</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"node scripts/dev.js reactivity -f global"</span><span class="token punctuation">,</span>     <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"node scripts/build.js"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>scripts/dev.js</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> build <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"esbuild"</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> resolve <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"minimist"</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> target <span class="token operator">=</span> args<span class="token punctuation">.</span>_<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">"reactivity"</span><span class="token keyword">const</span> format <span class="token operator">=</span> args<span class="token punctuation">.</span>f <span class="token operator">||</span> <span class="token string">"global"</span><span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../packages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> outputFormat <span class="token operator">=</span> format<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"global"</span><span class="token punctuation">)</span> <span class="token comment">// è¾“å‡ºçš„æ ¼å¼</span>  <span class="token operator">?</span> <span class="token string">"iife"</span>  <span class="token operator">:</span> format <span class="token operator">===</span> <span class="token string">"cjs"</span>  <span class="token operator">?</span> <span class="token string">"cjs"</span>  <span class="token operator">:</span> <span class="token string">"esm"</span><span class="token keyword">const</span> outfile <span class="token operator">=</span> <span class="token function">resolve</span><span class="token punctuation">(</span>  <span class="token comment">// è¾“å‡ºçš„æ–‡ä»¶</span>  __dirname<span class="token punctuation">,</span>  <span class="token comment">// `../packages/$&#123;target&#125;/dist/$&#123;target&#125;.$&#123;format&#125;.js`</span>  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../packages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/dist/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token literal-property property">entryPoints</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">../packages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">/src/index.ts</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  outfile<span class="token punctuation">,</span>  <span class="token literal-property property">bundle</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token literal-property property">format</span><span class="token operator">:</span> outputFormat<span class="token punctuation">,</span>  <span class="token literal-property property">globalName</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>buildOptions<span class="token operator">?.</span>name<span class="token punctuation">,</span>  <span class="token literal-property property">platform</span><span class="token operator">:</span> format <span class="token operator">===</span> <span class="token string">"cjs"</span> <span class="token operator">?</span> <span class="token string">"node"</span> <span class="token operator">:</span> <span class="token string">"browser"</span><span class="token punctuation">,</span>  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç›‘æ§æ–‡ä»¶å˜åŒ–</span>    <span class="token function">onRebuild</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rebuilt~~~~</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"watching~~~"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç”Ÿäº§ç¯å¢ƒrollupæ‰“åŒ…"><a href="#ç”Ÿäº§ç¯å¢ƒrollupæ‰“åŒ…" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒrollupæ‰“åŒ…"></a>ç”Ÿäº§ç¯å¢ƒ<code>rollup</code>æ‰“åŒ…</h3><h4 id="rollup-config-js"><a href="#rollup-config-js" class="headerlink" title="rollup.config.js"></a>rollup.config.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token comment">// è·å–packagesç›®å½•</span><span class="token keyword">const</span> packagesDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"packages"</span><span class="token punctuation">)</span><span class="token comment">// è·å–å¯¹åº”çš„æ¨¡å—</span><span class="token keyword">const</span> packageDir <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>packagesDir<span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">TARGET</span><span class="token punctuation">)</span><span class="token comment">// å…¨éƒ¨ä»¥æ‰“åŒ…ç›®å½•æ¥è§£ææ–‡ä»¶</span><span class="token keyword">const</span> <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>packageDir<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"package.json"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">const</span> name <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>packageDir<span class="token punctuation">)</span> <span class="token comment">// è·å–åŒ…çš„åå­—</span><span class="token comment">// é…ç½®æ‰“åŒ…ä¿¡æ¯</span><span class="token keyword">const</span> outputConfigs <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string-property property">"esm-bundler"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.esm-bundler.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">"es"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">cjs</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.cjs.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">"cjs"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">global</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">dist/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>name<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.global.js</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">"iife"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">// è·å–formats</span><span class="token keyword">const</span> packageFormats <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FORMATS</span> <span class="token operator">&amp;&amp;</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FORMATS</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token keyword">const</span> packageConfigs <span class="token operator">=</span> packageFormats <span class="token operator">||</span> pkg<span class="token punctuation">.</span>buildOptions<span class="token punctuation">.</span>formats<span class="token keyword">const</span> json <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@rollup/plugin-json"</span><span class="token punctuation">)</span><span class="token keyword">const</span> commonjs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@rollup/plugin-commonjs"</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> nodeResolve <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@rollup/plugin-node-resolve"</span><span class="token punctuation">)</span><span class="token keyword">const</span> tsPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"rollup-plugin-typescript2"</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">createConfig</span><span class="token punctuation">(</span><span class="token parameter">format<span class="token punctuation">,</span> output</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  output<span class="token punctuation">.</span>sourcemap <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SOURCE_MAP</span>  output<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">"named"</span>  <span class="token keyword">let</span> external <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>format <span class="token operator">===</span> <span class="token string">"global"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    output<span class="token punctuation">.</span>name <span class="token operator">=</span> pkg<span class="token punctuation">.</span>buildOptions<span class="token punctuation">.</span>name  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// cjs/esm ä¸éœ€è¦æ‰“åŒ…ä¾èµ–æ–‡ä»¶</span>    external <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>dependencies <span class="token operator">||</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"src/index.ts"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    output<span class="token punctuation">,</span>    external<span class="token punctuation">,</span>    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">tsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">nodeResolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// å¼€å§‹æ‰“åŒ…æŠŠ</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> packageConfigs<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">format</span><span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token function">createConfig</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> outputConfigs<span class="token punctuation">[</span>format<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="srcipts-build-js"><a href="#srcipts-build-js" class="headerlink" title="srcipts/build.js"></a>srcipts/build.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token keyword">const</span> execa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"execa"</span><span class="token punctuation">)</span><span class="token keyword">debugger</span><span class="token keyword">const</span> targets <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readdirSync</span><span class="token punctuation">(</span><span class="token string">"packages"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">statSync</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">packages/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>f<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token boolean">false</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runParallel</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> iteratorFn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> item <span class="token keyword">of</span> source<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">iteratorFn</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>    ret<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">await</span> <span class="token function">execa</span><span class="token punctuation">(</span><span class="token string">"rollup"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"-c"</span><span class="token punctuation">,</span> <span class="token string">"--environment"</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">TARGET:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>target<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token string">"inherit"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">runParallel</span><span class="token punctuation">(</span>targets<span class="token punctuation">,</span> build<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Reactivityæ–¹æ³•çš„å®ç°</title>
      <link href="/2023/04/21/reactivity-fang-fa-de-shi-xian/"/>
      <url>/2023/04/21/reactivity-fang-fa-de-shi-xian/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>reactive</code>æ–¹æ³•ä¼šå°†å¯¹è±¡å˜æˆ proxy å¯¹è±¡</p></blockquote><h3 id="åŸºæœ¬å®ç°"><a href="#åŸºæœ¬å®ç°" class="headerlink" title="åŸºæœ¬å®ç°"></a>åŸºæœ¬å®ç°</h3><ul><li>reactivity.ts</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> isObject <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@vue/shared"</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> object</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// reactive åªèƒ½å¤„ç†å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œä¸æ˜¯å¯¹è±¡ä¸å¤„ç†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> target  <span class="token keyword">const</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> muableHandlers<span class="token punctuation">)</span> <span class="token comment">// æ²¡æœ‰ä»£ç†è¿‡åˆ›å»ºä»£ç†</span>  <span class="token keyword">return</span> proxy<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>@vue/shared</li></ul><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> isObject <span class="token operator">=</span> <span class="token punctuation">(</span>value<span class="token operator">:</span> <span class="token builtin">unknown</span><span class="token punctuation">)</span><span class="token operator">:</span> value <span class="token keyword">is</span> Record<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">any</span><span class="token operator">></span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">// return Object.prototype.toString.call(value) === '[object Object]';</span>  <span class="token keyword">return</span> value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">"object"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>handler.ts</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token literal-property property">muableHandlers</span><span class="token operator">:</span> ProxyHandler<span class="token operator">&lt;</span>object<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// receiverç›¸å½“äºä»£ç†å¯¹è±¡</span>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å–å€¼çš„æ—¶å€™ï¼Œè®©å±æ€§å’Œeffectäº§ç”Ÿå…³ç³»</span>    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è®¾ç½®çš„æ—¶å€™ï¼Œè®©å±æ€§å¯¹åº”çš„effectæ‰§è¡Œ</span>    Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¢åŠ ç¼“å†²"><a href="#å¢åŠ ç¼“å†²" class="headerlink" title="å¢åŠ ç¼“å†²"></a>å¢åŠ ç¼“å†²</h3><p><strong>é—®é¢˜:</strong> åŒä¸€ä¸ªå¯¹è±¡è¢«ä»£ç†å¤šæ¬¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./reactivity.js"</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"ghx"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span> <span class="token punctuation">&#125;</span><span class="token keyword">const</span> state1 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token keyword">const</span> state2 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"state=>"</span><span class="token punctuation">,</span> state1 <span class="token operator">===</span> state2<span class="token punctuation">)</span> <span class="token comment">//false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¼˜åŒ–</strong>ï¼šé‡‡ç”¨æ˜ å°„è¡¨</p><ul><li>reactivity.ts</li></ul><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">import &#123; isObject &#125; from "@vue/shared";import &#123; muableHandlers &#125; from "./handler";<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line"> const reactiveMap = new WeakMap()</span></span>export function reactive(target: object) &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> // reactive åªèƒ½å¤„ç†å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œä¸æ˜¯å¯¹è±¡ä¸å¤„ç†</span><span class="token prefix unchanged"> </span><span class="token line"> if (!isObject(target)) return target</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  // ç¼“å­˜å¯ä»¥é‡‡ç”¨æ˜ å°„è¡¨ &#123;&#123;target&#125; -> proxy&#125;</span><span class="token prefix inserted">+</span><span class="token line">  let existingProxy = reactiveMap.get(target)// çœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è¢«ä»£ç†è¿‡</span><span class="token prefix inserted">+</span><span class="token line">  if (existingProxy) return existingProxy// ä»£ç†è¿‡ç›´æ¥è¿”å›</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> //é˜²æ­¢å¯¹è±¡é‡å¤è¢«ä»£ç†</span><span class="token prefix unchanged"> </span><span class="token line"> if (target[ReactiveFlags.IS_REACTIVE]) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   return target;</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const proxy = new Proxy(target, muableHandlers)// æ²¡æœ‰ä»£ç†è¿‡åˆ›å»ºä»£ç†</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  reactiveMap.set(target, proxy) // ç¼“å­˜ä»£ç†ç»“æœ</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> return proxy</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å”¯ä¸€æ ‡è¯†"><a href="#å”¯ä¸€æ ‡è¯†" class="headerlink" title="å”¯ä¸€æ ‡è¯†"></a>å”¯ä¸€æ ‡è¯†</h3><p><strong>é—®é¢˜ï¼š</strong>æŠŠå·²ç»ä»£ç†è¿‡çš„å¯¹è±¡ç»§ç»­ä»£ç†</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> reactive <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./reactivity.js"</span><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"ghx"</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">22</span> <span class="token punctuation">&#125;</span><span class="token keyword">const</span> state1 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token keyword">const</span> state2 <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span>state1<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"state=>"</span><span class="token punctuation">,</span> state1 <span class="token operator">===</span> state2<span class="token punctuation">)</span> <span class="token comment">//false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»¥å‰çš„æ–¹æ¡ˆ</p><ul><li>åœ¨ vue3.0 çš„æ—¶å€™ ä¼šåˆ›é€ ä¸€ä¸ªåå‘æ˜ å°„è¡¨ {ä»£ç†çš„ç»“æœ -ã€‹ åŸå†…å®¹}ã€‘</li></ul><p><strong>ä¼˜åŒ–ï¼š</strong> é‡‡ç”¨å”¯ä¸€æ ‡è¯†</p><p>reactivity.ts</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">import &#123; isObject &#125; from "@vue/shared";import &#123; muableHandlers &#125; from "./handler";<span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">export const enum ReactiveFlags &#123; // å¯¹è±¡</span><span class="token prefix inserted">+</span><span class="token line">  IS_REACTIVE = "__v_isReactive",</span><span class="token prefix inserted">+</span><span class="token line">&#125;</span></span>const reactiveMap = new WeakMap()export function reactive(target: object) &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> // reactive åªèƒ½å¤„ç†å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼Œä¸æ˜¯å¯¹è±¡ä¸å¤„ç†</span><span class="token prefix unchanged"> </span><span class="token line"> if (!isObject(target)) return target</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> // ç¼“å­˜å¯ä»¥é‡‡ç”¨æ˜ å°„è¡¨ target -> proxy</span><span class="token prefix unchanged"> </span><span class="token line"> let existingProxy = reactiveMap.get(target)// çœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹è±¡æ˜¯å¦æœ‰è¢«ä»£ç†è¿‡</span><span class="token prefix unchanged"> </span><span class="token line"> if (existingProxy) return existingProxy// ä»£ç†è¿‡ç›´æ¥è¿”å›</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">  //é˜²æ­¢å¯¹è±¡é‡å¤è¢«ä»£ç†</span><span class="token prefix inserted">+</span><span class="token line">  if (target[ReactiveFlags.IS_REACTIVE]) &#123;</span><span class="token prefix inserted">+</span><span class="token line">    return target;</span><span class="token prefix inserted">+</span><span class="token line">  &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> const proxy = new Proxy(target, muableHandlers)// æ²¡æœ‰ä»£ç†è¿‡åˆ›å»ºä»£ç†</span><span class="token prefix unchanged"> </span><span class="token line"> reactiveMap.set(target, proxy) // ç¼“å­˜ä»£ç†ç»“æœ</span><span class="token prefix unchanged"> </span><span class="token line"> return proxy</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>handler.ts</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">import &#123; ReactiveFlags &#125; from "./reactivity";</span></span>export const muableHandlers: ProxyHandler&lt;object> = &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line"> // receiverç›¸å½“äºä»£ç†å¯¹è±¡</span><span class="token prefix unchanged"> </span><span class="token line"> get(target, key, receiver) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   //å–å€¼çš„æ—¶å€™ï¼Œè®©å±æ€§å’Œeffectäº§ç”Ÿå…³ç³»</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">    if (key === ReactiveFlags.IS_REACTIVE) &#123;</span><span class="token prefix inserted">+</span><span class="token line">      return true;</span><span class="token prefix inserted">+</span><span class="token line">    &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return Reflect.get(target, key, receiver)</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;,</span><span class="token prefix unchanged"> </span><span class="token line"> set(target, key, value, receiver) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">   //è®¾ç½®çš„æ—¶å€™ï¼Œè®©å±æ€§å¯¹åº”çš„effectæ‰§è¡Œ</span><span class="token prefix unchanged"> </span><span class="token line">   Reflect.set(target, key, value, receiver)</span><span class="token prefix unchanged"> </span><span class="token line">   return true</span><span class="token prefix unchanged"> </span><span class="token line"> &#125;,</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Vue.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Proxyå’ŒReflectçš„ä½¿ç”¨</title>
      <link href="/2023/04/21/proxy-he-reflect-de-shi-yong/"/>
      <url>/2023/04/21/proxy-he-reflect-de-shi-yong/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ä½¿ç”¨-Reflect"><a href="#ä¸ä½¿ç”¨-Reflect" class="headerlink" title="ä¸ä½¿ç”¨ Reflect"></a>ä¸ä½¿ç”¨ Reflect</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">aliasName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"**"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">set</span> <span class="token function">aliasName</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> value  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">//ä»£ç†å¯¹è±¡</span><span class="token keyword">const</span> proxyPerson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"è·å–"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>    <span class="token keyword">return</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">//target ä¸ºperson</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"é€šçŸ¥é¡µé¢"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"æ”¹å˜äº†"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"proxyPerson.aliasName=>"</span><span class="token punctuation">,</span> proxyPerson<span class="token punctuation">.</span>aliasName<span class="token punctuation">)</span>proxyPerson<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"å¼ ä¸‰"</span><span class="token comment">// è·å–aliasName</span><span class="token comment">// proxyPerson.aliasName=> **John Doe</span><span class="token comment">// é€šçŸ¥é¡µé¢nameæ”¹å˜äº†</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>é—®é¢˜</strong></p><ol><li><p>å– aliasName çš„æ—¶å€™ä¸­é‡Œé¢åŒè¿‡ this.name, æ­¤æ—¶ this ä¸º personï¼Œ å½“è°ƒç”¨ this.name çš„æ—¶å€™æ²¡æœ‰è§¦å‘ä»£ç†å¯¹è±¡çš„è·å–</p></li><li><p>å‡å¦‚é¡µé¢ä¸­ä½¿ç”¨çš„ aliasName ï¼Œä¼šæœ‰ aliasName å¯¹åº”çš„é¡µé¢ï¼Œæ²¡æœ‰åˆ›å»º name å’Œé¡µé¢çš„å¯¹åº”å…³ç³»</p></li><li><p>å½“åé¢ä¿®æ”¹çš„ name å±æ€§çš„æ—¶å€™ï¼Œä¸ä¼šè§¦å‘é¡µé¢çš„æ›´æ–°</p></li><li><p>å¸Œæœ›è·å– aliasName çš„æ—¶å€™ï¼Œname å±æ€§ä¹Ÿè§¦å‘ get</p></li></ol><h2 id="ä½¿ç”¨-Reflect"><a href="#ä½¿ç”¨-Reflect" class="headerlink" title="ä½¿ç”¨ Reflect"></a>ä½¿ç”¨ Reflect</h2><p>ä½¿ç”¨ Reflect è¿›è¡Œæ“ä½œï¼Œä¿è¯ this æŒ‡å‘æ°¸è¿œæŒ‡å‘ä»£ç†å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>  <span class="token keyword">get</span> <span class="token function">aliasName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token string">"**"</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token keyword">set</span> <span class="token function">aliasName</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> value  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> proxyPerson <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"è·å–"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>    <span class="token comment">//ä¸ºäº†è§£å†³thisé—®é¢˜ï¼Œå¢åŠ ä¸€å±‚æ˜ å°„</span>    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"é€šçŸ¥é¡µé¢"</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">"æ”¹å˜äº†"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>proxyPerson<span class="token punctuation">.</span>aliasNameproxyPerson<span class="token punctuation">.</span>aliasName <span class="token operator">=</span> <span class="token string">"zhangsan"</span><span class="token comment">//è·å–aliasName</span><span class="token comment">//è·å–name</span><span class="token comment">//é€šçŸ¥é¡µé¢aliasNameæ”¹å˜äº†</span><span class="token comment">//é€šçŸ¥é¡µé¢nameæ”¹å˜äº†</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•é¡ºåºæ‰§è¡Œ10ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Ÿ</title>
      <link href="/2023/03/23/runtasks/"/>
      <url>/2023/03/23/runtasks/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ³•ä¸€ï¼šä½¿ç”¨-async-await-å’Œ-for-å¾ªç¯"><a href="#æ–¹æ³•ä¸€ï¼šä½¿ç”¨-async-await-å’Œ-for-å¾ªç¯" class="headerlink" title="æ–¹æ³•ä¸€ï¼šä½¿ç”¨ async/await å’Œ for å¾ªç¯"></a>æ–¹æ³•ä¸€ï¼šä½¿ç”¨ async/await å’Œ for å¾ªç¯</h2><p>è¿™ç§æ–¹æ³•ä½¿ç”¨ async/await å’Œ for å¾ªç¯ï¼Œæ¯æ¬¡åªæ‰§è¡Œä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆåå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doAsyncTask</span><span class="token punctuation">(</span><span class="token parameter">taskNumber</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åœ¨è¿™é‡Œå†™å¼‚æ­¥ä»»åŠ¡çš„ä»£ç </span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">å¼€å§‹æ‰§è¡Œä»»åŠ¡</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>taskNumber<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ä»»åŠ¡</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>taskNumber<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">æ‰§è¡Œå®Œæ¯•</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">runTasks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">doAsyncTask</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–¹æ³•äºŒï¼šä½¿ç”¨-Promise-å’Œ-reduce-æ–¹æ³•"><a href="#æ–¹æ³•äºŒï¼šä½¿ç”¨-Promise-å’Œ-reduce-æ–¹æ³•" class="headerlink" title="æ–¹æ³•äºŒï¼šä½¿ç”¨ Promise å’Œ reduce æ–¹æ³•"></a>æ–¹æ³•äºŒï¼šä½¿ç”¨ Promise å’Œ reduce æ–¹æ³•</h2><p>è¿™ç§æ–¹æ³•ä½¿ç”¨ Promise å’Œ reduce æ–¹æ³•ï¼Œå°†æ¯ä¸ªå¼‚æ­¥ä»»åŠ¡åŒ…è£…æˆ Promise å®ä¾‹ï¼Œå¹¶ä½¿ç”¨ reduce æ–¹æ³•ä¾æ¬¡æ‰§è¡Œæ¯ä¸ª Promiseã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">sleep</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">delay</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">task</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">now is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>i<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token operator">++</span>i    <span class="token function">resolve</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">[</span>task<span class="token punctuation">,</span> task<span class="token punctuation">,</span> task<span class="token punctuation">,</span> task<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> task</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> prev  <span class="token keyword">return</span> <span class="token function">task</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥è¿™æ ·ç†è§£ prev å’Œ taskï¼š</p><ul><li>prevï¼šå‰ä¸€ä¸ª å¼‚æ­¥ä»»åŠ¡ï¼ˆpromiseï¼‰</li><li>taskï¼šå½“å‰çš„å¼‚æ­¥ä»»åŠ¡</li></ul><p>å½“å‰çš„å¼‚æ­¥ä»»åŠ¡éœ€è¦ä¸Šä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„ç»“æœä½œå‚æ•°ï¼Œæ•…å¾ˆæ˜¾ç„¶è¦ await prevã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•å®å…¸ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
            <tag> javaScript </tag>
            
            <tag> ç¼–ç¨‹é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>systemJS ä½¿ç”¨åŠå…¶åŸç†è§£æŠ›</title>
      <link href="/2023/03/20/systemjs/"/>
      <url>/2023/03/20/systemjs/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æ˜¯ä¸€ä¸ªé€šç”¨çš„æ¨¡å—åŠ è½½å™¨ï¼Œå®ƒèƒ½åœ¨æµè§ˆå™¨ä¸ŠåŠ¨æ€åŠ è½½æ¨¡å—ã€‚å¾®å‰ç«¯çš„æ ¸å¿ƒå°±æ˜¯åŠ è½½å¾®åº”ç”¨ï¼Œæˆ‘ä»¬å°†åº”ç”¨æ‰“åŒ…æˆæ¨¡å—ï¼Œåœ¨æµè§ˆå™¨ä¸­é€šè¿‡ systemJS æ¥åŠ è½½æ¨¡å—ã€‚</p></blockquote><h2 id="1-åŸºæœ¬ä½¿ç”¨"><a href="#1-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="1. åŸºæœ¬ä½¿ç”¨"></a>1. åŸºæœ¬ä½¿ç”¨</h2><h4 id="æ­å»º-react-å¼€å‘ç¯å¢ƒ"><a href="#æ­å»º-react-å¼€å‘ç¯å¢ƒ" class="headerlink" title="æ­å»º react å¼€å‘ç¯å¢ƒ"></a>æ­å»º react å¼€å‘ç¯å¢ƒ</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> init <span class="token parameter variable">-y</span><span class="token function">npm</span> <span class="token function">install</span> webpack webpack-cli webpack-dev-server babel-loader@babel/core @babel/preset-env @babel/preset-react html-webpack-plugin <span class="token parameter variable">-D</span><span class="token function">npm</span> <span class="token function">install</span> react react-dom<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js"></a>webpack.config.js</h4><blockquote><p>å¾®å‰ç«¯çš„å…¬å…±æ¨¡å— å¿…é¡»é‡‡ç”¨ cdn çš„æ–¹å¼</p><p>ç”Ÿäº§æ¨¡å¼ä¸‹éœ€è¦æ‰“åŒ…æˆä¸€ä¸ªæ¨¡å—ç»™åˆ«äººä½¿ç”¨ ä¸ç”¨æ‰“åŒ… index.htmlã€react å’Œ react-dom</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"html-webpack-plugin"</span><span class="token punctuation">)</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">env</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"env=>"</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// 1.ä¸ºäº†æ›´å¥½çš„çœ‹åˆ°æ‰“åŒ…åçš„ä»£ç ï¼Œç»Ÿä¸€è®¾ç½®modeä¸ºå¼€å‘æ¨¡å¼</span>    <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"development"</span><span class="token punctuation">,</span>    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>      <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// 2.æŒ‡å®šç”Ÿäº§æ¨¡å¼ä¸‹é‡‡ç”¨systemjs æ¨¡å—è§„èŒƒ</span>      <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token string">"system"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// 3.ä½¿ç”¨babelè§£æjsæ–‡ä»¶</span>      <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">&#123;</span>          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>          <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">"babel-loader"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>          <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token comment">// 4.ç”Ÿäº§ç¯å¢ƒä¸‹ä¸ç”Ÿæˆhtml</span>      <span class="token operator">!</span>env<span class="token punctuation">.</span>production <span class="token operator">&amp;&amp;</span>        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>          <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">"./public/index.html"</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>Boolean<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">// 5.ç”Ÿäº§ç¯å¢ƒä¸‹ä¸æ‰“åŒ…react,react-domã€‚ï¼ˆè¿™é‡Œä¹Ÿå¯ä»¥æ‰“åŒ…åˆ°å½“å‰é¡¹ç›®ä¸‹å‡å¯ï¼‰</span>    <span class="token literal-property property">externals</span><span class="token operator">:</span> env<span class="token punctuation">.</span>production <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">"react"</span><span class="token punctuation">,</span> <span class="token string">"react-dom"</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token comment">// æ‰“åŒ…çš„æ—¶å€™ 1ï¼‰ è€ƒè™‘å…¬å…±æ¨¡å—æ˜¯å¦è¦æ‰“åŒ…è¿›å»  2ï¼‰ æ‰“åŒ…åçš„èµ„æºå¤§å°</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// æˆ‘ä»¬å°†å­åº”ç”¨ æ‰“åŒ…æˆç±»åº“ï¼Œåœ¨ä¸»åº”ç”¨ä¸­åŠ è½½è¿™ä¸ªåº“ï¼ˆsystemjsï¼‰</span><span class="token comment">// system æ¨¡å—è§„èŒƒ umd amd esModule commonjs</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="babelrc"><a href="#babelrc" class="headerlink" title=".babelrc"></a>.babelrc</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>    <span class="token string-property property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token string">"@babel/preset-react"</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>            <span class="token string-property property">"runtime"</span><span class="token operator">:</span><span class="token string">"automatic"</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">]</span>   <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="src-æ–‡ä»¶"><a href="#src-æ–‡ä»¶" class="headerlink" title="src æ–‡ä»¶"></a>src æ–‡ä»¶</h4><p>App.js</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">Hello, World!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>index.js</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom/client"</span><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"./App"</span><span class="token comment">// æ¸²æŸ“Appç»„ä»¶</span><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‰“åŒ…åçš„ç»“æœ"><a href="#æ‰“åŒ…åçš„ç»“æœ" class="headerlink" title="æ‰“åŒ…åçš„ç»“æœ"></a>æ‰“åŒ…åçš„ç»“æœ</h4><p>dist/index.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">System<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"react-dom"</span><span class="token punctuation">,</span><span class="token string">"react"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="æµè§ˆå™¨åŠ è½½æ¨¡å—-dist-index-html"><a href="#æµè§ˆå™¨åŠ è½½æ¨¡å—-dist-index-html" class="headerlink" title="æµè§ˆå™¨åŠ è½½æ¨¡å—(dist/index.html)"></a>æµè§ˆå™¨åŠ è½½æ¨¡å—(dist/index.html)</h4><blockquote><p>systemjs-importmap å…¬å…±èµ„æºé…ç½®</p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>systemJS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">defer</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    ä¸»åº”ç”¨ - åŸºåº§ - ç”¨æ¥åŠ è½½å­åº”ç”¨çš„ webpack importMap    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>systemjs-importmap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">          <span class="token punctuation">&#123;</span>              <span class="token string-property property">"import"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>                  react<span class="token string">":"</span><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>bootcdn<span class="token punctuation">.</span>net<span class="token operator">/</span>ajax<span class="token operator">/</span>libs<span class="token operator">/</span>react<span class="token operator">/</span><span class="token number">17.0</span><span class="token number">.2</span><span class="token operator">/</span>umd<span class="token operator">/</span>react<span class="token punctuation">.</span>pro      duction<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js"<span class="token punctuation">,</span>                  <span class="token string-property property">"react-dom"</span><span class="token operator">:</span>"https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cdn<span class="token punctuation">.</span>bootcdn<span class="token punctuation">.</span>net<span class="token operator">/</span>ajax<span class="token operator">/</span>libs<span class="token operator">/</span>react<span class="token operator">-</span>      dom<span class="token operator">/</span><span class="token number">17.0</span><span class="token number">.2</span><span class="token operator">/</span>umd<span class="token operator">/</span>react<span class="token operator">-</span>dom<span class="token punctuation">.</span>production<span class="token punctuation">.</span>min<span class="token punctuation">.</span>js"              <span class="token punctuation">&#125;</span>          <span class="token punctuation">&#125;</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>root<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.bootcdn.net/ajax/libs/systemjs/6.10.1/system.min.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">      <span class="token comment">// è¡¨ç¤ºå¯ä»¥åŠ¨æ€åŠ è½½æ¨¡å—</span>      <span class="token comment">//åŠ è½½æ¨¡å—çš„æ—¶å€™ä¼šæç¤ºåŠ è½½reactå’Œreact-dom ä¼šè‡ªåŠ¨åœ¨ä¸Šè¾¹åŠ è½½systemjs-importmap ä¸­é…ç½®çš„è¦åŠ è½½çš„æ¨¡å—</span>      <span class="token comment">// å¯ä»¥åŠ è½½è¿œç¨‹è¿æ¥</span>      <span class="token comment">// ç±»ä¼¼AMDçš„å‰ç½®ä¾èµ–  å¼•å…¥index.jsçš„æ—¶å€™éœ€è¦å…ˆåŠ è½½ reactå’Œ react-dom</span>      System<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">"./index.js"</span><span class="token punctuation">)</span>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-æ‰‹åŠ¨å®ç°-system-åŸç†"><a href="#2-æ‰‹åŠ¨å®ç°-system-åŸç†" class="headerlink" title="2. æ‰‹åŠ¨å®ç° system åŸç†"></a>2. æ‰‹åŠ¨å®ç° system åŸç†</h2><ul><li>systemjs æ˜¯å¦‚ä½•å®šä¹‰çš„ å…ˆçœ‹æ‰“åŒ…åçš„ç»“æœ System.register(ä¾èµ–åˆ—è¡¨,åè°ƒå‡½æ•°è¿”å›å€¼ä¸€ä¸ª settersï¼Œexecuteï¼‰</li><li>react , react-dom åŠ è½½åè°ƒç”¨ setters å°†å¯¹åº”çš„ç»“æœèµ‹äºˆç»™ webpack</li><li>è°ƒç”¨æ‰§è¡Œé€»è¾‘ æ‰§è¡Œé¡µé¢æ¸²æŸ“</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> newMapUrl <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">//å­˜å‚¨ä¾èµ–çš„æ¨¡å—åœ°å€</span><span class="token comment">/** * è§£æ importsMap,å°†éœ€è¦æå‰åŠ è½½çš„æ¨¡å—å­˜å‚¨åˆ°newMapUrlå¯¹è±¡ */</span><span class="token keyword">function</span> <span class="token function">processScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>script<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"systemjs-importmap"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> imports <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>script<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token punctuation">.</span>imports      Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>imports<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>newMapUrl<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// åŠ è½½èµ„æº</span><span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span>    script<span class="token punctuation">.</span>src <span class="token operator">=</span> newMapUrl<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">||</span> id <span class="token comment">// æ”¯æŒcdnçš„æŸ¥æ‰¾</span>    script<span class="token punctuation">.</span>async <span class="token operator">=</span> <span class="token boolean">true</span>    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span>    <span class="token comment">// æ­¤æ—¶ä¼šæ‰§è¡Œä»£ç </span>    script<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"load"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> _lastRegister <span class="token operator">=</span> lastRegister      lastRegister <span class="token operator">=</span> <span class="token keyword">undefined</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>_lastRegister<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 1ï¼‰å…ˆä¿å­˜windowä¸Šçš„å±æ€§</span><span class="token keyword">function</span> <span class="token function">saveGlobalProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">saveGlobalProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">getLastGlobalProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// çœ‹ä¸‹windowä¸Šæ–°å¢çš„å±æ€§</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> window<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">continue</span>    set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span>    <span class="token keyword">return</span> window<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token comment">// æˆ‘é€šè¿‡scriptæ–°å¢çš„å˜é‡</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> lastRegister<span class="token keyword">class</span> <span class="token class-name">SystemJs</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¿™ä¸ªidåŸåˆ™ä¸Šå¯ä»¥æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹è·¯å¾„cdn</span>  <span class="token keyword">import</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">processScripts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 1ï¼‰å»å½“å‰è·¯å¾„æŸ¥æ‰¾ å¯¹åº”çš„èµ„æº ./index.js</span>        <span class="token keyword">const</span> lastSepIndex <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>        <span class="token keyword">const</span> baseURL <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lastSepIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"./"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> baseURL <span class="token operator">+</span> id<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// http  https</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// æ ¹æ®æ–‡ä»¶çš„è·¯å¾„ æ¥åŠ è½½èµ„æº</span>        <span class="token keyword">let</span> execute        <span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">register</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> setters<span class="token punctuation">,</span> <span class="token literal-property property">execute</span><span class="token operator">:</span> exe <span class="token punctuation">&#125;</span> <span class="token operator">=</span> register<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            execute <span class="token operator">=</span> exe            <span class="token comment">// execute æ˜¯çœŸæ­£æ‰§è¡Œçš„æ¸²æŸ“é€»è¾‘</span>            <span class="token comment">// setters æ˜¯ç”¨æ¥ä¿å­˜åŠ è½½åçš„èµ„æºï¼ŒåŠ è½½èµ„æºè°ƒç”¨setters</span>            <span class="token comment">//    console.log(setters,execute)</span>            <span class="token keyword">return</span> <span class="token punctuation">[</span>register<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> setters<span class="token punctuation">]</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>registeration<span class="token punctuation">,</span> setters<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>              registeration<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dep<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token function">load</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>                  <span class="token keyword">const</span> property <span class="token operator">=</span> <span class="token function">getLastGlobalProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                  <span class="token comment">// åŠ è½½å®Œæ¯•åï¼Œä¼šåœ¨windowä¸Šå¢æ·»å±æ€§ window.React window.ReactDOM</span>                  setters<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span>                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>                <span class="token comment">// æ‹¿åˆ°çš„æ˜¯å‡½æ•°ï¼ŒåŠ è½½èµ„æº å°†åŠ è½½åçš„æ¨¡å—ä¼ é€’ç»™è¿™ä¸ªsetter</span>              <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token function">register</span><span class="token punctuation">(</span><span class="token parameter">deps<span class="token punctuation">,</span> declare</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°†å›è°ƒçš„ç»“æœä¿å­˜èµ·æ¥</span>    lastRegister <span class="token operator">=</span> <span class="token punctuation">[</span>deps<span class="token punctuation">,</span> declare<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> System <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SystemJs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li><p>è°ƒç”¨ System.import(â€œ./index.jsâ€)å¼€å§‹åŠ è½½</p></li><li><p>è§£æ importmap èµ„æºæ˜ å°„è¡¨</p></li><li><p>æ ¹æ®åŠ è½½çš„æ–‡ä»¶è·å–è¦åŠ è½½èµ„æºçš„ç»å¯¹è·¯å¾„</p></li><li><p>ä½¿ç”¨ JSONP åŠ è½½èµ„æº</p></li><li><p>æ‰§è¡ŒåŠ è½½åçš„ä»£ç ï¼Œè°ƒç”¨<code>System.register(deps,declareï¼‰</code>æ–¹æ³•</p></li><li><p>å°†å›è°ƒçš„ç»“æœä¿å­˜èµ·æ¥, <code>lastRegister = [deps, declare]</code>ï¼Œå›ä¼ ç»™ import æ–¹æ³•</p></li><li><p>æ‰§è¡Œ register ç¬¬äºŒä¸ªå‚æ•° è·å– setters å’Œ execute å±æ€§</p><ol><li>setters æ˜¯ç”¨æ¥ä¿å­˜åŠ è½½åçš„èµ„æºï¼ŒåŠ è½½èµ„æºè°ƒç”¨ setters</li><li>execute æ˜¯çœŸæ­£æ‰§è¡Œçš„æ¸²æŸ“é€»è¾‘</li></ol></li><li><p>åŠ è½½ register çš„æå‰æ³¨å†Œçš„æ¨¡å—ï¼ŒåŠ è½½å®Œæˆåä¼šåœ¨ window ä¸Šå¢æ·»å…¨å±€å±æ€§</p></li><li><p>è·å– window ä¸Šæœ€åæ·»åŠ çš„æ˜¯å±æ€§ï¼ˆå¿«ç…§çš„æ–¹å¼ï¼šå…ˆå–ä¸€æ¬¡ï¼Œå†å–ä¸€æ¬¡ï¼‰</p></li><li><p>éƒ½åŠ è½½å®Œæ‰§è¡Œ execute æ˜¯çœŸæ­£æ‰§è¡Œçš„æ¸²æŸ“é€»è¾‘</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆéœ€è¦å¾®å‰ç«¯ï¼Ÿ</title>
      <link href="/2023/03/20/wei-qian-duan/"/>
      <url>/2023/03/20/wei-qian-duan/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¾®å‰ç«¯å°±æ˜¯å°†ä¸åŒçš„åŠŸèƒ½æŒ‰ç…§ä¸åŒçš„ç»´åº¦æ‹†åˆ†æˆå¤šä¸ªå­åº”ç”¨ã€‚é€šè¿‡ä¸»åº”ç”¨æ¥åŠ è½½è¿™äº›å­åº” ç”¨ã€‚</p></blockquote><p><strong>å¾®å‰ç«¯çš„æ ¸å¿ƒåœ¨äºæ‹†, æ‹†å®Œååœ¨åˆï¼Œå®ç°åˆ†è€Œæ²»ä¹‹ï¼</strong></p><h3 id="1-å¾®å‰ç«¯è§£å†³çš„é—®é¢˜"><a href="#1-å¾®å‰ç«¯è§£å†³çš„é—®é¢˜" class="headerlink" title="1. å¾®å‰ç«¯è§£å†³çš„é—®é¢˜"></a>1. å¾®å‰ç«¯è§£å†³çš„é—®é¢˜</h3><ol><li>ä¸åŒå›¢é˜Ÿï¼ˆæŠ€æœ¯æ ˆä¸åŒï¼‰ï¼ŒåŒæ—¶å¼€å‘ä¸€ä¸ªåº”ç”¨</li><li>æ¯ä¸ªå›¢é˜Ÿå¼€å‘çš„æ¨¡å—éƒ½å¯ä»¥ç‹¬ç«‹å¼€å‘ï¼Œç‹¬ç«‹éƒ¨ç½²</li><li>å®ç°å¢é‡è¿ç§»</li></ol><h3 id="2-å¦‚ä½•å®ç°å¾®å‰ç«¯"><a href="#2-å¦‚ä½•å®ç°å¾®å‰ç«¯" class="headerlink" title="**2.**å¦‚ä½•å®ç°å¾®å‰ç«¯"></a>**2.**å¦‚ä½•å®ç°å¾®å‰ç«¯</h3><p>æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªåº”ç”¨åˆ’åˆ†æˆè‹¥å¹²ä¸ªå­åº”ç”¨ï¼Œå°†å­åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªä¸ªçš„æ¨¡å—ã€‚å½“è·¯å¾„åˆ‡æ¢æ—¶åŠ è½½ä¸åŒ</p><p>çš„å­åº”ç”¨ã€‚è¿™æ ·æ¯ä¸ªå­åº”ç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæŠ€æœ¯æ ˆä¹Ÿä¸ç”¨åšé™åˆ¶äº†ï¼</p><p><strong>ä»è€Œè§£å†³äº†å‰ç«¯ååŒå¼€å‘é—®é¢˜</strong></p><h3 id="3-å®ç°å¾®å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ"><a href="#3-å®ç°å¾®å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ" class="headerlink" title="**3.**å®ç°å¾®å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ"></a>**3.**å®ç°å¾®å‰ç«¯æŠ€æœ¯æ–¹æ¡ˆ</h3><ul><li><p>é‡‡ç”¨ä½•ç§æ–¹æ¡ˆè¿›è¡Œåº”ç”¨æ‹†åˆ†ï¼Ÿ</p></li><li><p>é‡‡ç”¨ä½•ç§æ–¹å¼è¿›è¡Œåº”ç”¨é€šä¿¡ï¼Ÿ</p></li><li><p>åº”ç”¨ä¹‹é—´å¦‚ä½•è¿›è¡Œéš”ç¦»ï¼Ÿ</p></li></ul><h4 id="3-1-iframe"><a href="#3-1-iframe" class="headerlink" title="3.1 iframe"></a>3.1 iframe</h4><ul><li><p>å¾®å‰ç«¯çš„æœ€ç®€å•æ–¹æ¡ˆï¼Œé€šè¿‡ iframe åŠ è½½å­åº”ç”¨ã€‚</p></li><li><p>é€šä¿¡å¯ä»¥é€šè¿‡ postMessage è¿›è¡Œé€šä¿¡ã€‚</p></li><li><p>å®Œç¾çš„æ²™ç®±æœºåˆ¶è‡ªå¸¦åº”ç”¨éš”ç¦»ã€‚</p></li></ul><blockquote><p><em>ç¼ºç‚¹ï¼šç”¨æˆ·ä½“éªŒå·® ï¼ˆå¼¹æ¡†åªèƒ½åœ¨<strong>iframe</strong>ä¸­ã€åœ¨å†…éƒ¨åˆ‡æ¢åˆ·æ–°å°±ä¼šä¸¢å¤±çŠ¶æ€ï¼‰</em></p></blockquote><h4 id="3-2-Web-Components"><a href="#3-2-Web-Components" class="headerlink" title="3.2 Web Components"></a>3.2 Web Components</h4><ul><li>å°†å‰ç«¯åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºè‡ªå®šä¹‰ HTML å…ƒç´ ã€‚</li><li>åŸºäº CustomEvent å®ç°é€šä¿¡</li><li>Shadow DOM å¤©ç”Ÿçš„ä½œç”¨åŸŸéš”ç¦»</li></ul><blockquote><p>_ç¼ºç‚¹ï¼šæµè§ˆå™¨æ”¯æŒé—®é¢˜ã€å­¦ä¹ æˆæœ¬ã€è°ƒè¯•å›°éš¾ã€ä¿®æ”¹æ ·å¼å›°éš¾ç­‰é—®é¢˜_ã€‚</p></blockquote><h4 id="3-3-single-spa"><a href="#3-3-single-spa" class="headerlink" title="3.3 single-spa"></a><strong>3.3 single-spa</strong></h4><ul><li>single-spa é€šè¿‡è·¯ç”±åŠ«æŒå®ç°åº”ç”¨çš„åŠ è½½ï¼ˆé‡‡ç”¨ SystemJSï¼‰ï¼Œæä¾›åº”ç”¨é—´å…¬å…±ç»„ä»¶åŠ è½½åŠ</li></ul><p>å…¬å…±ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚å­åº”ç”¨éœ€è¦æš´éœ²å›ºå®šçš„é’©å­ <strong>bootstrap</strong>ã€<strong>mount</strong>ã€ <strong>unmount</strong>ï¼‰æ¥å…¥å</p><p>è®®ã€‚</p><ul><li><p>åŸºäº props ä¸»å­åº”ç”¨é—´é€šä¿¡</p></li><li><p>æ— æ²™ç®±æœºåˆ¶ï¼Œéœ€è¦å®ç°è‡ªå·±å®ç° JS æ²™ç®±ä»¥åŠ CSS æ²™ç®±</p></li></ul><blockquote><p>ç¼ºç‚¹ï¼šå­¦ä¹ æˆæœ¬ã€æ— æ²™ç®±æœºåˆ¶ã€éœ€è¦å¯¹åŸæœ‰çš„åº”ç”¨è¿›è¡Œæ”¹é€ ã€å­åº”ç”¨é—´ç›¸åŒèµ„æºé‡å¤åŠ è½½é—®é¢˜ã€‚</p></blockquote><h4 id="3-4-qiankun"><a href="#3-4-qiankun" class="headerlink" title="3.4 qiankun"></a>3.4 qiankun</h4><ul><li>2019 å¹´ qiankun åŸºäº single-spaï¼Œæä¾›äº†å¼€ç®±å³ç”¨çš„ apiï¼ˆsingle-spa + sanbox + import-html-entryï¼‰</li><li>åšåˆ°äº† æŠ€æœ¯æ ˆæ— å…³ã€å¹¶ä¸”æ¥å…¥ç®€å•</li><li>å®ç°äº†æ ·å¼éš”ç¦»å’Œ js éš”ç¦»</li></ul><h4 id="3-5-Module-federation"><a href="#3-5-Module-federation" class="headerlink" title="3.5 Module federation"></a>3.5 Module federation</h4><ul><li><p>é€šè¿‡æ¨¡å—è”é‚¦å°†ç»„ä»¶è¿›è¡Œæ‰“åŒ…å¯¼å‡ºä½¿ç”¨</p></li><li><p>å…±äº«æ¨¡å—çš„æ–¹å¼è¿›è¡Œé€šä¿¡</p></li></ul><blockquote><p>æ—  CSS æ²™ç®±å’Œ JS æ²™ç®±<em>ç¼ºç‚¹ï¼šéœ€è¦<strong>webpack5</strong>ã€‚</em></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®å‰ç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webpack ç¼–è¯‘æµç¨‹</title>
      <link href="/2023/03/20/webpackflow/"/>
      <url>/2023/03/20/webpackflow/</url>
      
        <content type="html"><![CDATA[<h2 id="webpack-ç¼–è¯‘æµç¨‹"><a href="#webpack-ç¼–è¯‘æµç¨‹" class="headerlink" title="webpack ç¼–è¯‘æµç¨‹"></a>webpack ç¼–è¯‘æµç¨‹</h2><ol><li>åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶å‚æ•°,å¾—å‡ºæœ€ç»ˆçš„é…ç½®å¯¹è±¡</li><li>ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compiler å¯¹è±¡</li><li>åŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶</li><li>æ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘</li><li>æ ¹æ®é…ç½®ä¸­çš„<code>entry</code>æ‰¾å‡ºå…¥å£æ–‡ä»¶</li><li>ä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„<code>Loader</code>å¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘</li><li>å†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†</li><li>æ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunk</li><li>å†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨</li><li>åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ</li></ol><blockquote><p>åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¹¿æ’­å‡ºç‰¹å®šçš„äº‹ä»¶ï¼Œæ’ä»¶åœ¨ç›‘å¬åˆ°æ„Ÿå…´è¶£çš„äº‹ä»¶åä¼šæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¹¶ä¸”æ’ä»¶å¯ä»¥è°ƒç”¨ Webpack æä¾›çš„ API æ”¹å˜ Webpack çš„è¿è¡Œç»“æœ</p></blockquote><p><img src="https://raw.githubusercontent.com/ghx9908/image-hosting/master/img/20230302105130.png"></p><h3 id="1-1entry"><a href="#1-1entry" class="headerlink" title="1.1entry"></a>1.1entry</h3><p>src\entry1.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./title"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"entry12"</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>src\entry2.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./title.js"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"entry2"</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>src\title.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">"title"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-2loader-js"><a href="#1-2loader-js" class="headerlink" title="1.2loader.js"></a>1.2loader.js</h3><ul><li><p>loader çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç”¨äºè½¬æ¢æˆ–è€…è¯´ç¿»è¯‘çš„å‡½æ•°</p></li><li><p>æŠŠé‚£äº› webpack ä¸è®¤è¯†çš„æ¨¡å— less sass baxx è½¬æ¢ä¸º webpack èƒ½è®¤è¯†çš„æ¨¡å— js json</p></li></ul><p>loaders\logger1-loader.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loader1</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//let name= 'entry1';</span>  <span class="token keyword">return</span> source <span class="token operator">+</span> <span class="token string">"//logger1"</span> <span class="token comment">//let name= 'entry1';//logger1</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>loaders\logger2-loader.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">loader2</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//let name= 'entry1';</span>  <span class="token keyword">return</span> source <span class="token operator">+</span> <span class="token string">"//logger2"</span> <span class="token comment">//let name= 'entry1';//logger2</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-plugin-js"><a href="#1-3-plugin-js" class="headerlink" title="1.3 plugin.js"></a>1.3 plugin.js</h3><p>plugins\done-plugin.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">DonePlugin</span> <span class="token punctuation">&#123;</span>  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">"DonePlugin"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"done:ç»“æŸç¼–è¯‘"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DonePlugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>plugins\run1-plugin.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">RunPlugin</span> <span class="token punctuation">&#123;</span>  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åœ¨æ­¤æ’ä»¶é‡Œå¯ä»¥ç›‘å¬runè¿™ä¸ªé’©å­</span>    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">"Run1Plugin"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"run1:å¼€å§‹ç¼–è¯‘"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> RunPlugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>plugins\run2-plugin.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">RunPlugin</span> <span class="token punctuation">&#123;</span>  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>run<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">"Run2Plugin"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"run2:å¼€å§‹ç¼–è¯‘"</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> RunPlugin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-4-webpack-config-js"><a href="#1-4-webpack-config-js" class="headerlink" title="1.4 webpack.config.js"></a>1.4 webpack.config.js</h3><p>webpack.config.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token keyword">const</span> Run1Plugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./plugins/run1-plugin"</span><span class="token punctuation">)</span><span class="token keyword">const</span> Run2Plugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./plugins/run2-plugin"</span><span class="token punctuation">)</span><span class="token keyword">const</span> DonePlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./plugins/done-plugin"</span><span class="token punctuation">)</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">"development"</span><span class="token punctuation">,</span>  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token literal-property property">context</span><span class="token operator">:</span> process<span class="token punctuation">.</span>cwd<span class="token punctuation">,</span>  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">entry1</span><span class="token operator">:</span> <span class="token string">"./src/entry1.js"</span><span class="token punctuation">,</span>    <span class="token literal-property property">entry2</span><span class="token operator">:</span> <span class="token string">"./src/entry2.js"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[name].js"</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">".js"</span><span class="token punctuation">,</span> <span class="token string">".jsx"</span><span class="token punctuation">,</span> <span class="token string">".tx"</span><span class="token punctuation">,</span> <span class="token string">".tsx"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"loaders/loader2.js"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"loaders/loader1.js"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">DonePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Run2Plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Run1Plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-5debugger-js"><a href="#1-5debugger-js" class="headerlink" title="1.5debugger.js"></a>1.5debugger.js</h3><p>debugger.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./webpack2"</span><span class="token punctuation">)</span><span class="token comment">// const webpack = require("webpack")</span><span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./webpack.config"</span><span class="token punctuation">)</span><span class="token keyword">debugger</span><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">)</span><span class="token comment">//4.æ‰§è¡Œ`Compiler`å¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘</span>compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//statsä»£è¡¨ç»Ÿè®¡ç»“æœå¯¹è±¡</span>    <span class="token keyword">const</span> statsJson <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>      stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>        <span class="token comment">// files: true, //ä»£è¡¨æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶</span>        <span class="token literal-property property">assets</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//å…¶å®æ˜¯ä¸€ä¸ªä»£ç å—åˆ°æ–‡ä»¶çš„å¯¹åº”å…³ç³»</span>        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//ä»å…¥å£æ¨¡å—å‡ºå‘ï¼Œæ‰¾åˆ°æ­¤å…¥å£æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œæˆ–è€…ä¾èµ–çš„æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œåˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªä»£ç å—</span>        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//æ‰“åŒ…çš„æ¨¡å— æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span>    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">"./statsJson.json"</span><span class="token punctuation">,</span> statsJson<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-6-webpack-js"><a href="#1-6-webpack-js" class="headerlink" title="1.6 webpack.js"></a>1.6 webpack.js</h3><p>webpack2.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> Compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./Compiler"</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 1.åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶å‚æ•°,å¾—å‡ºæœ€ç»ˆçš„é…ç½®å¯¹è±¡</span>  <span class="token comment">//argv[0]æ˜¯Nodeç¨‹åºçš„ç»å¯¹è·¯å¾„ argv[1] æ­£åœ¨è¿è¡Œçš„è„šæœ¬</span>  <span class="token comment">// node debugger --mode=production</span>  <span class="token keyword">const</span> argv <span class="token operator">=</span> process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> shellOptions <span class="token operator">=</span> argv<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">shellOptions<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">// options = '--mode=development'</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> value<span class="token punctuation">]</span> <span class="token operator">=</span> options<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>    shellOptions<span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> value    <span class="token keyword">return</span> shellOptions  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"shellOptions=>"</span><span class="token punctuation">,</span> shellOptions<span class="token punctuation">)</span>  <span class="token keyword">const</span> finalOptions <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token operator">...</span>options<span class="token punctuation">,</span> <span class="token operator">...</span>shellOptions <span class="token punctuation">&#125;</span>  <span class="token comment">//2.ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– `Compiler` å¯¹è±¡</span>  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>finalOptions<span class="token punctuation">)</span>  <span class="token comment">//3.åŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> plugins <span class="token punctuation">&#125;</span> <span class="token operator">=</span> finalOptions  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> plugin <span class="token keyword">of</span> plugins<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//è®¢é˜…é’©å­</span>    <span class="token function">plugin</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> compiler<span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> webpack<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-7-Compilation"><a href="#1-7-Compilation" class="headerlink" title="1.7 Compilation"></a>1.7 Compilation</h3><p>Compiler.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> SyncHook <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"tapable"</span><span class="token punctuation">)</span><span class="token keyword">const</span> Compilation <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./Compilation"</span><span class="token punctuation">)</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token comment">// Compiler æ¨¡å—æ˜¯ webpack çš„ä¸»è¦å¼•æ“</span><span class="token keyword">class</span> <span class="token class-name">Compiler</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//åœ¨å¼€å§‹ç¼–è¯‘ä¹‹å‰è°ƒç”¨</span>      <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//åœ¨ç¼–è¯‘å®Œæˆæ—¶æ‰§è¡Œ</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">run</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//åœ¨ç¼–è¯‘å¼€å§‹å‰è§¦å‘runé’©å­æ‰§è¡Œ</span>    <span class="token comment">//åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ä¼šæ”¶é›†æ‰€æœ‰çš„ä¾èµ–çš„æ¨¡å—æˆ–è€…è¯´æ–‡ä»¶</span>    <span class="token comment">//statsæŒ‡çš„æ˜¯ç»Ÿè®¡ä¿¡æ¯ modules chunks  files=bundle assetsæŒ‡çš„æ˜¯æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹çš„æ˜ å°„å…³ç³»</span>    <span class="token keyword">const</span> <span class="token function-variable function">onCompiled</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats<span class="token punctuation">,</span> fileDependencies</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">// 10.åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> filename <span class="token keyword">in</span> stats<span class="token punctuation">.</span>assets<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span> filename<span class="token punctuation">)</span>        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> stats<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>filename<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>      <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token function-variable function">toJson</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> stats <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fileDependency <span class="token keyword">of</span> fileDependencies<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//ç›‘å¬ä¾èµ–çš„æ–‡ä»¶å˜åŒ–ï¼Œå¦‚æœä¾èµ–çš„æ–‡ä»¶å˜åŒ–åä¼šå¼€å§‹ä¸€æ¬¡æ–°çš„ç¼–è¯‘</span>        fs<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>fileDependency<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>onCompiled<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//åœ¨ç¼–è¯‘å®Œæˆæ—¶è§¦å‘doneé’©å­æ‰§è¡Œ</span>    <span class="token comment">//è°ƒç”¨compileæ–¹æ³•è¿›è¡Œç¼–è¯‘  å¼€å§‹ä¸€æ¬¡æ–°çš„ç¼–è¯‘</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">(</span>onCompiled<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//å¼€å¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘</span>  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ¯æ¬¡ç¼–è¯‘ éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Compilationå®ä¾‹</span>    <span class="token keyword">let</span> compilation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compilation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>    compilation<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-8-Compilation"><a href="#1-8-Compilation" class="headerlink" title="1.8 Compilation"></a>1.8 Compilation</h3><p>Compilation.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@babel/parser"</span><span class="token punctuation">)</span><span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@babel/types"</span><span class="token punctuation">)</span><span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@babel/traverse"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@babel/generator"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token keyword">const</span> baseDir <span class="token operator">=</span> <span class="token function">normalizePath</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">normalizePath</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">Compilation</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token punctuation">,</span> compiler</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>options <span class="token operator">=</span> options <span class="token comment">// é…ç½®å‚æ•°</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>context <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>context <span class="token operator">||</span> <span class="token function">normalizePath</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>compiler <span class="token operator">=</span> compiler    <span class="token keyword">this</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//è¿™é‡Œæ”¾ç½®æœ¬æ¬¡ç¼–è¯‘æ¶‰åŠçš„æ‰€æœ‰çš„æ¨¡å—</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//æœ¬æ¬¡ç¼–è¯‘æ‰€ç»„è£…å‡ºçš„ä»£ç å—</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>assets <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// å­˜æ”¾è¾“å‡ºçš„æ–‡ä»¶ keyæ˜¯æ–‡ä»¶å,å€¼æ˜¯æ–‡ä»¶å†…å®¹</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>files <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//ä»£è¡¨æœ¬æ¬¡æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>fileDependencies <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//æœ¬æ¬¡ç¼–è¯‘ä¾èµ–çš„æ–‡ä»¶æˆ–è€…è¯´æ¨¡å—</span>  <span class="token punctuation">&#125;</span>  <span class="token function">build</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//5.æ ¹æ®é…ç½®ä¸­çš„entryæ‰¾å‡ºå…¥å£æ–‡ä»¶</span>    <span class="token keyword">let</span> entry <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">//æ ¼å¼åŒ–å…¥å£æ–‡ä»¶</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>entry <span class="token operator">===</span> <span class="token string">"string"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      entry<span class="token punctuation">.</span>main <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>entry    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      entry <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>entry    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¯¹å…¥å£è¿›è¡Œéå†</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> entryName <span class="token keyword">in</span> entry<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//è·å–å…¥å£æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</span>      <span class="token keyword">let</span> entryFilePath <span class="token operator">=</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> entry<span class="token punctuation">[</span>entryName<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment">//æŠŠæ­¤å…¥å£æ–‡ä»¶æ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ä¸­</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>fileDependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entryFilePath<span class="token punctuation">)</span>      <span class="token comment">//6.ä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„Loaderå¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘</span>      <span class="token keyword">let</span> entryModule <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> entryFilePath<span class="token punctuation">)</span>      <span class="token comment">// this.modules.push(entryModule)</span>      <span class="token comment">// 8.æ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunk</span>      <span class="token keyword">let</span> chunk <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">name</span><span class="token operator">:</span> entryName<span class="token punctuation">,</span> <span class="token comment">//å…¥å£åç§°</span>        entryModule<span class="token punctuation">,</span> <span class="token comment">//å…¥å£çš„æ¨¡å— ./src/entry.js</span>        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> module<span class="token punctuation">.</span>names<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>entryName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//æ­¤å…¥å£å¯¹åº”çš„æ¨¡å—</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// 9.å†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> filename <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>output<span class="token punctuation">.</span>filename<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"[name]"</span><span class="token punctuation">,</span> chunk<span class="token punctuation">.</span>name<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>      <span class="token comment">//ç»„è£…chunk</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">[</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getSource</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token function">callback</span><span class="token punctuation">(</span>      <span class="token keyword">null</span><span class="token punctuation">,</span>      <span class="token punctuation">&#123;</span>        <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">,</span>        <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span>        <span class="token literal-property property">assets</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>assets<span class="token punctuation">,</span>        <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>files<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>fileDependencies    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">/**   * ç¼–è¯‘æ¨¡å—   * @param &#123;*&#125; name æ¨¡å—æ‰€å±çš„ä»£ç å—(chunk)çš„åç§°ï¼Œä¹Ÿå°±æ˜¯entryçš„name entry1 entry2   * @param &#123;*&#125; modulePath æ¨¡å—çš„ç»å¯¹è·¯å¾„   */</span>  <span class="token function">buildModule</span><span class="token punctuation">(</span><span class="token parameter">entryName<span class="token punctuation">,</span> modulePath</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1.è¯»å–æ–‡ä»¶çš„å†…å®¹</span>    <span class="token keyword">let</span> rawSourceCode <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span> <span class="token string">"utf8"</span><span class="token punctuation">)</span>    <span class="token comment">//è·å–loaderçš„é…ç½®è§„åˆ™</span>    <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> rules <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>module    <span class="token comment">//æ ¹æ®è§„åˆ™æ‰¾åˆ°æ‰€æœ‰çš„åŒ¹é…çš„loader é€‚ç”¨äºæ­¤æ¨¡å—çš„æ‰€æœ‰loader</span>    <span class="token keyword">let</span> loaders <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    rules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">rule</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">//ç”¨æ¨¡å—è·¯å¾„åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>modulePath<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>rule<span class="token punctuation">.</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        loaders<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">...</span>rule<span class="token punctuation">.</span>use<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">//è°ƒç”¨æ‰€æœ‰é…ç½®çš„Loaderå¯¹æ¨¡å—è¿›è¡Œè½¬æ¢</span>    <span class="token keyword">let</span> transformedSourceCode <span class="token operator">=</span> loaders<span class="token punctuation">.</span><span class="token function">reduceRight</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">sourceCode<span class="token punctuation">,</span> loaderPath</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> loaderFn <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>loaderPath<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token function">loaderFn</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> rawSourceCode<span class="token punctuation">)</span>    <span class="token comment">//7.å†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†</span>    <span class="token comment">//è·å–å½“å‰æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯ ./src/entry1.jsçš„æ¨¡å—ID</span>    <span class="token keyword">let</span> moduleId <span class="token operator">=</span> <span class="token string">"./"</span> <span class="token operator">+</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span>    <span class="token comment">//åˆ›å»ºä¸€ä¸ªæ¨¡å—IDå°±æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ dependencieså°±æ˜¯æ­¤æ¨¡å—ä¾èµ–çš„æ¨¡å—</span>    <span class="token comment">//nameæ˜¯æ¨¡å—æ‰€å±çš„ä»£ç å—çš„åç§°,å¦‚æœä¸€ä¸ªæ¨¡å—å±äºå¤šä¸ªä»£ç å—ï¼Œé‚£ä¹ˆnameå°±æ˜¯ä¸€ä¸ªæ•°ç»„</span>    <span class="token keyword">let</span> module <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">id</span><span class="token operator">:</span> moduleId<span class="token punctuation">,</span> <span class="token literal-property property">dependencies</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">names</span><span class="token operator">:</span> <span class="token punctuation">[</span>entryName<span class="token punctuation">]</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>module<span class="token punctuation">)</span>    <span class="token keyword">let</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>transformedSourceCode<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">//Visitoræ˜¯babelæ’ä»¶ä¸­çš„æ¦‚å¿µï¼Œæ­¤å¤„æ²¡æœ‰</span>    <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token function-variable function">CallExpression</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> node <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">//å¦‚æœè°ƒç”¨çš„æ–¹æ³•åæ˜¯requireçš„è¯ï¼Œè¯´æ˜å°±è¦ä¾èµ–ä¸€ä¸ªå…¶å®ƒæ¨¡å—</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">"require"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token comment">// .ä»£è¡¨å½“å‰çš„æ¨¡å—æ‰€æœ‰çš„ç›®å½•ï¼Œä¸æ˜¯å·¥ä½œç›®å½•</span>          <span class="token keyword">let</span> depModuleName <span class="token operator">=</span> node<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token comment">//"./title"</span>          <span class="token keyword">let</span> depModulePath          <span class="token comment">//è·å–å½“å‰çš„æ¨¡å—æ‰€åœ¨çš„ç›®å½•</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>depModuleName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//æš‚æ—¶å…ˆä¸è€ƒè™‘node_modulesé‡Œçš„æ¨¡å—ï¼Œå…ˆåªè€ƒè™‘ç›¸å¯¹è·¯å¾„</span>            <span class="token keyword">const</span> currentDir <span class="token operator">=</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>            <span class="token comment">//è¦æ‰¾å½“å‰æ¨¡å—æ‰€æœ‰åœ¨çš„ç›®å½•ä¸‹é¢çš„ç›¸å¯¹è·¯å¾„</span>            depModulePath <span class="token operator">=</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>currentDir<span class="token punctuation">,</span> depModuleName<span class="token punctuation">)</span>            <span class="token comment">//æ­¤ç»å¯¹è·¯å¾„å¯èƒ½æ²¡æœ‰åç»­ï¼Œéœ€è¦å°è¯•æ·»åŠ åç¼€</span>            <span class="token comment">// è·å–é…ç½®çš„æ‰©å±•ååç¼€</span>            <span class="token keyword">const</span> extensions <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>options<span class="token punctuation">.</span>resolve<span class="token punctuation">.</span>extensions            <span class="token comment">//å°è¯•æ·»åŠ åç¼€ è¿”å›æœ€ç»ˆçš„è·¯å¾„</span>            depModulePath <span class="token operator">=</span> <span class="token function">tryExtensions</span><span class="token punctuation">(</span>depModulePath<span class="token punctuation">,</span> extensions<span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token comment">//å¦‚æœä¸æ˜¯ä»¥.å¼€å¤´çš„è¯ï¼Œå°±æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—</span>            depModulePath <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>depModuleName<span class="token punctuation">)</span>          <span class="token punctuation">&#125;</span>          <span class="token comment">//æŠŠä¾èµ–çš„æ¨¡å—è·¯å¾„æ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>fileDependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>depModulePath<span class="token punctuation">)</span>          <span class="token comment">//è·å–æ­¤ä¾èµ–çš„æ¨¡å—çš„ID, ä¹Ÿå°±æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„</span>          <span class="token keyword">let</span> depModuleId <span class="token operator">=</span> <span class="token string">"./"</span> <span class="token operator">+</span> path<span class="token punctuation">.</span>posix<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>baseDir<span class="token punctuation">,</span> depModulePath<span class="token punctuation">)</span>          <span class="token comment">//ä¿®æ”¹è¯­æ³•æ ‘ï¼ŒæŠŠä¾èµ–çš„æ¨¡å—åæ¢æˆæ¨¡å—ID</span>          node<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>depModuleId<span class="token punctuation">)</span>          <span class="token comment">//æŠŠä¾èµ–çš„æ¨¡å—IDå’Œä¾èµ–çš„æ¨¡å—è·¯å¾„æ”¾ç½®åˆ°å½“å‰æ¨¡å—çš„ä¾èµ–æ•°ç»„ä¸­</span>          module<span class="token punctuation">.</span>dependencies<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> depModuleId<span class="token punctuation">,</span> depModulePath <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">//è½¬æ¢æºä»£ç ,æŠŠè½¬æ¢åçš„æºç æ”¾åœ¨_sourceå±æ€§,ç”¨äºåé¢å†™å…¥æ–‡ä»¶</span>    <span class="token keyword">let</span> <span class="token punctuation">&#123;</span> code <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span>    module<span class="token punctuation">.</span>_source <span class="token operator">=</span> code    <span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token operator">...</span>module<span class="token punctuation">.</span>dependencies<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> depModuleId<span class="token punctuation">,</span> depModulePath <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">//åˆ¤æ–­æ­¤ä¾èµ–çš„æ¨¡å—æ˜¯å¦å·²ç»æ‰“åŒ…è¿‡äº†æˆ–è€…è¯´ç¼–è¯‘ è¿‡äº†</span>      <span class="token keyword">let</span> existModule <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> module<span class="token punctuation">.</span>id <span class="token operator">===</span> depModuleId<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>existModule<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        existModule<span class="token punctuation">.</span>names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>entryName<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> depModule <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildModule</span><span class="token punctuation">(</span>entryName<span class="token punctuation">,</span> depModulePath<span class="token punctuation">)</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>depModule<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> module  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * * @param &#123;*&#125; modulePath * @param &#123;*&#125; extensions * @returns */</span><span class="token keyword">function</span> <span class="token function">tryExtensions</span><span class="token punctuation">(</span><span class="token parameter">modulePath<span class="token punctuation">,</span> extensions</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> modulePath  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> extensions<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> filePath <span class="token operator">=</span> modulePath <span class="token operator">+</span> extensions<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> filePath    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">æ‰¾ä¸åˆ°</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>modulePath<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token parameter">chunk</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">  (() => &#123;    var modules = &#123;      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>chunk<span class="token punctuation">.</span>modules        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> module<span class="token punctuation">.</span>id <span class="token operator">!==</span> chunk<span class="token punctuation">.</span>entryModule<span class="token punctuation">.</span>id<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>          <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">          "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>module<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">": module => &#123;            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>module<span class="token punctuation">.</span>_source<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">          &#125;        </span><span class="token template-punctuation string">`</span></span>        <span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">    &#125;;    var cache = &#123;&#125;;    function require(moduleId) &#123;      var cachedModule = cache[moduleId];      if (cachedModule !== undefined) &#123;        return cachedModule.exports;      &#125;      var module = cache[moduleId] = &#123;        exports: &#123;&#125;      &#125;;      modules[moduleId](module, module.exports, require);      return module.exports;    &#125;    var exports = &#123;&#125;;    (() => &#123;      </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>chunk<span class="token punctuation">.</span>entryModule<span class="token punctuation">.</span>_source<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">    &#125;)();  &#125;)();  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compilation<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>webpack2.js</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="1-æ–‡ä»¶ä½œç”¨"><a href="#1-æ–‡ä»¶ä½œç”¨" class="headerlink" title="1. æ–‡ä»¶ä½œç”¨"></a>1. æ–‡ä»¶ä½œç”¨</h3><h4 id="webpack-js-æ–‡ä»¶"><a href="#webpack-js-æ–‡ä»¶" class="headerlink" title="webpack.js æ–‡ä»¶"></a><strong>webpack.js æ–‡ä»¶</strong></h4><p>webpack æ–¹æ³•</p><ol><li>æ¥æ”¶ webpack.config.js å‚æ•°ï¼Œè¿”å› compiler å®ä¾‹</li><li>åˆå§‹åŒ–å‚æ•°</li><li>å§‹åŒ– Compiler å¯¹è±¡å®ä¾‹</li><li>åŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶</li></ol><h4 id="Compileræ–‡ä»¶"><a href="#Compileræ–‡ä»¶" class="headerlink" title="Compileræ–‡ä»¶"></a><strong>Compiler</strong>æ–‡ä»¶</h4><ul><li><p>Compiler æ¨¡å—æ˜¯ <strong>webpack çš„ä¸»è¦å¼•æ“</strong></p></li><li><p><strong>constructor æ–¹æ³•</strong>ï¼š åˆå§‹åŒ–ä¸€äº› hooks</p></li><li><p><strong>run æ–¹æ³•</strong></p><ul><li>æ‰§è¡Œæ’ä»¶è®¢é˜…çš„ä¸€ç³»åˆ— hooks</li><li>åˆ›å»º Compilation å®ä¾‹å¹¶æ‰§è¡Œå®ä¾‹çš„ buildï¼ˆonCompiledï¼‰æ–¹æ³•ï¼ˆå¼€å¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘ï¼‰</li><li>onCompiled å›è°ƒ<ul><li>åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ</li><li>æ‰§è¡Œ compiler.run æ–¹æ³•çš„å›è°ƒï¼Œä¼ å…¥ info</li><li>ç›‘å¬ä¾èµ–çš„æ–‡ä»¶å˜åŒ–ï¼Œå¦‚æœä¾èµ–çš„æ–‡ä»¶å˜åŒ–åä¼šå¼€å§‹ä¸€æ¬¡æ–°çš„ç¼–è¯‘</li></ul></li></ul></li></ul><h4 id="Compilation-æ–‡ä»¶"><a href="#Compilation-æ–‡ä»¶" class="headerlink" title="Compilation æ–‡ä»¶"></a>Compilation æ–‡ä»¶</h4><p><strong>build æ–¹æ³•</strong></p><ol><li>.æ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºå…¥å£æ–‡ä»¶</li><li>ä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘</li><li>å†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†</li><li>æ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunk</li><li>å†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨</li><li>æ‰§è¡ŒæˆåŠŸåçš„å›è°ƒ</li></ol><h3 id="2-æµç¨‹æ€»ç»“"><a href="#2-æµç¨‹æ€»ç»“" class="headerlink" title="2. æµç¨‹æ€»ç»“"></a>2. æµç¨‹æ€»ç»“</h3><h4 id="åˆå§‹åŒ–å‚æ•°ï¼š"><a href="#åˆå§‹åŒ–å‚æ•°ï¼š" class="headerlink" title="åˆå§‹åŒ–å‚æ•°ï¼š"></a><strong>åˆå§‹åŒ–å‚æ•°ï¼š</strong></h4><ol><li><strong>åˆå§‹åŒ–å‚æ•°</strong>ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶å‚æ•°,å¾—å‡ºæœ€ç»ˆçš„é…ç½®å¯¹è±¡ï¼ˆå‘½ä»¤è¡Œä¼˜å…ˆçº§é«˜ï¼‰</li></ol><h4 id="å¼€å§‹ç¼–è¯‘"><a href="#å¼€å§‹ç¼–è¯‘" class="headerlink" title="å¼€å§‹ç¼–è¯‘"></a><strong>å¼€å§‹ç¼–è¯‘</strong></h4><ol start="2"><li><p>ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°<strong>åˆå§‹åŒ– Compiler å¯¹è±¡</strong></p><ol><li>åˆå§‹åŒ– options å‚æ•°å’Œ hooks ï¼ˆ<code> run: new SyncHook()</code>, //åœ¨å¼€å§‹ç¼–è¯‘ä¹‹å‰è°ƒç”¨â€¦ï¼‰</li></ol></li><li><p><strong>åŠ è½½</strong>æ‰€æœ‰é…ç½®çš„<strong>æ’ä»¶</strong>ï¼š</p><ol><li>åœ¨é…ç½®ä¸­æ‰¾åˆ° plugins æ•°ç»„</li><li>éå† plugins æ‰§è¡Œæ¯ä¸ªæ’ä»¶çš„ apply æ–¹æ³•ï¼Œå¹¶æŠŠ compiler å®ä¾‹ä¼ è¿›å»ï¼ˆæ¯ä¸ªæ’ä»¶éƒ½æœ‰ä¸€ä¸ª apply æ–¹æ³•ï¼‰</li><li>æ‰§è¡Œ<code> compiler.hooks.run.tap</code>ç­‰æ–¹æ³•æ³¨å†Œäº‹ä»¶</li></ol></li><li><p><strong>æ‰§è¡Œ</strong><code>compiler</code>å®ä¾‹çš„ <strong>run æ–¹æ³•</strong>å¼€å§‹æ‰§è¡Œç¼–è¯‘</p><ol><li>æ•´ä¸ªè¿‡ç¨‹ä¼´éšç€è§¦å‘æ’ä»¶çš„æ³¨å†Œä¸ªå„ç§é’©å­å‡½æ•°<code> this.hooks.done.call()</code>â€¦</li><li>å¼€å¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ Compilation å®ä¾‹</li><li>æ‰§è¡Œå®ä¾‹çš„ build æ–¹æ³•ï¼Œä¼ å…¥å®Œæˆçš„å›è°ƒ</li></ol></li></ol><h4 id="ç¼–è¯‘æ¨¡å—"><a href="#ç¼–è¯‘æ¨¡å—" class="headerlink" title="ç¼–è¯‘æ¨¡å—"></a><strong>ç¼–è¯‘æ¨¡å—</strong></h4><ol start="5"><li><p>æ ¹æ®é…ç½®ä¸­çš„ entry æ‰¾å‡ºå…¥å£æ–‡ä»¶</p><ol><li>æ ¼å¼åŒ–å…¥å£æ–‡ä»¶ï¼Œå˜æˆå¯¹è±¡å½¢å¼</li><li>å¯¹å…¥å£è¿›è¡Œéå†ï¼Œè·å–å…¥å£æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ï¼Œæ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ä¸­</li></ol></li><li><p><strong>loader è½¬æ¢</strong>ï¼šä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œè½¬æ¢ ï¼ˆæœ€ç»ˆè¿”å› module å¯¹è±¡ï¼‰</p><ol><li><p>è¯»å–å¤„ç†æ–‡ä»¶çš„å†…å®¹</p></li><li><p>æ ¹æ®è§„åˆ™æ‰¾åˆ°æ‰€æœ‰çš„åŒ¹é…çš„ loader</p></li><li><p>è°ƒç”¨æ‰€æœ‰é…ç½®çš„ Loader å¯¹æ¨¡å—è¿›è¡Œè½¬æ¢ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼Œä»å³å‘å·¦ï¼‰</p></li><li><p>è·å–å½“å‰æ¨¡å—æ¨¡å— idï¼Œç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„</p></li><li><p>åˆ›å»ºä¸€ä¸ª module å¯¹è±¡</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> module <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">id</span><span class="token operator">:</span><span class="token string">'./src/entry1.js'</span><span class="token punctuation">,</span><span class="token comment">//ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„</span>     <span class="token literal-property property">dependencies</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token literal-property property">depModuleId</span><span class="token operator">:</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>title<span class="token punctuation">.</span>js<span class="token punctuation">,</span><span class="token literal-property property">depModulePath</span><span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//dependencieså°±æ˜¯æ­¤æ¨¡å—ä¾èµ–çš„æ¨¡å—</span>    <span class="token literal-property property">names</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'entry1'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// nameæ˜¯æ¨¡å—æ‰€å±çš„ä»£ç å—çš„åç§°,å¦‚æœä¸€ä¸ªæ¨¡å—å±äºå¤šä¸ªä»£ç å—ï¼Œé‚£ä¹ˆnameå°±æ˜¯ä¸€ä¸ªæ•°ç»„</span><span class="token number">2.</span>     <span class="token literal-property property">_source</span><span class="token operator">:</span><span class="token string">'xxx'</span><span class="token punctuation">,</span><span class="token comment">//å­˜æ”¾å¯¹åº”çš„æºç </span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li><li><p><strong>ç¼–è¯‘æ¨¡å—åˆ†æä¾èµ–</strong>ï¼Œå†<strong>é€’å½’éå†</strong>æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£<strong>ä¾èµ–æ¨¡å—</strong>çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†</p><ol><li>å°† loader ç¼–è¯‘åçš„ä»£ç è°ƒç”¨ parse è½¬æ¢ä¸º ast</li><li>éå†è¯­æ³•æ ‘ï¼Œå¦‚æœå­˜åœ¨ require æˆ–è€… importï¼Œè¯´æ˜å°±è¦ä¾èµ–ä¸€ä¸ªå…¶å®ƒæ¨¡å—</li><li>è·å–ä¾èµ–æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œæ·»åŠ åˆ°æ–‡ä»¶ä¾èµ–åˆ—è¡¨ä¸­</li><li>è·å–æ­¤ä¾èµ–çš„æ¨¡å—çš„ ID, ä¹Ÿå°±æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„</li><li>ä¿®æ”¹è¯­æ³•æ ‘ï¼ŒæŠŠä¾èµ–çš„æ¨¡å—åæ¢æˆæ¨¡å— ID</li><li>æŠŠä¾èµ–çš„æ¨¡å— ID å’Œä¾èµ–çš„æ¨¡å—è·¯å¾„æ”¾ç½®åˆ°å½“å‰æ¨¡å— module çš„ä¾èµ–æ•°ç»„ä¸­</li><li>è°ƒç”¨ generatorï¼ˆastï¼‰ï¼ŒæŠŠè½¬æ¢åçš„æºç æ”¾åœ¨ module._source å±æ€§,ç”¨äºåé¢å†™å…¥æ–‡ä»¶</li><li>éå†<code>module.dependencies</code>ï¼Œé€’å½’æ„å»º moduleï¼Œæ„å»ºå¥½çš„å­˜å‚¨åˆ° this.modules ä¸Šï¼Œå¦‚æœç¬¬äºŒä¸ªå…¥å£ä¹Ÿä¾èµ–è¯¥æ¨¡å—ï¼Œç›´æ¥å–ç”¨ï¼Œåªéœ€è¦ç»™è¯¥æ¨¡å—çš„ name å±æ€§ä¸Šæ·»åŠ ä¸Šå…¥å£ä¿¡æ¯</li></ol></li></ol><h4 id="è¾“å‡ºèµ„æº"><a href="#è¾“å‡ºèµ„æº" class="headerlink" title="è¾“å‡ºèµ„æº"></a><strong>è¾“å‡ºèµ„æº</strong></h4><ol start="8"><li><p><strong>ç»„è£… chuck å¯¹è±¡ï¼š</strong></p><ol><li>ç»„è£…</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> chuck <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"entry1"</span><span class="token punctuation">,</span> <span class="token comment">//å…¥å£åç§°</span>  entryModule<span class="token punctuation">,</span> <span class="token comment">//å…¥å£çš„æ¨¡å—çš„module &#123;id,name,dependencies,_source&#125;</span>  <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// å…¥å£ä¾èµ–æ¨¡å—çš„é›†åˆ</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><code>this.chunks.push(chunk)</code></li></ol></li></ol><h4 id="ç”Ÿæˆ-bundle-æ–‡ä»¶"><a href="#ç”Ÿæˆ-bundle-æ–‡ä»¶" class="headerlink" title="ç”Ÿæˆ bundle æ–‡ä»¶"></a>ç”Ÿæˆ bundle æ–‡ä»¶</h4><ol start="9"><li>æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨<ol><li>è·å–è¦ç”Ÿæˆçš„æ–‡ä»¶åç§°å¹¶æŠŠæ–‡ä»¶åæ·»åŠ åˆ° this.files ä¸­</li><li>è·å–æ–‡ä»¶å†…å®¹å¹¶ç»™ this.assets å¯¹è±¡</li><li>æ‰§è¡Œ <code>compilation.build</code> æ–¹æ³•çš„å›è°ƒ</li></ol></li></ol><h4 id="å†™å…¥æ–‡ä»¶"><a href="#å†™å…¥æ–‡ä»¶" class="headerlink" title="å†™å…¥æ–‡ä»¶"></a>å†™å…¥æ–‡ä»¶</h4><ol start="10"><li>åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ</li></ol>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CommonJS å’Œ ES Modules</title>
      <link href="/2023/03/20/commonjs-he-esm/"/>
      <url>/2023/03/20/commonjs-he-esm/</url>
      
        <content type="html"><![CDATA[<h3 id="åœ¨ä½¿ç”¨ä¸Šçš„å·®åˆ«ä¸»è¦æœ‰ï¼š"><a href="#åœ¨ä½¿ç”¨ä¸Šçš„å·®åˆ«ä¸»è¦æœ‰ï¼š" class="headerlink" title="åœ¨ä½¿ç”¨ä¸Šçš„å·®åˆ«ä¸»è¦æœ‰ï¼š"></a><strong>åœ¨ä½¿ç”¨ä¸Šçš„å·®åˆ«ä¸»è¦æœ‰ï¼š</strong></h3><ul><li><p><code>CommonJS</code> æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ã€‚</p></li><li><p><code>CommonJS</code> æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼ˆé™æ€ç¼–è¯‘ï¼‰ã€‚</p></li><li><p><code>CommonJs</code> æ˜¯å•ä¸ªå€¼å¯¼å‡ºï¼Œ<code>ES6 Module</code> å¯ä»¥å¯¼å‡ºå¤šä¸ª</p></li><li><p><code>CommonJs</code> æ˜¯åŠ¨æ€è¯­æ³•å¯ä»¥å†™åœ¨åˆ¤æ–­é‡Œï¼Œ<code>ES6 Module</code> é™æ€è¯­æ³•åªèƒ½å†™åœ¨é¡¶å±‚</p></li><li><p><code>CommonJs</code> çš„ <code>this</code> æ˜¯å½“å‰æ¨¡å—ï¼Œ<code>ES6 Module</code> çš„ <code>this</code> æ˜¯ <code>undefined</code></p></li><li><p><code>CommonJS</code>æ˜¯æœåŠ¡å™¨ç«¯æ¨¡å—çš„è§„èŒƒï¼Œ<code>CommonJS</code>è§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„</p></li></ul><p><strong>CommonJS</strong> å’Œ <strong>ES Modules (ESM)</strong> æ˜¯ä¸¤ç§ JavaScript ä¸­çš„æ¨¡å—åŒ–ç³»ç»Ÿï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºæ¨¡å—çš„å®šä¹‰æ–¹å¼ã€åŠ è½½æœºåˆ¶ã€è¯­æ³•å’Œä½¿ç”¨åœºæ™¯ã€‚ä¸‹é¢ä»å¤šä¸ªç»´åº¦æ¥å¯¹æ¯”è¿™ä¸¤è€…çš„åŒºåˆ«ï¼š</p><h3 id="1-æ¨¡å—å®šä¹‰æ–¹å¼å’Œè¯­æ³•"><a href="#1-æ¨¡å—å®šä¹‰æ–¹å¼å’Œè¯­æ³•" class="headerlink" title="1. æ¨¡å—å®šä¹‰æ–¹å¼å’Œè¯­æ³•"></a>1. <strong>æ¨¡å—å®šä¹‰æ–¹å¼å’Œè¯­æ³•</strong></h3><ul><li><p><strong>CommonJS</strong>ï¼šä½¿ç”¨ <code>require</code> è¯­æ³•å¼•å…¥æ¨¡å—ï¼Œç”¨ <code>module.exports</code> æˆ– <code>exports</code> å¯¼å‡ºæ¨¡å—ã€‚CommonJS æ˜¯æ¨¡å—ç³»ç»Ÿçš„æ—©æœŸå®ç°ï¼Œä¸»è¦ç”¨äº Node.js æœåŠ¡å™¨ç«¯å¼€å‘ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å¯¼å‡ºï¼ˆCommonJSï¼‰</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function-variable function">greet</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">// å¯¼å…¥ï¼ˆCommonJSï¼‰</span><span class="token keyword">const</span> myModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./myModule"</span><span class="token punctuation">)</span>myModule<span class="token punctuation">.</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¾“å‡ºï¼šHello World</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>**ES Modules (ESM)**ï¼šä½¿ç”¨ <code>import</code> å’Œ <code>export</code> è¯­æ³•å¯¼å…¥å’Œå¯¼å‡ºæ¨¡å—ã€‚ESM æ˜¯ JavaScript å®˜æ–¹æ ‡å‡†åŒ–çš„æ¨¡å—ç³»ç»Ÿï¼ŒåŸç”Ÿæ”¯æŒæµè§ˆå™¨å’Œ Node.jsã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å¯¼å‡ºï¼ˆES Modulesï¼‰</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// å¯¼å…¥ï¼ˆES Modulesï¼‰</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> greet <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./myModule.js"</span><span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¾“å‡ºï¼šHello World</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="2-åŠ è½½æœºåˆ¶"><a href="#2-åŠ è½½æœºåˆ¶" class="headerlink" title="2. åŠ è½½æœºåˆ¶"></a>2. <strong>åŠ è½½æœºåˆ¶</strong></h3><ul><li><strong>CommonJS</strong>ï¼š<strong>åŒæ­¥åŠ è½½</strong>æ¨¡å—ã€‚è¿™æ„å‘³ç€åœ¨ <code>require</code> è°ƒç”¨æ—¶ï¼ŒNode.js ä¼šç«‹å³æ‰§è¡Œå¹¶è¿”å›æ¨¡å—çš„å†…å®¹ï¼Œè¿™ç§åŒæ­¥ç‰¹æ€§ä½¿å¾—å®ƒéå¸¸é€‚åˆåœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼Œå› ä¸ºæœåŠ¡å™¨ç«¯ä»£ç ä¸ä¼šå—åˆ°ç½‘ç»œå»¶è¿Ÿç­‰å› ç´ çš„å½±å“ã€‚<ul><li>CommonJS çš„æ¨¡å—åœ¨é¦–æ¬¡åŠ è½½æ—¶ä¼šè¢«æ‰§è¡Œï¼Œç»“æœä¼šè¢«ç¼“å­˜ï¼Œåç»­çš„ <code>require</code> è°ƒç”¨ä¼šç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœï¼Œè€Œä¸ä¼šé‡å¤æ‰§è¡Œæ¨¡å—ä»£ç ã€‚</li></ul></li><li><strong>ESM</strong>ï¼š<strong>å¼‚æ­¥åŠ è½½</strong>æ¨¡å—ã€‚ESM çš„ <code>import</code> è¯­å¥æ˜¯åŸºäº Promise çš„ï¼Œè¿™ä½¿å¾—æ¨¡å—åŠ è½½å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œå°¤å…¶é€‚ç”¨äºæµè§ˆå™¨ç«¯ï¼Œé¿å…é˜»å¡é¡µé¢çš„åŠ è½½ã€‚<ul><li>ESM åœ¨åŠ è½½æ—¶ä¼šè¿›è¡Œé™æ€åˆ†æï¼Œå› æ­¤åœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½ç¡®å®šæ¨¡å—ä¾èµ–å…³ç³»ï¼Œè¿™æ ·å¯ä»¥å®ç°æ›´å¥½çš„ä¼˜åŒ–å’Œæå‰æŠ¥é”™ã€‚</li></ul></li></ul><h3 id="3-è¿è¡Œæ—¶ä¸ç¼–è¯‘æ—¶"><a href="#3-è¿è¡Œæ—¶ä¸ç¼–è¯‘æ—¶" class="headerlink" title="3. è¿è¡Œæ—¶ä¸ç¼–è¯‘æ—¶"></a>3. <strong>è¿è¡Œæ—¶ä¸ç¼–è¯‘æ—¶</strong></h3><ul><li><p><strong>CommonJS</strong>ï¼šæ˜¯<strong>è¿è¡Œæ—¶</strong>æ¨¡å—è§£æç³»ç»Ÿã€‚<code>require</code> è¯­å¥ä¼šåœ¨ä»£ç è¿è¡Œæ—¶è¢«è§£é‡Šæ‰§è¡Œï¼Œä¾èµ–å¯ä»¥æ ¹æ®è¿è¡Œæ—¶çš„æ¡ä»¶åŠ¨æ€åŠ è½½ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>someCondition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./moduleA"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> moduleB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./moduleB"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>ESM</strong>ï¼šæ˜¯<strong>ç¼–è¯‘æ—¶</strong>æ¨¡å—ç³»ç»Ÿï¼Œå¯¼å…¥æ¨¡å—çš„å£°æ˜å¿…é¡»ä½äºä»£ç çš„é¡¶å±‚ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥æˆ–å‡½æ•°ä¸­åŠ¨æ€å¼•å…¥ã€‚è¿™æ˜¯ä¸ºäº†è®©ç¼–è¯‘å™¨èƒ½åœ¨ç¼–è¯‘æ—¶ç¡®å®šæ¨¡å—çš„ä¾èµ–å…³ç³»ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ä»¥ä¸‹æ˜¯éæ³•çš„ï¼Œåœ¨ ESM ä¸­ä¸èƒ½ä½¿ç”¨åŠ¨æ€å¯¼å…¥</span><span class="token keyword">if</span> <span class="token punctuation">(</span>someCondition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">import</span> <span class="token punctuation">&#123;</span> funcA <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./moduleA.js"</span> <span class="token comment">// é”™è¯¯</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="4-å¯¼å‡ºæœºåˆ¶"><a href="#4-å¯¼å‡ºæœºåˆ¶" class="headerlink" title="4. å¯¼å‡ºæœºåˆ¶"></a>4. <strong>å¯¼å‡ºæœºåˆ¶</strong></h3><ul><li><p><strong>CommonJS</strong>ï¼šé€šè¿‡ <code>module.exports</code> æˆ– <code>exports</code> å¯¼å‡ºå¯¹è±¡ã€å‡½æ•°æˆ–å˜é‡ã€‚å®ƒå¯ä»¥å¯¼å‡ºæ•´ä¸ªå¯¹è±¡æˆ–æ¨¡å—çš„ä¸åŒéƒ¨åˆ†ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å¯¼å‡ºå•ä¸ªå¯¹è±¡æˆ–å‡½æ•°</span>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// å¯¼å‡ºå¤šä¸ªå€¼</span>exports<span class="token punctuation">.</span><span class="token function-variable function">greet</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>ESM</strong>ï¼šä½¿ç”¨ <code>export</code> å…³é”®å­—å¯¼å‡ºï¼Œå¯ä»¥è¿›è¡Œ<strong>å‘½åå¯¼å‡º</strong>æˆ–<strong>é»˜è®¤å¯¼å‡º</strong>ã€‚å‘½åå¯¼å‡ºå…è®¸å¯¼å‡ºå¤šä¸ªå˜é‡æˆ–å‡½æ•°ï¼Œè€Œé»˜è®¤å¯¼å‡ºåˆ™åªèƒ½å¯¼å‡ºä¸€ä¸ªé»˜è®¤å€¼ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å‘½åå¯¼å‡º</span><span class="token keyword">export</span> <span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token string">"John"</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">greet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">// é»˜è®¤å¯¼å‡º</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Default Export"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="5-æ¨¡å—çš„ç¼“å­˜"><a href="#5-æ¨¡å—çš„ç¼“å­˜" class="headerlink" title="5. æ¨¡å—çš„ç¼“å­˜"></a>5. <strong>æ¨¡å—çš„ç¼“å­˜</strong></h3><ul><li><p><strong>CommonJS</strong>ï¼šæ¨¡å—åœ¨ç¬¬ä¸€æ¬¡åŠ è½½åä¼šè¢«ç¼“å­˜ï¼Œåç»­å¯¹è¯¥æ¨¡å—çš„ <code>require</code> è°ƒç”¨ä¼šè¿”å›ç¼“å­˜çš„ç»“æœï¼Œè€Œä¸æ˜¯é‡æ–°æ‰§è¡Œæ¨¡å—ä»£ç ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// ç¬¬ä¸€æ¬¡ require æ¨¡å—æ—¶ï¼Œæ¨¡å—ä»£ç ä¼šæ‰§è¡Œ</span><span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./moduleA"</span><span class="token punctuation">)</span><span class="token comment">// ç¬¬äºŒæ¬¡ require ç›¸åŒæ¨¡å—æ—¶ï¼Œè¿”å›çš„æ˜¯ç¼“å­˜çš„ç»“æœ</span><span class="token keyword">const</span> moduleA_again <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./moduleA"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>ESM</strong>ï¼šåŒæ ·ä¼šå¯¹æ¨¡å—è¿›è¡Œç¼“å­˜ï¼Œé¦–æ¬¡åŠ è½½åï¼Œæ¨¡å—ä¼šè¢«ç¼“å­˜å¹¶å¤ç”¨ã€‚å’Œ CommonJS ä¸€æ ·ï¼Œæ¨¡å—åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œä»£ç ã€‚</p></li></ul><h3 id="6-é¡¶å±‚ä½œç”¨åŸŸ"><a href="#6-é¡¶å±‚ä½œç”¨åŸŸ" class="headerlink" title="6. é¡¶å±‚ä½œç”¨åŸŸ"></a>6. <strong>é¡¶å±‚ä½œç”¨åŸŸ</strong></h3><ul><li><strong>CommonJS</strong>ï¼šæ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„<strong>ç‹¬ç«‹ä½œç”¨åŸŸ</strong>ï¼Œè€Œä¸æ˜¯å…¨å±€ä½œç”¨åŸŸã€‚æ¨¡å—å†…éƒ¨çš„å˜é‡å’Œå‡½æ•°é»˜è®¤æ˜¯ç§æœ‰çš„ï¼Œåªæœ‰é€šè¿‡ <code>module.exports</code> æˆ– <code>exports</code> å…¬å¼€çš„éƒ¨åˆ†æ‰å¯¹å¤–å¯è§ã€‚</li><li><strong>ESM</strong>ï¼šåŒæ ·å…·æœ‰æ¨¡å—ä½œç”¨åŸŸï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¨¡å—å†…éƒ¨çš„å˜é‡ã€å‡½æ•°ç­‰éƒ½æ˜¯ç§æœ‰çš„ï¼Œåªæœ‰é€šè¿‡ <code>export</code> å¯¼å‡ºçš„éƒ¨åˆ†æ‰å¯¹å¤–å¯è§ã€‚</li></ul><h3 id="7-æ¨¡å—å¾ªç¯ä¾èµ–"><a href="#7-æ¨¡å—å¾ªç¯ä¾èµ–" class="headerlink" title="7. æ¨¡å—å¾ªç¯ä¾èµ–"></a>7. <strong>æ¨¡å—å¾ªç¯ä¾èµ–</strong></h3><ul><li><p><strong>CommonJS</strong>ï¼šå…è®¸å¹¶ä¸”èƒ½å¤Ÿå¤„ç†å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½†åœ¨å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹ï¼Œåªæœ‰æ¨¡å—çš„éƒ¨åˆ†ä»£ç ä¼šè¢«å¯¼å…¥ï¼ˆå³å·²æ‰§è¡Œçš„éƒ¨åˆ†ï¼‰ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// moduleA.js</span><span class="token keyword">const</span> moduleB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./moduleB"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Module A"</span><span class="token punctuation">)</span><span class="token comment">// moduleB.js</span><span class="token keyword">const</span> moduleA <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./moduleA"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Module B"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>ESM</strong>ï¼šä¹Ÿå…è®¸å¾ªç¯ä¾èµ–ï¼Œä½† ESM ä¼šç¡®ä¿æ¨¡å—çš„æ‰€æœ‰ä¾èµ–å…³ç³»éƒ½è¢«åˆå§‹åŒ–ï¼Œåœ¨åŠ è½½æ—¶ä¼šæ‰§è¡Œä¸€éƒ¨åˆ†å·²è§£æçš„æ¨¡å—ä»£ç ã€‚å› æ­¤ ESM æ›´é€‚åˆå¤„ç†å¾ªç¯ä¾èµ–ã€‚</p></li></ul><h3 id="8-æµè§ˆå™¨æ”¯æŒ"><a href="#8-æµè§ˆå™¨æ”¯æŒ" class="headerlink" title="8. æµè§ˆå™¨æ”¯æŒ"></a>8. <strong>æµè§ˆå™¨æ”¯æŒ</strong></h3><ul><li><p><strong>CommonJS</strong>ï¼šä¸»è¦ç”¨äº Node.js ç¯å¢ƒï¼Œæµè§ˆå™¨åŸç”Ÿä¸æ”¯æŒ CommonJS æ¨¡å—åŒ–ç³»ç»Ÿã€‚åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ CommonJS é€šå¸¸éœ€è¦é€šè¿‡æ‰“åŒ…å·¥å…·ï¼ˆå¦‚ Webpack æˆ– Browserifyï¼‰å°†æ¨¡å—è½¬æ¢æˆæµè§ˆå™¨å¯æ‰§è¡Œçš„ä»£ç ã€‚</p></li><li><p><strong>ESM</strong>ï¼šæµè§ˆå™¨åŸç”Ÿæ”¯æŒ ES Modulesï¼Œå°¤å…¶æ˜¯åœ¨ç°ä»£æµè§ˆå™¨ä¸­ï¼Œä½¿ç”¨ <code>&lt;script type=&quot;module&quot;&gt;</code> æ ‡ç­¾å¯ä»¥ç›´æ¥åŠ è½½ ES æ¨¡å—ï¼Œæ— éœ€é¢å¤–çš„æ‰“åŒ…å·¥å…·ã€‚</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>module<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>app.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><h3 id="9-ä½¿ç”¨åœºæ™¯"><a href="#9-ä½¿ç”¨åœºæ™¯" class="headerlink" title="9. ä½¿ç”¨åœºæ™¯"></a>9. <strong>ä½¿ç”¨åœºæ™¯</strong></h3><ul><li><strong>CommonJS</strong>ï¼šç”±äºå®ƒæ˜¯ Node.js çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯å¼€å‘ã€‚</li><li><strong>ESM</strong>ï¼šé€æ¸æˆä¸º JavaScript çš„æ ‡å‡†æ¨¡å—ç³»ç»Ÿï¼Œè¢«å¹¿æ³›åº”ç”¨äºæµè§ˆå™¨å’Œ Node.js ç¯å¢ƒä¸­ã€‚</li></ul><h3 id="10-é»˜è®¤å¯¼å‡ºä¸å‘½åå¯¼å‡º"><a href="#10-é»˜è®¤å¯¼å‡ºä¸å‘½åå¯¼å‡º" class="headerlink" title="10. é»˜è®¤å¯¼å‡ºä¸å‘½åå¯¼å‡º"></a>10. <strong>é»˜è®¤å¯¼å‡ºä¸å‘½åå¯¼å‡º</strong></h3><ul><li><strong>CommonJS</strong>ï¼šæ²¡æœ‰é»˜è®¤å¯¼å‡ºçš„æ¦‚å¿µï¼Œæ¨¡å—å¯ä»¥å¯¼å‡ºå•ä¸ªå¯¹è±¡æˆ–å¤šä¸ªå±æ€§ï¼Œä½†æ²¡æœ‰ä¸“é—¨çš„è¯­æ³•åŒºåˆ†é»˜è®¤å¯¼å‡ºå’Œå‘½åå¯¼å‡ºã€‚</li><li><strong>ESM</strong>ï¼šæ”¯æŒ<strong>é»˜è®¤å¯¼å‡º</strong>å’Œ<strong>å‘½åå¯¼å‡º</strong>ã€‚ä¸€ä¸ªæ¨¡å—å¯ä»¥æœ‰å¤šä¸ªå‘½åå¯¼å‡ºï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤å¯¼å‡ºã€‚</li></ul><h3 id="11-å€¼å¾—å¼•ç”¨å’Œæ‹·è´"><a href="#11-å€¼å¾—å¼•ç”¨å’Œæ‹·è´" class="headerlink" title="11 å€¼å¾—å¼•ç”¨å’Œæ‹·è´"></a>11 å€¼å¾—å¼•ç”¨å’Œæ‹·è´</h3><ul><li><p><strong>CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´</strong>ï¼šå½“ä½¿ç”¨ CommonJS <code>require</code> å¼•å…¥ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œæ¨¡å—ä¸­çš„å€¼ä¼šè¢«<strong>æ‹·è´</strong>åˆ°å¼•å…¥æ¨¡å—çš„åœ°æ–¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡å—çš„å¯¼å‡ºå€¼æ˜¯<strong>åœ¨æ¨¡å—é¦–æ¬¡åŠ è½½æ—¶è®¡ç®—å¹¶è¿”å›</strong>çš„ï¼Œè€Œåç»­å¯¹è¯¥æ¨¡å—çš„ <code>require</code> è°ƒç”¨éƒ½ä¼šè¿”å›ç›¸åŒçš„æ‹·è´ã€‚<strong>å¦‚æœæ¨¡å—å†…éƒ¨çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œè¿™ç§å˜åŒ–ä¸ä¼šå½±å“åˆ°å·²ç»å¼•å…¥çš„æ‹·è´</strong>ã€‚</p></li><li><p><strong>ES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨</strong>ï¼šå½“ä½¿ç”¨ ES Modules (<code>import/export</code>) å¼•å…¥ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œæ¨¡å—ä¸­çš„å¯¼å‡ºå€¼æ˜¯<strong>å¼•ç”¨</strong>ï¼Œå³å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªâ€œç»‘å®šâ€ï¼Œä¸ä¼šè¢«æ‹·è´ã€‚å¦‚æœæ¨¡å—å†…éƒ¨çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œ<strong>åœ¨å…¶ä»–æ¨¡å—ä¸­é€šè¿‡ <code>import</code> å¯¼å…¥çš„å€¼ä¹Ÿä¼šéšä¹‹æ›´æ–°</strong>ï¼Œå› ä¸ºå®ƒä»¬å¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p></li></ul><h4 id="1-CommonJS-æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´"><a href="#1-CommonJS-æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´" class="headerlink" title="1. CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´"></a>1. <strong>CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´</strong></h4><p>CommonJS çš„æ¨¡å—æœºåˆ¶æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼Œæ¨¡å—åœ¨é¦–æ¬¡è¢« <code>require</code> æ—¶ä¼šæ‰§è¡Œæ•´ä¸ªæ¨¡å—ä»£ç ï¼Œå¹¶ç¼“å­˜å¯¼å‡ºçš„ç»“æœã€‚åç»­çš„ <code>require</code> æ“ä½œä¸ä¼šé‡æ–°æ‰§è¡Œæ¨¡å—ä»£ç ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨ç¼“å­˜çš„æ‹·è´ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// counter.js (CommonJS æ¨¡å—)</span><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  count<span class="token operator">++</span><span class="token punctuation">&#125;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  count<span class="token punctuation">,</span>  increment<span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// main.js (CommonJS å¯¼å…¥)</span><span class="token keyword">const</span> counter <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./counter"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// è¾“å‡º 0</span>counter<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>count<span class="token punctuation">)</span> <span class="token comment">// è¾“å‡º 0 ï¼ˆæ¨¡å—å¯¼å‡ºçš„ count æ˜¯æ‹·è´ï¼Œå€¼ä¸ä¼šæ›´æ–°ï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>counter.js</code> æ¨¡å—å¯¼å‡ºçš„ <code>count</code> å€¼åœ¨ <code>require</code> æ—¶å°±è¢«å›ºå®šä¸‹æ¥ã€‚å³ä½¿ <code>counter.increment()</code> ä¿®æ”¹äº†æ¨¡å—å†…éƒ¨çš„ <code>count</code>ï¼Œä½†ç”±äº <code>require</code> è¿”å›çš„æ˜¯<strong>åˆå§‹å€¼çš„æ‹·è´</strong>ï¼Œæ‰€ä»¥ <code>main.js</code> ä¸­çš„ <code>count</code> ä¸ä¼šæ›´æ–°ã€‚</p><h4 id="2-ES-Modules-è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨"><a href="#2-ES-Modules-è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨" class="headerlink" title="2. ES Modules è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨"></a>2. <strong>ES Modules è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨</strong></h4><p>ES6 çš„æ¨¡å—æœºåˆ¶æ˜¯ç¼–è¯‘æ—¶åŠ è½½ï¼Œ<code>import</code> å¯¼å…¥çš„æ˜¯ä¸€ä¸ªå¯¹åŸæ¨¡å—çš„<strong>å¼•ç”¨</strong>ï¼Œå³ä½¿åŸæ¨¡å—ä¸­çš„å˜é‡å‘ç”Ÿå˜åŒ–ï¼Œå¯¼å…¥æ¨¡å—ä¸­çš„å€¼ä¹Ÿä¼šå®æ—¶æ›´æ–°ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// counter.js (ES Modules)</span><span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  count<span class="token operator">++</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> count <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// main.js (ES Modules å¯¼å…¥)</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> count<span class="token punctuation">,</span> increment <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./counter.js"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token comment">// è¾“å‡º 0</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token comment">// è¾“å‡º 1 ï¼ˆæ¨¡å—å¯¼å‡ºçš„ count æ˜¯å¼•ç”¨ï¼Œå€¼ä¼šæ›´æ–°ï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>count</code> æ˜¯é€šè¿‡ <code>export</code> å¯¼å‡ºçš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼•ç”¨ã€‚å½“ <code>increment()</code> è¢«è°ƒç”¨æ—¶ï¼Œ<code>count</code> çš„å€¼æ›´æ–°äº†ï¼Œè€Œ <code>main.js</code> ä¸­çš„ <code>count</code> ä¹Ÿéšä¹‹æ›´æ–°ï¼Œå› ä¸ºå®ƒå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul><li><strong>CommonJS</strong> å¯¼å‡ºçš„æ˜¯<strong>å€¼çš„æ‹·è´</strong>ï¼Œæ¨¡å—é¦–æ¬¡åŠ è½½æ—¶ä¼šæ‰§è¡Œå¹¶ç¼“å­˜ï¼Œåç»­ä½¿ç”¨çš„éƒ½æ˜¯è¿™ä¸ªç¼“å­˜çš„ç»“æœï¼Œæ¨¡å—å†…éƒ¨å˜é‡çš„å˜åŒ–ä¸ä¼šå½±å“åˆ°å…¶ä»–æ–‡ä»¶ã€‚</li><li><strong>ES Modules</strong> å¯¼å‡ºçš„æ˜¯<strong>å€¼çš„å¼•ç”¨</strong>ï¼Œæ¨¡å—å¯¼å…¥æ—¶ä¼šåŠ¨æ€å¼•ç”¨æ¨¡å—çš„å†…éƒ¨å€¼ï¼Œå¦‚æœæ¨¡å—å†…éƒ¨çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œå¯¼å…¥çš„åœ°æ–¹ä¹Ÿä¼šæ„ŸçŸ¥åˆ°è¿™äº›å˜åŒ–ã€‚</li></ul><p>æ‰€ä»¥ï¼ŒES Modules çš„ <code>import</code> å…·æœ‰åŠ¨æ€æ€§ï¼Œè€Œ CommonJS çš„ <code>require</code> æ›´åƒæ˜¯é™æ€çš„å¿«ç…§ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>webpack æ‰“åŒ…åæ¨¡å—åˆ†æ</title>
      <link href="/2023/03/16/bundle/"/>
      <url>/2023/03/16/bundle/</url>
      
        <content type="html"><![CDATA[<h2 id="1-åŒæ­¥åŠ è½½"><a href="#1-åŒæ­¥åŠ è½½" class="headerlink" title="1. åŒæ­¥åŠ è½½"></a>1. åŒæ­¥åŠ è½½</h2><h3 id="æ²¡æœ‰ä¾èµ–"><a href="#æ²¡æœ‰ä¾èµ–" class="headerlink" title="æ²¡æœ‰ä¾èµ–"></a>æ²¡æœ‰ä¾èµ–</h3><p>src\index.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>bundle.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//å¯¼å‡ºå¯¹è±¡</span><span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ¨¡å—å†…å®¹</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰“åŒ…æ¨¡å—åˆ†æ"><a href="#æ‰“åŒ…æ¨¡å—åˆ†æ" class="headerlink" title="æ‰“åŒ…æ¨¡å—åˆ†æ"></a><strong>æ‰“åŒ…æ¨¡å—åˆ†æ</strong></h3><p>src\index.js</p><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">let title &#x3D; require(&quot;.&#x2F;title.js&quot;);console.log(title);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>src\title.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">"title"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>bundle.js</p><blockquote><p>æœªåŠ å…¥ç¼“å­˜</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//æ¨¡å—å®šä¹‰</span><span class="token comment">//keyæ˜¯æ¨¡å—IDï¼Œä¹Ÿå°±æ˜¯æ¨¡å—ç›¸å¯¹äºç›¸å‰æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„</span><span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string-property property">"./src/title.js"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">"title"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">//åŠ è½½æ¨¡å—ï¼Œæ‰§è¡Œ modules å¯¹åº”çš„å‡½æ•°</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">&#125;</span><span class="token comment">//å…¥å£</span><span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/title.js"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-å…¼å®¹æ€§å®ç°"><a href="#2-å…¼å®¹æ€§å®ç°" class="headerlink" title="2. å…¼å®¹æ€§å®ç°"></a>2. å…¼å®¹æ€§å®ç°</h2><h3 id="2-1-common-js-åŠ è½½-common-js"><a href="#2-1-common-js-åŠ è½½-common-js" class="headerlink" title="2.1 common.js åŠ è½½ common.js"></a>2.1 common.js åŠ è½½ common.js</h3><h4 id="2-1-1-index-js"><a href="#2-1-1-index-js" class="headerlink" title="2.1.1 index.js"></a>2.1.1 index.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./title"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>name<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-1-2-title-js"><a href="#2-1-2-title-js" class="headerlink" title="2.1.2 title.js"></a>2.1.2 title.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"title_name"</span>exports<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">"title_age"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-1-3-bundle-js"><a href="#2-1-3-bundle-js" class="headerlink" title="2.1.3 bundle.js"></a>2.1.3 bundle.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">//éœ€è¦åŠ è½½çš„æ¨¡å—</span>  <span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string-property property">"./src/title.js"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      exports<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"title_name"</span>      exports<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token string">"title_age"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//ç¼“å­˜</span>  <span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">//require æ–¹æ³•</span>  <span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports    <span class="token punctuation">&#125;</span>    <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports  <span class="token punctuation">&#125;</span>  <span class="token comment">// å…¥å£</span>  <span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/title.js"</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>name<span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>age<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-common-js-åŠ è½½-ES6-modules"><a href="#2-2-common-js-åŠ è½½-ES6-modules" class="headerlink" title="2.2 common.js åŠ è½½ ES6 modules"></a>2.2 common.js åŠ è½½ ES6 modules</h3><h4 id="2-2-1-index-js"><a href="#2-2-1-index-js" class="headerlink" title="2.2.1 index.js"></a>2.2.1 index.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./title"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-2-2-title-js"><a href="#2-2-2-title-js" class="headerlink" title="2.2.2 title.js"></a>2.2.2 title.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">"title_name"</span><span class="token keyword">export</span> <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token string">"title_age"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-2-3-bundle-js"><a href="#2-2-3-bundle-js" class="headerlink" title="2.2.3 bundle.js"></a>2.2.3 bundle.js</h4><blockquote><p>å»é™¤äº†è‡ªæ‰§è¡Œå‡½æ•°å’Œæ¨¡å—ç¼“å­˜</p></blockquote><ul><li>æ‰“åŒ…å‰é¢æ˜¯ commonjs æ‰“åŒ…åä¸éœ€è¦å˜ï¼Œæ‰“åŒ…å‰æ˜¯ esmodule æ‰“åŒ…åå¾—å˜</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * å¦‚æœåŸæ¨¡å—æ˜¯esmodule * å…ˆæ‰§è¡Œrequire.r * å†æ‰§è¡Œrequire.d */</span><span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string-property property">"./src/title.js"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1.å£°æ˜æˆ–è€…è¯´è¡¨ç¤ºå½“å‰çš„æ¨¡å—åŸæ¥æ˜¯ä¸€ä¸ªes module</span>    require<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span>    <span class="token comment">//2. å®šä¹‰å±æ€§</span>    require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token function-variable function">age</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> age<span class="token punctuation">,</span>      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token constant">DEFAULT_EXPORTS</span><span class="token punctuation">,</span> <span class="token comment">//å€¼æ˜¯ä¸€ä¸ªgetter</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">//é»˜è®¤å¯¼å‡º</span>    <span class="token keyword">const</span> <span class="token constant">DEFAULT_EXPORTS</span> <span class="token operator">=</span> <span class="token string">"title_name"</span>    <span class="token comment">//å‘½åå¯¼å‡º</span>    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token string">"title_age"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token comment">/** * æ‰§è¡Œmoduleså¯¹è±¡å¯¹åº”çš„æ¨¡å—å‡½æ•° * @param &#123;*&#125; moduleId æ¨¡å—Id * @returns module.exports */</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span>  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">&#125;</span><span class="token comment">/** * ç»™exports ä¸Šé¢å®šä¹‰å±æ€§ * @param &#123;*&#125; exports å¯¼å‡ºå¯¹è±¡ * @param &#123;*&#125; definition å®šä¹‰çš„å±æ€§ */</span>require<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">//éå†key</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> definition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//åœ¨ definition ä¸Šä¸åœ¨ exports ä¸Šå°±èµ‹å€¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>definition<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ç»™exports ä¸Šé¢å®šä¹‰å±æ€§ geT è·å–</span>      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">get</span><span class="token operator">:</span> definition<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">//å¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§</span>require<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token comment">/** * ç»™exports å£°æ˜ Symbol.toStringTagä¸ºModule ï¼Œ__esModule æœªtrue * @param &#123;*&#125; exports */</span>require<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"Module"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/title.js"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>default<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>title<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-ES6-modules-åŠ è½½-ES6-modules"><a href="#2-3-ES6-modules-åŠ è½½-ES6-modules" class="headerlink" title="2.3 ES6 modules åŠ è½½ ES6 modules"></a>2.3 ES6 modules åŠ è½½ ES6 modules</h3><h4 id="2-3-1-index-js"><a href="#2-3-1-index-js" class="headerlink" title="2.3.1 index.js"></a>2.3.1 index.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> name<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./title"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-3-2-title-js"><a href="#2-3-2-title-js" class="headerlink" title="2.3.2 title.js"></a>2.3.2 title.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> name <span class="token operator">=</span> <span class="token string">"title_name"</span><span class="token keyword">export</span> <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token string">"title_age"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="2-3-3-bundle-js"><a href="#2-3-3-bundle-js" class="headerlink" title="2.3.3 bundle.js"></a>2.3.3 bundle.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * å¦‚æœåŸæ¨¡å—æ˜¯esmodule * å…ˆæ‰§è¡Œrequire.r * å†æ‰§è¡Œrequire.d */</span><span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string-property property">"./src/title.js"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1.å£°æ˜æˆ–è€…è¯´è¡¨ç¤ºå½“å‰çš„æ¨¡å—åŸæ¥æ˜¯ä¸€ä¸ªes module</span>    require<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span>    <span class="token comment">//2. å®šä¹‰å±æ€§</span>    require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token function-variable function">age</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> age<span class="token punctuation">,</span>      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _DEFAULT_EXPORT__<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">// æ­¤å¤„ä¸ºäº†å®ç°Livbindingåšå‡†å¤‡</span>    <span class="token keyword">const</span> _DEFAULT_EXPORT__ <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"title_name"</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token string">"title_age"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * æ‰§è¡Œmoduleså¯¹è±¡å¯¹åº”çš„æ¨¡å—å‡½æ•° * @param &#123;*&#125; moduleId æ¨¡å—Id * @returns module.exports */</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">&#125;</span><span class="token comment">/** * ç»™exports ä¸Šé¢å®šä¹‰å±æ€§ * @param &#123;*&#125; exports å¯¼å‡ºå¯¹è±¡ * @param &#123;*&#125; definition å®šä¹‰çš„å±æ€§ */</span>require<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> definition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>definition<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">get</span><span class="token operator">:</span> definition<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>require<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token comment">/** * ç»™exports å£°æ˜ Symbol.toStringTagä¸ºModule ï¼Œ__esModule æœªtrue * @param &#123;*&#125; exports */</span>require<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"Module"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//å…¥å£</span><span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ ‡æ˜æ˜¯esModuleæ¨¡å—</span>require<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span><span class="token comment">//åŠ è½½å¯¹åº”çš„æ¨¡å—</span><span class="token keyword">var</span> _title_0__ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/title.js"</span><span class="token punctuation">)</span><span class="token comment">//å–å€¼</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_title_0__<span class="token punctuation">[</span><span class="token string">"default"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_title_0__<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-4-ES6-modules-åŠ è½½-common-js"><a href="#2-4-ES6-modules-åŠ è½½-common-js" class="headerlink" title="2.4 ES6 modules åŠ è½½ common.js"></a>2.4 ES6 modules åŠ è½½ common.js</h3><h4 id="2-4-1-index-js"><a href="#2-4-1-index-js" class="headerlink" title="2.4.1 index.js"></a>2.4.1 index.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> name<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> age <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./title"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="2-4-2-title-js"><a href="#2-4-2-title-js" class="headerlink" title="2.4.2 title.js"></a>2.4.2 title.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"title_name"</span><span class="token punctuation">,</span>  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">"title_age"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-4-3-bundle-js"><a href="#2-4-3-bundle-js" class="headerlink" title="2.4.3 bundle.js"></a>2.4.3 bundle.js</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * å¦‚æœåŸæ¨¡å—æ˜¯esmodule * å…ˆæ‰§è¡Œrequire.r * å†æ‰§è¡Œrequire.d */</span><span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token string-property property">"./src/title.js"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1.å£°æ˜æˆ–è€…è¯´è¡¨ç¤ºå½“å‰çš„æ¨¡å—åŸæ¥æ˜¯ä¸€ä¸ªes module</span>    require<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span>    <span class="token comment">//2. å®šä¹‰å±æ€§</span>    require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token function-variable function">age</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> age<span class="token punctuation">,</span>      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _DEFAULT_EXPORT__<span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment">// æ­¤å¤„ä¸ºäº†å®ç°Livbindingåšå‡†å¤‡</span>    <span class="token keyword">const</span> _DEFAULT_EXPORT__ <span class="token operator">=</span> <span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"title_name"</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> age <span class="token operator">=</span> <span class="token string">"title_age"</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * æ‰§è¡Œmoduleså¯¹è±¡å¯¹åº”çš„æ¨¡å—å‡½æ•° * @param &#123;*&#125; moduleId æ¨¡å—Id * @returns module.exports */</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">&#125;</span><span class="token comment">/** * ç»™exports ä¸Šé¢å®šä¹‰å±æ€§ * @param &#123;*&#125; exports å¯¼å‡ºå¯¹è±¡ * @param &#123;*&#125; definition å®šä¹‰çš„å±æ€§ */</span>require<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> definition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>definition<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">get</span><span class="token operator">:</span> definition<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>require<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token comment">/** * ç»™exports å£°æ˜ Symbol.toStringTagä¸ºModule ï¼Œ__esModule æœªtrue * @param &#123;*&#125; exports */</span>require<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"Module"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//å…¥å£</span><span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//æ ‡æ˜æ˜¯esModuleæ¨¡å—</span>require<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span><span class="token comment">//åŠ è½½å¯¹åº”çš„æ¨¡å—</span><span class="token keyword">var</span> _title_0__ <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/title.js"</span><span class="token punctuation">)</span><span class="token comment">//å–å€¼</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_title_0__<span class="token punctuation">[</span><span class="token string">"default"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>_title_0__<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-å¼‚æ­¥åŠ è½½å®ç°åˆ†æ"><a href="#3-å¼‚æ­¥åŠ è½½å®ç°åˆ†æ" class="headerlink" title="3. å¼‚æ­¥åŠ è½½å®ç°åˆ†æ"></a>3. å¼‚æ­¥åŠ è½½å®ç°åˆ†æ</h2><h3 id="æ‰“åŒ…å‰"><a href="#æ‰“åŒ…å‰" class="headerlink" title="æ‰“åŒ…å‰"></a>æ‰“åŒ…å‰</h3><p>index.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./title.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>default<span class="token punctuation">)</span>  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">"./title.js"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>default<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>title.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">"title"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="æ‰“åŒ…å"><a href="#æ‰“åŒ…å" class="headerlink" title="æ‰“åŒ…å"></a>æ‰“åŒ…å</h3><p>main.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//å®šä¹‰ä¸€ä¸ªæ¨¡å—å®šä¹‰çš„å¯¹è±¡</span><span class="token keyword">var</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//å­˜æ”¾å·²ç»åŠ è½½çš„æ¨¡å—çš„ç¼“å­˜</span><span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//åœ¨æµè§ˆå™¨é‡Œå®ç°requireæ–¹æ³•</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> cachedModule <span class="token operator">=</span> cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>cachedModule <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> cachedModule<span class="token punctuation">.</span>exports  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">(</span>cache<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">(</span>module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> require<span class="token punctuation">)</span>  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">&#125;</span><span class="token comment">//ç»™requireæ–¹æ³•å®šä¹‰ä¸€ä¸ªmå±æ€§ï¼ŒæŒ‡å‘æ¨¡å—å®šä¹‰å¯¹è±¡</span>require<span class="token punctuation">.</span>m <span class="token operator">=</span> modulesrequire<span class="token punctuation">.</span><span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports<span class="token punctuation">,</span> definition</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> definition<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>definition<span class="token punctuation">,</span> key<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token literal-property property">get</span><span class="token operator">:</span> definition<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>require<span class="token punctuation">.</span>f <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">//ç©ºå¯¹è±¡</span><span class="token comment">/** * * @param &#123;*&#125; chunkId  chunk ä»£ç å— æ¨¡å—çš„é›†åˆ * @returns è¿”å›Promise */</span>require<span class="token punctuation">.</span><span class="token function-variable function">e</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  require<span class="token punctuation">.</span>f<span class="token punctuation">.</span><span class="token function">j</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">,</span> promises<span class="token punctuation">)</span>  <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//æºä»£ç åŠ è½½ç»å¯¹è·¯å¾„ æ­¤å¤„å†™æˆ''</span>require<span class="token punctuation">.</span>p <span class="token operator">=</span> <span class="token string">""</span><span class="token comment">//è¿”å›æ­¤ä»£ç å—å¯¹åº”çš„æ–‡ä»¶å</span>require<span class="token punctuation">.</span><span class="token function-variable function">u</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkId</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token string">""</span> <span class="token operator">+</span> chunkId <span class="token operator">+</span> <span class="token string">".main.js"</span><span class="token punctuation">&#125;</span>require<span class="token punctuation">.</span>g <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> globalThis <span class="token operator">===</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> globalThis  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">"return this"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">"object"</span><span class="token punctuation">)</span> <span class="token keyword">return</span> window  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>require<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span class="token comment">// é€šè¿‡JSONPåŠ è½½ä»£ç  åŠ¨æ€åŠ è½½ä»£ç  åŸä»£ç ä¸­ä¼šæœ‰ä¸€ä¸ªå®šæ—¶å™¨ï¼ŒæˆåŠŸåè¾¾åˆ°æ—¶é—´åˆ é™¤åˆ›å»ºscriptæ ‡ç­¾</span>require<span class="token punctuation">.</span><span class="token function-variable function">l</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"script"</span><span class="token punctuation">)</span>  script<span class="token punctuation">.</span>src <span class="token operator">=</span> url  document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>require<span class="token punctuation">.</span><span class="token function-variable function">r</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">exports</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Symbol <span class="token operator">!==</span> <span class="token string">"undefined"</span> <span class="token operator">&amp;&amp;</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>      <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"Module"</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token string">"__esModule"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//å­˜æ”¾åŠ è½½çš„ä»£ç å—çš„çŠ¶æ€</span><span class="token comment">//keyæ˜¯ä»£ç å—çš„åå­—</span><span class="token comment">//0è¡¨ç¤ºå·²ç»åŠ è½½å®Œæˆäº†</span><span class="token keyword">var</span> installedChunks <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment">//å½“ä¸€ä¸ªä»£ç å—å®ƒçš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„çš„æ—¶å€™è¡¨ç¤ºæ­¤ä»£ç å—å¯¹åº”çš„JSæ–‡ä»¶æ­£åœ¨åŠ è½½ä¸­</span>  <span class="token comment">//'src_hello_js':[resolve,reject,promise]=>0</span><span class="token punctuation">&#125;</span><span class="token comment">/** * é€šè¿‡JSONPå¼‚æ­¥åŠ è½½ä¸€ä¸ªchunkIdå¯¹åº”çš„ä»£ç å—æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯title.main.js * ä¼šè¿”å›ä¸€ä¸ªPromise * @param &#123;*&#125; chunkId ä»£ç å—ID * @param &#123;*&#125; promises promiseæ•°ç»„ */</span>require<span class="token punctuation">.</span>f<span class="token punctuation">.</span><span class="token function-variable function">j</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">chunkId<span class="token punctuation">,</span> promises</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token comment">//åšç¼“å­˜  å½“å‰çš„ä»£ç å—çš„æ•°æ®</span>  <span class="token keyword">var</span> installedChunkData <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>installedChunks<span class="token punctuation">,</span> chunkId<span class="token punctuation">)</span> <span class="token operator">?</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token keyword">undefined</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>installedChunkData <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      installedChunkData <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    installedChunkData<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> promise    <span class="token comment">//installedChunkData=[resolve,reject,promise]</span>    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> require<span class="token punctuation">.</span>p <span class="token operator">+</span> require<span class="token punctuation">.</span><span class="token function">u</span><span class="token punctuation">(</span>chunkId<span class="token punctuation">)</span>    require<span class="token punctuation">.</span><span class="token function">l</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * * @param &#123;*&#125; chunkIds ä»£ç å—IDæ•°ç»„ * @param &#123;*&#125; moreModules é¢å¤–çš„æ¨¡å—å®šä¹‰ */</span><span class="token keyword">function</span> <span class="token function">webpackJsonpCallback</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>chunkIds<span class="token punctuation">,</span> moreModules<span class="token punctuation">]</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> resolves <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> chunkIds<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> chunkId <span class="token operator">=</span> chunkIds<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token comment">//src_title_js</span>    <span class="token keyword">const</span> resolve <span class="token operator">=</span> installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>    resolves<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span>    <span class="token comment">//åˆ°è¿™é‡Œæ­¤ä»£ç å—å°±å·²ç»åŠ è½½æˆåŠŸäº†ï¼Œå¯ä»¥æŠŠchunkIdçš„å€¼è®¾ç½®ä¸º0</span>    installedChunks<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//åˆå¹¶æ¨¡å—å®šä¹‰åˆ°moduleså»</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> moduleId <span class="token keyword">in</span> moreModules<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> moreModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>resolves<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//å–å‡ºæ‰€æœ‰çš„resolveæ–¹æ³•ï¼Œè®©å®ƒæ‰§è¡Œï¼Œè®©å®ƒå¯¹åº”çš„promiseå˜æˆæˆåŠŸæ€</span>    resolves<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> chunkLoadingGlobal <span class="token operator">=</span> <span class="token punctuation">(</span>window<span class="token punctuation">[</span><span class="token string">"someName"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>chunkLoadingGlobal<span class="token punctuation">.</span>push <span class="token operator">=</span> webpackJsonpCallback<span class="token keyword">var</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * require.eå¼‚æ­¥åŠ è½½titleä»£ç å—æ–‡ä»¶ title.main.js * promiseæˆåŠŸåä¼šæŠŠ title.main.jsé‡Œé¢çš„ä»£ç å®šä¹‰åˆå¹¶åˆ°require.må¯¹è±¡ä¸Šï¼Œä¹Ÿå°±æ˜¯modulesä¸Š * è°ƒç”¨requireæ–¹æ³•åŠ è½½./src/title.jsæ¨¡å—ï¼Œè·å– æ¨¡å—çš„å¯¼å‡ºå¯¹è±¡ï¼Œè¿›è¡Œæ‰“å° */</span>require  <span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"src_title_js"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>require<span class="token punctuation">,</span> <span class="token string">"./src/title.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>default<span class="token punctuation">)</span>    require      <span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"src_title_js"</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token function">require</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>require<span class="token punctuation">,</span> <span class="token string">"./src/title.js"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>default<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>src_title_js.main.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">[</span><span class="token string">"someName"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>  <span class="token punctuation">[</span><span class="token string">"src_title_js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token string-property property">"./src/title.js"</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span> exports<span class="token punctuation">,</span> require</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      require<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>exports<span class="token punctuation">)</span>      require<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>exports<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>        <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> _DEFAULT_EXPORT__<span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">const</span> _DEFAULT_EXPORT__ <span class="token operator">=</span> <span class="token string">"title"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-æ€»ç»“"><a href="#4-æ€»ç»“" class="headerlink" title="4 æ€»ç»“"></a>4 æ€»ç»“</h2><h3 id="æ ¸å¿ƒæ–¹æ³•"><a href="#æ ¸å¿ƒæ–¹æ³•" class="headerlink" title="æ ¸å¿ƒæ–¹æ³•"></a>æ ¸å¿ƒæ–¹æ³•</h3><ul><li><p>**modules å¯¹è±¡ ** key æ˜¯æ¨¡å— IDï¼Œä¹Ÿå°±æ˜¯æ¨¡å—ç›¸å¯¹äºç›¸å‰æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ å€¼ä¸ºå¯¹åº”åŠ è½½æ¨¡å—çš„å†…å®¹å‡½æ•°</p></li><li><p><strong>require æ–¹æ³•</strong> æ‰§è¡Œ modules å¯¹è±¡å¯¹åº”çš„æ¨¡å—å‡½æ•° è¿”å› modules.exports å¯¹è±¡</p></li><li><p><strong>require.d æ–¹æ³•</strong> é€šè¿‡ defineProperty ç»™ exports ä¸Šè®¾ç½®å±æ€§ get è·å–</p></li><li><p><strong>require.o æ–¹æ³•</strong> å¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§</p></li><li><p><strong>require.r æ–¹æ³•</strong> æ ‡æ˜è¯¥æ¨¡å—æ˜¯ esModele æ¨¡å—</p></li><li><p><strong>require.n æ–¹æ³•</strong> è¿”å›å‡½æ•°å…¼å®¹æ€§å¤„ç†é»˜è®¤å€¼ ï¼ŒesModule æ¨¡å— æ˜¯çš„è¿”å› module[â€œdefaultâ€] å¦åˆ™ commonjs æ¨¡å—è¿”å›æœ¬èº«</p></li><li><p><strong>require.m æ–¹æ³•</strong> æŒ‡å‘æ¨¡å—å®šä¹‰å¯¹è±¡ equire.m = modules;</p></li><li><p><strong>require.p æ–¹æ³•</strong> è·å–è¦åŠ è½½æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</p></li><li><p><strong>require.u æ–¹æ³•</strong> è¿”å›æ­¤ä»£ç å—å¯¹åº”çš„æ–‡ä»¶å</p></li><li><p><strong>require.l æ–¹æ³•</strong> è¿”å›æ­¤ä»£ç å—å¯¹åº”çš„æ–‡ä»¶å</p></li><li><p><strong>require.f.j æ–¹æ³•</strong></p></li><li><p><strong>require.e æ–¹æ³•</strong> å¼‚æ­¥åŠ è½½ä»£ç å—æ–‡ä»¶</p><ul><li>è¿”å› Promise.all([promises])</li><li>promise æˆåŠŸåä¼šæŠŠ åŠ è½½é‡Œé¢çš„ä»£ç å®šä¹‰åˆå¹¶åˆ° require.m å¯¹è±¡ä¸Šï¼Œä¹Ÿå°±æ˜¯ modules ä¸Š</li><li>è°ƒç”¨ require æ–¹æ³•åŠ è½½å¯¹åº”æ¨¡å—ï¼Œè·å– æ¨¡å—çš„å¯¼å‡ºå¯¹è±¡ï¼Œè¿›è¡Œæ‰“å°</li></ul><p><strong>installedChunks å¯¹è±¡</strong> //å­˜æ”¾åŠ è½½çš„ä»£ç å—çš„çŠ¶æ€ //key æ˜¯ä»£ç å—çš„åå­— //0 è¡¨ç¤ºå·²ç»åŠ è½½å®Œæˆäº†</p></li></ul><h3 id="å…¼å®¹å¤„ç†"><a href="#å…¼å®¹å¤„ç†" class="headerlink" title="å…¼å®¹å¤„ç†"></a><strong>å…¼å®¹å¤„ç†</strong></h3><ul><li><strong>common.js åŠ è½½ common.js</strong><ol><li>ç›´æ¥è°ƒç”¨ require æ–¹æ³• æ‰§è¡Œ modules å¯¹è±¡å¯¹åº”çš„å‡½æ•°è¿”å› modules.exports å¯¹è±¡</li></ol></li><li><strong>common.js åŠ è½½ ES6 modules</strong></li></ul><ol><li> ç›´æ¥è°ƒç”¨ require æ–¹æ³•</li><li>æ‰§è¡Œ modules å¯¹è±¡å¯¹åº”çš„å‡½æ•°<ol><li> è°ƒç”¨ require.r æ–¹æ³• æ ‡æ˜è¯¥æ¨¡å—ä¸º esModule</li><li> è°ƒç”¨ require.d æ–¹æ³• ç»™ export å¯¹è±¡èµ‹å€¼</li></ol></li><li> è¿”å› modules.exports</li></ol><ul><li><p>ES6 modules åŠ è½½ ES6 modules</p><ol><li>æ¨¡å—å…¥å£ è°ƒç”¨ require.r æ ‡æ˜æ˜¯ esModule æ¨¡å—</li><li>è°ƒç”¨ require æ–¹æ³• åŠ è½½æ¨¡å—<ol><li>è°ƒç”¨ require.r æ ‡æ˜è¢«åŠ è½½çš„æ¨¡å—æ˜¯ esModule</li><li>è°ƒç”¨ require.d æ–¹æ³• ç»™ export å¯¹è±¡èµ‹å€¼</li></ol></li><li>è¿”å› åŠ è½½çš„å†…å®¹ modules.exports</li></ol></li><li><p>ES6 modules åŠ è½½ common.js</p><ol><li><p>æ¨¡å—å…¥å£ è°ƒç”¨ require.r æ ‡æ˜æ˜¯ esModule æ¨¡å—ã€</p></li><li><p>è°ƒç”¨ require æ–¹æ³• åŠ è½½æ¨¡å— è¿”å›å¯¹åº”æ¨¡å—å†…å®¹</p></li><li><p>å…¼å®¹å¤„ç†è¿”å›çš„é»˜è®¤å€¼ è°ƒç”¨ require.n</p></li></ol></li></ul><h3 id="å¼‚æ­¥åŠ è½½"><a href="#å¼‚æ­¥åŠ è½½" class="headerlink" title="å¼‚æ­¥åŠ è½½"></a><strong>å¼‚æ­¥åŠ è½½</strong></h3><ul><li><p>è°ƒç”¨ require.e å¼‚æ­¥åŠ è½½ä»£ç ï¼Œå‚æ•°è¦åŠ è½½çš„æ¨¡å— ID</p><ul><li>åˆ›å»ºä¸€ä¸ªç©ºçš„ promises æ•°ç»„</li><li>è°ƒç”¨ require.f.j(chunkId, promisesï¼‰<ul><li>å®šä¹‰ä¸€ä¸ª promise å’Œå¹¶ä¸”å°†è¯¥ chunkId å¯¹åº” promise çš„ resolve,reject æ”¾è¿›æ•°ç»„</li><li>åœ¨å…¨å±€å¯¹è±¡ installedChunks å­˜å– keyï¼šchunkId ï¼Œvalue ä¸ºå®šä¹‰çš„æ•°ç»„</li><li>å°†è¯¥ promise æ·»åŠ åˆ° promises ä¸Š</li><li>é€šè¿‡ require.p + require.u(chunkId) è·å–è¦åŠ¨æ€åŠ è½½çš„ script çš„ url åœ°å€</li><li>è°ƒç”¨ require.l åŒè¿‡ JSONPï¼ˆåŠ¨æ€åˆ›å»º scriptï¼ŒæˆåŠŸååˆ é™¤ï¼‰å¼‚æ­¥åŠ è½½å¯¹æ¥çš„æ–‡ä»¶</li><li>è°ƒç”¨<strong>webpackJsonpCallback</strong>åŠ è½½æˆåŠŸçš„å›è°ƒï¼Œå‚æ•°ä¸º chunkIds å’Œ moreModules å¯¹è±¡<ul><li>installedChunks å–å‡ºå¯¹åº” chunkId çš„ resolves æ–¹æ³•å­˜èµ·æ¥</li><li>æŠŠ installedChunks ä¸­ chunkId çš„å€¼è®¾ç½®ä¸º 0 ï¼ˆè¡¨æ˜è¯¥æ¨¡å—åŠ è½½æˆåŠŸäº†ï¼‰</li><li>éå† moreModules åˆå¹¶æ¨¡å—å®šä¹‰åˆ° modules å»</li><li>ä¾æ¬¡å–å‡º resolve æ–¹æ³•å¹¶æ‰§è¡Œ</li></ul></li></ul></li><li>è¿”å› Promise.all(promises)</li></ul></li><li><p>æˆåŠŸä¹‹åé€šè¿‡ then æ–¹æ³•åŠ è½½è°ƒç”¨ require æ–¹æ³•åŠ è½½æ¨¡å—å†…å®¹å¹¶è¿”å›ä¸‹ä¸€ä¸ª then</p></li><li><p>é¡µé¢é€šè¿‡.then æ–¹æ³•æ‹¿åˆ°ç»“æœ</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hasOwnProperty</title>
      <link href="/2023/03/15/hasownproperty/"/>
      <url>/2023/03/15/hasownproperty/</url>
      
        <content type="html"><![CDATA[<h1 id="Object-prototype-hasOwnProperty"><a href="#Object-prototype-hasOwnProperty" class="headerlink" title="Object.prototype.hasOwnProperty()"></a>Object.prototype.hasOwnProperty()</h1><p><strong><code>hasOwnProperty()</code></strong> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºå¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ˜¯å¦æœ‰æŒ‡å®šçš„é”®ï¼‰ã€‚</p><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">const object1 &#x3D; &#123;&#125;;object1.property1 &#x3D; 42;console.log(object1.hasOwnProperty(&#39;property1&#39;));&#x2F;&#x2F; Expected output: trueconsole.log(object1.hasOwnProperty(&#39;toString&#39;));&#x2F;&#x2F; Expected output: falseconsole.log(object1.hasOwnProperty(&#39;hasOwnProperty&#39;));&#x2F;&#x2F; Expected output: false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä½¿ç”¨æ¡ˆä¾‹ | äºŒæ¬¡å°è£…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">require<span class="token punctuation">.</span><span class="token function-variable function">o</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>defineProperty å’Œ toStringTag</title>
      <link href="/2023/03/15/defineproperty/"/>
      <url>/2023/03/15/defineproperty/</url>
      
        <content type="html"><![CDATA[<h3 id="1-toStringTag"><a href="#1-toStringTag" class="headerlink" title="1. toStringTag"></a>1. toStringTag</h3><ul><li><code>Symbol.toStringTag</code> æ˜¯ä¸€ä¸ªå†…ç½® symbolï¼Œå®ƒé€šå¸¸ä½œä¸ºå¯¹è±¡çš„å±æ€§é”®ä½¿ç”¨ï¼Œå¯¹åº”çš„å±æ€§å€¼åº”è¯¥ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºè¯¥å¯¹è±¡çš„è‡ªå®šä¹‰ç±»å‹æ ‡ç­¾</li><li>é€šå¸¸åªæœ‰å†…ç½®çš„ <code>Object.prototype.toString()</code> æ–¹æ³•ä¼šå»è¯»å–è¿™ä¸ªæ ‡ç­¾å¹¶æŠŠå®ƒåŒ…å«åœ¨è‡ªå·±çš„è¿”å›å€¼é‡Œã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "[object String]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "[object Array]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "[object Number]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "[object Boolean]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "[object Undefined]"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// "[object Null]"</span><span class="token keyword">let</span> myExports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myExports<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">"Module"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>myExports<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//[object Module]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-defineProperty"><a href="#2-defineProperty" class="headerlink" title="2. defineProperty"></a>2. defineProperty</h3><ul><li>defineProperty æ–¹æ³•ä¼šç›´æ¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œ å¹¶è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚<ul><li>obj è¦åœ¨å…¶ä¸Šå®šä¹‰å±æ€§çš„å¯¹è±¡ã€‚</li><li>prop è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°ã€‚</li><li>descriptor å°†è¢«å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦ã€‚</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> ageValue <span class="token operator">=</span> <span class="token number">10</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//writable: true, //æ˜¯å¦å¯ä¿®æ”¹</span>  <span class="token comment">//value: 10, //writeable å’Œ setä¸èƒ½æ··ç”¨</span>  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> ageValue  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    ageValue <span class="token operator">=</span> newValue  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//æ˜¯å¦å¯æšä¸¾</span>  <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//æ˜¯å¦å¯é…ç½®å¯åˆ é™¤</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>age<span class="token punctuation">)</span>obj<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo</title>
      <link href="/2023/03/15/000-hexo/"/>
      <url>/2023/03/15/000-hexo/</url>
      
        <content type="html"><![CDATA[<h2 id="å†™ä½œ-test"><a href="#å†™ä½œ-test" class="headerlink" title="å†™ä½œ test"></a>å†™ä½œ test</h2><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹åˆ—å‘½ä»¤æ¥åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« æˆ–è€…æ–°çš„é¡µé¢ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token punctuation">[</span>layout<span class="token punctuation">]</span> <span class="token operator">&lt;</span>title<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ‚¨å¯ä»¥åœ¨å‘½ä»¤ä¸­æŒ‡å®šæ–‡ç« çš„å¸ƒå±€ï¼ˆlayoutï¼‰ï¼Œé»˜è®¤ä¸º postï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>_config.yml </code>ä¸­çš„ <code>default_layout </code>å‚æ•°æ¥æŒ‡å®šé»˜è®¤å¸ƒå±€ã€‚</p><h3 id="å¸ƒå±€ï¼ˆLayoutï¼‰"><a href="#å¸ƒå±€ï¼ˆLayoutï¼‰" class="headerlink" title="å¸ƒå±€ï¼ˆLayoutï¼‰"></a>å¸ƒå±€ï¼ˆLayoutï¼‰</h3><ul><li>Hexo æœ‰ä¸‰ç§é»˜è®¤å¸ƒå±€ï¼š<code>post</code>ã€<code>page</code> å’Œ <code>draft</code>ã€‚</li><li>åœ¨åˆ›å»ºè¿™ä¸‰ç§ä¸åŒç±»å‹çš„æ–‡ä»¶æ—¶ï¼Œå®ƒä»¬å°†ä¼šè¢«ä¿å­˜åˆ°ä¸åŒçš„è·¯å¾„ï¼›</li><li>è€Œæ‚¨è‡ªå®šä¹‰çš„å…¶ä»–å¸ƒå±€å’Œ post ç›¸åŒï¼Œéƒ½å°†å‚¨å­˜åˆ° <code>source/_posts</code> æ–‡ä»¶å¤¹ã€‚</li></ul><table><thead><tr><th><strong>å¸ƒå±€</strong></th><th><strong>è·¯å¾„</strong></th></tr></thead><tbody><tr><td>post</td><td>source/_posts</td></tr><tr><td>page</td><td>source</td></tr><tr><td>draft</td><td>source/_drafts</td></tr></tbody></table><h3 id="æ–‡ä»¶åç§°"><a href="#æ–‡ä»¶åç§°" class="headerlink" title="æ–‡ä»¶åç§°"></a>æ–‡ä»¶åç§°</h3><p>Hexo é»˜è®¤ä»¥æ ‡é¢˜åšä¸ºæ–‡ä»¶åç§°ï¼Œä½†æ‚¨å¯ç¼–è¾‘ <code>new_post_name</code> å‚æ•°æ¥æ”¹å˜é»˜è®¤çš„æ–‡ä»¶åç§°ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œè®¾ä¸º <code>:year-:month-:day-:title.md</code> å¯è®©æ‚¨æ›´æ–¹ä¾¿çš„é€šè¿‡æ—¥æœŸæ¥ç®¡ç†æ–‡ç« ã€‚</p><table><thead><tr><th align="left">å˜é‡</th><th align="left">æè¿°</th></tr></thead><tbody><tr><td align="left"><code>:title</code></td><td align="left">æ ‡é¢˜ï¼ˆå°å†™ï¼Œç©ºæ ¼å°†ä¼šè¢«æ›¿æ¢ä¸ºçŸ­æ ï¼‰</td></tr><tr><td align="left"><code>:year</code></td><td align="left">å»ºç«‹çš„å¹´ä»½ï¼Œæ¯”å¦‚ï¼Œ <code>2015</code></td></tr><tr><td align="left"><code>:month</code></td><td align="left">å»ºç«‹çš„æœˆä»½ï¼ˆæœ‰å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>04</code></td></tr><tr><td align="left"><code>:i_month</code></td><td align="left">å»ºç«‹çš„æœˆä»½ï¼ˆæ— å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>4</code></td></tr><tr><td align="left"><code>:day</code></td><td align="left">å»ºç«‹çš„æ—¥æœŸï¼ˆæœ‰å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>07</code></td></tr><tr><td align="left"><code>:i_day</code></td><td align="left">å»ºç«‹çš„æ—¥æœŸï¼ˆæ— å‰å¯¼é›¶ï¼‰ï¼Œæ¯”å¦‚ï¼Œ <code>7</code></td></tr></tbody></table><h3 id="è‰ç¨¿"><a href="#è‰ç¨¿" class="headerlink" title="è‰ç¨¿"></a>è‰ç¨¿</h3><p>åˆšåˆšæåˆ°äº† Hexo çš„ä¸€ç§ç‰¹æ®Šå¸ƒå±€ï¼š<code>draft</code>ï¼Œè¿™ç§å¸ƒå±€åœ¨å»ºç«‹æ—¶ä¼šè¢«ä¿å­˜åˆ° <code>source/_drafts</code> æ–‡ä»¶å¤¹ï¼Œæ‚¨å¯é€šè¿‡ <code>publish</code> å‘½ä»¤å°†è‰ç¨¿ç§»åŠ¨åˆ° <code>source/_posts</code> æ–‡ä»¶å¤¹ï¼Œè¯¥å‘½ä»¤çš„ä½¿ç”¨æ–¹å¼ä¸ <code>new</code> ååˆ†ç±»ä¼¼ï¼Œæ‚¨ä¹Ÿå¯åœ¨å‘½ä»¤ä¸­æŒ‡å®š <code>layout</code> æ¥æŒ‡å®šå¸ƒå±€ã€‚</p><pre class="line-numbers language-none"><code class="language-none">$ hexo publish [layout] &lt;title&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è‰ç¨¿é»˜è®¤ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œæ‚¨å¯åœ¨æ‰§è¡Œæ—¶åŠ ä¸Š <code>--draft</code> å‚æ•°ï¼Œæˆ–æ˜¯æŠŠ <code>render_drafts</code> å‚æ•°è®¾ä¸º <code>true</code> æ¥é¢„è§ˆè‰ç¨¿ã€‚</p><h2 id="Front-matter"><a href="#Front-matter" class="headerlink" title="Front-matter"></a>Front-matter</h2><p><code>Front-matter</code> é€‰é¡¹ä¸­çš„æ‰€æœ‰å†…å®¹å‡ä¸º<strong>éå¿…å¡«</strong>çš„ã€‚ä½†æˆ‘ä»ç„¶å»ºè®®è‡³å°‘å¡«å†™ <code>title</code> å’Œ <code>date</code> çš„å€¼ã€‚</p><table><thead><tr><th>é…ç½®é€‰é¡¹</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td>title</td><td><code>Markdown</code> çš„æ–‡ä»¶æ ‡é¢˜</td><td>æ–‡ç« æ ‡é¢˜ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹</td></tr><tr><td>date</td><td>æ–‡ä»¶åˆ›å»ºæ—¶çš„æ—¥æœŸæ—¶é—´</td><td>å‘å¸ƒæ—¶é—´ï¼Œå¼ºçƒˆå»ºè®®å¡«å†™æ­¤é€‰é¡¹ï¼Œä¸”æœ€å¥½ä¿è¯å…¨å±€å”¯ä¸€</td></tr><tr><td>author</td><td>æ ¹ <code>_config.yml</code> ä¸­çš„ <code>author</code></td><td>æ–‡ç« ä½œè€…</td></tr><tr><td>img</td><td><code>featureImages</code> ä¸­çš„æŸä¸ªå€¼</td><td>æ–‡ç« ç‰¹å¾å›¾ï¼Œæ¨èä½¿ç”¨å›¾åºŠ(è…¾è®¯äº‘ã€ä¸ƒç‰›äº‘ã€åˆæ‹äº‘ç­‰)æ¥åšå›¾ç‰‡çš„è·¯å¾„.å¦‚: <code>http://xxx.com/xxx.jpg</code></td></tr><tr><td>top</td><td><code>true</code></td><td>æ¨èæ–‡ç« ï¼ˆæ–‡ç« æ˜¯å¦ç½®é¡¶ï¼‰ï¼Œå¦‚æœ <code>top</code> å€¼ä¸º <code>true</code>ï¼Œåˆ™ä¼šä½œä¸ºé¦–é¡µæ¨èæ–‡ç« </td></tr><tr><td>hide</td><td><code>false</code></td><td>éšè—æ–‡ç« ï¼Œå¦‚æœ<code>hide</code>å€¼ä¸º<code>true</code>ï¼Œåˆ™æ–‡ç« ä¸ä¼šåœ¨é¦–é¡µæ˜¾ç¤º</td></tr><tr><td>cover</td><td><code>false</code></td><td><code>v1.0.2</code>ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« æ˜¯å¦éœ€è¦åŠ å…¥åˆ°é¦–é¡µè½®æ’­å°é¢ä¸­</td></tr><tr><td>coverImg</td><td>æ— </td><td><code>v1.0.2</code>ç‰ˆæœ¬æ–°å¢ï¼Œè¡¨ç¤ºè¯¥æ–‡ç« åœ¨é¦–é¡µè½®æ’­å°é¢éœ€è¦æ˜¾ç¤ºçš„å›¾ç‰‡è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™é»˜è®¤ä½¿ç”¨æ–‡ç« çš„ç‰¹è‰²å›¾ç‰‡</td></tr><tr><td>password</td><td>æ— </td><td>æ–‡ç« é˜…è¯»å¯†ç ï¼Œå¦‚æœè¦å¯¹æ–‡ç« è®¾ç½®é˜…è¯»éªŒè¯å¯†ç çš„è¯ï¼Œå°±å¯ä»¥è®¾ç½® <code>password</code> çš„å€¼ï¼Œè¯¥å€¼å¿…é¡»æ˜¯ç”¨ <code>SHA256</code> åŠ å¯†åçš„å¯†ç ï¼Œé˜²æ­¢è¢«ä»–äººè¯†ç ´ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ <code>config.yml</code> ä¸­æ¿€æ´»äº† <code>verifyPassword</code> é€‰é¡¹</td></tr><tr><td>toc</td><td><code>true</code></td><td>æ˜¯å¦å¼€å¯ TOCï¼Œå¯ä»¥é’ˆå¯¹æŸç¯‡æ–‡ç« å•ç‹¬å…³é—­ TOC çš„åŠŸèƒ½ã€‚å‰ææ˜¯åœ¨ä¸»é¢˜çš„ <code>config.yml</code> ä¸­æ¿€æ´»äº† <code>toc</code> é€‰é¡¹</td></tr><tr><td>mathjax</td><td><code>false</code></td><td>æ˜¯å¦å¼€å¯æ•°å­¦å…¬å¼æ”¯æŒ ï¼Œæœ¬æ–‡ç« æ˜¯å¦å¼€å¯ <code>mathjax</code>ï¼Œä¸”éœ€è¦åœ¨ä¸»é¢˜çš„ <code>_config.yml</code> æ–‡ä»¶ä¸­ä¹Ÿéœ€è¦å¼€å¯æ‰è¡Œ</td></tr><tr><td>summary</td><td>æ— </td><td>æ–‡ç« æ‘˜è¦ï¼Œè‡ªå®šä¹‰çš„æ–‡ç« æ‘˜è¦å†…å®¹ï¼Œå¦‚æœè¿™ä¸ªå±æ€§æœ‰å€¼ï¼Œæ–‡ç« å¡ç‰‡æ‘˜è¦å°±æ˜¾ç¤ºè¿™æ®µæ–‡å­—ï¼Œå¦åˆ™ç¨‹åºä¼šè‡ªåŠ¨æˆªå–æ–‡ç« çš„éƒ¨åˆ†å†…å®¹ä½œä¸ºæ‘˜è¦</td></tr><tr><td>categories</td><td>æ— </td><td>æ–‡ç« åˆ†ç±»ï¼Œæœ¬ä¸»é¢˜çš„åˆ†ç±»è¡¨ç¤ºå®è§‚ä¸Šå¤§çš„åˆ†ç±»ï¼Œåªå»ºè®®ä¸€ç¯‡æ–‡ç« ä¸€ä¸ªåˆ†ç±»</td></tr><tr><td>tags</td><td>æ— </td><td>æ–‡ç« æ ‡ç­¾ï¼Œä¸€ç¯‡æ–‡ç« å¯ä»¥å¤šä¸ªæ ‡ç­¾</td></tr><tr><td>keywords</td><td>æ–‡ç« æ ‡é¢˜</td><td>æ–‡ç« å…³é”®å­—ï¼ŒSEO æ—¶éœ€è¦</td></tr><tr><td>reprintPolicy</td><td>cc_by</td><td>æ–‡ç« è½¬è½½è§„åˆ™ï¼Œ å¯ä»¥æ˜¯ cc_by, cc_by_nd, cc_by_sa, cc_by_nc, cc_by_nc_nd, cc_by_nc_sa, cc0, noreprint æˆ– pay ä¸­çš„ä¸€ä¸ª</td></tr></tbody></table><p><strong>tags:</strong></p><ul><li>HTML | CSS | javaScript | TypeScript | ES6 | git | npm | Node.js | webpack | Vue.js | React | ç®—æ³• | è®¾è®¡æ¨¡å¼ | é¢è¯• | å¾®å‰ç«¯ | å·¥å…· | ç¼–ç¨‹é¢˜ | nginx | docker | åŸºç¡€ ï½œç§»åŠ¨ç«¯ï½œ echarts</li></ul><p><strong>categories:</strong></p><ul><li><p>å¼€å‘å·¥å…·</p></li><li><p>å‰ç«¯åŸºç¡€</p></li><li><p>é¢è¯•å®å…¸</p></li><li><p>å‰ç«¯æ¡†æ¶</p></li><li><p>å‰ç«¯è¿ç»´</p></li><li><p>å·¥ç¨‹åŒ–</p></li><li><p>æ¶æ„</p></li><li><p>LeetCode</p></li><li><p>è§£å†³æ–¹æ³•</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>polyfill å®è·µ</title>
      <link href="/2023/03/10/014-polyfill/"/>
      <url>/2023/03/10/014-polyfill/</url>
      
        <content type="html"><![CDATA[<h2 id="1-babel-polyfill"><a href="#1-babel-polyfill" class="headerlink" title="1. babel-polyfill"></a>1. babel-polyfill</h2><ul><li><p><code>Babel</code>é»˜è®¤åªè½¬æ¢æ–°çš„<code>Javascript</code>è¯­æ³•ï¼Œè€Œä¸è½¬æ¢æ–°çš„ APIï¼Œæ¯”å¦‚</p><ul><li><p>Iterator, Generator, Set, Maps, Proxy, Reflect,Symbol,Promise ç­‰å…¨å±€å¯¹è±¡</p></li><li><p>åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹æ³•,æ¯”å¦‚è¯´ ES6 åœ¨ Array å¯¹è±¡ä¸Šæ–°å¢äº†<code>Array.find</code>æ–¹æ³•ï¼ŒBabel å°±ä¸ä¼šè½¬ç è¿™ä¸ªæ–¹æ³•</p></li></ul></li><li><p>å¦‚æœæƒ³è®©è¿™ä¸ªæ–¹æ³•è¿è¡Œï¼Œå¿…é¡»ä½¿ç”¨ <code>babel-polyfill</code>æ¥è½¬æ¢ç­‰</p></li><li><p>Babel 7.4 ä¹‹åä¸å†æ¨èä½¿ç”¨@babel/polyfill</p></li><li><p>babel v7 æ¨èä½¿ç”¨@babel/preset-env ä»£æ›¿ä»¥å¾€çš„è¯¸å¤š polyfill æ–¹æ¡ˆ</p></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm install <span class="token operator">--</span>save core<span class="token operator">-</span>js@<span class="token number">2</span>    core<span class="token operator">-</span>js@<span class="token number">3</span>  @babel<span class="token operator">/</span>polyfill<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="1-1ã€-useBuiltIns-false"><a href="#1-1ã€-useBuiltIns-false" class="headerlink" title="1.1ã€ useBuiltIns: false"></a>1.1ã€ useBuiltIns: false</h3><ul><li><p><code>babel-polyfill</code> å®ƒæ˜¯é€šè¿‡<strong>å‘å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„<code>prototype</code>ä¸Šæ·»åŠ æ–¹æ³•æ¥å®ç°çš„</strong>ã€‚æ¯”å¦‚è¿è¡Œç¯å¢ƒä¸­ä¸æ”¯æŒ<code>Array.prototype.find</code>æ–¹æ³•ï¼Œå¼•å…¥<code>polyfill</code>, æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>ES6</code>æ–¹æ³•æ¥ç¼–å†™äº†ï¼Œä½†æ˜¯<strong>ç¼ºç‚¹å°±æ˜¯ä¼šé€ æˆå…¨å±€ç©ºé—´æ±¡æŸ“</strong></p></li><li><p><code>useBuiltIns: false</code> æ­¤æ—¶ä¸å¯¹ <code>polyfill</code> åšæ“ä½œã€‚å¦‚æœå¼•å…¥ <code>@babel/polyfill</code>ï¼Œåˆ™<strong>æ— è§†é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æ‰€æœ‰çš„ <code>polyfill</code></strong></p></li><li><p><code>@babel/preset-env</code>é»˜è®¤åªæ”¯æŒè¯­æ³•è½¬åŒ–ï¼Œéœ€è¦å¼€å¯<code>useBuiltIns</code>é…ç½®æ‰èƒ½è½¬åŒ– API å’Œå®ä¾‹æ–¹æ³•</p></li></ul><h3 id="1-2ã€useBuiltIns-â€œentryâ€"><a href="#1-2ã€useBuiltIns-â€œentryâ€" class="headerlink" title="1.2ã€useBuiltIns: â€œentryâ€"></a>1.2ã€useBuiltIns: â€œentryâ€</h3><ul><li>åœ¨é¡¹ç›®å…¥å£å¼•å…¥ä¸€æ¬¡ï¼ˆå¤šæ¬¡å¼•å…¥ä¼šæŠ¥é”™ï¼‰</li><li>â€œuseBuiltInsâ€: â€œentryâ€ æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æµè§ˆå™¨ä¸å…¼å®¹çš„ polyfillã€‚éœ€è¦åœ¨å…¥å£æ–‡ä»¶æ‰‹åŠ¨æ·»åŠ  <code>import &#39;@babel/polyfill&#39;</code>ï¼Œä¼šè‡ªåŠ¨æ ¹æ® browserslist æ›¿æ¢æˆæµè§ˆå™¨ä¸å…¼å®¹çš„æ‰€æœ‰ polyfill</li><li>è¿™é‡Œéœ€è¦æŒ‡å®š core-js çš„ç‰ˆæœ¬,<code>corejs</code>é»˜è®¤æ˜¯ 2,</li><li>å¦‚æœé…ç½® <code>corejs: 3</code>, åˆ™<code>import &#39;@babel/polyfill&#39;</code> éœ€è¦æ”¹æˆ <code>import &#39;core-js/stable&#39;;import &#39;regenerator-runtime/runtime&#39;;</code></li><li><ul><li><code>corejs</code>é»˜è®¤æ˜¯ 2</li></ul></li></ul><h3 id="1-3ã€-â€œuseBuiltInsâ€-â€œusageâ€"><a href="#1-3ã€-â€œuseBuiltInsâ€-â€œusageâ€" class="headerlink" title="1.3ã€ â€œuseBuiltInsâ€: â€œusageâ€"></a>1.3ã€ â€œuseBuiltInsâ€: â€œusageâ€</h3><ul><li>â€œuseBuiltInsâ€: â€œusageâ€ <code>usage</code> ä¼šæ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œä»¥åŠä½ ä»£ç ä¸­ç”¨åˆ°çš„ API æ¥è¿›è¡Œ polyfillï¼Œå®ç°äº†æŒ‰éœ€æ·»åŠ </li><li>å½“è®¾ç½®ä¸º usage æ—¶ï¼Œpolyfill ä¼šè‡ªåŠ¨æŒ‰éœ€æ·»åŠ ï¼Œä¸å†éœ€è¦æ‰‹å·¥å¼•å…¥<code>@babel/polyfill</code></li></ul><h2 id="2-babel-runtime"><a href="#2-babel-runtime" class="headerlink" title="2. babel-runtime"></a>2. babel-runtime</h2><ul><li>Babel ä¸ºäº†è§£å†³å…¨å±€ç©ºé—´æ±¡æŸ“çš„é—®é¢˜ï¼Œæä¾›äº†å•ç‹¬çš„åŒ…<a href="https://babeljs.io/docs/en/babel-runtime">babel-runtime</a>ç”¨ä»¥æä¾›ç¼–è¯‘æ¨¡å—çš„å·¥å…·å‡½æ•°</li><li>ç®€å•è¯´ <code>babel-runtime</code> æ›´åƒæ˜¯ä¸€ç§æŒ‰éœ€åŠ è½½çš„å®ç°ï¼Œæ¯”å¦‚ä½ å“ªé‡Œéœ€è¦ä½¿ç”¨ <code>Promise</code>ï¼Œåªè¦åœ¨è¿™ä¸ªæ–‡ä»¶å¤´éƒ¨<code>import Promise from &#39;babel-runtime/core-js/promise&#39;</code>å°±è¡Œäº†</li></ul><h2 id="3-babel-plugin-transform-runtime"><a href="#3-babel-plugin-transform-runtime" class="headerlink" title="3. babel-plugin-transform-runtime"></a>3. babel-plugin-transform-runtime</h2><ul><li><p>@babel/plugin-transform-runtime æ’ä»¶æ˜¯ä¸ºäº†è§£å†³</p><ul><li>å¤šä¸ªæ–‡ä»¶é‡å¤å¼•ç”¨ ç›¸åŒ helpers(å¸®åŠ©å‡½æ•°)=&gt;æå–è¿è¡Œæ—¶</li><li>æ–° API æ–¹æ³•å…¨å±€æ±¡æŸ“ -&gt; å±€éƒ¨å¼•å…¥</li></ul></li><li><p>å¯ç”¨æ’ä»¶<code>babel-plugin-transform-runtime</code>åï¼ŒBabel å°±ä¼šä½¿ç”¨<code>babel-runtime</code>ä¸‹çš„å·¥å…·å‡½æ•°</p></li><li><p><code>babel-plugin-transform-runtime</code>æ’ä»¶èƒ½å¤Ÿå°†è¿™äº›å·¥å…·å‡½æ•°çš„ä»£ç è½¬æ¢æˆ<code>require</code>è¯­å¥ï¼ŒæŒ‡å‘ä¸ºå¯¹<code>babel-runtime</code>çš„å¼•ç”¨</p></li><li><p><code> babel-plugin-transform-runtime</code>å°±æ˜¯å¯ä»¥åœ¨æˆ‘ä»¬ä½¿ç”¨æ–° API æ—¶è‡ªåŠ¨ import<br><code>babel-runtime</code>é‡Œé¢çš„<code>  polyfill</code></p><ul><li><p>å½“æˆ‘ä»¬ä½¿ç”¨ <code>async/await</code> æ—¶ï¼Œè‡ªåŠ¨å¼•å…¥ <code>babel-runtime/regenerator</code></p></li><li><p>å½“æˆ‘ä»¬ä½¿ç”¨ ES6 çš„é™æ€äº‹ä»¶æˆ–å†…ç½®å¯¹è±¡æ—¶ï¼Œè‡ªåŠ¨å¼•å…¥ <code>babel-runtime/core-js</code></p></li><li><p>ç§»é™¤å†…è”<code>babel helpers</code>å¹¶æ›¿æ¢ä½¿ç”¨<code>babel-runtime/helpers</code> æ¥æ›¿æ¢</p></li></ul></li></ul><p><strong>helpers: true</strong></p><ul><li><p>ç§»é™¤å†…è” babel helpers å¹¶æ›¿æ¢ä½¿ç”¨<code>babel-runtime/helpers</code> æ¥æ›¿æ¢</p></li><li><p>é¿å…å†…è”çš„ helper ä»£ç åœ¨å¤šä¸ªæ–‡ä»¶é‡å¤å‡ºç°</p><p><strong>regenerator: true</strong></p></li><li><p>æ˜¯å¦å¼€å¯<code>generator</code>å‡½æ•°è½¬æ¢æˆä½¿ç”¨<code>regenerator runtime</code>æ¥é¿å…æ±¡æŸ“å…¨å±€åŸŸ</p></li></ul><h2 id="4-æœ€ä½³å®è·µ"><a href="#4-æœ€ä½³å®è·µ" class="headerlink" title="4. æœ€ä½³å®è·µ"></a>4. æœ€ä½³å®è·µ</h2><ul><li>@babel/preset-env å’Œ plugin-transform-runtime äºŒè€…éƒ½å¯ä»¥è®¾ç½®ä½¿ç”¨ corejs æ¥å¤„ç† polyfill</li></ul><h3 id="4-1-é¡¹ç›®å¼€å‘"><a href="#4-1-é¡¹ç›®å¼€å‘" class="headerlink" title="4.1 é¡¹ç›®å¼€å‘"></a>4.1 é¡¹ç›®å¼€å‘</h3><ul><li><p>useBuiltIns ä½¿ç”¨ usage</p></li><li><p>plugin-transform-runtime åªä½¿ç”¨å…¶ç§»é™¤å†…è”å¤ç”¨çš„è¾…åŠ©å‡½æ•°çš„ç‰¹æ€§ï¼Œå‡å°æ‰“åŒ…ä½“ç§¯</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">[</span>          <span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span>          <span class="token punctuation">&#123;</span>              <span class="token property">"useBuiltIns"</span><span class="token operator">:</span> <span class="token string">"usage"</span><span class="token punctuation">,</span><span class="token comment">//å®ç°polyfill é¡¹ç›®ä¸­ä¸ç”¨æ‹…å¿ƒä¼šæ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ</span>              <span class="token property">"corejs"</span><span class="token operator">:</span> <span class="token number">3</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">]</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>      <span class="token punctuation">[</span>          <span class="token string">"@babel/plugin-transform-runtime"</span><span class="token punctuation">,</span>          <span class="token punctuation">&#123;</span>              <span class="token property">"corejs"</span><span class="token operator">:</span> <span class="token boolean">false</span>ï¼Œ<span class="token comment">//ä¸å±äºæ­¤æ’ä»¶æä¾›çš„polyfill</span>               helpers<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//ä½¿ç”¨æ­¤æ’ä»¶,å¤ç”¨å¸®åŠ© æ–¹æ³•ï¼Œå‡å°‘æ–‡ä»¶ä½“ç§¯</span>              regenerator<span class="token operator">:</span><span class="token boolean">false</span>          <span class="token punctuation">&#125;</span>      <span class="token punctuation">]</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="4-2-ç±»åº“å¼€å‘"><a href="#4-2-ç±»åº“å¼€å‘" class="headerlink" title="4.2 ç±»åº“å¼€å‘"></a>4.2 ç±»åº“å¼€å‘</h3><ul><li>ç±»åº“å¼€å‘å°½é‡ä¸ä½¿ç”¨æ±¡æŸ“å…¨å±€ç¯å¢ƒçš„<code>polyfill</code>ï¼Œå› æ­¤<code>@babel/preset-env</code>åªå‘æŒ¥è¯­æ³•è½¬æ¢çš„åŠŸèƒ½</li><li>polyfill ç”±<code>@babel/plugin-transform-runtime</code>æ¥å¤„ç†ï¼Œæ¨èä½¿ç”¨ core-js@3</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">&#123;</span>    <span class="token string-property property">"presets"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">[</span>            <span class="token string">"@babel/preset-env"</span>        <span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token string-property property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>        <span class="token punctuation">[</span>             <span class="token string">"@babel/plugin-transform-runtime"</span><span class="token punctuation">,</span>                                    <span class="token punctuation">&#123;</span>                                        <span class="token literal-property property">corejs</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token comment">//ä½¿ç”¨æ­¤æ’ä»¶æä¾›çš„polyfill,æ­¤æ’ä»¶ä¸ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒ</span>                                        <span class="token literal-property property">helpers</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//ä½¿ç”¨æ­¤æ’ä»¶,å¤ç”¨å¸®åŠ© æ–¹æ³•ï¼Œå‡å°‘æ–‡ä»¶ä½“ç§¯</span>                                        <span class="token literal-property property">regenerator</span><span class="token operator">:</span><span class="token boolean">false</span>                                    <span class="token punctuation">&#125;</span>        <span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-polyfill-service"><a href="#5-polyfill-service" class="headerlink" title="5. polyfill-service"></a>5. polyfill-service</h2><ul><li><a href="https://polyfill.io/v3/">polyfill.io</a>è‡ªåŠ¨åŒ–çš„ JavaScript Polyfill æœåŠ¡</li><li><a href="https://polyfill.io/v3/">polyfill.io</a>é€šè¿‡åˆ†æè¯·æ±‚å¤´ä¿¡æ¯ä¸­çš„ UserAgent å®ç°è‡ªåŠ¨åŠ è½½æµè§ˆå™¨æ‰€éœ€çš„ polyfills</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://polyfill.io/v3/polyfill.min.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>babel-polyfill</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token operator">-</span> åœ¨é¡¹ç›®å…¥å£å¼•å…¥ä¸€æ¬¡ï¼ˆå¤šæ¬¡å¼•å…¥ä¼šæŠ¥é”™<span class="token punctuation">)</span><span class="token operator">-</span> åˆ™æ— è§†é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æ‰€æœ‰çš„ <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">polyfill</span><span class="token template-punctuation string">`</span></span><span class="token operator">-</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">babel-polyfill</span><span class="token template-punctuation string">`</span></span> å®ƒæ˜¯é€šè¿‡å‘å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">prototype</span><span class="token template-punctuation string">`</span></span>ä¸Šæ·»åŠ æ–¹æ³•æ¥å®ç°çš„<span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">"entry"</span> <span class="token operator">+</span> corejs<span class="token operator">-</span> åœ¨é¡¹ç›®å…¥å£å¼•å…¥ä¸€æ¬¡ï¼ˆå¤šæ¬¡å¼•å…¥ä¼šæŠ¥é”™<span class="token operator">-</span> æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æµè§ˆå™¨ä¸å…¼å®¹çš„ polyfill <span class="token literal-property property">useBuiltIns</span><span class="token operator">:</span> <span class="token string">"usage"</span><span class="token operator">-</span> æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œä»¥åŠä½ ä»£ç ä¸­ç”¨åˆ°çš„ <span class="token constant">API</span> æ¥è¿›è¡Œ polyfillï¼Œå®ç°äº†æŒ‰éœ€æ·»åŠ <span class="token operator">-</span> æ— éœ€æ‰‹åŠ¨å¼•å…¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç¼ºç‚¹ æ±¡æŸ“å…¨å±€</li></ul><p><strong>babel-runtime</strong></p><ul><li>Babel ä¸ºäº†è§£å†³å…¨å±€ç©ºé—´æ±¡æŸ“çš„é—®é¢˜ï¼Œæä¾›äº†å•ç‹¬çš„åŒ…<a href="https://babeljs.io/docs/en/babel-runtime">babel-runtime</a>ç”¨ä»¥æä¾›ç¼–è¯‘æ¨¡å—çš„å·¥å…·å‡½æ•°</li><li>ç¼ºç‚¹ä»£ç ä¸­æ¯ä¸ªå¤´éƒ¨éƒ½éœ€è¦æ‰‹åŠ¨å¼•å…¥éœ€è¦çš„æ¨¡å—</li></ul><p><strong>babel-plugin-transform-runtime</strong></p><ul><li>å¤šä¸ªæ–‡ä»¶é‡å¤å¼•ç”¨ ç›¸åŒ helpers(å¸®åŠ©å‡½æ•°)=&gt;æå–è¿è¡Œæ—¶</li><li>æ–° API æ–¹æ³•å…¨å±€æ±¡æŸ“ -&gt; å±€éƒ¨å¼•å…¥</li></ul>]]></content>
      
      
      <categories>
          
          <category> å·¥ç¨‹åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webpack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¨¡å—åŒ–çš„å‘å±•å†ç¨‹</title>
      <link href="/2023/03/09/013-mo-kuai-hua/"/>
      <url>/2023/03/09/013-mo-kuai-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€æ¨¡å—åŒ–"><a href="#ä¸€ã€æ¨¡å—åŒ–" class="headerlink" title="ä¸€ã€æ¨¡å—åŒ–"></a>ä¸€ã€æ¨¡å—åŒ–</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–"><a href="#1-1-ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–" class="headerlink" title="1.1.ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–"></a>1.1.ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–</h3><ul><li>æ¨¡å—åˆ’å°±æ˜¯æŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠä»£ç å°è£…æˆè‹¥å¹²çš„ç›¸äº’ä¾èµ–çš„æ–‡ä»¶å¹¶è¿›è¡Œç»„åˆ</li><li>æ¯ä¸ªæ¨¡å—å†…çš„æ•°æ®éƒ½æ˜¯ç§æœ‰çš„ï¼Œåªå‘å¤–é€‰æ‹©æ€§çš„æš´éœ²ä¸€äº›æ–¹æ³•å’Œæ•°æ®ä¸å¤–ç•Œè¿›è¡Œæ•°æ®é€šä¿¡</li></ul><h3 id="1-2-æ¨¡å—åŒ–çš„æ„ä¹‰"><a href="#1-2-æ¨¡å—åŒ–çš„æ„ä¹‰" class="headerlink" title="1.2.æ¨¡å—åŒ–çš„æ„ä¹‰"></a>1.2.æ¨¡å—åŒ–çš„æ„ä¹‰</h3><ul><li>æœ‰åˆ©äºä»£ç åˆ†äº«ã€è§£è€¦ä»¥åŠå¤ç”¨</li><li>å›¢é˜Ÿå¹¶è¡Œå¼€å‘</li><li>é¿å…å‘½åå†²çª</li><li>ç›¸äº’å¼•ç”¨ï¼ŒæŒ‰éœ€åŠ è½½</li></ul><h3 id="1-3-æ¨¡å—åŒ–çš„å‘å±•å²"><a href="#1-3-æ¨¡å—åŒ–çš„å‘å±•å²" class="headerlink" title="1.3. æ¨¡å—åŒ–çš„å‘å±•å²"></a>1.3. æ¨¡å—åŒ–çš„å‘å±•å²</h3><ul><li>è‡ªæ‰§è¡Œå‡½æ•°</li><li>AMD (Asynchronous Module Definition)<ul><li>AMD æ¨å´‡ä¾èµ–å‰ç½®ï¼Œåœ¨å®šä¹‰æ¨¡å—çš„æ—¶å€™å°±è¦å£°æ˜å…¶ä¾èµ–çš„æ¨¡å—</li><li><code>AMD</code>è§„èŒƒåˆ™æ˜¯éåŒæ­¥åŠ è½½æ¨¡å—ï¼Œéœ€è¦å®šä¹‰å›è°ƒ<code>define</code>æ–¹å¼</li></ul></li><li>CMD (Common Module Definition)<ul><li>CMD æ¨å´‡å°±è¿‘ä¾èµ–ï¼Œåªæœ‰åœ¨ç”¨åˆ°æŸä¸ªæ¨¡å—çš„æ—¶å€™å†å» require</li></ul></li><li>CommonJS (æœåŠ¡å™¨ç«¯å¼€å‘)</li><li>UMD (Universal Module Definition)<ul><li>UMD å«åšé€šç”¨æ¨¡å—å®šä¹‰è§„èŒƒ(Universal Module Definition)å¯ä»¥é€šè¿‡è¿è¡Œæ—¶æˆ–è€…ç¼–è¯‘æ—¶è®©åŒä¸€ä¸ªä»£ç æ¨¡å—åœ¨ä½¿ç”¨ CommonJsã€CMD ç”šè‡³æ˜¯ AMD çš„é¡¹ç›®ä¸­è¿è¡Œ</li></ul></li><li>ES6 Module (ESMï¼ŒJS å®˜æ–¹æ ‡å‡†æ¨¡å—å®šä¹‰æ–¹å¼)</li></ul><h3 id="1-4-common-js-å’Œ-ES6-ä¸­æ¨¡å—å¼•å…¥çš„åŒºåˆ«"><a href="#1-4-common-js-å’Œ-ES6-ä¸­æ¨¡å—å¼•å…¥çš„åŒºåˆ«" class="headerlink" title="1. 4 common.js å’Œ ES6 ä¸­æ¨¡å—å¼•å…¥çš„åŒºåˆ«"></a>1. 4 common.js å’Œ ES6 ä¸­æ¨¡å—å¼•å…¥çš„åŒºåˆ«</h3><p>ç›®å‰æµè§ˆå™¨ç«¯è™½å†™æ³•æ˜¯ä»¥ esm ä¸ºä¸»ï¼Œä½†æ˜¯å„ç§å‰ç«¯å·¥å…·è½¬æ¢ä¸º cjs</p><p><strong>åœ¨ä½¿ç”¨ä¸Šçš„å·®åˆ«ä¸»è¦æœ‰ï¼š</strong></p><ul><li><p><code>CommonJS</code> æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ã€‚</p></li><li><p><code>CommonJS</code> æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ï¼ˆé™æ€ç¼–è¯‘ï¼‰ã€‚</p></li><li><p><code>CommonJs</code> æ˜¯å•ä¸ªå€¼å¯¼å‡ºï¼Œ<code>ES6 Module</code> å¯ä»¥å¯¼å‡ºå¤šä¸ª</p></li><li><p><code>CommonJs</code> æ˜¯åŠ¨æ€è¯­æ³•å¯ä»¥å†™åœ¨åˆ¤æ–­é‡Œï¼Œ<code>ES6 Module</code> é™æ€è¯­æ³•åªèƒ½å†™åœ¨é¡¶å±‚</p></li><li><p><code>CommonJs</code> çš„ <code>this</code> æ˜¯å½“å‰æ¨¡å—ï¼Œ<code>ES6 Module</code> çš„ <code>this</code> æ˜¯ <code>undefined</code></p></li><li><p><code>CommonJS</code>æ˜¯æœåŠ¡å™¨ç«¯æ¨¡å—çš„è§„èŒƒï¼Œ<code>CommonJS</code>è§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„</p></li></ul><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>export {&lt;å˜é‡&gt;}è¿™ç§æ–¹å¼ä¸€èˆ¬ç§°ä¸º å‘½åå¼å¯¼å‡º æˆ–è€… å…·åå¯¼å‡ºï¼Œå¯¼å‡ºçš„æ˜¯ä¸€ä¸ª<code>å˜é‡çš„å¼•ç”¨</code>ã€‚</li><li>export default è¿™ç§æ–¹å¼ç§°ä¸º é»˜è®¤å¯¼å‡º æˆ–è€… åŒ¿åå¯¼å‡ºï¼Œå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå€¼ã€‚</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// a.js</span><span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">10</span><span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">20</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  x <span class="token operator">=</span> <span class="token number">100</span>  y <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> x <span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> y<span class="token comment">// b.js</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> x <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./a.js"</span><span class="token keyword">import</span> y <span class="token keyword">from</span> <span class="token string">"./a.js"</span><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token comment">// 100,20</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="äºŒã€å®ç°"><a href="#äºŒã€å®ç°" class="headerlink" title="äºŒã€å®ç°"></a>äºŒã€å®ç°</h2><h3 id="2-1-æœ‰ä¾èµ–çš„è‡ªæ‰§è¡Œå‡½æ•°"><a href="#2-1-æœ‰ä¾èµ–çš„è‡ªæ‰§è¡Œå‡½æ•°" class="headerlink" title="2.1 æœ‰ä¾èµ–çš„è‡ªæ‰§è¡Œå‡½æ•°"></a>2.1 æœ‰ä¾èµ–çš„è‡ªæ‰§è¡Œå‡½æ•°</h3><ul><li>æ‰‹å·¥å¼•å…¥ä¾èµ–</li><li>ä¾èµ–å…³ç³»ä¸æ˜æ˜¾</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b  <span class="token punctuation">&#125;</span>  global<span class="token punctuation">.</span>addModule <span class="token operator">=</span> <span class="token punctuation">&#123;</span> add <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b  <span class="token punctuation">&#125;</span>  global<span class="token punctuation">.</span>minusModule <span class="token operator">=</span> <span class="token punctuation">&#123;</span> minus <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">global<span class="token punctuation">,</span> addModule<span class="token punctuation">,</span> minusModule</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  global<span class="token punctuation">.</span>mathModule <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">add</span><span class="token operator">:</span> addModule<span class="token punctuation">.</span>add<span class="token punctuation">,</span> <span class="token literal-property property">minus</span><span class="token operator">:</span> minusModule<span class="token punctuation">.</span>minus <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> addModule<span class="token punctuation">,</span> minusModule<span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mathModule<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>mathModule<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-2-AMD"><a href="#2-2-AMD" class="headerlink" title="2.2 AMD"></a>2.2 AMD</h3><ul><li><p><a href="https://requirejs.org/docs/release/2.1.20/minified/require.js">require.js</a></p></li><li><p>å‰ç½®ä¾èµ–</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">define</span><span class="token punctuation">(</span>id<span class="token operator">?</span><span class="token punctuation">,</span> dependencies<span class="token operator">?</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> moduleFactory <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  moduleFactory<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> factory<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">dependencies<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">callback</span><span class="token punctuation">(</span><span class="token operator">...</span>dependencies<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">dependency</span><span class="token punctuation">)</span> <span class="token operator">=></span> moduleFactory<span class="token punctuation">[</span>dependency<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"addModule"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    add<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"minusModule"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">minus</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    minus<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"addModule"</span><span class="token punctuation">,</span> <span class="token string">"minusModule"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">addModule<span class="token punctuation">,</span> minusModule</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>addModule<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> minusModule<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-3-CMD"><a href="#2-3-CMD" class="headerlink" title="2.3. CMD"></a>2.3. CMD</h3><ul><li><code>CMD</code> å«åšé€šç”¨æ¨¡å—å®šä¹‰è§„èŒƒï¼ˆCommon Module Defination )</li><li><a href="http://seajs.org/">seajs</a></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> factories <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> modules <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> factory <span class="token operator">=</span> factories<span class="token punctuation">[</span>name<span class="token punctuation">]</span>  <span class="token keyword">let</span> exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token function">factory</span><span class="token punctuation">(</span>require<span class="token punctuation">,</span> exports<span class="token punctuation">)</span>  modules<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> exports  <span class="token keyword">return</span> exports<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">define</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> factory</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  factories<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> factory<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">use</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">require</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"addModule"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"minusModule"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  exports<span class="token punctuation">.</span><span class="token function-variable function">minus</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">require<span class="token punctuation">,</span> exports</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> addModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"addModule"</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> result1 <span class="token operator">=</span> addModule<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result1<span class="token punctuation">)</span>  <span class="token keyword">var</span> minusModule <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"minusModule"</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> result2 <span class="token operator">=</span> minusModule<span class="token punctuation">.</span><span class="token function">minus</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result2<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ES6 </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>react è™šæ‹Ÿåˆ—è¡¨ä¹‹ FixedSizeList å°è£…</title>
      <link href="/2023/01/06/012fixedsizelist-feng-zhuang/"/>
      <url>/2023/01/06/012fixedsizelist-feng-zhuang/</url>
      
        <content type="html"><![CDATA[<h2 id="1-é•¿åˆ—è¡¨æ¸²æŸ“"><a href="#1-é•¿åˆ—è¡¨æ¸²æŸ“" class="headerlink" title="1. é•¿åˆ—è¡¨æ¸²æŸ“"></a>1. é•¿åˆ—è¡¨æ¸²æŸ“</h2><ul><li>å¦‚æœæœ‰æµ·é‡æ•°æ®åœ¨æµè§ˆå™¨é‡Œä¸€æ¬¡æ€§æ¸²æŸ“ä¼šæœ‰ä»¥ä¸‹é—®é¢˜<ul><li>è®¡ç®—æ—¶é—´è¿‡é•¿ï¼Œç”¨æˆ·éœ€è¦é•¿æ—¶é—´ç­‰å¾…ï¼Œä½“éªŒå·®</li><li>CPU å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œæ»‘åŠ¨è¿‡ç¨‹ä¸­å¯èƒ½å¡é¡¿</li><li>GPU è´Ÿè½½è¿‡é«˜ï¼Œæ¸²æŸ“ä¸è¿‡æ¥ä¼šå‡ºç°é—ªåŠ¨</li><li>å†…å­˜å ç”¨è¿‡å¤šï¼Œä¸¥é‡ä¼šå¼•èµ·æµè§ˆå™¨å¡æ­»å’Œå´©æºƒ</li></ul></li><li>ä¼˜åŒ–æ–¹æ³•<ul><li>ä¸‹æ‹‰åº•éƒ¨åŠ è½½æ›´å¤šå®ç°æ‡’åŠ è½½ï¼Œæ­¤æ–¹æ³•éšç€å†…å®¹è¶Šæ¥è¶Šå¤šï¼Œä¼šå¼•èµ·å¤§é‡çš„é‡æ’å’Œé‡ç»˜ï¼Œä¾èµ–å¯èƒ½ä¼šå¡é¡¿</li><li>è™šæ‹Ÿåˆ—è¡¨ å…¶å®æˆ‘ä»¬çš„å±å¹•å¯è§†åŒºåŸŸæ˜¯æœ‰é™çš„ï¼Œèƒ½çœ‹åˆ°çš„æ•°æ®ä¹Ÿæ˜¯æœ‰é™çš„,æ‰€ä»¥å¯ä»¥åœ¨ç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œåªæ¸²æŸ“å¯è§†åŒºåŸŸå†…çš„å†…å®¹å³å¯,ä¸å¯è§åŒºåŸŸç”¨ç©ºç™½å ä½å¡«å……, è¿™æ ·çš„è¯é¡µé¢ä¸­çš„ DOM å…ƒç´ å°‘ï¼ŒCPUã€GPU å’Œå†…å­˜è´Ÿè½½å°</li></ul></li></ul><h2 id="2-é•¿åˆ—è¡¨ç»„ä»¶"><a href="#2-é•¿åˆ—è¡¨ç»„ä»¶" class="headerlink" title="2.é•¿åˆ—è¡¨ç»„ä»¶"></a>2.é•¿åˆ—è¡¨ç»„ä»¶</h2><ul><li><a href="https://github.com/bvaughn/react-virtualized">react-virtualized</a></li><li><a href="https://github.com/bvaughn/react-window">react-window</a></li><li><a href="https://react-window.vercel.app/#/examples/list/fixed-size">react-window.vercel.app</a></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">npm i react<span class="token operator">-</span>window <span class="token operator">--</span>save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-å›ºå®šé«˜åº¦åˆ—è¡¨å®æˆ˜"><a href="#3-å›ºå®šé«˜åº¦åˆ—è¡¨å®æˆ˜" class="headerlink" title="3. å›ºå®šé«˜åº¦åˆ—è¡¨å®æˆ˜"></a>3. å›ºå®šé«˜åº¦åˆ—è¡¨å®æˆ˜</h2><h3 id="3-1-src-index-js"><a href="#3-1-src-index-js" class="headerlink" title="3.1 src\index.js"></a>3.1 src\index.js</h3><blockquote><p>src\index.js</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom/client"</span><span class="token keyword">import</span> FixedSizeList <span class="token keyword">from</span> <span class="token string">"./fixed-size-list"</span><span class="token keyword">const</span> root <span class="token operator">=</span> ReactDOM<span class="token punctuation">.</span><span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>FixedSizeList <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-fixed-size-list-js"><a href="#3-2-fixed-size-list-js" class="headerlink" title="3.2 fixed-size-list.js"></a>3.2 fixed-size-list.js</h3><blockquote><p>src\fixed-size-list.js</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> FixedSizeList <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"react-window"</span><span class="token keyword">import</span> <span class="token string">"./fixed-size-list.css"</span><span class="token keyword">const</span> <span class="token function-variable function">Row</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> index<span class="token punctuation">,</span> style <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>  <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token punctuation">&#123;</span>index <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token string">"ListItemOdd"</span> <span class="token operator">:</span> <span class="token string">"ListItemEven"</span><span class="token punctuation">&#125;</span> style<span class="token operator">=</span><span class="token punctuation">&#123;</span>style<span class="token punctuation">&#125;</span><span class="token operator">></span>    Row<span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span>  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">&lt;</span>FixedSizeList      className<span class="token operator">=</span><span class="token string">"List"</span>      height<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">200</span><span class="token punctuation">&#125;</span>      width<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">200</span><span class="token punctuation">&#125;</span>      itemSize<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">50</span><span class="token punctuation">&#125;</span>      itemCount<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token number">1000</span><span class="token punctuation">&#125;</span>    <span class="token operator">></span>      <span class="token punctuation">&#123;</span>Row<span class="token punctuation">&#125;</span>    <span class="token operator">&lt;</span><span class="token operator">/</span>FixedSizeList<span class="token operator">></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-3-fixed-size-list-css"><a href="#3-3-fixed-size-list-css" class="headerlink" title="3.3 fixed-size-list.css"></a>3.3 fixed-size-list.css</h3><blockquote><p>src\fixed-size-list.css</p></blockquote><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.List</span> <span class="token punctuation">&#123;</span>  <span class="token property">border</span><span class="token punctuation">:</span> 1px solid gray<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.ListItemEven,.ListItemOdd</span> <span class="token punctuation">&#123;</span>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>  <span class="token property">justify-content</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.ListItemOdd</span> <span class="token punctuation">&#123;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> lightcoral<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token selector">.ListItemEven</span> <span class="token punctuation">&#123;</span>  <span class="token property">background-color</span><span class="token punctuation">:</span> lightblue<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-FixedSizeListå®ç°"><a href="#4-FixedSizeListå®ç°" class="headerlink" title="4.FixedSizeListå®ç°"></a>4.<code>FixedSizeList</code>å®ç°</h2><h3 id="4-1-å…¨éƒ¨æ¸²æŸ“"><a href="#4-1-å…¨éƒ¨æ¸²æŸ“" class="headerlink" title="4. 1 å…¨éƒ¨æ¸²æŸ“"></a>4. 1 å…¨éƒ¨æ¸²æŸ“</h3><blockquote><p>é¦–å…ˆå®ç°ä¼ å…¥çš„æ•°æ®é¡µé¢å…¨éƒ¨æ¸²æŸ“</p></blockquote><p><img src="https://static.zhufengpeixun.com/reactwindowfixed_1651225094542.jpg" alt="åŸç†"></p><h4 id="4-1-1fixed-size-list-js"><a href="#4-1-1fixed-size-list-js" class="headerlink" title="4.1 .1fixed-size-list.js"></a>4.1 .1fixed-size-list.js</h4><p>src\fixed-size-list.js</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> FixedSizeList <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./react-window"</span><span class="token keyword">import</span> <span class="token string">"./fixed-size-list.css"</span><span class="token keyword">const</span> <span class="token function-variable function">Row</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> index<span class="token punctuation">,</span> style <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>index <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token string">"ListItemOdd"</span> <span class="token operator">:</span> <span class="token string">"ListItemEven"</span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>style<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">    Row</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span><span class="token plain-text">  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">FixedSizeList</span></span>      <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>List<span class="token punctuation">"</span></span>      <span class="token attr-name">height</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">200</span><span class="token punctuation">&#125;</span></span>      <span class="token attr-name">width</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">200</span><span class="token punctuation">&#125;</span></span>      <span class="token attr-name">itemSize</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">50</span><span class="token punctuation">&#125;</span></span>      <span class="token attr-name">itemCount</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token number">1000</span><span class="token punctuation">&#125;</span></span>    <span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token punctuation">&#123;</span>Row<span class="token punctuation">&#125;</span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">FixedSizeList</span></span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> App<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-1-2-react-window-index-js"><a href="#4-1-2-react-window-index-js" class="headerlink" title="4.1.2 react-window\index.js"></a>4.1.2 react-window\index.js</h4><p>src\react-window\index.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">export</span> <span class="token punctuation">&#123;</span> <span class="token keyword">default</span> <span class="token keyword">as</span> FixedSizeList <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"./FixedSizeList"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="4-1-3-FixedSizeList-js"><a href="#4-1-3-FixedSizeList-js" class="headerlink" title="4.1.3 FixedSizeList.js"></a>4.1.3 FixedSizeList.js</h4><p>src\react-window\FixedSizeList.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> createListComponent <span class="token keyword">from</span> <span class="token string">"./createListComponent"</span><span class="token keyword">const</span> FixedSizeList <span class="token operator">=</span> <span class="token function">createListComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  <span class="token function-variable function">getItemSize</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> itemSize <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> itemSize<span class="token punctuation">,</span> <span class="token comment">//æ¯ä¸ªæ¡ç›®çš„é«˜åº¦</span>  <span class="token function-variable function">getEstimatedTotalSize</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> itemSize<span class="token punctuation">,</span> itemCount <span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> itemSize <span class="token operator">*</span> itemCount<span class="token punctuation">,</span> <span class="token comment">//è·å–é¢„è®¡çš„æ€»é«˜åº¦</span>  <span class="token function-variable function">getItemOffset</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span> itemSize <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> itemSize <span class="token operator">*</span> index<span class="token punctuation">,</span> <span class="token comment">//è·å–æ¯ä¸ªæ¡ç›®çš„åç§»é‡</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">export</span> <span class="token keyword">default</span> FixedSizeList<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-1-4-createListComponent-js"><a href="#4-1-4-createListComponent-js" class="headerlink" title="4.1.4 createListComponent.js"></a>4.1.4 createListComponent.js</h4><p>src\react-window\createListComponent.js</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">createListComponent</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>  getEstimatedTotalSize<span class="token punctuation">,</span> <span class="token comment">//è·å–é¢„è®¡çš„æ€»é«˜åº¦</span>  getItemSize<span class="token punctuation">,</span> <span class="token comment">//æ¯ä¸ªæ¡ç›®çš„é«˜åº¦</span>  getItemOffset<span class="token punctuation">,</span> <span class="token comment">//è·å–æ¯ä¸ªæ¡ç›®çš„åç§»é‡</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">class</span> <span class="token class-name">extends</span> React<span class="token punctuation">.</span>Component <span class="token punctuation">&#123;</span>    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> itemCount<span class="token punctuation">,</span> <span class="token literal-property property">children</span><span class="token operator">:</span> ComponentType <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props      <span class="token keyword">const</span> containerStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">"relative"</span><span class="token punctuation">,</span>        width<span class="token punctuation">,</span>        height<span class="token punctuation">,</span>        <span class="token literal-property property">overflow</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>        <span class="token literal-property property">willChange</span><span class="token operator">:</span> <span class="token string">"transform"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">const</span> contentStyle <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token function">getEstimatedTotalSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">"100%"</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">const</span> items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>itemCount <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> itemCount<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>            <span class="token operator">&lt;</span>ComponentType              key<span class="token operator">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span>              index<span class="token operator">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span>              style<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getItemStyle</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>            <span class="token operator">/</span><span class="token operator">></span>          <span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> <span class="token punctuation">(</span>        <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span>containerStyle<span class="token punctuation">&#125;</span><span class="token operator">></span>          <span class="token operator">&lt;</span>div style<span class="token operator">=</span><span class="token punctuation">&#123;</span>contentStyle<span class="token punctuation">&#125;</span><span class="token operator">></span><span class="token punctuation">&#123;</span>items<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span>      <span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//è·å–æ¯ä¸ªitemçš„æ ·å¼</span>    <span class="token function-variable function">_getItemStyle</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> style <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">"absolute"</span><span class="token punctuation">,</span>        <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">"100%"</span><span class="token punctuation">,</span>        <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token function">getItemSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token literal-property property">top</span><span class="token operator">:</span> <span class="token function">getItemOffset</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span>      <span class="token keyword">return</span> style    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-2-æ¸²æŸ“é¦–å±"><a href="#4-2-æ¸²æŸ“é¦–å±" class="headerlink" title="4.2. æ¸²æŸ“é¦–å±"></a>4.2. æ¸²æŸ“é¦–å±</h2><h3 id="4-2-1-FixedSizeList-js"><a href="#4-2-1-FixedSizeList-js" class="headerlink" title="4.2.1 FixedSizeList.js"></a>4.2.1 FixedSizeList.js</h3><p>src\react-window\FixedSizeList.js</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">import createListComponent from './createListComponent';const FixedSizeList = createListComponent(&#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   getItemSize: (&#123; itemSize &#125;) => itemSize,//æ¯ä¸ªæ¡ç›®çš„é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getEstimatedTotalSize: (&#123; itemSize, itemCount &#125;) => itemSize * itemCount, //è·å–é¢„è®¡çš„æ€»é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemOffset: (&#123; itemSize &#125;, index) => itemSize * index, //è·å–æ¯ä¸ªæ¡ç›®çš„åç§»é‡</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   getStartIndexForOffset: (&#123; itemSize &#125;, offset) => Math.floor(offset / itemSize),//è·å–èµ·å§‹ç´¢å¼•</span><span class="token prefix inserted">+</span><span class="token line">   getStopIndexForStartIndex: (&#123; height, itemSize &#125;, startIndex) => &#123;//è·å–ç»“æŸç´¢å¼•</span><span class="token prefix inserted">+</span><span class="token line">       const numVisibleItems = Math.ceil(height / itemSize);</span><span class="token prefix inserted">+</span><span class="token line">       return startIndex + numVisibleItems - 1;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &#125;</span></span>&#125;);export default FixedSizeList;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-2-createListComponent-js"><a href="#4-2-2-createListComponent-js" class="headerlink" title="4.2.2 createListComponent.js"></a>4.2.2 createListComponent.js</h3><p>src\react-window\createListComponent.js</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">import React from 'react';export default function createListComponent(&#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   getEstimatedTotalSize,//è·å–é¢„è®¡çš„æ€»é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemSize,//æ¯ä¸ªæ¡ç›®çš„é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemOffset,//è·å–æ¯ä¸ªæ¡ç›®çš„åç§»é‡</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">   getStartIndexForOffset,</span><span class="token prefix inserted">+</span><span class="token line">   getStopIndexForStartIndex</span></span>&#125;) &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return class extends React.Component &#123;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       state = &#123; scrollOffset: 0 &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       render() &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const &#123; width, height, itemCount, children: ComponentType &#125; = this.props;</span><span class="token prefix unchanged"> </span><span class="token line">           const containerStyle = &#123; position: 'relative', width, height, overflow: 'auto', willChange: 'transform' &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           const contentStyle = &#123; height: getEstimatedTotalSize(this.props), width: '100%' &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           const items = [];</span><span class="token prefix unchanged"> </span><span class="token line">           if (itemCount > 0) &#123;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">               const [startIndex, stopIndex] = this._getRangeToRender();</span><span class="token prefix inserted">+</span><span class="token line">               for (let index = startIndex; index &lt;= stopIndex; index++) &#123;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                   items.push(</span><span class="token prefix unchanged"> </span><span class="token line">                       &lt;ComponentType key=&#123;index&#125; index=&#123;index&#125; style=&#123;this._getItemStyle(index)&#125; /></span><span class="token prefix unchanged"> </span><span class="token line">                   );</span><span class="token prefix unchanged"> </span><span class="token line">               &#125;</span><span class="token prefix unchanged"> </span><span class="token line">           &#125;</span><span class="token prefix unchanged"> </span><span class="token line">           return (</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;div style=&#123;containerStyle&#125;></span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;div style=&#123;contentStyle&#125;></span><span class="token prefix unchanged"> </span><span class="token line">                       &#123;items&#125;</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;/div></span><span class="token prefix unchanged"> </span><span class="token line">               &lt;/div></span><span class="token prefix unchanged"> </span><span class="token line">           )</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       _getItemStyle = (index) => &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const style = &#123;</span><span class="token prefix unchanged"> </span><span class="token line">               position: 'absolute',</span><span class="token prefix unchanged"> </span><span class="token line">               width: '100%',</span><span class="token prefix unchanged"> </span><span class="token line">               height: getItemSize(this.props),</span><span class="token prefix unchanged"> </span><span class="token line">               top: getItemOffset(this.props, index)</span><span class="token prefix unchanged"> </span><span class="token line">           &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           return style;</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       _getRangeToRender = () => &#123;</span><span class="token prefix inserted">+</span><span class="token line">           const &#123; scrollOffset &#125; = this.state;</span><span class="token prefix inserted">+</span><span class="token line">           const startIndex = getStartIndexForOffset(this.props, scrollOffset);</span><span class="token prefix inserted">+</span><span class="token line">           const stopIndex = getStopIndexForStartIndex(this.props, startIndex);</span><span class="token prefix inserted">+</span><span class="token line">           return [startIndex, stopIndex];</span><span class="token prefix inserted">+</span><span class="token line">       &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   &#125;</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-3-ç›‘å¬æ»šåŠ¨"><a href="#4-3-ç›‘å¬æ»šåŠ¨" class="headerlink" title="4.3. ç›‘å¬æ»šåŠ¨"></a>4.3. ç›‘å¬æ»šåŠ¨</h2><h3 id="4-3-1-createListComponent-js"><a href="#4-3-1-createListComponent-js" class="headerlink" title="4.3.1 createListComponent.js"></a>4.3.1 createListComponent.js</h3><p>src\react-window\createListComponent.js</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">import React from 'react';export default function createListComponent(&#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   getEstimatedTotalSize,//è·å–é¢„è®¡çš„æ€»é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemSize,//æ¯ä¸ªæ¡ç›®çš„é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemOffset,//è·å–æ¯ä¸ªæ¡ç›®çš„åç§»é‡</span><span class="token prefix unchanged"> </span><span class="token line">   getStartIndexForOffset,</span><span class="token prefix unchanged"> </span><span class="token line">   getStopIndexForStartIndex</span></span>&#125;) &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return class extends React.Component &#123;</span><span class="token prefix unchanged"> </span><span class="token line">       state = &#123; scrollOffset: 0 &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       render() &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const &#123; width, height, itemCount, children: ComponentType &#125; = this.props;</span><span class="token prefix unchanged"> </span><span class="token line">           const containerStyle = &#123; position: 'relative', width, height, overflow: 'auto', willChange: 'transform' &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           const contentStyle = &#123; height: getEstimatedTotalSize(this.props), width: '100%' &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           const items = [];</span><span class="token prefix unchanged"> </span><span class="token line">           if (itemCount > 0) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">               const [startIndex, stopIndex] = this._getRangeToRender();</span><span class="token prefix unchanged"> </span><span class="token line">               for (let index = startIndex; index &lt;= stopIndex; index++) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">                   items.push(</span><span class="token prefix unchanged"> </span><span class="token line">                       &lt;ComponentType key=&#123;index&#125; index=&#123;index&#125; style=&#123;this._getItemStyle(index)&#125; /></span><span class="token prefix unchanged"> </span><span class="token line">                   );</span><span class="token prefix unchanged"> </span><span class="token line">               &#125;</span><span class="token prefix unchanged"> </span><span class="token line">           &#125;</span><span class="token prefix unchanged"> </span><span class="token line">           return (</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">               &lt;div style=&#123;containerStyle&#125; onScroll=&#123;this.onScroll&#125;></span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">                   &lt;div style=&#123;contentStyle&#125;></span><span class="token prefix unchanged"> </span><span class="token line">                       &#123;items&#125;</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;/div></span><span class="token prefix unchanged"> </span><span class="token line">               &lt;/div></span><span class="token prefix unchanged"> </span><span class="token line">           )</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       onScroll = event => &#123;</span><span class="token prefix inserted">+</span><span class="token line">           const &#123; scrollTop &#125; = event.currentTarget;</span><span class="token prefix inserted">+</span><span class="token line">           this.setState(&#123; scrollOffset: scrollTop &#125;);</span><span class="token prefix inserted">+</span><span class="token line">       &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       _getItemStyle = (index) => &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const style = &#123;</span><span class="token prefix unchanged"> </span><span class="token line">               position: 'absolute',</span><span class="token prefix unchanged"> </span><span class="token line">               width: '100%',</span><span class="token prefix unchanged"> </span><span class="token line">               height: getItemSize(this.props),</span><span class="token prefix unchanged"> </span><span class="token line">               top: getItemOffset(this.props, index)</span><span class="token prefix unchanged"> </span><span class="token line">           &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           return style;</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       _getRangeToRender = () => &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const &#123; scrollOffset &#125; = this.state;</span><span class="token prefix unchanged"> </span><span class="token line">           const startIndex = getStartIndexForOffset(this.props, scrollOffset);</span><span class="token prefix unchanged"> </span><span class="token line">           const stopIndex = getStopIndexForStartIndex(this.props, startIndex);</span><span class="token prefix unchanged"> </span><span class="token line">           return [startIndex, stopIndex]</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">   &#125;</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-4-overscan-å¢åŠ ç¼“å­˜åŒºåŸŸ"><a href="#4-4-overscan-å¢åŠ ç¼“å­˜åŒºåŸŸ" class="headerlink" title="4.4. overscan (å¢åŠ ç¼“å­˜åŒºåŸŸ)"></a>4.4. overscan (å¢åŠ ç¼“å­˜åŒºåŸŸ)</h2><ul><li>è¿‡æ‰«æå®è´¨ä¸Šæ˜¯åˆ‡æ–­å›¾ç‰‡çš„è¾¹ç¼˜ï¼Œä»¥ç¡®ä¿æ‰€æœ‰é‡è¦çš„ä¸œè¥¿æ˜¾ç¤ºåœ¨å±å¹•ä¸Š <img src="https://static.zhufengpeixun.com/Overscan_1651392914894.png" alt="img"></li></ul><h3 id="4-4-1-createListComponent-js"><a href="#4-4-1-createListComponent-js" class="headerlink" title="4.4.1 createListComponent.js"></a>4.4.1 createListComponent.js</h3><p>src\react-window\createListComponent.js</p><pre class="line-numbers language-diff" data-language="diff"><code class="language-diff">import React from 'react';export default function createListComponent(&#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   getEstimatedTotalSize,//è·å–é¢„è®¡çš„æ€»é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemSize,//æ¯ä¸ªæ¡ç›®çš„é«˜åº¦</span><span class="token prefix unchanged"> </span><span class="token line">   getItemOffset,//è·å–æ¯ä¸ªæ¡ç›®çš„åç§»é‡</span><span class="token prefix unchanged"> </span><span class="token line">   getStartIndexForOffset,</span><span class="token prefix unchanged"> </span><span class="token line">   getStopIndexForStartIndex</span></span>&#125;) &#123;<span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">   return class extends React.Component &#123;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">       static defaultProps = &#123;</span><span class="token prefix inserted">+</span><span class="token line">           overscanCount: 2</span><span class="token prefix inserted">+</span><span class="token line">       &#125;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">       state = &#123; scrollOffset: 0 &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       render() &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const &#123; width, height, itemCount, children: ComponentType &#125; = this.props;</span><span class="token prefix unchanged"> </span><span class="token line">           const containerStyle = &#123; position: 'relative', width, height, overflow: 'auto', willChange: 'transform' &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           const contentStyle = &#123; height: getEstimatedTotalSize(this.props), width: '100%' &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           const items = [];</span><span class="token prefix unchanged"> </span><span class="token line">           if (itemCount > 0) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">               const [startIndex, stopIndex] = this._getRangeToRender();</span><span class="token prefix unchanged"> </span><span class="token line">               for (let index = startIndex; index &lt;= stopIndex; index++) &#123;</span><span class="token prefix unchanged"> </span><span class="token line">                   items.push(</span><span class="token prefix unchanged"> </span><span class="token line">                       &lt;ComponentType key=&#123;index&#125; index=&#123;index&#125; style=&#123;this._getItemStyle(index)&#125; /></span><span class="token prefix unchanged"> </span><span class="token line">                   );</span><span class="token prefix unchanged"> </span><span class="token line">               &#125;</span><span class="token prefix unchanged"> </span><span class="token line">           &#125;</span><span class="token prefix unchanged"> </span><span class="token line">           return (</span><span class="token prefix unchanged"> </span><span class="token line">               &lt;div style=&#123;containerStyle&#125; onScroll=&#123;this.onScroll&#125;></span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;div style=&#123;contentStyle&#125;></span><span class="token prefix unchanged"> </span><span class="token line">                       &#123;items&#125;</span><span class="token prefix unchanged"> </span><span class="token line">                   &lt;/div></span><span class="token prefix unchanged"> </span><span class="token line">               &lt;/div></span><span class="token prefix unchanged"> </span><span class="token line">           )</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       onScroll = event => &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const &#123; scrollTop &#125; = event.currentTarget;</span><span class="token prefix unchanged"> </span><span class="token line">           this.setState(&#123; scrollOffset: scrollTop &#125;);</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       _getItemStyle = (index) => &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const style = &#123;</span><span class="token prefix unchanged"> </span><span class="token line">               position: 'absolute',</span><span class="token prefix unchanged"> </span><span class="token line">               width: '100%',</span><span class="token prefix unchanged"> </span><span class="token line">               height: getItemSize(this.props),</span><span class="token prefix unchanged"> </span><span class="token line">               top: getItemOffset(this.props, index)</span><span class="token prefix unchanged"> </span><span class="token line">           &#125;;</span><span class="token prefix unchanged"> </span><span class="token line">           return style;</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">       _getRangeToRender = () => &#123;</span><span class="token prefix unchanged"> </span><span class="token line">           const &#123; scrollOffset &#125; = this.state;</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">           const &#123; itemCount, overscanCount &#125; = this.props;</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">           const startIndex = getStartIndexForOffset(this.props, scrollOffset);</span><span class="token prefix unchanged"> </span><span class="token line">           const stopIndex = getStopIndexForStartIndex(this.props, startIndex);</span><span class="token prefix unchanged"> </span><span class="token line">           return [</span></span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span><span class="token line">               Math.max(0, startIndex - overscanCount),</span><span class="token prefix inserted">+</span><span class="token line">               Math.max(0, Math.min(itemCount - 1, stopIndex + overscanCount)),</span></span><span class="token unchanged"><span class="token prefix unchanged"> </span><span class="token line">               startIndex, stopIndex]</span><span class="token prefix unchanged"> </span><span class="token line">       &#125;</span><span class="token prefix unchanged"> </span><span class="token line">   &#125;</span></span>&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> reactå…¨å®¶æ¡¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> reactç»„ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ä»‹ç»ä¸ç¼“å­˜ç­–ç•¥å‰–æ</title>
      <link href="/2023/01/06/011-liu-lan-qi-de-huan-cun-ji-zhi/"/>
      <url>/2023/01/06/011-liu-lan-qi-de-huan-cun-ji-zhi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¼“å­˜å¯ä»¥å‡å°‘ç½‘ç»œ Â <code>IO</code>Â  æ¶ˆè€—ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚æµè§ˆå™¨ç¼“å­˜æ˜¯ä¸€ç§æ“ä½œç®€å•ã€æ•ˆæœæ˜¾è‘—çš„å‰ç«¯æ€§èƒ½ä¼˜åŒ–æ‰‹æ®µã€‚å¯¹äºè¿™ä¸ªæ“ä½œçš„å¿…è¦æ€§ï¼ŒChrome å®˜æ–¹ç»™å‡ºçš„è§£é‡Šä¼¼ä¹æ›´æœ‰è¯´æœåŠ›ä¸€äº›ï¼š</p></blockquote><blockquote><p>é€šè¿‡ç½‘ç»œè·å–å†…å®¹æ—¢é€Ÿåº¦ç¼“æ…¢åˆå¼€é”€å·¨å¤§ã€‚è¾ƒå¤§çš„å“åº”éœ€è¦åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œå¤šæ¬¡å¾€è¿”é€šä¿¡ï¼Œè¿™ä¼šå»¶è¿Ÿæµè§ˆå™¨è·å¾—å’Œå¤„ç†å†…å®¹çš„æ—¶é—´ï¼Œè¿˜ä¼šå¢åŠ è®¿é—®è€…çš„æµé‡è´¹ç”¨ã€‚å› æ­¤ï¼Œç¼“å­˜å¹¶é‡å¤åˆ©ç”¨ä¹‹å‰è·å–çš„èµ„æºçš„èƒ½åŠ›æˆä¸ºæ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªå…³é”®æ–¹é¢ã€‚</p></blockquote><ul><li>å¾ˆå¤šæ—¶å€™ï¼Œå¤§å®¶å€¾å‘äºå°†æµè§ˆå™¨ç¼“å­˜ç®€å•åœ°ç†è§£ä¸ºâ€œHTTP ç¼“å­˜â€ã€‚ä½†äº‹å®ä¸Šï¼Œæµè§ˆå™¨ç¼“å­˜æœºåˆ¶æœ‰å››ä¸ªæ–¹é¢ï¼Œå®ƒä»¬æŒ‰ç…§è·å–èµ„æºæ—¶è¯·æ±‚çš„ä¼˜å…ˆçº§ä¾æ¬¡æ’åˆ—å¦‚ä¸‹ï¼š</li></ul><ol><li> <code>Memory Cache</code></li><li> <code>Service Worker Cache</code></li><li> <code>HTTP Cache</code></li><li> <code>Push Cache</code></li></ol><blockquote><p>å¤§å®¶å¯¹ Â <code>HTTP Cache</code>ï¼ˆå³ Â <code>Cache-Control</code>ã€<code>expires</code>Â  ç­‰å­—æ®µæ§åˆ¶çš„ç¼“å­˜ï¼‰åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰ï¼Œå¦‚æœå¯¹å…¶å®ƒå‡ ç§ç¼“å­˜å¯èƒ½è¿˜æ²¡ä»€ä¹ˆæ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸€å¼ çº¿ä¸Šç½‘ç«™çš„ Â <code>Network</code>Â  é¢æ¿æˆªå›¾ï¼š</p></blockquote><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ddfa3219d3f3410fabad2cc0d765dcdf~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><p>æˆ‘ä»¬ç»™ Â <code>size</code>Â  è¿™ä¸€æ ä¸€ä¸ªç‰¹å†™ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/127ce325ad70464abf9b713d4812fb29~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><blockquote><p>å¤§å®¶æ³¨æ„ä¸€ä¸‹éæ•°å­—â€”â€”å³å½¢å¦‚â€œï¼ˆ<code>from xxx</code>ï¼‰â€è¿™æ ·çš„æè¿°â€”â€”å¯¹åº”çš„èµ„æºï¼Œè¿™äº›èµ„æºå°±æ˜¯æˆ‘ä»¬é€šè¿‡ç¼“å­˜è·å–åˆ°çš„ã€‚å…¶ä¸­ï¼Œâ€œfrom memory cacheâ€å¯¹æ ‡åˆ° Â <code>Memory Cache</code>Â  ç±»å‹ï¼Œâ€œ<code>from ServiceWorker</code>â€å¯¹æ ‡åˆ° Â <code>Service Worker Cache</code>Â  ç±»å‹ã€‚è‡³äº Â <code>Push Cache</code>ï¼Œè¿™ä¸ªæ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯ Â <code>HTTP2</code>Â  çš„æ–°ç‰¹æ€§ã€‚</p></blockquote><p>æœ¬èŠ‚å°†ä¼šé’ˆå¯¹è¿™å››ä¸ªæ–¹é¢å„ä¸ªå‡»ç ´ã€‚è€ƒè™‘åˆ° HTTP ç¼“å­˜æ˜¯æœ€ä¸»è¦ã€æœ€å…·æœ‰ä»£è¡¨æ€§çš„ç¼“å­˜ç­–ç•¥ï¼Œä¹Ÿæ˜¯æ¯ä¸€ä½å‰ç«¯å·¥ç¨‹å¸ˆéƒ½åº”è¯¥æ·±åˆ»ç†è§£æŒæ¡çš„æ€§èƒ½ä¼˜åŒ–çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬ä¸‹é¢ä¼˜å…ˆé’ˆå¯¹ HTTP ç¼“å­˜æœºåˆ¶è¿›è¡Œå‰–æã€‚</p><h1 id="HTTP-ç¼“å­˜æœºåˆ¶æ¢ç§˜"><a href="#HTTP-ç¼“å­˜æœºåˆ¶æ¢ç§˜" class="headerlink" title="HTTP ç¼“å­˜æœºåˆ¶æ¢ç§˜"></a>HTTP ç¼“å­˜æœºåˆ¶æ¢ç§˜</h1><hr><p>HTTP ç¼“å­˜æ˜¯æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­æœ€ä¸ºç†Ÿæ‚‰çš„ä¸€ç§ç¼“å­˜æœºåˆ¶ã€‚å®ƒåˆåˆ†ä¸º<strong>å¼ºç¼“å­˜</strong>å’Œ<strong>åå•†ç¼“å­˜</strong>ã€‚ä¼˜å…ˆçº§è¾ƒé«˜çš„æ˜¯å¼ºç¼“å­˜ï¼Œåœ¨å‘½ä¸­å¼ºç¼“å­˜å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šèµ°åå•†ç¼“å­˜ã€‚</p><h2 id="1-å¼ºç¼“å­˜çš„ç‰¹å¾"><a href="#1-å¼ºç¼“å­˜çš„ç‰¹å¾" class="headerlink" title="1. å¼ºç¼“å­˜çš„ç‰¹å¾"></a><strong>1. å¼ºç¼“å­˜çš„ç‰¹å¾</strong></h2><blockquote><p>å¼ºç¼“å­˜æ˜¯åˆ©ç”¨ Â <code>http</code>Â  å¤´ä¸­çš„ Â <code>Expires</code>Â  å’Œ Â <code>Cache-Control</code>Â  ä¸¤ä¸ªå­—æ®µæ¥æ§åˆ¶çš„ã€‚å¼ºç¼“å­˜ä¸­ï¼Œå½“è¯·æ±‚å†æ¬¡å‘å‡ºæ—¶ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®å…¶ä¸­çš„ Â <code>expires</code>Â  å’Œ Â <code>cache-control</code>Â  åˆ¤æ–­ç›®æ ‡èµ„æºæ˜¯å¦â€œå‘½ä¸­â€å¼ºç¼“å­˜ï¼Œè‹¥å‘½ä¸­åˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è·å–èµ„æºï¼Œ<strong>ä¸ä¼šå†ä¸æœåŠ¡ç«¯å‘ç”Ÿé€šä¿¡ã€‚</strong></p></blockquote><p>å‘½ä¸­å¼ºç¼“å­˜çš„æƒ…å†µä¸‹ï¼Œè¿”å›çš„ Â <code>HTTP</code>Â  çŠ¶æ€ç ä¸º Â <code>200</code>Â ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fb3ff675124489484fe40580bf90a4d~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><h2 id="2-å¼ºç¼“å­˜çš„å®ç°ï¼šä»-expires-åˆ°-cache-control"><a href="#2-å¼ºç¼“å­˜çš„å®ç°ï¼šä»-expires-åˆ°-cache-control" class="headerlink" title="2. å¼ºç¼“å­˜çš„å®ç°ï¼šä» expires åˆ° cache-control"></a><strong>2. å¼ºç¼“å­˜çš„å®ç°ï¼šä» expires åˆ° cache-control</strong></h2><ul><li>å®ç°å¼ºç¼“å­˜ï¼Œè¿‡å»æˆ‘ä»¬ä¸€ç›´ç”¨ Â <code>expires</code>ã€‚</li><li>å½“æœåŠ¡å™¨è¿”å›å“åº”æ—¶ï¼Œåœ¨ Â <code>Response Headers</code>Â  ä¸­å°†è¿‡æœŸæ—¶é—´å†™å…¥ Â <code>expires</code>Â  å­—æ®µã€‚åƒè¿™æ ·ï¼š</li></ul><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6157f49ca998455fbfbada92149b0f08~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><p>æˆ‘ä»¬ç»™ Â <code>expires</code>Â  ä¸€ä¸ªç‰¹å†™ï¼š</p><pre class="line-numbers language-none"><code class="language-none">expires: Wed, 11 Sep 2019 16:12:18 GMT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><ul><li>å¯ä»¥çœ‹åˆ°ï¼Œ<code>expires</code>Â  æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œæ¥ä¸‹æ¥å¦‚æœæˆ‘ä»¬è¯•å›¾å†æ¬¡å‘æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼Œæµè§ˆå™¨å°±ä¼šå…ˆå¯¹æ¯”æœ¬åœ°æ—¶é—´å’Œ Â <code>expires</code>Â  çš„æ—¶é—´æˆ³ï¼Œå¦‚æœæœ¬åœ°æ—¶é—´å°äº Â <code>expires</code>Â  è®¾å®šçš„è¿‡æœŸæ—¶é—´ï¼Œé‚£ä¹ˆå°±ç›´æ¥å»ç¼“å­˜ä¸­å–è¿™ä¸ªèµ„æºã€‚</li><li>ä»è¿™æ ·çš„æè¿°ä¸­å¤§å®¶ä¹Ÿä¸éš¾çŒœæµ‹ï¼Œ<code>expires</code>Â  æ˜¯æœ‰é—®é¢˜çš„ï¼Œå®ƒæœ€å¤§çš„é—®é¢˜åœ¨äºå¯¹â€œæœ¬åœ°æ—¶é—´â€çš„ä¾èµ–ã€‚å¦‚æœæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„æ—¶é—´è®¾ç½®å¯èƒ½ä¸åŒï¼Œæˆ–è€…æˆ‘ç›´æ¥æ‰‹åŠ¨å»æŠŠå®¢æˆ·ç«¯çš„æ—¶é—´æ”¹æ‰ï¼Œé‚£ä¹ˆ Â <code>expires</code>Â  å°†æ— æ³•è¾¾åˆ°æˆ‘ä»¬çš„é¢„æœŸã€‚</li><li>è€ƒè™‘åˆ° Â <code>expires</code>Â  çš„å±€é™æ€§ï¼Œ<code>HTTP1.1</code>Â  æ–°å¢äº† Â <code>Cache-Control</code>Â  å­—æ®µæ¥å®Œæˆ Â <code>expires</code>Â  çš„ä»»åŠ¡ã€‚<br>expires èƒ½åšçš„äº‹æƒ…ï¼ŒCache-Control éƒ½èƒ½åšï¼›<code>expires</code>Â  å®Œæˆä¸äº†çš„äº‹æƒ…ï¼Œ<code>Cache-Control</code>Â  ä¹Ÿèƒ½åšã€‚å› æ­¤ï¼Œ<code>Cache-Control</code>Â  å¯ä»¥è§†ä½œæ˜¯ Â <code>expires</code>Â  çš„<strong>å®Œå…¨æ›¿ä»£æ–¹æ¡ˆ</strong>ã€‚åœ¨å½“ä¸‹çš„å‰ç«¯å®è·µé‡Œï¼Œæˆ‘ä»¬ç»§ç»­ä½¿ç”¨ Â <code>expires</code>Â  çš„å”¯ä¸€ç›®çš„å°±æ˜¯<strong>å‘ä¸‹å…¼å®¹</strong>ã€‚</li></ul><blockquote><p>ç°åœ¨æˆ‘ä»¬ç»™ Â <code>Cache-Control</code>Â  å­—æ®µä¸€ä¸ªç‰¹å†™ï¼š</p></blockquote><pre class="line-numbers language-none"><code class="language-none">cache-control: max-age&#x3D;31536000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><blockquote><p>å¦‚å¤§å®¶æ‰€è§ï¼Œåœ¨ Â <code>Cache-Control</code>Â  ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ Â <code>max-age</code>Â  æ¥æ§åˆ¶èµ„æºçš„æœ‰æ•ˆæœŸã€‚<code>max-age</code>Â  ä¸æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œè€Œæ˜¯ä¸€ä¸ªæ—¶é—´é•¿åº¦ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>max-age</code>Â  æ˜¯ 31536000 ç§’ï¼Œå®ƒæ„å‘³ç€è¯¥èµ„æºåœ¨ 31536000 ç§’ä»¥å†…éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œå®Œç¾åœ°è§„é¿äº†æ—¶é—´æˆ³å¸¦æ¥çš„æ½œåœ¨é—®é¢˜ã€‚</p></blockquote><p><strong>Cache-Control ç›¸å¯¹äº expires æ›´åŠ å‡†ç¡®ï¼Œå®ƒçš„ä¼˜å…ˆçº§ä¹Ÿæ›´é«˜ã€‚å½“ Cache-Control ä¸ expires åŒæ—¶å‡ºç°æ—¶ï¼Œæˆ‘ä»¬ä»¥ Cache-Control ä¸ºå‡†ã€‚</strong></p><h2 id="3-Cache-Control-åº”ç”¨åˆ†æ"><a href="#3-Cache-Control-åº”ç”¨åˆ†æ" class="headerlink" title="3. Cache-Control åº”ç”¨åˆ†æ"></a><strong>3. Cache-Control åº”ç”¨åˆ†æ</strong></h2><blockquote><p><code>Cache-Control</code>Â  çš„ç¥é€šï¼Œå¯ä¸æ­¢äºè¿™ä¸€ä¸ªå°å°çš„ Â <code>max-age</code>ã€‚å¦‚ä¸‹çš„ç”¨æ³•ä¹Ÿéå¸¸å¸¸è§ï¼š</p></blockquote><pre class="line-numbers language-none"><code class="language-none">cache-control: max-age&#x3D;3600, s-maxage&#x3D;31536000<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><p><strong>s-maxage ä¼˜å…ˆçº§é«˜äº max-ageï¼Œä¸¤è€…åŒæ—¶å‡ºç°æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ s-maxageã€‚å¦‚æœ s-maxage æœªè¿‡æœŸï¼Œåˆ™å‘ä»£ç†æœåŠ¡å™¨è¯·æ±‚å…¶ç¼“å­˜å†…å®¹ã€‚</strong></p><blockquote><p>è¿™ä¸ª Â <code>s-maxage</code>Â  ä¸åƒ Â <code>max-age</code>Â  ä¸€æ ·ä¸ºå¤§å®¶æ‰€ç†ŸçŸ¥ã€‚çš„ç¡®ï¼Œåœ¨é¡¹ç›®ä¸æ˜¯ç‰¹åˆ«å¤§çš„åœºæ™¯ä¸‹ï¼Œ<code>max-age</code>Â  è¶³å¤Ÿç”¨äº†ã€‚ä½†åœ¨ä¾èµ–å„ç§<strong>ä»£ç†</strong>çš„å¤§å‹æ¶æ„ä¸­ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘<strong>ä»£ç†æœåŠ¡å™¨</strong>çš„ç¼“å­˜é—®é¢˜ã€‚<code>s-maxage</code>Â  å°±æ˜¯ç”¨äºè¡¨ç¤º Â <code>cache</code>Â  æœåŠ¡å™¨ä¸Šï¼ˆæ¯”å¦‚ Â <code>cache CDN</code>ï¼‰çš„ç¼“å­˜çš„æœ‰æ•ˆæ—¶é—´çš„ï¼Œå¹¶åªå¯¹ Â <code>public</code>Â  ç¼“å­˜æœ‰æ•ˆã€‚</p></blockquote><ul><li>æ­¤å¤„åº”æ³¨æ„è¿™æ ·ä¸€ä¸ªç»†èŠ‚ï¼š<code>s-maxage</code>ä»…åœ¨ä»£ç†æœåŠ¡å™¨ä¸­ç”Ÿæ•ˆï¼Œå®¢æˆ·ç«¯ä¸­æˆ‘ä»¬åªè€ƒè™‘<code>max-age</code></li><li>é‚£ä¹ˆä»€ä¹ˆæ˜¯ Â <code>public</code>Â  ç¼“å­˜å‘¢ï¼Ÿè¯´åˆ°è¿™é‡Œï¼Œ<code>Cache-Control</code>Â  ä¸­æœ‰ä¸€äº›é€‚åˆæ”¾åœ¨ä¸€èµ·ç†è§£çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬é›†ä¸­æ¢³ç†ä¸€ä¸‹ï¼š</li></ul><p><strong>3.1 public ä¸ private</strong></p><ul><li><code>public</code>Â  ä¸ Â <code>private</code>Â  æ˜¯é’ˆå¯¹èµ„æºæ˜¯å¦èƒ½å¤Ÿè¢«ä»£ç†æœåŠ¡ç¼“å­˜è€Œå­˜åœ¨çš„ä¸€ç»„å¯¹ç«‹æ¦‚å¿µã€‚</li><li>å¦‚æœæˆ‘ä»¬ä¸ºèµ„æºè®¾ç½®äº† Â <code>public</code>ï¼Œé‚£ä¹ˆå®ƒæ—¢å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜ï¼Œä¹Ÿå¯ä»¥è¢«ä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼›å¦‚æœæˆ‘ä»¬è®¾ç½®äº† Â <code>private</code>ï¼Œåˆ™è¯¥èµ„æºåªèƒ½è¢«æµè§ˆå™¨ç¼“å­˜ã€‚<code>private</code>Â  ä¸º<strong>é»˜è®¤å€¼</strong>ã€‚ä½†å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>public</code>Â  å¹¶ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®ï¼Œæ¯”å¦‚æœ‰å¾ˆå¤šçº¿ä¸Šç½‘ç«™çš„ Â <code>cache-control</code>Â  æ˜¯è¿™æ ·çš„ï¼š</li></ul><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1852b17ee6ad45d2a36f41256079e56e~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><blockquote><p>è®¾ç½®äº† Â <code>s-maxage</code>ï¼Œæ²¡è®¾ç½® Â <code>public</code>ï¼Œé‚£ä¹ˆ Â <code>CDN</code>Â  è¿˜å¯ä»¥ç¼“å­˜è¿™ä¸ªèµ„æºå—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å› ä¸ºæ˜ç¡®çš„ç¼“å­˜ä¿¡æ¯ï¼ˆä¾‹å¦‚â€œ<code>max-age</code>â€ï¼‰å·²è¡¨ç¤ºå“åº”æ˜¯å¯ä»¥ç¼“å­˜çš„ã€‚</p></blockquote><p><strong>3.2 no-store ä¸ no-cache</strong></p><ul><li><code>no-cache</code>Â  ç»•å¼€äº†æµè§ˆå™¨ï¼šæˆ‘ä»¬ä¸ºèµ„æºè®¾ç½®äº† Â <code>no-cache</code>Â  åï¼Œæ¯ä¸€æ¬¡å‘èµ·è¯·æ±‚éƒ½ä¸ä¼šå†å»è¯¢é—®æµè§ˆå™¨çš„ç¼“å­˜æƒ…å†µï¼Œè€Œæ˜¯ç›´æ¥å‘æœåŠ¡ç«¯å»ç¡®è®¤è¯¥èµ„æºæ˜¯å¦è¿‡æœŸï¼ˆå³èµ°æˆ‘ä»¬ä¸‹æ–‡å³å°†è®²è§£çš„åå•†ç¼“å­˜çš„è·¯çº¿ï¼‰ã€‚</li><li><code>no-store</code>Â  æ¯”è¾ƒç»æƒ…ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸ä½¿ç”¨ä»»ä½•ç¼“å­˜ç­–ç•¥ã€‚åœ¨ Â <code>no-cache</code>Â  çš„åŸºç¡€ä¸Šï¼Œå®ƒè¿æœåŠ¡ç«¯çš„ç¼“å­˜ç¡®è®¤ä¹Ÿç»•å¼€äº†ï¼Œåªå…è®¸ä½ ç›´æ¥å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ã€å¹¶ä¸‹è½½å®Œæ•´çš„å“åº”ã€‚</li></ul><h2 id="4-åå•†ç¼“å­˜ï¼šæµè§ˆå™¨ä¸æœåŠ¡å™¨åˆä½œä¹‹ä¸‹çš„ç¼“å­˜ç­–ç•¥"><a href="#4-åå•†ç¼“å­˜ï¼šæµè§ˆå™¨ä¸æœåŠ¡å™¨åˆä½œä¹‹ä¸‹çš„ç¼“å­˜ç­–ç•¥" class="headerlink" title="4. åå•†ç¼“å­˜ï¼šæµè§ˆå™¨ä¸æœåŠ¡å™¨åˆä½œä¹‹ä¸‹çš„ç¼“å­˜ç­–ç•¥"></a><strong>4. åå•†ç¼“å­˜ï¼šæµè§ˆå™¨ä¸æœåŠ¡å™¨åˆä½œä¹‹ä¸‹çš„ç¼“å­˜ç­–ç•¥</strong></h2><ul><li>åå•†ç¼“å­˜ä¾èµ–äºæœåŠ¡ç«¯ä¸æµè§ˆå™¨ä¹‹é—´çš„é€šä¿¡ã€‚</li></ul><blockquote><p>åå•†ç¼“å­˜æœºåˆ¶ä¸‹ï¼Œæµè§ˆå™¨éœ€è¦å‘æœåŠ¡å™¨å»è¯¢é—®ç¼“å­˜çš„ç›¸å…³ä¿¡æ¯ï¼Œè¿›è€Œåˆ¤æ–­æ˜¯é‡æ–°å‘èµ·è¯·æ±‚ã€ä¸‹è½½å®Œæ•´çš„å“åº”ï¼Œè¿˜æ˜¯ä»æœ¬åœ°è·å–ç¼“å­˜çš„èµ„æºã€‚</p></blockquote><p>å¦‚æœæœåŠ¡ç«¯æç¤ºç¼“å­˜èµ„æºæœªæ”¹åŠ¨ï¼ˆ<code>Not Modified</code>ï¼‰ï¼Œèµ„æºä¼šè¢«<strong>é‡å®šå‘</strong>åˆ°æµè§ˆå™¨ç¼“å­˜ï¼Œ<strong>è¿™ç§æƒ…å†µä¸‹ç½‘ç»œè¯·æ±‚å¯¹åº”çš„çŠ¶æ€ç æ˜¯ 304</strong>ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1386624ba5364d63b29931988a9e8eb5~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><h2 id="5-åå•†ç¼“å­˜çš„å®ç°ï¼šä»-Last-Modified-åˆ°-Etag"><a href="#5-åå•†ç¼“å­˜çš„å®ç°ï¼šä»-Last-Modified-åˆ°-Etag" class="headerlink" title="5. åå•†ç¼“å­˜çš„å®ç°ï¼šä» Last-Modified åˆ° Etag"></a><strong>5. åå•†ç¼“å­˜çš„å®ç°ï¼šä» Last-Modified åˆ° Etag</strong></h2><blockquote><p><code>Last-Modified</code>Â  æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œå¦‚æœæˆ‘ä»¬å¯ç”¨äº†åå•†ç¼“å­˜ï¼Œå®ƒä¼šåœ¨é¦–æ¬¡è¯·æ±‚æ—¶éšç€ Â <code>Response Headers</code>Â  è¿”å›ï¼š</p></blockquote><pre class="line-numbers language-none"><code class="language-none">Last-Modified: Fri, 27 Oct 2017 06:35:57 GMT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><blockquote><p>éšåæˆ‘ä»¬æ¯æ¬¡è¯·æ±‚æ—¶ï¼Œä¼šå¸¦ä¸Šä¸€ä¸ªå« Â <code>If-Modified-Since</code>Â  çš„æ—¶é—´æˆ³å­—æ®µï¼Œå®ƒçš„å€¼æ­£æ˜¯ä¸Šä¸€æ¬¡ Â <code>response</code>Â  è¿”å›ç»™å®ƒçš„ Â <code>last-modified</code>Â  å€¼ï¼š</p></blockquote><pre class="line-numbers language-none"><code class="language-none">If-Modified-Since: Fri, 27 Oct 2017 06:35:57 GMT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><blockquote><p>æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªæ—¶é—´æˆ³åï¼Œä¼šæ¯”å¯¹è¯¥æ—¶é—´æˆ³å’Œèµ„æºåœ¨æœåŠ¡å™¨ä¸Šçš„æœ€åä¿®æ”¹æ—¶é—´æ˜¯å¦ä¸€è‡´ï¼Œä»è€Œåˆ¤æ–­èµ„æºæ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ã€‚å¦‚æœå‘ç”Ÿäº†å˜åŒ–ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªå®Œæ•´çš„å“åº”å†…å®¹ï¼Œå¹¶åœ¨ Â <code>Response Headers</code>Â  ä¸­æ·»åŠ æ–°çš„ Â <code>Last-Modified</code>å€¼ï¼›å¦åˆ™ï¼Œè¿”å›å¦‚ä¸Šå›¾çš„ Â <code>304</code>Â  å“åº”ï¼Œ<code>Response Headers</code>Â  ä¸ä¼šå†æ·»åŠ  Â <code>Last-Modified</code>Â  å­—æ®µã€‚</p></blockquote><p><strong>ä½¿ç”¨ Last-Modified å­˜åœ¨ä¸€äº›å¼Šç«¯ï¼Œè¿™å…¶ä¸­æœ€å¸¸è§çš„å°±æ˜¯è¿™æ ·ä¸¤ä¸ªåœºæ™¯ï¼š</strong></p><ul><li>æˆ‘ä»¬ç¼–è¾‘äº†æ–‡ä»¶ï¼Œä½†æ–‡ä»¶çš„å†…å®¹æ²¡æœ‰æ”¹å˜ã€‚æœåŠ¡ç«¯å¹¶ä¸æ¸…æ¥šæˆ‘ä»¬æ˜¯å¦çœŸæ­£æ”¹å˜äº†æ–‡ä»¶ï¼Œå®ƒä»ç„¶é€šè¿‡æœ€åç¼–è¾‘æ—¶é—´è¿›è¡Œåˆ¤æ–­ã€‚å› æ­¤è¿™ä¸ªèµ„æºåœ¨å†æ¬¡è¢«è¯·æ±‚æ—¶ï¼Œä¼šè¢«å½“åšæ–°èµ„æºï¼Œè¿›è€Œå¼•å‘ä¸€æ¬¡å®Œæ•´çš„å“åº”â€”â€”ä¸è¯¥é‡æ–°è¯·æ±‚çš„æ—¶å€™ï¼Œä¹Ÿä¼šé‡æ–°è¯·æ±‚ã€‚</li><li>å½“æˆ‘ä»¬ä¿®æ”¹æ–‡ä»¶çš„é€Ÿåº¦è¿‡å¿«æ—¶ï¼ˆæ¯”å¦‚èŠ±äº† Â <code>100ms</code>Â  å®Œæˆäº†æ”¹åŠ¨ï¼‰ï¼Œç”±äº Â <code>If-Modified-Since</code>Â  åªèƒ½æ£€æŸ¥åˆ°ä»¥ç§’ä¸ºæœ€å°è®¡é‡å•ä½çš„æ—¶é—´å·®ï¼Œæ‰€ä»¥å®ƒæ˜¯æ„ŸçŸ¥ä¸åˆ°è¿™ä¸ªæ”¹åŠ¨çš„â€”â€”è¯¥é‡æ–°è¯·æ±‚çš„æ—¶å€™ï¼Œåè€Œæ²¡æœ‰é‡æ–°è¯·æ±‚äº†ã€‚</li></ul><blockquote><p>è¿™ä¸¤ä¸ªåœºæ™¯å…¶å®æŒ‡å‘äº†åŒä¸€ä¸ª Â <code>bug</code>â€”â€”æœåŠ¡å™¨å¹¶æ²¡æœ‰æ­£ç¡®æ„ŸçŸ¥æ–‡ä»¶çš„å˜åŒ–ã€‚ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œ<code>Etag</code>Â  ä½œä¸º Â <code>Last-Modified</code>Â  çš„è¡¥å……å‡ºç°äº†ã€‚</p></blockquote><ul><li><code>Etag</code>Â  æ˜¯ç”±æœåŠ¡å™¨ä¸ºæ¯ä¸ªèµ„æºç”Ÿæˆçš„å”¯ä¸€çš„<strong>æ ‡è¯†å­—ç¬¦ä¸²</strong>ï¼Œè¿™ä¸ªæ ‡è¯†å­—ç¬¦ä¸²æ˜¯åŸºäºæ–‡ä»¶å†…å®¹ç¼–ç çš„ï¼Œåªè¦æ–‡ä»¶å†…å®¹ä¸åŒï¼Œå®ƒä»¬å¯¹åº”çš„ Â <code>Etag</code>Â  å°±æ˜¯ä¸åŒçš„ï¼Œåä¹‹äº¦ç„¶ã€‚å› æ­¤ Â <code>Etag</code>Â  èƒ½å¤Ÿç²¾å‡†åœ°æ„ŸçŸ¥æ–‡ä»¶çš„å˜åŒ–ã€‚</li><li><code>Etag</code>Â  å’Œ Â <code>Last-Modified</code>Â  ç±»ä¼¼ï¼Œå½“é¦–æ¬¡è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨å“åº”å¤´é‡Œè·å–åˆ°ä¸€ä¸ªæœ€åˆçš„æ ‡è¯†ç¬¦å­—ç¬¦ä¸²ï¼Œä¸¾ä¸ª ğŸŒ°ï¼Œå®ƒå¯ä»¥æ˜¯è¿™æ ·çš„ï¼š</li></ul><pre class="line-numbers language-none"><code class="language-none">ETag: W&#x2F;&quot;2a3b-1602480f459&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><p>é‚£ä¹ˆä¸‹ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œè¯·æ±‚å¤´é‡Œå°±ä¼šå¸¦ä¸Šä¸€ä¸ªå€¼ç›¸åŒçš„ã€åä¸º Â <code>if-None-Match</code>Â  çš„å­—ç¬¦ä¸²ä¾›æœåŠ¡ç«¯æ¯”å¯¹äº†ï¼š</p><pre class="line-numbers language-none"><code class="language-none">If-None-Match: W&#x2F;&quot;2a3b-1602480f459&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><blockquote><p><code>Etag</code>Â  çš„ç”Ÿæˆè¿‡ç¨‹éœ€è¦æœåŠ¡å™¨é¢å¤–ä»˜å‡ºå¼€é”€ï¼Œä¼šå½±å“æœåŠ¡ç«¯çš„æ€§èƒ½ï¼Œè¿™æ˜¯å®ƒçš„å¼Šç«¯ã€‚å› æ­¤å¯ç”¨ Â <code>Etag</code>Â  éœ€è¦æˆ‘ä»¬å®¡æ—¶åº¦åŠ¿ã€‚æ­£å¦‚æˆ‘ä»¬åˆšåˆšæ‰€æåˆ°çš„â€”â€”<code>Etag</code>Â  å¹¶ä¸èƒ½æ›¿ä»£ Â <code>Last-Modified</code>ï¼Œå®ƒåªèƒ½ä½œä¸º Â <code>Last-Modified</code>Â  çš„è¡¥å……å’Œå¼ºåŒ–å­˜åœ¨ã€‚Â <strong>Etag åœ¨æ„ŸçŸ¥æ–‡ä»¶å˜åŒ–ä¸Šæ¯” Last-Modified æ›´åŠ å‡†ç¡®ï¼Œä¼˜å…ˆçº§ä¹Ÿæ›´é«˜ã€‚å½“ Etag å’Œ Last-Modified åŒæ—¶å­˜åœ¨æ—¶ï¼Œä»¥ Etag ä¸ºå‡†ã€‚</strong></p></blockquote><h1 id="HTTP-ç¼“å­˜å†³ç­–æŒ‡å—"><a href="#HTTP-ç¼“å­˜å†³ç­–æŒ‡å—" class="headerlink" title="HTTP ç¼“å­˜å†³ç­–æŒ‡å—"></a>HTTP ç¼“å­˜å†³ç­–æŒ‡å—</h1><blockquote><p>è¡Œæ–‡è‡³æ­¤ï¼Œå½“ä»£ HTTP ç¼“å­˜æŠ€æœ¯ç”¨åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘ä»¬å·²ç»ä»å¤´åˆ°å°¾æŒ–æ˜äº†ä¸€éäº†ã€‚é‚£ä¹ˆåœ¨é¢å¯¹ä¸€ä¸ªå…·ä½“çš„ç¼“å­˜éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬åˆ°åº•è¯¥æ€ä¹ˆå†³ç­–å‘¢ï¼Ÿ</p></blockquote><p>èµ°åˆ°å†³ç­–å»ºè®®è¿™ä¸€æ­¥ï¼Œæˆ‘æœ¬æ¥æƒ³ç»™å¤§å®¶é‡æ–°ç”»ä¸€ä¸ªæµç¨‹å›¾ã€‚ä½†æ˜¯ç”»æ¥ç”»å»ç»ˆç©¶ä¸å¦‚ Chrome å®˜æ–¹ç»™å‡ºçš„è¿™å¼ æ¸…æ™°ã€æƒå¨ï¼š</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3f5262ee53ab4ae1a2ac27e56ce5bf9c~tplv-k3u1fbpfcp-zoom-1.image"><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22">â€‹ ç¼–è¾‘</p><p><strong>æˆ‘ä»¬ç°åœ¨ä¸€èµ·è§£è¯»ä¸€ä¸‹è¿™å¼ æµç¨‹å›¾ï¼š</strong></p><ul><li>å½“æˆ‘ä»¬çš„èµ„æºå†…å®¹ä¸å¯å¤ç”¨æ—¶ï¼Œç›´æ¥ä¸º Â <code>Cache-Control</code>Â  è®¾ç½® Â <code>no-store</code>ï¼Œæ‹’ç»ä¸€åˆ‡å½¢å¼çš„ç¼“å­˜ï¼›å¦åˆ™è€ƒè™‘æ˜¯å¦æ¯æ¬¡éƒ½éœ€è¦å‘æœåŠ¡å™¨è¿›è¡Œç¼“å­˜æœ‰æ•ˆç¡®è®¤ï¼Œå¦‚æœéœ€è¦ï¼Œé‚£ä¹ˆè®¾ Â <code>Cache-Control</code>Â  çš„å€¼ä¸º Â <code>no-cache</code>ï¼›å¦åˆ™è€ƒè™‘è¯¥èµ„æºæ˜¯å¦å¯ä»¥è¢«ä»£ç†æœåŠ¡å™¨ç¼“å­˜ï¼Œæ ¹æ®å…¶ç»“æœå†³å®šæ˜¯è®¾ç½®ä¸º Â <code>private</code>Â  è¿˜æ˜¯ Â <code>public</code>ï¼›ç„¶åè€ƒè™‘è¯¥èµ„æºçš„è¿‡æœŸæ—¶é—´ï¼Œè®¾ç½®å¯¹åº”çš„ Â <code>max-age</code>Â  å’Œ Â <code>s-maxage</code>Â  å€¼ï¼›æœ€åï¼Œé…ç½®åå•†ç¼“å­˜éœ€è¦ç”¨åˆ°çš„ Â <code>Etag</code>ã€<code>Last-Modified</code>Â  ç­‰å‚æ•°ã€‚</li><li>ä¸ªäººéå¸¸æ¨å´‡è¿™å¼ æµç¨‹å›¾ç»™å‡ºçš„å†³ç­–å»ºè®®ï¼Œä¹Ÿå¼ºçƒˆæ¨èå¤§å®¶åœ¨ç†è§£ä»¥ä¸ŠçŸ¥è¯†ç‚¹çš„åŸºç¡€ä¸Šï¼Œå°†è¿™å¼ å›¾ä¿å­˜ä¸‹æ¥ã€åœ¨æ—¥å¸¸å¼€å‘ä¸­ç”¨ç”¨çœ‹ï¼Œå®ƒçš„å¯è¡Œåº¦éå¸¸é«˜ã€‚</li></ul><p>OKï¼Œèµ°åˆ°è¿™é‡Œï¼Œæœ¬èŠ‚æœ€å¤§çš„ä¸€åº§å±±å·²ç»è¢«å¤§å®¶ç¿»è¿‡å»äº†ã€‚æ¥ä¸‹æ¥çš„å†…å®¹ä¼šç›¸å¯¹æ¯”è¾ƒè½»æ¾ï¼Œå¤§å®¶æ”¾æ¾å¿ƒæƒ…ï¼Œæˆ‘ä»¬ç»§ç»­å‰è¡Œï¼</p><h2 id="MemoryCache"><a href="#MemoryCache" class="headerlink" title="MemoryCache"></a>MemoryCache</h2><ul><li><code>MemoryCache</code>ï¼Œæ˜¯æŒ‡å­˜åœ¨å†…å­˜ä¸­çš„ç¼“å­˜ã€‚ä»ä¼˜å…ˆçº§ä¸Šæ¥è¯´ï¼Œå®ƒæ˜¯æµè§ˆå™¨æœ€å…ˆå°è¯•å»å‘½ä¸­çš„ä¸€ç§ç¼“å­˜ã€‚ä»æ•ˆç‡ä¸Šæ¥è¯´ï¼Œå®ƒæ˜¯å“åº”é€Ÿåº¦æœ€å¿«çš„ä¸€ç§ç¼“å­˜ã€‚</li><li>å†…å­˜ç¼“å­˜æ˜¯å¿«çš„ï¼Œä¹Ÿæ˜¯â€œçŸ­å‘½â€çš„ã€‚å®ƒå’Œæ¸²æŸ“è¿›ç¨‹â€œç”Ÿæ­»ç›¸ä¾â€ï¼Œå½“è¿›ç¨‹ç»“æŸåï¼Œä¹Ÿå°±æ˜¯ tab å…³é—­ä»¥åï¼Œå†…å­˜é‡Œçš„æ•°æ®ä¹Ÿå°†ä¸å¤å­˜åœ¨ã€‚</li></ul><p>é‚£ä¹ˆå“ªäº›æ–‡ä»¶ä¼šè¢«æ”¾å…¥å†…å­˜å‘¢ï¼Ÿ</p><ul><li>äº‹å®ä¸Šï¼Œè¿™ä¸ªåˆ’åˆ†è§„åˆ™ï¼Œä¸€ç›´ä»¥æ¥æ˜¯æ²¡æœ‰å®šè®ºçš„ã€‚ä¸è¿‡æƒ³æƒ³ä¹Ÿå¯ä»¥ç†è§£ï¼Œå†…å­˜æ˜¯æœ‰é™çš„ï¼Œå¾ˆå¤šæ—¶å€™éœ€è¦å…ˆè€ƒè™‘å³æ—¶å‘ˆç°çš„å†…å­˜ä½™é‡ï¼Œå†æ ¹æ®å…·ä½“çš„æƒ…å†µå†³å®šåˆ†é…ç»™å†…å­˜å’Œç£ç›˜çš„èµ„æºé‡çš„æ¯”é‡â€”â€”èµ„æºå­˜æ”¾çš„ä½ç½®å…·æœ‰ä¸€å®šçš„éšæœºæ€§ã€‚</li><li>è™½ç„¶åˆ’åˆ†è§„åˆ™æ²¡æœ‰å®šè®ºï¼Œä½†æ ¹æ®æ—¥å¸¸å¼€å‘ä¸­è§‚å¯Ÿçš„ç»“æœï¼ŒåŒ…æ‹¬æˆ‘ä»¬å¼€ç¯‡ç»™å¤§å®¶å±•ç¤ºçš„ Â <code>Network</code>æˆªå›¾ï¼Œæˆ‘ä»¬è‡³å°‘å¯ä»¥æ€»ç»“å‡ºè¿™æ ·çš„è§„å¾‹ï¼šèµ„æºå­˜ä¸å­˜å†…å­˜ï¼Œæµè§ˆå™¨ç§‰æ‰¿çš„æ˜¯â€œèŠ‚çº¦åŸåˆ™â€ã€‚æˆ‘ä»¬å‘ç°ï¼Œ<code>Base64</code>Â  æ ¼å¼çš„å›¾ç‰‡ï¼Œå‡ ä¹æ°¸è¿œå¯ä»¥è¢«å¡è¿› Â <code>memory cache</code>ï¼Œè¿™å¯ä»¥è§†ä½œæµè§ˆå™¨ä¸ºèŠ‚çœæ¸²æŸ“å¼€é”€çš„â€œè‡ªä¿è¡Œä¸ºâ€ï¼›æ­¤å¤–ï¼Œä½“ç§¯ä¸å¤§çš„ Â <code>JS</code>ã€<code>CSS</code>Â  æ–‡ä»¶ï¼Œä¹Ÿæœ‰è¾ƒå¤§åœ°è¢«å†™å…¥å†…å­˜çš„å‡ ç‡â€”â€”ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¾ƒå¤§çš„ Â <code>JS</code>ã€<code>CSS</code>Â  æ–‡ä»¶å°±æ²¡æœ‰è¿™ä¸ªå¾…é‡äº†ï¼Œå†…å­˜èµ„æºæ˜¯æœ‰é™çš„ï¼Œå®ƒä»¬å¾€å¾€è¢«ç›´æ¥ç”©è¿›ç£ç›˜ã€‚</li></ul><h2 id="Service-Worker-Cache"><a href="#Service-Worker-Cache" class="headerlink" title="Service Worker Cache"></a>Service Worker Cache</h2><blockquote><p><code>Service Worker</code>Â  æ˜¯ä¸€ç§ç‹¬ç«‹äºä¸»çº¿ç¨‹ä¹‹å¤–çš„ Javascript çº¿ç¨‹ã€‚å®ƒè„±ç¦»äºæµè§ˆå™¨çª—ä½“ï¼Œå› æ­¤æ— æ³•ç›´æ¥è®¿é—® DOMã€‚è¿™æ ·ç‹¬ç«‹çš„ä¸ªæ€§ä½¿å¾— Â <code>Service Worker</code>Â  çš„â€œä¸ªäººè¡Œä¸ºâ€æ— æ³•å¹²æ‰°é¡µé¢çš„æ€§èƒ½ï¼Œè¿™ä¸ªâ€œå¹•åå·¥ä½œè€…â€å¯ä»¥å¸®æˆ‘ä»¬å®ç°ç¦»çº¿ç¼“å­˜ã€æ¶ˆæ¯æ¨é€å’Œç½‘ç»œä»£ç†ç­‰åŠŸèƒ½ã€‚æˆ‘ä»¬å€ŸåŠ© Â <code>Service worker</code>Â  å®ç°çš„ç¦»çº¿ç¼“å­˜å°±ç§°ä¸º Â <code>Service Worker Cache</code>ã€‚</p></blockquote><ul><li><code>Service Worker</code>Â  çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬ Â <code>install</code>ã€<code>active</code>ã€<code>working</code>Â  ä¸‰ä¸ªé˜¶æ®µã€‚ä¸€æ—¦ Â <code>Service Worker</code>Â  è¢« Â <code>install</code>ï¼Œå®ƒå°†å§‹ç»ˆå­˜åœ¨ï¼Œåªä¼šåœ¨ Â <code>active</code>Â  ä¸ Â <code>working</code>Â  ä¹‹é—´åˆ‡æ¢ï¼Œé™¤éæˆ‘ä»¬ä¸»åŠ¨ç»ˆæ­¢å®ƒã€‚è¿™æ˜¯å®ƒå¯ä»¥ç”¨æ¥å®ç°ç¦»çº¿å­˜å‚¨çš„é‡è¦å…ˆå†³æ¡ä»¶ã€‚</li><li>ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡å®æˆ˜çš„æ–¹å¼ï¼Œä¸€èµ·è§è¯†ä¸€ä¸‹ Â <code>Service Worker</code>Â  å¦‚ä½•ä¸ºæˆ‘ä»¬å®ç°ç¦»çº¿ç¼“å­˜ï¼ˆæ³¨æ„çœ‹æ³¨é‡Šï¼‰ï¼š æˆ‘ä»¬é¦–å…ˆåœ¨å…¥å£æ–‡ä»¶ä¸­æ’å…¥è¿™æ ·ä¸€æ®µ JS ä»£ç ï¼Œç”¨ä»¥åˆ¤æ–­å’Œå¼•å…¥ Â <code>Service Worker</code>ï¼š</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">window<span class="token punctuation">.</span>navigator<span class="token punctuation">.</span>serviceWorker  <span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">"/test.js"</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ³¨å†ŒæˆåŠŸ"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ³¨å†Œå¤±è´¥"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><blockquote><p>åœ¨ Â <code>test.js</code>Â  ä¸­ï¼Œæˆ‘ä»¬è¿›è¡Œç¼“å­˜çš„å¤„ç†ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ç¼“å­˜çš„æ–‡ä»¶åˆ†åˆ«æ˜¯ Â <code>test.html</code>,<code>test.css</code>Â  å’Œ Â <code>test.js</code>ï¼š</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// Service Workerä¼šç›‘å¬ installäº‹ä»¶ï¼Œæˆ‘ä»¬åœ¨å…¶å¯¹åº”çš„å›è°ƒé‡Œå¯ä»¥å®ç°åˆå§‹åŒ–çš„é€»è¾‘</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"install"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  event<span class="token punctuation">.</span><span class="token function">waitUntil</span><span class="token punctuation">(</span>    <span class="token comment">// è€ƒè™‘åˆ°ç¼“å­˜ä¹Ÿéœ€è¦æ›´æ–°ï¼Œopenå†…ä¼ å…¥çš„å‚æ•°ä¸ºç¼“å­˜çš„ç‰ˆæœ¬å·</span>    caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test-v1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token punctuation">[</span>        <span class="token comment">// æ­¤å¤„ä¼ å…¥æŒ‡å®šçš„éœ€ç¼“å­˜çš„æ–‡ä»¶å</span>        <span class="token string">"/test.html"</span><span class="token punctuation">,</span>        <span class="token string">"/test.css"</span><span class="token punctuation">,</span>        <span class="token string">"/test.js"</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token comment">// Service Workerä¼šç›‘å¬æ‰€æœ‰çš„ç½‘ç»œè¯·æ±‚ï¼Œç½‘ç»œè¯·æ±‚çš„äº§ç”Ÿè§¦å‘çš„æ˜¯fetchäº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶å¯¹åº”çš„ç›‘å¬å‡½æ•°ä¸­å®ç°å¯¹è¯·æ±‚çš„æ‹¦æˆªï¼Œè¿›è€Œåˆ¤æ–­æ˜¯å¦æœ‰å¯¹åº”åˆ°è¯¥è¯·æ±‚çš„ç¼“å­˜ï¼Œå®ç°ä»Service Workerä¸­å–åˆ°ç¼“å­˜çš„ç›®çš„</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"fetch"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span>    <span class="token comment">// å°è¯•åŒ¹é…è¯¥è¯·æ±‚å¯¹åº”çš„ç¼“å­˜å€¼</span>    caches<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¦‚æœåŒ¹é…åˆ°äº†ï¼Œè°ƒç”¨Server Workerç¼“å­˜</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res      <span class="token punctuation">&#125;</span>      <span class="token comment">// å¦‚æœæ²¡åŒ¹é…åˆ°ï¼Œå‘æœåŠ¡ç«¯å‘èµ·è¿™ä¸ªèµ„æºè¯·æ±‚</span>      <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>response <span class="token operator">||</span> response<span class="token punctuation">.</span>status <span class="token operator">!==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> response        <span class="token punctuation">&#125;</span>        <span class="token comment">// è¯·æ±‚æˆåŠŸçš„è¯ï¼Œå°†è¯·æ±‚ç¼“å­˜èµ·æ¥ã€‚</span>        caches<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"test-v1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">cache</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="%22%E7%82%B9%E5%87%BB%E5%B9%B6%E6%8B%96%E6%8B%BD%E4%BB%A5%E7%A7%BB%E5%8A%A8%22"></p><p><strong>PS</strong>ï¼šå¤§å®¶æ³¨æ„ Â <code>Server Worker</code>Â  å¯¹åè®®æ˜¯æœ‰è¦æ±‚çš„ï¼Œå¿…é¡»ä»¥ Â <code>https</code>Â  åè®®ä¸ºå‰æã€‚</p><h2 id="Push-Cache"><a href="#Push-Cache" class="headerlink" title="Push Cache"></a>Push Cache</h2><blockquote><p>é¢„å‘Šï¼šæœ¬å°èŠ‚å®šä½ä¸ºåŸºç¡€ç§‘æ™®å‘ï¼Œå¯¹ Push Cache æœ‰æ·±å…¥æŒ–æ˜å…´è¶£çš„åŒå­¦ï¼Œå¼ºçƒˆæ¨èæ‹“å±•é˜…è¯» Chrome å·¥ç¨‹å¸ˆ Jake Archibald çš„è¿™ç¯‡ Â <a href="https://jakearchibald.com/2017/h2-push-tougher-than-i-thought/" title="HTTP/2 push is tougher than I thoughtÂ (opens new window)">HTTP/2 push is tougher than I thoughtÂ (opens new window)</a>ã€‚</p></blockquote><ul><li><code>Push Cache</code>Â  æ˜¯æŒ‡ Â <code>HTTP2</code>Â  åœ¨ Â <code>server push</code>Â  é˜¶æ®µå­˜åœ¨çš„ç¼“å­˜ã€‚è¿™å—çš„çŸ¥è¯†æ¯”è¾ƒæ–°ï¼Œåº”ç”¨ä¹Ÿè¿˜å¤„äºèŒèŠ½é˜¶æ®µï¼Œæˆ‘æ‰¾äº†å¥½å‡ ä¸ªç½‘ç«™ä¹Ÿæ²¡æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ¡ˆä¾‹æ¥ç»™å¤§å®¶åšå…·ä½“çš„ä»‹ç»ã€‚ä½†åº”ç”¨èŒƒå›´æœ‰é™ä¸ä»£è¡¨ä¸é‡è¦â€”â€”<code>HTTP2</code>Â  æ˜¯è¶‹åŠ¿ã€æ˜¯æœªæ¥ã€‚åœ¨å®ƒè¿˜æœªè¢«æ¨è€Œå¹¿ä¹‹çš„æ­¤æ—¶æ­¤åˆ»ï¼Œæˆ‘ä»å¸Œæœ›å¤§å®¶èƒ½å¯¹ Â <code>Push Cache</code>Â  çš„å…³é”®ç‰¹æ€§æœ‰æ‰€äº†è§£ï¼š</li></ul><!----><ul><li><code>Push Cache</code>Â  æ˜¯ç¼“å­˜çš„æœ€åä¸€é“é˜²çº¿ã€‚æµè§ˆå™¨åªæœ‰åœ¨ Â <code>Memory Cache</code>ã€<code>HTTP Cache</code>Â  å’Œ Â <code>Service Worker Cache</code>Â  å‡æœªå‘½ä¸­çš„æƒ…å†µä¸‹æ‰ä¼šå»è¯¢é—® Â <code>Push Cache</code>ã€‚</li><li><code>Push Cache</code>Â  æ˜¯ä¸€ç§å­˜åœ¨äºä¼šè¯é˜¶æ®µçš„ç¼“å­˜ï¼Œå½“ Â <code>session</code>Â  ç»ˆæ­¢æ—¶ï¼Œç¼“å­˜ä¹Ÿéšä¹‹é‡Šæ”¾ã€‚</li><li>ä¸åŒçš„é¡µé¢åªè¦å…±äº«äº†åŒä¸€ä¸ª Â <code>HTTP2</code>Â  è¿æ¥ï¼Œé‚£ä¹ˆå®ƒä»¬å°±å¯ä»¥å…±äº«åŒä¸€ä¸ª Â <code>Push Cache</code>ã€‚</li></ul><p>æ›´å¤šçš„ç‰¹æ€§å’Œåº”ç”¨ï¼ŒæœŸå¾…å¤§å®¶å¯ä»¥åœ¨æ—¥åçš„å¼€å‘è¿‡ç¨‹ä¸­å»æŒ–æ˜å’Œå®è·µã€‚</p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><blockquote><p>å°å»ºè®®ï¼å¾ˆå¤šäººåœ¨å­¦ä¹ ç¼“å­˜è¿™å—çŸ¥è¯†çš„æ—¶å€™å¯èƒ½å¤šå°‘ä¼šæœ‰è¿™æ ·çš„æ„Ÿè§‰ï¼šå¯¹æµè§ˆå™¨ç¼“å­˜ï¼Œåªèƒ½æè¿°ä¸ªå¤§è‡´ï¼Œå´è¯´ä¸ä¸Šæ·±å±‚åŸç†ï¼›å¥½ä¸å®¹æ˜“è®°ä½äº†æ¯ä¸ªå­—æ®µæ€ä¹ˆç”¨ï¼Œè¿‡å‡ å¤©åˆç»™å¿˜äº†ã€‚è¿™æ˜¯å› ä¸ºç¼“å­˜éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œå…·æœ‰â€œç»†ç¢ã€è¿­ä»£å¿«â€çš„ç‰¹ç‚¹ã€‚å¯¹äºè¿™æ ·çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬åº”è¯¥å°è¯•å…ˆåˆ’åˆ†å‡ºå±‚æ¬¡å’Œé‡ç‚¹ï¼Œå½’çº³å‡ºå®Œæ•´çš„ä½“ç³»ï¼Œç„¶åé’ˆå¯¹æ¯ä¸ªçŸ¥è¯†ç‚¹å»å„ä¸ªå‡»ç ´ã€‚</p></blockquote><p>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè§ˆå™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰å…¨é—®é¢˜ï¼šCSRF å’Œ XSS</title>
      <link href="/2023/01/06/010-wang-luo-an-quan/"/>
      <url>/2023/01/06/010-wang-luo-an-quan/</url>
      
        <content type="html"><![CDATA[<h2 id="1-å‰è¨€"><a href="#1-å‰è¨€" class="headerlink" title="1 å‰è¨€"></a>1 å‰è¨€</h2><ul><li><code>CSRF</code>ï¼šåŸºæœ¬æ¦‚å¿µã€æ”»å‡»æ–¹å¼ã€é˜²å¾¡æªæ–½</li><li><code>XSS</code>ï¼šåŸºæœ¬æ¦‚å¿µã€æ”»å‡»æ–¹å¼ã€é˜²å¾¡æªæ–½</li></ul><blockquote><p>æœ‰äººé—®ï¼š<code>SQL</code>æ³¨å…¥ç®—å—ï¼Ÿç­”æ¡ˆï¼šè¿™ä¸ªå…¶å®è·Ÿå‰ç«¯çš„å…³ç³»ä¸æ˜¯å¾ˆå¤§ã€‚</p></blockquote><h2 id="2-CSRF"><a href="#2-CSRF" class="headerlink" title="2 CSRF"></a>2 CSRF</h2><h3 id="2-1-CSRF-çš„åŸºæœ¬æ¦‚å¿µã€ç¼©å†™ã€å…¨ç§°"><a href="#2-1-CSRF-çš„åŸºæœ¬æ¦‚å¿µã€ç¼©å†™ã€å…¨ç§°" class="headerlink" title="2.1 CSRF çš„åŸºæœ¬æ¦‚å¿µã€ç¼©å†™ã€å…¨ç§°"></a>2.1 CSRF çš„åŸºæœ¬æ¦‚å¿µã€ç¼©å†™ã€å…¨ç§°</h3><blockquote><p><code>CSRF</code>ï¼ˆ<code>Cross-site request forgery</code>ï¼‰ï¼š<strong>è·¨ç«™è¯·æ±‚ä¼ªé€ </strong>ã€‚</p></blockquote><h3 id="2-2-CSRF-çš„æ”»å‡»åŸç†"><a href="#2-2-CSRF-çš„æ”»å‡»åŸç†" class="headerlink" title="2.2 CSRF çš„æ”»å‡»åŸç†"></a>2.2 CSRF çš„æ”»å‡»åŸç†</h3><p><img src="https://s.poetries.work/gitee/2020/07/17.png" alt="img"></p><blockquote><p>ç”¨æˆ·æ˜¯ç½‘ç«™ A çš„æ³¨å†Œç”¨æˆ·ï¼Œä¸”ç™»å½•è¿›å»ï¼Œäºæ˜¯ç½‘ç«™ A å°±ç»™ç”¨æˆ·ä¸‹å‘<code>cookie</code>ã€‚</p></blockquote><p>è¦å®Œæˆä¸€æ¬¡<code>CSRF</code>æ”»å‡»ï¼Œå—å®³è€…å¿…é¡»æ»¡è¶³<strong>ä¸¤ä¸ªå¿…è¦çš„æ¡ä»¶</strong>ï¼š</p><ol><li>ç™»å½•å—ä¿¡ä»»ç½‘ç«™<code>A</code>ï¼Œå¹¶åœ¨æœ¬åœ°ç”Ÿæˆ<code>Cookie</code>ã€‚ï¼ˆå¦‚æœç”¨æˆ·æ²¡æœ‰ç™»å½•ç½‘ç«™<code>A</code>ï¼Œé‚£ä¹ˆç½‘ç«™<code>B</code>åœ¨è¯±å¯¼çš„æ—¶å€™ï¼Œè¯·æ±‚ç½‘ç«™<code>A</code>çš„<code>api</code>æ¥å£æ—¶ï¼Œä¼šæç¤ºä½ ç™»å½•ï¼‰</li><li>åœ¨ä¸ç™»å‡º<code>A</code>çš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™<code>B</code>ï¼ˆå…¶å®æ˜¯åˆ©ç”¨äº†ç½‘ç«™<code>A</code>çš„æ¼æ´ï¼‰ã€‚</li></ol><blockquote><p><code>cookie</code>ä¿è¯äº†ç”¨æˆ·å¯ä»¥å¤„äºç™»å½•çŠ¶æ€ï¼Œä½†ç½‘ç«™<code>B</code>å…¶å®æ‹¿ä¸åˆ° <code>cookie</code>ã€‚</p></blockquote><p><strong>æ¡ˆä¾‹</strong>ï¼ˆé’“é±¼ç½‘ç«™å–é’±ï¼‰</p><h3 id="2-3-CSRF-å¦‚ä½•é˜²å¾¡"><a href="#2-3-CSRF-å¦‚ä½•é˜²å¾¡" class="headerlink" title="2.3 CSRF å¦‚ä½•é˜²å¾¡"></a>2.3 CSRF å¦‚ä½•é˜²å¾¡</h3><h4 id="æ–¹æ³•ä¸€ã€Token-éªŒè¯ï¼šï¼ˆç”¨çš„æœ€å¤šï¼‰"><a href="#æ–¹æ³•ä¸€ã€Token-éªŒè¯ï¼šï¼ˆç”¨çš„æœ€å¤šï¼‰" class="headerlink" title="æ–¹æ³•ä¸€ã€Token éªŒè¯ï¼šï¼ˆç”¨çš„æœ€å¤šï¼‰"></a><strong>æ–¹æ³•ä¸€ã€Token éªŒè¯ï¼š</strong>ï¼ˆç”¨çš„æœ€å¤šï¼‰</h4><ol><li>æœåŠ¡å™¨å‘é€ç»™å®¢æˆ·ç«¯ä¸€ä¸ª<code>token</code>ï¼›</li><li>å®¢æˆ·ç«¯æäº¤çš„è¡¨å•ä¸­å¸¦ç€è¿™ä¸ª<code>token</code>ã€‚</li><li>å¦‚æœè¿™ä¸ª <code>token</code> ä¸åˆæ³•ï¼Œé‚£ä¹ˆæœåŠ¡å™¨æ‹’ç»è¿™ä¸ªè¯·æ±‚ã€‚</li></ol><h4 id="æ–¹æ³•äºŒï¼šéšè—ä»¤ç‰Œï¼š"><a href="#æ–¹æ³•äºŒï¼šéšè—ä»¤ç‰Œï¼š" class="headerlink" title="æ–¹æ³•äºŒï¼šéšè—ä»¤ç‰Œï¼š"></a><strong>æ–¹æ³•äºŒï¼šéšè—ä»¤ç‰Œï¼š</strong></h4><ul><li>æŠŠ <code>token</code> éšè—åœ¨ <code>http</code> çš„ <code>head</code>å¤´ä¸­ã€‚</li></ul><blockquote><p>æ–¹æ³•äºŒå’Œæ–¹æ³•ä¸€æœ‰ç‚¹åƒï¼Œæœ¬è´¨ä¸Šæ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œåªæ˜¯ä½¿ç”¨æ–¹å¼ä¸Šæœ‰åŒºåˆ«ã€‚</p></blockquote><h4 id="æ–¹æ³•ä¸‰ã€Referer-éªŒè¯ï¼š"><a href="#æ–¹æ³•ä¸‰ã€Referer-éªŒè¯ï¼š" class="headerlink" title="æ–¹æ³•ä¸‰ã€Referer éªŒè¯ï¼š"></a><strong>æ–¹æ³•ä¸‰ã€Referer éªŒè¯ï¼š</strong></h4><blockquote><p><code>Referer</code> æŒ‡çš„æ˜¯é¡µé¢è¯·æ±‚æ¥æºã€‚æ„æ€æ˜¯ï¼Œ<strong>åªæ¥å—æœ¬ç«™çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ‰åšå“åº”</strong>ï¼›å¦‚æœä¸æ˜¯ï¼Œå°±æ‹¦æˆªã€‚ï¼ˆå¯ä»¥ä»¿é€ ï¼‰</p></blockquote><h4 id="æ–¹æ³•å››ã€æ·»åŠ éªŒè¯ç ï¼ˆä½“éªŒä¸å¥½ï¼‰"><a href="#æ–¹æ³•å››ã€æ·»åŠ éªŒè¯ç ï¼ˆä½“éªŒä¸å¥½ï¼‰" class="headerlink" title="æ–¹æ³•å››ã€æ·»åŠ éªŒè¯ç ï¼ˆä½“éªŒä¸å¥½ï¼‰"></a><strong>æ–¹æ³•å››ã€æ·»åŠ éªŒè¯ç ï¼ˆä½“éªŒä¸å¥½ï¼‰</strong></h4><blockquote><p>æœåŠ¡ç«¯ç”Ÿæˆå›¾ç‰‡å‘é€ç»™å®¢æˆ·ç«¯</p></blockquote><h2 id="3-XSS"><a href="#3-XSS" class="headerlink" title="3 XSS"></a>3 XSS</h2><h3 id="3-1-XSS-çš„åŸºæœ¬æ¦‚å¿µ"><a href="#3-1-XSS-çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="3.1 XSS çš„åŸºæœ¬æ¦‚å¿µ"></a>3.1 XSS çš„åŸºæœ¬æ¦‚å¿µ</h3><blockquote><p><code>XSSï¼ˆCross Site Scriptingï¼‰</code>ï¼š<strong>è·¨åŸŸè„šæœ¬æ”»å‡»</strong>ã€‚</p></blockquote><h3 id="3-2-XSS-çš„æ”»å‡»åŸç†"><a href="#3-2-XSS-çš„æ”»å‡»åŸç†" class="headerlink" title="3.2 XSS çš„æ”»å‡»åŸç†"></a>3.2 XSS çš„æ”»å‡»åŸç†</h3><blockquote><p><code>XSS</code>æ”»å‡»çš„æ ¸å¿ƒåŸç†æ˜¯ï¼šä¸éœ€è¦ä½ åšä»»ä½•çš„ç™»å½•è®¤è¯ï¼Œå®ƒä¼šé€šè¿‡åˆæ³•çš„æ“ä½œï¼ˆæ¯”å¦‚åœ¨<code>url</code>ä¸­è¾“å…¥ã€åœ¨è¯„è®ºæ¡†ä¸­è¾“å…¥ï¼‰ï¼Œå‘ä½ çš„é¡µé¢æ³¨å…¥è„šæœ¬ï¼ˆå¯èƒ½æ˜¯<code>js</code>ã€<code>hmtl</code>ä»£ç å—ç­‰ï¼‰ã€‚</p></blockquote><blockquote><p>æœ€åå¯¼è‡´çš„ç»“æœå¯èƒ½æ˜¯ï¼š</p></blockquote><ul><li>ç›—ç”¨<code>Cookie</code></li><li>ç ´åé¡µé¢çš„æ­£å¸¸ç»“æ„ï¼Œæ’å…¥å¹¿å‘Šç­‰æ¶æ„å†…å®¹</li><li><code>D-doss</code>æ”»å‡»ï¼ˆæ¶ˆè€—æœåŠ¡å™¨å¸¦å®½ï¼‰</li></ul><h3 id="3-3-XSS-çš„æ”»å‡»æ–¹å¼å’Œé˜²èŒƒæªæ–½"><a href="#3-3-XSS-çš„æ”»å‡»æ–¹å¼å’Œé˜²èŒƒæªæ–½" class="headerlink" title="3.3 XSS çš„æ”»å‡»æ–¹å¼å’Œé˜²èŒƒæªæ–½"></a>3.3 XSS çš„æ”»å‡»æ–¹å¼å’Œé˜²èŒƒæªæ–½</h3><h4 id="1-åå°„å‹ï¼ˆåŸºäºåç«¯ï¼‰"><a href="#1-åå°„å‹ï¼ˆåŸºäºåç«¯ï¼‰" class="headerlink" title="1. åå°„å‹ï¼ˆåŸºäºåç«¯ï¼‰"></a>1. åå°„å‹ï¼ˆåŸºäºåç«¯ï¼‰</h4><blockquote><p>å‘å‡ºè¯·æ±‚æ—¶ï¼Œ<code>XSS</code>ä»£ç å‡ºç°åœ¨<code>url</code>ä¸­ï¼Œä½œä¸ºè¾“å…¥æäº¤åˆ°æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡å™¨ç«¯è§£æåå“åº”ï¼Œ<code>XSS</code>ä»£ç éšå“åº”å†…å®¹ä¸€èµ·ä¼ å›ç»™æµè§ˆå™¨ï¼Œæœ€åæµè§ˆå™¨è§£ææ‰§è¡Œ<code>XSS</code>ä»£ç ã€‚è¿™ä¸ªè¿‡ç¨‹åƒä¸€æ¬¡åå°„ï¼Œæ‰€ä»¥å«åå°„å‹<code>XSS</code></p></blockquote><p>â€‹ <strong>æ¡ˆä¾‹ ç”¨æˆ· type å‚æ•°ä¼ é€’ä»€ä¹ˆè¿”å›ä»€ä¹ˆ</strong></p><ul><li><p><code>?type=&lt;script&gt;alart(1)&lt;/script&gt;</code></p></li><li><p>chrome å‘ç°è·¯å¾„å­˜åœ¨å¼‚å¸¸ ä¼šæœ‰ xss å±è”½åŠŸèƒ½</p></li><li><p>è¯±å¯¼ç”¨æˆ·ç‚¹å‡»ï¼ˆä¸€æ¬¡æ€§ï¼‰æ‹¿åˆ°ç”¨æˆ· cookier</p></li></ul><p><strong>è§£å†³æ–¹å¼</strong></p><ul><li>æœåŠ¡ç«¯æŸ¥è¯¢å‚æ•° åŠ ä¸Š<code>encodeURLComponent(req.query.type)</code>è½¬ç </li></ul><h4 id="2ã€DOM-Based-ä¸åŸºäºåç«¯"><a href="#2ã€DOM-Based-ä¸åŸºäºåç«¯" class="headerlink" title="2ã€DOM-Based(ä¸åŸºäºåç«¯)"></a>2ã€DOM-Based(ä¸åŸºäºåç«¯)</h4><blockquote><p>ä¿®æ”¹å±æ€§ æ’å…¥å†…å®¹ document.writeâ€¦</p></blockquote><p>â€‹ <strong>æ¡ˆä¾‹ è¾“å…¥å›¾ç‰‡åœ°å€ ç„¶åå‡ºç°å›¾ç‰‡</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#box"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;img src = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token operator">&lt;</span>img src <span class="token operator">=</span><span class="token string">"xxx"</span> onerror<span class="token operator">=</span><span class="token string">"alert(1)"</span> id<span class="token operator">=</span><span class="token string">""</span> <span class="token operator">></span>ç”¨æˆ·è¾“å…¥ xxx<span class="token string">" onerror="</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token string">" id="</span> é¡µé¢å°±ä¼šä¸€ç›´å¼¹æ¡†è§£å†³æ–¹æ³•<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#box"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;img src = '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span><span class="token function">encodeURL</span><span class="token punctuation">(</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#url'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">'></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><ul><li>å®¢æˆ·ç«¯å¯¹å†…å®¹è¿›è¡Œ<code>encodeURLï¼ˆï¼‰</code></li></ul><h4 id="3ã€å­˜å‚¨å‹ï¼ˆæ¶æ„è„šæœ¬å­˜å‚¨åˆ°æœåŠ¡å™¨ï¼‰"><a href="#3ã€å­˜å‚¨å‹ï¼ˆæ¶æ„è„šæœ¬å­˜å‚¨åˆ°æœåŠ¡å™¨ï¼‰" class="headerlink" title="3ã€å­˜å‚¨å‹ï¼ˆæ¶æ„è„šæœ¬å­˜å‚¨åˆ°æœåŠ¡å™¨ï¼‰"></a>3ã€å­˜å‚¨å‹ï¼ˆæ¶æ„è„šæœ¬å­˜å‚¨åˆ°æœåŠ¡å™¨ï¼‰</h4><blockquote><p>å­˜å‚¨å‹<code>XSS</code>å’Œåå°„å‹<code>XSS</code>çš„å·®åˆ«åœ¨äºï¼Œæäº¤çš„ä»£ç ä¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯ï¼ˆæ•°æ®åº“ã€å†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼‰ï¼Œä¸‹æ¬¡è¯·æ±‚æ—¶ç›®æ ‡é¡µé¢æ—¶ä¸ç”¨å†æäº¤ XSS ä»£ç ã€‚</p></blockquote><p>â€‹ **æ¡ˆä¾‹ ï¼š è¯„è®º åŠŸèƒ½ **</p><pre class="line-numbers language-none"><code class="language-none">ç”¨æˆ·è¯„è®ºçš„çš„æ—¶å€™æ·»åŠ æ¶æ„è„šæœ¬   å­˜å‚¨åˆ°æœåŠ¡å™¨ç„¶åå…¶ä»–äººè·å–è¯„è®ºåˆ—è¡¨ å°±ä¼šè¢«è„šæœ¬æ”»å‡»  ï¼ˆèŒƒå›´å¹¿ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><ul><li><p>å®¢æˆ·ç«¯ä¼ é€’ç»™æœåŠ¡å™¨æ—¶å€™ï¼Œéœ€è¦æ ¡éªŒå…ˆè¿‡æ»¤ä¸€ä¸‹</p></li><li><p>æœåŠ¡å™¨å†åšä¸€æ¬¡è¿‡æ»¤</p></li><li><p>ç›´æ¥åœ¨è¾“å‡ºçš„æ—¶å€™è¿‡æ»¤</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">encodeHtml</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> str    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">"</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;quot;"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">'</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;apos;"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&amp;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;amp;"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">&lt;</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;lt;"</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">"&amp;gt;"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="3-4-XSS-çš„é˜²èŒƒæªæ–½ï¼ˆencode-è¿‡æ»¤ï¼‰"><a href="#3-4-XSS-çš„é˜²èŒƒæªæ–½ï¼ˆencode-è¿‡æ»¤ï¼‰" class="headerlink" title="3.4 XSS çš„é˜²èŒƒæªæ–½ï¼ˆencode + è¿‡æ»¤ï¼‰"></a>3.4 XSS çš„é˜²èŒƒæªæ–½ï¼ˆencode + è¿‡æ»¤ï¼‰</h3><p><strong>XSS çš„é˜²èŒƒæªæ–½ä¸»è¦æœ‰ä¸‰ä¸ªï¼š</strong></p><h4 id="1-ç¼–ç ï¼š"><a href="#1-ç¼–ç ï¼š" class="headerlink" title="1. ç¼–ç ï¼š"></a><strong>1. ç¼–ç </strong>ï¼š</h4><blockquote><p>å¯¹ç”¨æˆ·è¾“å…¥çš„æ•°æ®è¿›è¡Œ<code>HTML Entity</code>ç¼–ç ã€‚</p></blockquote><blockquote><p><code>Encode</code>çš„ä½œç”¨æ˜¯å°†<code>$var</code>ç­‰ä¸€äº›å­—ç¬¦è¿›è¡Œè½¬åŒ–ï¼Œä½¿å¾—æµè§ˆå™¨åœ¨æœ€ç»ˆè¾“å‡ºç»“æœä¸Šæ˜¯ä¸€æ ·çš„ã€‚</p></blockquote><h4 id="2ã€è¿‡æ»¤ï¼š"><a href="#2ã€è¿‡æ»¤ï¼š" class="headerlink" title="2ã€è¿‡æ»¤ï¼š"></a><strong>2ã€è¿‡æ»¤ï¼š</strong></h4><ul><li>ç§»é™¤ç”¨æˆ·è¾“å…¥çš„å’Œäº‹ä»¶ç›¸å…³çš„å±æ€§ã€‚å¦‚<code>onerror</code>å¯ä»¥è‡ªåŠ¨è§¦å‘æ”»å‡»ï¼Œè¿˜æœ‰<code>onclick</code>ç­‰ã€‚ï¼ˆæ€»è€Œè¨€æ˜¯ï¼Œè¿‡æ»¤æ‰ä¸€äº›ä¸å®‰å…¨çš„å†…å®¹ï¼‰</li><li>ç§»é™¤ç”¨æˆ·è¾“å…¥çš„<code>Style</code>èŠ‚ç‚¹ã€<code>Script</code>èŠ‚ç‚¹ã€<code>Iframe</code>èŠ‚ç‚¹ã€‚ï¼ˆå°¤å…¶æ˜¯<code>Script</code>èŠ‚ç‚¹ï¼Œå®ƒå¯æ˜¯æ”¯æŒè·¨åŸŸçš„å‘€ï¼Œä¸€å®šè¦ç§»é™¤ï¼‰ã€‚</li></ul><h4 id="3ã€æ ¡æ­£"><a href="#3ã€æ ¡æ­£" class="headerlink" title="3ã€æ ¡æ­£"></a><strong>3ã€æ ¡æ­£</strong></h4><ul><li>é¿å…ç›´æ¥å¯¹<code>HTML Entity</code>è¿›è¡Œè§£ç ã€‚</li><li>ä½¿ç”¨<code>DOM Parse</code>è½¬æ¢ï¼Œæ ¡æ­£ä¸é…å¯¹çš„<code>DOM</code>æ ‡ç­¾ã€‚</li></ul><blockquote><p>å¤‡æ³¨ï¼šæˆ‘ä»¬åº”è¯¥å»äº†è§£ä¸€ä¸‹<code>DOM Parse</code>è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒçš„ä½œç”¨æ˜¯æŠŠæ–‡æœ¬è§£ææˆ<code>DOM</code>ç»“æ„ã€‚</p></blockquote><p>æ¯”è¾ƒå¸¸ç”¨çš„åšæ³•æ˜¯ï¼Œé€šè¿‡ç¬¬ä¸€æ­¥çš„ç¼–ç è½¬æˆæ–‡æœ¬ï¼Œç„¶åç¬¬ä¸‰æ­¥è½¬æˆ<code>DOM</code>å¯¹è±¡ï¼Œç„¶åç»è¿‡ç¬¬äºŒæ­¥çš„è¿‡æ»¤ã€‚</p><p><strong>è¿˜æœ‰ä¸€ç§ç®€æ´çš„ç­”æ¡ˆï¼š</strong></p><p>é¦–å…ˆæ˜¯<strong>encodeï¼Œå¦‚æœæ˜¯å¯Œæ–‡æœ¬</strong>ï¼Œå°±ç™½åå•ã€‚</p><h2 id="4-CSRF-å’Œ-XSS-çš„åŒºåˆ«"><a href="#4-CSRF-å’Œ-XSS-çš„åŒºåˆ«" class="headerlink" title="4 CSRF å’Œ XSS çš„åŒºåˆ«"></a>4 CSRF å’Œ XSS çš„åŒºåˆ«</h2><p><strong>åŒºåˆ«ä¸€ï¼š</strong></p><ul><li><code>CSRF</code>ï¼šéœ€è¦ç”¨æˆ·å…ˆç™»å½•ç½‘ç«™<code>A</code>ï¼Œè·å– <code>cookie</code></li><li><code>XSS</code>ï¼šä¸éœ€è¦ç™»å½•ã€‚</li></ul><p><strong>åŒºåˆ«äºŒï¼šï¼ˆåŸç†çš„åŒºåˆ«ï¼‰</strong></p><ul><li><code>CSRF</code>ï¼šæ˜¯åˆ©ç”¨ç½‘ç«™<code>A</code>æœ¬èº«çš„æ¼æ´ï¼Œå»è¯·æ±‚ç½‘ç«™<code>A</code>çš„<code>api</code>ã€‚</li><li><code>XSS</code>ï¼šæ˜¯å‘ç½‘ç«™ <code>A</code> æ³¨å…¥ <code>JS</code>ä»£ç ï¼Œç„¶åæ‰§è¡Œ <code>JS</code> é‡Œçš„ä»£ç ï¼Œç¯¡æ”¹ç½‘ç«™<code>A</code>çš„å†…å®¹ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œå®‰å…¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>V8 å†…å­˜ç®¡ç†ï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶ï¼‰</title>
      <link href="/2023/01/04/009v8-nei-cun-guan-li/"/>
      <url>/2023/01/04/009v8-nei-cun-guan-li/</url>
      
        <content type="html"><![CDATA[<blockquote><p>V8 ä¹Ÿä¼šç”³è¯·å†…å­˜ï¼Œç”³è¯·çš„å†…å­˜åˆä¼šåˆ†ä¸º<strong>å †å†…å­˜å’Œæ ˆå†…å­˜</strong></p></blockquote><h3 id="1-1-æ ˆ"><a href="#1-1-æ ˆ" class="headerlink" title="1.1 æ ˆ"></a>1.1 æ ˆ</h3><ul><li>æ ˆç”¨äºå­˜æ”¾ JS ä¸­çš„<strong>åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹æŒ‡é’ˆ</strong></li><li>æ ˆçš„<strong>ç©ºé—´æ˜¯è¿ç»­</strong>çš„ï¼Œå¢åŠ åˆ é™¤åªéœ€è¦ç§»åŠ¨æŒ‡é’ˆï¼Œæ“ä½œé€Ÿåº¦éå¸¸å¿«</li><li>æ ˆçš„<strong>ç©ºé—´æ˜¯æœ‰é™</strong>çš„ï¼Œå½“æ ˆæ»¡äº†ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯</li><li>æ ˆä¸€èˆ¬æ˜¯åœ¨<strong>æ‰§è¡Œå‡½æ•°æ—¶åˆ›å»º</strong>çš„ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆå°±ä¼šè¢«é”€æ¯</li></ul><h3 id="1-2-å †"><a href="#1-2-å †" class="headerlink" title="1.2 å †"></a>1.2 å †</h3><ul><li>å †ä¸»è¦ç”¨äºå­˜å‚¨ JS ä¸­çš„<strong>å¼•ç”¨ç±»å‹</strong></li></ul><p><img src="https://static.zhufengpeixun.com/dui_de_nei_cun_fen_pei_1639157736483.jpg" alt="new_large_object_space"></p><h4 id="1-2-1-å †ç©ºé—´åˆ†ç±»"><a href="#1-2-1-å †ç©ºé—´åˆ†ç±»" class="headerlink" title="1.2.1 å †ç©ºé—´åˆ†ç±»"></a>1.2.1 å †ç©ºé—´åˆ†ç±»</h4><h5 id="1-2-1-1-æ–°ç”Ÿä»£-new-space"><a href="#1-2-1-1-æ–°ç”Ÿä»£-new-space" class="headerlink" title="1.2.1.1 æ–°ç”Ÿä»£(new space)"></a>1.2.1.1 æ–°ç”Ÿä»£(new space)</h5><ul><li>æ–°ç”Ÿä»£å†…å­˜ç”¨äºå­˜æ”¾ä¸€äº›<strong>ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒçŸ­çš„å¯¹è±¡æ•°æ®</strong></li></ul><h5 id="1-2-1-2-è€ç”Ÿä»£-old-space"><a href="#1-2-1-2-è€ç”Ÿä»£-old-space" class="headerlink" title="1.2.1.2 è€ç”Ÿä»£(old space)"></a>1.2.1.2 è€ç”Ÿä»£(old space)</h5><ul><li>è€ç”Ÿä»£å†…å­˜ç”¨äºå­˜æ”¾ä¸€äº›<strong>ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒé•¿çš„å¯¹è±¡æ•°æ®</strong></li><li>å½“<code>new space</code>çš„å¯¹è±¡è¿›è¡Œ<strong>ä¸¤ä¸ªå‘¨æœŸçš„</strong>åƒåœ¾å›æ”¶åï¼Œå¦‚æœæ•°æ®è¿˜å­˜åœ¨<code>new space</code>ä¸­ï¼Œåˆ™å°†ä»–ä»¬å­˜æ”¾åˆ°<code>old space</code>ä¸­</li><li>Old Space ä½¿<strong>ç”¨æ ‡è®°æ¸…é™¤</strong>å’Œ<strong>æ ‡è®°æ•´ç†</strong>çš„æ–¹å¼è¿›è¡Œåƒåœ¾å›æ”¶</li></ul><h4 id="1-2-2-ä»€ä¹ˆæ˜¯åƒåœ¾"><a href="#1-2-2-ä»€ä¹ˆæ˜¯åƒåœ¾" class="headerlink" title="1.2.2 ä»€ä¹ˆæ˜¯åƒåœ¾"></a>1.2.2 ä»€ä¹ˆæ˜¯åƒåœ¾</h4><ul><li>åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è‚¯å®šä¼šç”¨åˆ°ä¸€äº›æ•°æ®ï¼Œè¿™äº›æ•°æ®ä¼šæ”¾åœ¨å †æ ˆä¸­ï¼Œä½†æ˜¯åœ¨ç¨‹åºè¿è¡Œç»“æŸåï¼Œè¿™äº›æ•°æ®å°±ä¸ä¼šå†è¢«ä½¿ç”¨äº†ï¼Œé‚£äº›ä¸å†ä½¿ç”¨çš„æ•°æ®å°±æ˜¯åƒåœ¾</li></ul><h4 id="1-2-3-æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶"><a href="#1-2-3-æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶" class="headerlink" title="1.2.3 æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶"></a>1.2.3 æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶</h4><ul><li>æ–°ç”Ÿä»£å†…å­˜æœ‰<strong>ä¸¤ä¸ªåŒºåŸŸ</strong>ï¼Œåˆ†åˆ«æ˜¯<strong>å¯¹è±¡åŒºåŸŸ(from) å’Œ ç©ºé—²åŒºåŸŸ(to)</strong></li><li>æ–°ç”Ÿä»£å†…å­˜ä½¿ç”¨<strong>Scavenger ç®—æ³•</strong>æ¥ç®¡ç†å†…å­˜,åƒåœ¾å›æ”¶çš„å…¥å£<ul><li><strong>å¹¿åº¦ä¼˜å…ˆéå†</strong> From-Space ä¸­çš„å¯¹è±¡ï¼Œä»æ ¹å¯¹è±¡å‡ºå‘ï¼Œå¹¿åº¦ä¼˜å…ˆéå†æ‰€æœ‰èƒ½åˆ°è¾¾çš„å¯¹è±¡,æŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ° To-Space</li><li>éå†å®Œæˆåï¼Œ<strong>æ¸…ç©º</strong> From-Space</li><li>From-Space å’Œ To-Space <strong>è§’è‰²äº’æ¢</strong></li></ul></li><li>å¤åˆ¶åçš„å¯¹è±¡åœ¨ To-Space ä¸­å ç”¨çš„<strong>å†…å­˜ç©ºé—´æ˜¯è¿ç»­çš„</strong>ï¼Œ<strong>ä¸ä¼šå‡ºç°ç¢ç‰‡é—®é¢˜</strong></li><li>è¿™ç§åƒåœ¾å›æ”¶æ–¹å¼<strong>å¿«é€Ÿ</strong>è€Œåˆ<strong>é«˜æ•ˆ</strong>ï¼Œä½†æ˜¯<strong>ä¼šé€ æˆç©ºé—´æµªè´¹</strong>ï¼ˆæœ‰ To-Space ç©ºé—²åŒºåŸŸï¼‰</li><li>æ–°ç”Ÿä»£çš„ <strong>GC æ¯”è¾ƒé¢‘ç¹</strong></li><li><strong>æ–°ç”Ÿä»£çš„å¯¹è±¡è½¬ç§»åˆ°è€ç”Ÿ</strong>ä»£ç§°ä¸º<strong>æ™‹å‡ Promote</strong>,åˆ¤æ–­æ™‹å‡çš„æƒ…å†µæœ‰ä¸¤ç§<ul><li>ç»è¿‡<strong>ä¸€æ¬¡ GC</strong> è¿˜å­˜æ´»çš„å¯¹è±¡</li><li>å¯¹è±¡å¤åˆ¶åˆ° To-Space æ—¶ï¼ŒTo-Space çš„<strong>ç©ºé—´è¾¾åˆ°ä¸€å®šçš„é™åˆ¶</strong>ï¼ˆè¶…è¿‡ 25%ï¼‰</li></ul></li></ul><h4 id="1-2-4-è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶"><a href="#1-2-4-è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶" class="headerlink" title="1.2.4 è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶"></a>1.2.4 è€ç”Ÿä»£çš„åƒåœ¾å›æ”¶</h4><blockquote><p>V8 åœ¨è€ç”Ÿä»£ä¸­çš„åƒåœ¾å›æ”¶ç­–ç•¥é‡‡ç”¨<strong>Mark-Sweep(æ ‡è®°æ¸…é™¤)å’Œ Mark-Compact(æ ‡è®°æ•´ç†)ç›¸ç»“åˆ</strong></p></blockquote><h5 id="1-2-4-1-Mark-Sweep-æ ‡è®°æ¸…é™¤"><a href="#1-2-4-1-Mark-Sweep-æ ‡è®°æ¸…é™¤" class="headerlink" title="1.2.4.1 Mark-Sweep(æ ‡è®°æ¸…é™¤)"></a>1.2.4.1 Mark-Sweep(æ ‡è®°æ¸…é™¤)</h5><ul><li>æ ‡è®°æ¸…é™¤åˆ†ä¸º<strong>æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µ</strong></li><li>åœ¨æ ‡è®°é˜¶æ®µéœ€è¦éå†**(æ·±åº¦ä¼˜å…ˆéå†**)å †ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œå¹¶<strong>æ ‡è®°</strong>é‚£äº›<strong>æ´»ç€çš„å¯¹è±¡</strong>ï¼Œç„¶åè¿›å…¥æ¸…é™¤é˜¶æ®µã€‚åœ¨æ¸…é™¤é˜¶æ®µæ€»ï¼Œåª<strong>æ¸…é™¤æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</strong></li><li>V8 é‡‡å–çš„æ˜¯<strong>é»‘è‰²å’Œç™½è‰²æ¥æ ‡è®°æ•°æ®</strong>ï¼Œåƒåœ¾æ”¶é›†ä¹‹å‰ï¼Œä¼šæŠŠæ‰€æœ‰çš„æ•°æ®è®¾ç½®ä¸º<strong>ç™½è‰²</strong>ï¼Œç”¨æ¥æ ‡è®°æ‰€æœ‰çš„<strong>å°šæœªæ ‡è®°çš„å¯¹è±¡</strong>ï¼Œç„¶åä¼šä» GC æ ¹å‡ºå‘ï¼Œä»¥<strong>æ·±åº¦ä¼˜å…ˆçš„æ–¹å¼æŠŠæ‰€æœ‰çš„èƒ½è®¿é—®åˆ°çš„æ•°æ®éƒ½æ ‡è®°ä¸ºé»‘è‰²</strong>ï¼Œéå†ç»“æŸåé»‘è‰²çš„å°±æ˜¯æ´»çš„æ•°æ®ï¼Œç™½è‰²çš„å°±æ˜¯å¯ä»¥æ¸…ç†çš„åƒåœ¾æ•°æ®</li><li>ç”±äºæ ‡è®°æ¸…é™¤åªæ¸…é™¤æ­»äº¡å¯¹è±¡ï¼Œè€Œæ­»äº¡å¯¹è±¡åœ¨è€ç”Ÿä»£ä¸­å ç”¨çš„æ¯”ä¾‹å¾ˆå°ï¼Œæ‰€ä»¥<strong>æ•ˆç‡è¾ƒé«˜</strong></li><li>æ ‡è®°æ¸…é™¤æœ‰ä¸€ä¸ª<strong>é—®é¢˜</strong>å°±æ˜¯è¿›è¡Œä¸€æ¬¡æ ‡è®°æ¸…æ¥šå<strong>ï¼Œå†…å­˜ç©ºé—´å¾€å¾€æ˜¯ä¸è¿ç»­</strong>çš„ï¼Œä¼šå‡ºç°å¾ˆå¤šçš„<strong>å†…å­˜ç¢ç‰‡</strong>ã€‚å¦‚æœåç»­éœ€è¦åˆ†é…ä¸€ä¸ªéœ€è¦å†…å­˜ç©ºé—´è¾ƒå¤šçš„å¯¹è±¡æ—¶ï¼Œå¦‚æœæ‰€æœ‰çš„å†…å­˜ç¢ç‰‡éƒ½ä¸å¤Ÿç”¨ï¼Œå°±ä¼šå‡ºç°å†…å­˜æº¢å‡ºçš„é—®é¢˜</li></ul><h5 id="1-2-4-2-Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰"><a href="#1-2-4-2-Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰" class="headerlink" title="1.2.4.2 Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰"></a>1.2.4.2 Mark-Compactï¼ˆæ ‡è®°æ•´ç†ï¼‰</h5><ul><li>æ ‡è®°æ•´ç†æ­£æ˜¯ä¸ºäº†<strong>è§£å†³æ ‡è®°æ¸…é™¤æ‰€å¸¦æ¥çš„å†…å­˜ç¢ç‰‡çš„é—®é¢˜</strong></li><li>æ ‡è®°æ•´ç†åœ¨æ ‡è®°æ¸…é™¤çš„åŸºç¡€è¿›è¡Œä¿®æ”¹ï¼Œå°†å…¶çš„<strong>æ¸…é™¤é˜¶æ®µå˜ä¸ºç´§ç¼©æç«¯</strong></li><li>åœ¨æ•´ç†çš„è¿‡ç¨‹ä¸­ï¼Œå°†æ´»ç€çš„å¯¹è±¡å‘å†…å­˜åŒºçš„ä¸€æ®µç§»åŠ¨ï¼Œç§»åŠ¨å®Œæˆåç›´æ¥æ¸…ç†æ‰è¾¹ç•Œå¤–çš„å†…å­˜</li><li>ç´§ç¼©è¿‡ç¨‹æ¶‰åŠå¯¹è±¡çš„ç§»åŠ¨ï¼Œæ‰€ä»¥<strong>æ•ˆç‡å¹¶ä¸æ˜¯å¤ªå¥½ï¼Œ</strong>ä½†æ˜¯èƒ½ä¿è¯ä¸ä¼šç”Ÿæˆå†…å­˜ç¢ç‰‡ï¼Œ<strong>ä¸€èˆ¬ 10 æ¬¡æ ‡è®°æ¸…ç†ä¼šä¼´éšä¸€æ¬¡æ ‡è®°æ•´ç†</strong></li></ul><h4 id="1-2-5-ä¼˜åŒ–"><a href="#1-2-5-ä¼˜åŒ–" class="headerlink" title="1.2.5 ä¼˜åŒ–"></a>1.2.5 ä¼˜åŒ–</h4><ul><li>åœ¨æ‰§è¡Œåƒåœ¾å›æ”¶ç®—æ³•æœŸé—´ï¼ŒJS è„šæœ¬éœ€è¦æš‚åœï¼Œè¿™ç§å« Stop the world(å…¨åœé¡¿)</li><li>å¦‚æœå›æ”¶æ—¶é—´è¿‡é•¿ï¼Œä¼šå¼•èµ·å¡é¡¿</li><li>æ€§èƒ½ä¼˜åŒ–<ul><li>æŠŠå¤§ä»»åŠ¡æ‹†åˆ†å°ä»»åŠ¡ï¼Œåˆ†æ­¥æ‰§è¡Œï¼Œç±»ä¼¼ fiber</li><li>å°†ä¸€äº›ä»»åŠ¡æ”¾åœ¨åå°æ‰§è¡Œï¼Œä¸å ç”¨ä¸»çº¿ç¨‹</li></ul></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">JavaScriptæ‰§è¡Œ åƒåœ¾æ ‡è®°ã€åƒåœ¾æ¸…ç†ã€åƒåœ¾æ•´ç† JavaScriptæ‰§è¡Œ<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>                          <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="1-2-5-1-Parallel-å¹¶è¡Œæ‰§è¡Œ"><a href="#1-2-5-1-Parallel-å¹¶è¡Œæ‰§è¡Œ" class="headerlink" title="1.2.5.1 Parallel(å¹¶è¡Œæ‰§è¡Œ)"></a>1.2.5.1 Parallel(å¹¶è¡Œæ‰§è¡Œ)</h5><ul><li><strong>æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶</strong>é‡‡å–å¹¶è¡Œç­–ç•¥æå‡åƒåœ¾å›æ”¶é€Ÿåº¦ï¼Œå®ƒä¼š<strong>å¼€å¯å¤šä¸ªè¾…åŠ©çº¿</strong>ç¨‹æ¥æ‰§è¡Œæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶å·¥ä½œ</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾…åŠ©çº¿ç¨‹<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾…åŠ©çº¿ç¨‹<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>è¾…åŠ©çº¿ç¨‹<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>                    <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="1-2-5-2-å¢é‡æ ‡è®°"><a href="#1-2-5-2-å¢é‡æ ‡è®°" class="headerlink" title="1.2.5.2 å¢é‡æ ‡è®°"></a>1.2.5.2 å¢é‡æ ‡è®°</h5><ul><li>è€ç”Ÿä»£å› ä¸ºå¯¹è±¡åˆå¤§åˆå¤šï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶çš„æ—¶é—´æ›´é•¿ï¼Œé‡‡ç”¨å¢é‡æ ‡è®°çš„æ–¹å¼è¿›è¡Œä¼˜åŒ–</li><li>å¢é‡æ ‡è®°å°±æ˜¯æŠŠæ ‡è®°<strong>å·¥ä½œåˆ†æˆå¤šä¸ªé˜¶æ®µ</strong>ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½åªæ ‡è®°ä¸€éƒ¨åˆ†å¯¹è±¡ï¼Œå’Œä¸»çº¿ç¨‹çš„æ‰§è¡Œç©¿æ’è¿›è¡Œ</li><li>ä¸ºäº†æ”¯æŒå¢é‡æ ‡è®°ï¼ŒV8 å¿…é¡»å¯ä»¥æ”¯æŒåƒåœ¾å›æ”¶çš„<strong>æš‚åœå’Œæ¢å¤</strong>ï¼Œæ‰€ä»¥é‡‡ç”¨äº†<code>é»‘ç™½ç°</code>ä¸‰è‰²æ ‡è®°æ³•<ul><li>é»‘è‰²è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹è¢« GC æ ¹å¼•ç”¨åˆ°äº†ï¼Œè€Œä¸”è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹éƒ½å·²ç»æ ‡è®°å®Œæˆäº†</li><li>ç°è‰²è¡¨ç¤ºè¿™ä¸ªèŠ‚ç‚¹è¢« GC æ ¹å¼•ç”¨åˆ°äº†ï¼Œä½†å­èŠ‚ç‚¹è¿˜æ²¡è¢«åƒåœ¾å›æ”¶å™¨æ ‡è®°å¤„ç†ï¼Œä¹Ÿè¡¨æ˜ç›®å‰æ­£åœ¨å¤„ç†è¿™ä¸ªèŠ‚ç‚¹</li><li>ç™½è‰²è¡¨ç¤ºæ­¤èŠ‚ç‚¹è¿˜æ²¡æœªè¢«åƒåœ¾å›æ”¶å™¨å‘ç°ï¼Œå¦‚æœåœ¨æœ¬è½®éå†ç»“æŸæ—¶è¿˜æ˜¯ç™½è‰²ï¼Œé‚£ä¹ˆè¿™å—æ•°æ®å°±ä¼šè¢«æ”¶å›</li></ul></li><li>å¼•å…¥äº†ç°è‰²æ ‡è®°åï¼Œå°±å¯ä»¥é€šè¿‡åˆ¤æ–­æœ‰æ²¡æœ‰ç°è‰²èŠ‚ç‚¹æ¥åˆ¤æ–­æ ‡è®°æ˜¯å¦å®Œæˆäº†ï¼Œå¦‚æœæœ‰ç°è‰²èŠ‚ç‚¹ï¼Œä¸‹æ¬¡æ¢å¤çš„åº”è¯¥ä»ç°è‰²èŠ‚ç‚¹ç»§ç»­æ‰§è¡Œ</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>å¼€å§‹æ ‡è®°<span class="token operator">--</span><span class="token operator">-</span>å¢é‡æ ‡è®°<span class="token operator">--</span><span class="token operator">-</span>å¢é‡æ ‡è®°<span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†<span class="token operator">--</span><span class="token operator">-</span>æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="1-2-5-3-Write-barrier-å†™å±éšœ"><a href="#1-2-5-3-Write-barrier-å†™å±éšœ" class="headerlink" title="1.2.5.3 Write-barrier(å†™å±éšœ)"></a>1.2.5.3 Write-barrier(å†™å±éšœ)</h5><ul><li>å½“é»‘è‰²æŒ‡å‘ç™½è‰²èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘å†™å±éšœï¼Œè¿™ä¸ªå†™å±éšœä¼šæŠŠç™½è‰²èŠ‚ç‚¹è®¾ç½®ä¸ºç°è‰²</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">global<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"a"</span> <span class="token punctuation">&#125;</span>global<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"b1"</span> <span class="token punctuation">&#125;</span><span class="token comment">//æ‰§è¡Œæ ‡è®°å·¥ä½œ</span>global<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"b2"</span> <span class="token punctuation">&#125;</span><span class="token comment">//ç»§ç»­æ‰§è¡Œæ ‡è®°å·¥ä½œ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="1-2-5-4-Lazy-Sweeping-æƒ°æ€§æ¸…ç†"><a href="#1-2-5-4-Lazy-Sweeping-æƒ°æ€§æ¸…ç†" class="headerlink" title="1.2.5.4 Lazy Sweeping(æƒ°æ€§æ¸…ç†)"></a>1.2.5.4 Lazy Sweeping(æƒ°æ€§æ¸…ç†)</h5><ul><li>å½“å¢é‡æ ‡è®°å®Œæˆåï¼Œå¦‚æœå†…å­˜å¤Ÿç”¨ï¼Œå…ˆä¸æ¸…ç†ï¼Œç­‰ JS ä»£ç æ‰§è¡Œå®Œæ…¢æ…¢æ¸…ç†</li></ul><h5 id="1-2-5-5-concurrent-å¹¶å‘å›æ”¶"><a href="#1-2-5-5-concurrent-å¹¶å‘å›æ”¶" class="headerlink" title="1.2.5.5 concurrent(å¹¶å‘å›æ”¶)"></a>1.2.5.5 concurrent(å¹¶å‘å›æ”¶)</h5><ul><li>å…¶å®å¢é‡æ ‡è®°å’Œæƒ°æ€§æ¸…ç†å¹¶æ²¡æœ‰å‡å°‘æš‚åœçš„æ€»æ—¶é—´</li><li>å¹¶å‘å›æ”¶å°±æ˜¯ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè¾…åŠ©çº¿ç¨‹å¯ä»¥åœ¨åå°å®Œæˆåƒåœ¾å›æ”¶å·¥ä½œ</li><li>æ ‡è®°æ“ä½œå…¨éƒ½ç”±è¾…åŠ©çº¿ç¨‹å®Œï¼Œæ¸…ç†æ“ä½œç”±ä¸»çº¿ç¨‹å’Œè¾…åŠ©çº¿ç¨‹é…åˆå®Œæˆ</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">         <span class="token operator">--</span><span class="token operator">--</span>è¾…åŠ©çº¿ç¨‹æ ‡è®°<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span>è¾…åŠ©çº¿ç¨‹æ ‡è®°<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>         <span class="token operator">--</span><span class="token operator">--</span>è¾…åŠ©çº¿ç¨‹æ ‡è®°<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span>      <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ‰§è¡Œ<span class="token constant">JS</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>æ¸…ç†æ•´ç†<span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºç½‘ç»œ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æµè§ˆå™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JSä¸­çš„ç»§æ‰¿</title>
      <link href="/2023/01/03/008js-zhong-de-ji-cheng/"/>
      <url>/2023/01/03/008js-zhong-de-ji-cheng/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€ã€åŸå‹é“¾ç»§æ‰¿"><a href="#ä¸€ã€åŸå‹é“¾ç»§æ‰¿" class="headerlink" title="ä¸€ã€åŸå‹é“¾ç»§æ‰¿"></a>ä¸€ã€åŸå‹é“¾ç»§æ‰¿</h3><p><strong>æ„é€ å‡½æ•°ã€åŸå‹å’Œå®ä¾‹çš„å…³ç³»ï¼š</strong> æ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹æœ‰ä¸€ä¸ªå±æ€§æŒ‡å›æ„é€ å‡½æ•°ï¼Œè€Œå®ä¾‹æœ‰ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆæŒ‡å‘åŸå‹ã€‚</p><p><strong>åŸå‹é“¾çš„åŸºæœ¬æ„æƒ³ï¼š</strong> å¦‚æœåŸå‹æ˜¯å¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹å‘¢ï¼Ÿé‚£å°±æ„å‘³ç€è¿™ä¸ªåŸå‹æœ¬èº«æœ‰ä¸€ä¸ªå†…éƒ¨æŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªåŸå‹ï¼Œç›¸åº”åœ°å¦ä¸€ä¸ªåŸå‹ä¹Ÿæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¦ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚è¿™æ ·å°±åœ¨å®ä¾‹å’ŒåŸå‹ä¹‹é—´æ„é€ äº†ä¸€æ¡åŸå‹é“¾</p><p><strong>é‡ç‚¹ï¼š</strong> è®©æ–°å®ä¾‹çš„åŸå‹ç­‰äºçˆ¶ç±»çš„å®ä¾‹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getSuperValue</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>property<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>subproperty <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span class="token comment">// ç»§æ‰¿ SuperType</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getSubValue</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subproperty<span class="token punctuation">&#125;</span><span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span><span class="token function">getSuperValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ol><li>å®ä¾‹å¯ç»§æ‰¿çš„å±æ€§æœ‰ï¼šå®ä¾‹çš„æ„é€ å‡½æ•°çš„å±æ€§ï¼Œçˆ¶ç±»æ„é€ å‡½æ•°å±æ€§ï¼Œçˆ¶ç±»åŸå‹çš„å±æ€§ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>æ–°å®ä¾‹æ— æ³•å‘çˆ¶ç±»æ„é€ å‡½æ•°ä¼ å‚ã€‚</li><li>ç»§æ‰¿å•ä¸€ã€‚(åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»æ„é€ å‡½æ•°)</li><li>æ‰€æœ‰æ–°å®ä¾‹éƒ½ä¼šå…±äº«çˆ¶ç±»å®ä¾‹çš„å±æ€§ã€‚ï¼ˆåŸå‹ä¸Šçš„å±æ€§æ˜¯å…±äº«çš„ï¼Œä¸€ä¸ªå®ä¾‹ä¿®æ”¹äº†åŸå‹å±æ€§ï¼Œå¦ä¸€ä¸ªå®ä¾‹çš„åŸæ€§ä¹Ÿä¼šè¢«ä¿®æ”¹ï¼ï¼‰</li><li>è¦æƒ³ä¸ºå­ç±»åŸå‹æ–°å¢å±æ€§å’Œæ–¹æ³•ï¼Œå¿…é¡»è¦åœ¨<code>new SuperType()</code>è¿™æ ·çš„è¯­å¥ä¹‹åæ‰§è¡Œ</li></ol><p>ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">// ç»§æ‰¿ SuperType</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">let</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// "red,blue,green,black"</span><span class="token keyword">let</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// "red,blue,green,black"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="äºŒã€å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿"><a href="#äºŒã€å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿" class="headerlink" title="äºŒã€å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿"></a>äºŒã€å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿</h3><p><strong>é‡ç‚¹ï¼š</strong> ç”¨.call()å’Œ.apply()å°†çˆ¶ç±»æ„é€ å‡½æ•°å¼•å…¥å­ç±»å‡½æ•°ï¼ˆåœ¨å­ç±»å‡½æ•°ä¸­åšäº†çˆ¶ç±»å‡½æ•°çš„è‡ªæ‰§è¡Œï¼ˆå¤åˆ¶ï¼‰ï¼‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç»§æ‰¿ SuperType å¹¶ä¼ å‚</span>  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">"Nicholas"</span><span class="token punctuation">)</span>  <span class="token comment">// å®ä¾‹å±æ€§</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">29</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// "Nicholas";</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// 29</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ol><li>åªç»§æ‰¿äº†çˆ¶ç±»æ„é€ å‡½æ•°çš„å±æ€§ï¼Œæ²¡æœ‰ç»§æ‰¿çˆ¶ç±»åŸå‹çš„å±æ€§ã€‚</li><li>è§£å†³äº†åŸå‹é“¾ç»§æ‰¿ç¼ºç‚¹ 1ã€2ã€3ã€‚</li><li>å¯ä»¥ç»§æ‰¿å¤šä¸ªæ„é€ å‡½æ•°å±æ€§ï¼ˆcall å¤šä¸ªï¼‰ã€‚</li><li>åœ¨å­å®ä¾‹ä¸­å¯å‘çˆ¶å®ä¾‹ä¼ å‚ã€‚</li><li>è§£å†³äº†å¼•ç”¨å€¼é—®é¢˜</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li>åªèƒ½ç»§æ‰¿çˆ¶ç±»æ„é€ å‡½æ•°çš„å±æ€§ã€‚</li><li>æ— æ³•å®ç°æ„é€ å‡½æ•°çš„å¤ç”¨ã€‚</li><li>æ¯ä¸ªæ–°å®ä¾‹éƒ½æœ‰çˆ¶ç±»æ„é€ å‡½æ•°çš„å‰¯æœ¬ï¼Œè‡ƒè‚¿ã€‚</li></ol><h3 id="ä¸‰ã€ç»„åˆç»§æ‰¿ï¼ˆç»„åˆåŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ï¼‰ï¼ˆå¸¸ç”¨ï¼‰"><a href="#ä¸‰ã€ç»„åˆç»§æ‰¿ï¼ˆç»„åˆåŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ï¼‰ï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="ä¸‰ã€ç»„åˆç»§æ‰¿ï¼ˆç»„åˆåŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ï¼‰ï¼ˆå¸¸ç”¨ï¼‰"></a>ä¸‰ã€ç»„åˆç»§æ‰¿ï¼ˆç»„åˆåŸå‹é“¾ç»§æ‰¿å’Œå€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿ï¼‰ï¼ˆå¸¸ç”¨ï¼‰</h3><p><strong>é‡ç‚¹ï¼š</strong> ç»“åˆäº†ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ï¼Œ<strong>ä¼ å‚å’Œå¤ç”¨</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç»§æ‰¿å±æ€§</span>  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token comment">//// ç¬¬ä¸€æ¬¡è°ƒç”¨ SuperType()</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">&#125;</span><span class="token comment">// ç»§æ‰¿æ–¹æ³•</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SuperType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç¬¬äºŒæ¬¡è°ƒç”¨ SuperType()</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> instance1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">"Nicholas"</span><span class="token punctuation">,</span> <span class="token number">29</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"instance1=>"</span><span class="token punctuation">,</span> instance1<span class="token punctuation">)</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"black"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// "red,blue,green,black"</span>instance1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// "Nicholas";</span>instance1<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 29</span><span class="token keyword">let</span> instance2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubType</span><span class="token punctuation">(</span><span class="token string">"Greg"</span><span class="token punctuation">,</span> <span class="token number">27</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>instance2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// "red,blue,green"</span>instance2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// "Greg";</span>instance2<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 27</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç‰¹ç‚¹ï¼š</strong></p><ol><li>å¯ä»¥ç»§æ‰¿çˆ¶ç±»åŸå‹ä¸Šçš„å±æ€§ï¼Œå¯ä»¥ä¼ å‚ï¼Œå¯å¤ç”¨ã€‚</li><li>æ¯ä¸ªæ–°å®ä¾‹å¼•å…¥çš„æ„é€ å‡½æ•°å±æ€§æ˜¯ç§æœ‰çš„ã€‚</li></ol><p><strong>ç¼ºç‚¹ï¼š</strong> ç»„åˆç»§æ‰¿å…¶å®ä¹Ÿå­˜åœ¨æ•ˆç‡é—®é¢˜ã€‚æœ€ä¸»è¦çš„æ•ˆç‡é—®é¢˜å°±æ˜¯ <strong>çˆ¶ç±»æ„é€ å‡½æ•°å§‹ç»ˆä¼šè¢«è°ƒç”¨ä¸¤æ¬¡</strong> ï¼šä¸€æ¬¡åœ¨æ˜¯åˆ›å»ºå­ç±»åŸå‹æ—¶è°ƒç”¨ï¼Œå¦ä¸€æ¬¡æ˜¯åœ¨å­ç±»æ„é€ å‡½æ•°ä¸­è°ƒç”¨</p><h3 id="å››ã€åŸå‹å¼ç»§æ‰¿"><a href="#å››ã€åŸå‹å¼ç»§æ‰¿" class="headerlink" title="å››ã€åŸå‹å¼ç»§æ‰¿"></a>å››ã€åŸå‹å¼ç»§æ‰¿</h3><p><strong>é‡ç‚¹ï¼š</strong> ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£…ä¸€ä¸ªå¯¹è±¡ï¼Œç„¶åè¿”å›è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°å°±å˜æˆäº†ä¸ªå¯ä»¥éšæ„å¢æ·»å±æ€§çš„å®ä¾‹æˆ–å¯¹è±¡ã€‚object.create()å°±æ˜¯è¿™ä¸ªåŸç†ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">//æ ¸å¿ƒä»£ç </span><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Nicholas"</span><span class="token punctuation">,</span>  <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Shelby"</span><span class="token punctuation">,</span> <span class="token string">"Court"</span><span class="token punctuation">,</span> <span class="token string">"Van"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> anotherPerson <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>anotherPerson<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Greg"</span>anotherPerson<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Rob"</span><span class="token punctuation">)</span><span class="token keyword">let</span> yetAnotherPerson <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>yetAnotherPerson<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"Linda"</span>yetAnotherPerson<span class="token punctuation">.</span>friends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">"Barbie"</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>friends<span class="token punctuation">)</span> <span class="token comment">// "Shelby,Court,Van,Rob,Barbie"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ç‰¹ç‚¹ï¼š</strong> ç±»ä¼¼äºå¤åˆ¶ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨å‡½æ•°æ¥åŒ…è£…ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><ol><li><p>æ‰€æœ‰å®ä¾‹éƒ½ä¼šç»§æ‰¿åŸå‹ä¸Šçš„å±æ€§ã€‚</p></li><li><p>æ— æ³•å®ç°å¤ç”¨ã€‚ï¼ˆæ–°å®ä¾‹å±æ€§éƒ½æ˜¯åé¢æ·»åŠ çš„ï¼‰</p></li></ol><blockquote><p>åŸå‹å¼ç»§æ‰¿éå¸¸é€‚åˆä¸éœ€è¦å•ç‹¬åˆ›å»ºæ„é€ å‡½æ•°ï¼Œä½†ä»ç„¶éœ€è¦åœ¨å¯¹è±¡é—´å…±äº«ä¿¡æ¯çš„åœºåˆã€‚ä½†è¦è®°ä½ï¼Œå±æ€§ä¸­åŒ…å«çš„å¼•ç”¨å€¼å§‹ç»ˆä¼šåœ¨ç›¸å…³å¯¹è±¡é—´å…±äº«ï¼Œè·Ÿä½¿ç”¨åŸå‹æ¨¡å¼æ˜¯ä¸€æ ·çš„</p></blockquote><h3 id="äº”ã€å¯„ç”Ÿå¼ç»§æ‰¿"><a href="#äº”ã€å¯„ç”Ÿå¼ç»§æ‰¿" class="headerlink" title="äº”ã€å¯„ç”Ÿå¼ç»§æ‰¿"></a>äº”ã€å¯„ç”Ÿå¼ç»§æ‰¿</h3><p><strong>é‡ç‚¹ï¼š</strong> å°±æ˜¯ç»™åŸå‹å¼ç»§æ‰¿å¤–é¢å¥—äº†ä¸ªå£³å­ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">createAnother</span><span class="token punctuation">(</span><span class="token parameter">original</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> clone <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span> <span class="token comment">// é€šè¿‡è°ƒç”¨å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span>  clone<span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ä»¥æŸç§æ–¹å¼å¢å¼ºè¿™ä¸ªå¯¹è±¡</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"hi"</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> clone <span class="token comment">// è¿”å›è¿™ä¸ªå¯¹è±¡</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"Nicholas"</span><span class="token punctuation">,</span>  <span class="token literal-property property">friends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Shelby"</span><span class="token punctuation">,</span> <span class="token string">"Court"</span><span class="token punctuation">,</span> <span class="token string">"Van"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> anotherPerson <span class="token operator">=</span> <span class="token function">createAnother</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>anotherPerson<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// "hi"</span><span class="token comment">//å¯„ç”Ÿå¼ç»§æ‰¿åŒæ ·é€‚åˆä¸»è¦å…³æ³¨å¯¹è±¡ï¼Œè€Œä¸åœ¨ä¹ç±»å‹å’Œæ„é€ å‡½æ•°çš„åœºæ™¯ã€‚object()å‡½æ•°ä¸æ˜¯å¯„ç”Ÿå¼ç»§æ‰¿æ‰€å¿…éœ€çš„ï¼Œä»»ä½•è¿”å›æ–°å¯¹è±¡çš„å‡½æ•°éƒ½å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ã€‚</span><span class="token comment">// æ³¨æ„ é€šè¿‡å¯„ç”Ÿå¼ç»§æ‰¿ç»™å¯¹è±¡æ·»åŠ å‡½æ•°ä¼šå¯¼è‡´å‡½æ•°éš¾ä»¥é‡ç”¨ï¼Œä¸æ„é€ å‡½æ•°æ¨¡å¼ç±»ä¼¼ã€‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¼˜ç‚¹ï¼š</strong> æ²¡æœ‰åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ï¼Œå› ä¸ºåªæ˜¯å¥—äº†ä¸ªå£³å­è¿”å›å¯¹è±¡ï¼ˆè¿™ä¸ªï¼‰ï¼Œè¿™ä¸ªå‡½æ•°é¡ºç†æˆç« å°±æˆäº†åˆ›å»ºçš„æ–°å¯¹è±¡ã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong> æ²¡ç”¨åˆ°åŸå‹ï¼Œæ— æ³•å¤ç”¨ã€‚</p><h3 id="å…­ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ˆå¸¸ç”¨ï¼‰"><a href="#å…­ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ˆå¸¸ç”¨ï¼‰" class="headerlink" title="å…­ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ˆå¸¸ç”¨ï¼‰"></a>å…­ã€å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ˆå¸¸ç”¨ï¼‰</h3><p><strong>é‡ç‚¹ï¼š</strong> é€šè¿‡<strong>å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿å±æ€§</strong> ï¼Œä½†ä½¿ç”¨æ··åˆå¼åŸå‹é“¾ç»§æ‰¿æ–¹æ³•ã€‚åŸºæœ¬æ€è·¯æ˜¯ä¸é€šè¿‡è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ç»™å­ç±»åŸå‹èµ‹å€¼ï¼Œè€Œæ˜¯å–å¾—çˆ¶ç±»åŸå‹çš„ä¸€ä¸ªå‰¯æœ¬ã€‚è¯´åˆ°åº•å°±æ˜¯ä½¿ç”¨å¯„ç”Ÿå¼ç»§æ‰¿æ¥ç»§æ‰¿çˆ¶ç±»åŸå‹ï¼Œç„¶åå°†è¿”å›çš„æ–°å¯¹è±¡èµ‹å€¼ç»™å­ç±»åŸå‹ã€‚</p><p><strong>å¯„ç”Ÿï¼š</strong> åœ¨å‡½æ•°å†…è¿”å›å¯¹è±¡ç„¶åè°ƒç”¨</p><p><strong>ç»„åˆï¼š</strong></p><ol><li>å‡½æ•°çš„åŸå‹ç­‰äºå¦ä¸€ä¸ªå®ä¾‹ã€‚</li><li>åœ¨å‡½æ•°ä¸­ç”¨ apply æˆ–è€… call å¼•å…¥å¦ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå¯ä¼ å‚</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/*function inheritPrototype(subType, superType) &#123;  let prototype = object(superType.prototype); // åˆ›å»ºå¯¹è±¡ prototype.constructor = subType; // å¢å¼ºå¯¹è±¡  subType.prototype = prototype; // èµ‹å€¼å¯¹è±¡&#125;*/</span><span class="token keyword">function</span> <span class="token function">SuperType</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token class-name">SuperType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">SubType</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">SuperType</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">&#125;</span><span class="token keyword">let</span> prototype <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>superType<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token comment">// åˆ›å»ºå¯¹è±¡</span>subType<span class="token punctuation">.</span>prototype <span class="token operator">=</span> prototype <span class="token comment">// èµ‹å€¼å¯¹è±¡</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> subType <span class="token comment">// ä¿®å¤å®ä¾‹</span><span class="token comment">//inheritPrototype(SubType, SuperType);</span><span class="token class-name">SubType</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ä¼˜å…ˆï¼š</strong> ä¿®å¤äº†ç»„åˆç»§æ‰¿çš„é—®é¢˜</p><p><strong>ç¼ºç‚¹ï¼š</strong> å®ç°éº»çƒ¦</p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JSé«˜çº§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sentryç›‘æ§</title>
      <link href="/2022/11/16/007sentry/"/>
      <url>/2022/11/16/007sentry/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h2><ul><li><p><a href="https://github.com/zhilinYu/zhufeng-public/tree/master/%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7monitor/monitor">https://github.com/zhilinYu/zhufeng-public/tree/master/%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7monitor/monitor</a></p></li><li><p><a href="https://retechus.atlassian.net/browse/EW-1744">https://retechus.atlassian.net/browse/EW-1744</a></p></li><li><p><a href="https://juejin.cn/post/6856366626750038023">https://juejin.cn/post/6856366626750038023</a></p></li><li><p><a href="https://juejin.cn/post/6844903984457580551">https://juejin.cn/post/6844903984457580551</a></p></li></ul><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><ul><li><p><a href="https://juejin.cn/post/6914530201430917128">https://juejin.cn/post/6914530201430917128</a></p></li><li><p><a href="https://juejin.cn/post/6844904088866390024?share_token=72af2173-7dc5-4301-b2a4-35818b82813b">https://juejin.cn/post/6844904088866390024?share_token=72af2173-7dc5-4301-b2a4-35818b82813b</a></p></li></ul><h2 id="ä¸ŠæŠ¥-SourceMap-ç‰ˆæœ¬å·"><a href="#ä¸ŠæŠ¥-SourceMap-ç‰ˆæœ¬å·" class="headerlink" title="ä¸ŠæŠ¥ SourceMap ç‰ˆæœ¬å·"></a>ä¸ŠæŠ¥ SourceMap ç‰ˆæœ¬å·</h2><ul><li><p><a href="https://juejin.cn/post/6954303116783124487?share_token=fdac6d5d-73fe-43be-aa02-2930cca74729">https://juejin.cn/post/6954303116783124487?share_token=fdac6d5d-73fe-43be-aa02-2930cca74729</a></p></li><li><p><a href="https://juejin.cn/post/7123518368631652382">https://juejin.cn/post/7123518368631652382</a></p></li></ul><h2 id="æ‰‹åŠ¨ä¸ŠæŠ¥"><a href="#æ‰‹åŠ¨ä¸ŠæŠ¥" class="headerlink" title="æ‰‹åŠ¨ä¸ŠæŠ¥"></a>æ‰‹åŠ¨ä¸ŠæŠ¥</h2><ul><li><a href="https://juejin.cn/post/6957475955858210823">https://juejin.cn/post/6957475955858210823</a></li></ul><h2 id="ä¸»åŠ¨æ•è·é”™è¯¯"><a href="#ä¸»åŠ¨æ•è·é”™è¯¯" class="headerlink" title="ä¸»åŠ¨æ•è·é”™è¯¯"></a>ä¸»åŠ¨æ•è·é”™è¯¯</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">axios  <span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    Sentry<span class="token punctuation">.</span><span class="token function">captureException</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"something went wrong"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> scope<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h2><ul><li><a href="https://juejin.cn/post/6919856296522989582">https://juejin.cn/post/6919856296522989582</a></li></ul><h2 id="å¾®å‰ç«¯åŒºåˆ†é¡¹ç›®"><a href="#å¾®å‰ç«¯åŒºåˆ†é¡¹ç›®" class="headerlink" title="å¾®å‰ç«¯åŒºåˆ†é¡¹ç›®"></a>å¾®å‰ç«¯åŒºåˆ†é¡¹ç›®</h2><ul><li><a href="https://juejin.cn/post/7139452175088320520">https://juejin.cn/post/7139452175088320520</a></li></ul><h2 id="æ€§èƒ½"><a href="#æ€§èƒ½" class="headerlink" title="æ€§èƒ½"></a>æ€§èƒ½</h2><ul><li><p><a href="https://juejin.cn/post/7148364027817623589?share_token=387017f7-9c88-4765-b069-b5a6aff3c36d">https://juejin.cn/post/7148364027817623589?share_token=387017f7-9c88-4765-b069-b5a6aff3c36d</a></p></li><li><p><a href="https://juejin.cn/post/7151753139052347399?share_token=474df17d-1139-403e-b351-766e3ad65ab5">https://juejin.cn/post/7151753139052347399?share_token=474df17d-1139-403e-b351-766e3ad65ab5</a></p></li></ul><h2 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h2><ul><li><a href="https://juejin.cn/post/7143142055294795807">https://juejin.cn/post/7143142055294795807</a></li></ul><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><ul><li><a href="https://github.com/getsentry/sentry-javascript">https://github.com/getsentry/sentry-javascript</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡åŒ–å»ºè®¾</title>
      <link href="/2022/09/16/005-wen-hua/"/>
      <url>/2022/09/16/005-wen-hua/</url>
      
        <content type="html"><![CDATA[<h3 id="å…¬å¸æ–‡åŒ–ï¼š"><a href="#å…¬å¸æ–‡åŒ–ï¼š" class="headerlink" title="å…¬å¸æ–‡åŒ–ï¼š"></a>å…¬å¸æ–‡åŒ–ï¼š</h3><ol><li>Open minded and cooperative - å¼€æ”¾åˆä½œï¼Œè™šå¿ƒè‡ªçœ</li><li>Simple and direct communication - ä¸ç”©é”…ï¼Œä¸æŠ±æ€¨</li><li>Always seek for truth - åŸºäºäº‹å®ï¼Œè¿½æ±‚çœŸç†</li><li>Always keep learning, stay humble - ä¿æŒå­¦ä¹ ï¼Œä¿æŒæ•¬ç•</li><li>Mars view - Global team - ç«æ˜Ÿè§†è§’</li></ol><h3 id="å›¢é˜Ÿæ–‡åŒ–"><a href="#å›¢é˜Ÿæ–‡åŒ–" class="headerlink" title="å›¢é˜Ÿæ–‡åŒ–"></a>å›¢é˜Ÿæ–‡åŒ–</h3><ul><li>è‡ªé©±åä½œï¼›</li><li>å­¦ä¹ è¿›å–ï¼›</li><li>ç§¯æä¸»åŠ¨ï¼›</li><li>æ‰¿æ‹…è´£ä»»ï¼›</li><li>æˆå°±ä»–äººï¼›</li><li>å¾€å‰ä¸€æ­¥ï¼Œç«™åœ¨å¯¹æ–¹ç«‹åœºæ€è€ƒé—®é¢˜ï¼›</li><li>æ‹¥æŠ±å˜åŒ–ã€å‹‡äºæŒ‘æˆ˜ã€æ‰“ç ´è¾¹ç•Œï¼ˆèƒ½åŠ›ã€è®¤çŸ¥ï¼‰ï¼Œæœ‰å…¨å±€æ„è¯†ï¼</li></ul>]]></content>
      
      
      <categories>
          
          <category> æ–‡åŒ–å»ºè®¾ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡åŒ–å»ºè®¾ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿ç»­æ•°ç»„test1</title>
      <link href="/2022/09/16/006-lian-xu-shu-zu/"/>
      <url>/2022/09/16/006-lian-xu-shu-zu/</url>
      
        <content type="html"><![CDATA[<h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><blockquote><p>ç»™å®šä¸€ä¸ªäºŒè¿›åˆ¶æ•°ç»„ nums , æ‰¾åˆ°å«æœ‰ç›¸åŒæ•°é‡çš„ 0 å’Œ 1 çš„æœ€é•¿è¿ç»­å­æ•°ç»„ï¼Œå¹¶è¿”å›è¯¥å­æ•°ç»„çš„é•¿åº¦ã€‚</p><p>ç¤ºä¾‹ 1:</p><p>è¾“å…¥: nums = [0,1]</p><p>è¾“å‡º: 2</p><p>è¯´æ˜: [0, 1] æ˜¯å…·æœ‰ç›¸åŒæ•°é‡ 0 å’Œ 1 çš„æœ€é•¿è¿ç»­å­æ•°ç»„ã€‚</p><p>ç¤ºä¾‹ 2:</p><p>è¾“å…¥: nums = [0,1,0]</p><p>è¾“å‡º: 2</p><p>è¯´æ˜: [0, 1] (æˆ– [1, 0]) æ˜¯å…·æœ‰ç›¸åŒæ•°é‡ 0 å’Œ 1 çš„æœ€é•¿è¿ç»­å­æ•°ç»„ã€‚</p><p>var findMaxLength = function(nums) {</p><p>// TODO</p><p>};</p></blockquote><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><blockquote><p>// å‰ç¼€å’Œ+å“ˆå¸Œè¡¨<br>// ç”±äºã€Œ0 å’Œ 1 çš„æ•°é‡ç›¸åŒã€ç­‰ä»·äºã€Œ1 çš„æ•°é‡å‡å» 0 çš„æ•°é‡ç­‰äº 0ã€ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°ç»„ä¸­çš„ 0 è§†ä½œ âˆ’1ï¼Œåˆ™åŸé—®é¢˜è½¬æ¢æˆã€Œæ±‚æœ€é•¿çš„è¿ç»­å­æ•°ç»„ï¼Œå…¶å…ƒç´ å’Œä¸º 0ã€ã€‚</p><p>// ç”±äºå“ˆå¸Œè¡¨å­˜å‚¨çš„æ˜¯ counter çš„æ¯ä¸ªå–å€¼ç¬¬ä¸€æ¬¡å‡ºç°çš„ä¸‹æ ‡ï¼Œå› æ­¤å½“é‡åˆ°é‡å¤çš„å‰ç¼€å’Œæ—¶ï¼Œæ ¹æ®å½“å‰ä¸‹æ ‡å’Œå“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„ä¸‹æ ‡è®¡ç®—å¾—åˆ°çš„å­æ•°ç»„é•¿åº¦æ˜¯ä»¥å½“å‰ä¸‹æ ‡ç»“å°¾çš„å­æ•°ç»„ä¸­æ»¡è¶³æœ‰ç›¸åŒæ•°é‡çš„ 0 å’Œ 1 çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ã€‚éå†ç»“æŸæ—¶ï¼Œå³å¯å¾—åˆ° nums ä¸­çš„æœ‰ç›¸åŒæ•°é‡çš„ 0 å’Œ 1 çš„æœ€é•¿å­æ•°ç»„çš„é•¿åº¦ã€‚</p></blockquote><h3 id="å‚è€ƒç­”æ¡ˆ"><a href="#å‚è€ƒç­”æ¡ˆ" class="headerlink" title="å‚è€ƒç­”æ¡ˆ"></a>å‚è€ƒç­”æ¡ˆ</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">findMaxLength</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> maxLength <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> counter <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">////å­˜å‚¨newNumsçš„å‰ç¼€å’Œå³å¯</span>  map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>counter<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//åˆä¸ºkeyï¼Œç´¢å¼•ä¸ºvalue,åˆå§‹åŒ–ç´¢å¼•ä¸º-1ï¼Œå’Œä¸º0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      counter<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      counter<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      maxLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxLength<span class="token punctuation">,</span> i <span class="token operator">-</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>counter<span class="token punctuation">,</span> i<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> maxLength<span class="token punctuation">&#125;</span><span class="token keyword">const</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token keyword">const</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">findMaxLength</span><span class="token punctuation">(</span>arr1<span class="token punctuation">)</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">findMaxLength</span><span class="token punctuation">(</span>arr2<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è½¯ä»¶ä¸‹è½½</title>
      <link href="/2022/08/17/015-ruan-jian-an-zhuang/"/>
      <url>/2022/08/17/015-ruan-jian-an-zhuang/</url>
      
        <content type="html"><![CDATA[<h2 id="è„šæœ¬ä¹‹å®¶"><a href="#è„šæœ¬ä¹‹å®¶" class="headerlink" title="è„šæœ¬ä¹‹å®¶"></a>è„šæœ¬ä¹‹å®¶</h2><p><a href="https://www.jb51.net/">è„šæœ¬ä¹‹å®¶</a></p><h3 id="Navicat-Premium15"><a href="#Navicat-Premium15" class="headerlink" title="Navicat Premium15"></a><code>Navicat Premium</code>15</h3><p><a href="https://www.jb51.net/article/199525.htm"><code>Navicat Premium15</code>å®‰è£…åŠç ´è§£æ•™ç¨‹è¯¦è§£äº²æµ‹æœ‰æ•ˆ(é™„ç ´è§£å¤±è´¥è§£å†³æ–¹æ¡ˆ)</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>node å·¥å…·ä½¿ç”¨</title>
      <link href="/2022/08/17/022-node/"/>
      <url>/2022/08/17/022-node/</url>
      
        <content type="html"><![CDATA[<h2 id="nvm-å®‰è£…å’Œä½¿ç”¨"><a href="#nvm-å®‰è£…å’Œä½¿ç”¨" class="headerlink" title="nvm å®‰è£…å’Œä½¿ç”¨"></a>nvm å®‰è£…å’Œä½¿ç”¨</h2><ul><li><a href="http://nvm.uihtm.com/">nvm ä¸€ä¸ª nodejs ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼</a></li><li><a href="https://nodejs.org/en/">node å®˜ç½‘</a></li><li><a href="https://blog.csdn.net/QWERTYQ16/article/details/124497532">nvm çš„ç®€ä»‹ã€å®‰è£…ã€ä½¿ç”¨ï¼ˆç®€å•æ˜äº†ï¼‰</a></li><li><a href="https://github.com/coreybutler/nvm-windows/issues/145">å®‰è£…åï¼Œæ¯ä¸ªå‘½ä»¤éƒ½å¤±è´¥å¹¶æ˜¾ç¤ºæ¶ˆæ¯â€œC:\Users%username%\AppData\Roaming\nvm æ‰¾ä¸åˆ°æˆ–ä¸å­˜åœ¨ã€‚é€€å‡ºã€‚â€</a></li></ul><blockquote><p>å¸¸ç”¨å‘½ä»¤</p></blockquote><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># æ˜¾ç¤ºå¯ä¸‹è½½ç‰ˆæœ¬çš„éƒ¨åˆ†åˆ—è¡¨</span>$ nvm list available<span class="token comment"># å®‰è£…æœ€æ–°ç‰ˆæœ¬ ( å®‰è£…æ—¶å¯ä»¥åœ¨ä¸Šé¢çœ‹åˆ° node.js ã€ npm ç›¸åº”çš„ç‰ˆæœ¬å· ï¼Œä¸å»ºè®®å®‰è£…æœ€æ–°ç‰ˆæœ¬)</span>$ nvm install latest<span class="token comment"># å®‰è£…æŒ‡å®šçš„ç‰ˆæœ¬çš„nodejs</span>$ nvm install ç‰ˆæœ¬å·<span class="token comment"># æŸ¥çœ‹ç›®å‰å·²ç»å®‰è£…çš„ç‰ˆæœ¬ ï¼ˆ å½“å‰ç‰ˆæœ¬å·å‰é¢æ²¡æœ‰ * ï¼Œ æ­¤æ—¶è¿˜æ²¡æœ‰ä½¿ç”¨ä»»ä½•ä¸€ä¸ªç‰ˆæœ¬ï¼Œè¿™æ—¶ä½¿ç”¨ node.js æ—¶ä¼šæŠ¥é”™ ï¼‰</span>$ nvm listæˆ– $ nvm ls<span class="token comment"># ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„nodejs ï¼ˆ è¿™æ—¶ä¼šå‘ç°åœ¨å¯ç”¨çš„ node ç‰ˆæœ¬å‰é¢æœ‰ * æ ‡è®°ï¼Œè¿™æ—¶å°±å¯ä»¥ä½¿ç”¨ node.js ï¼‰</span>$ nvm use ç‰ˆæœ¬å·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="nvm-å¸¸è§é—®é¢˜"><a href="#nvm-å¸¸è§é—®é¢˜" class="headerlink" title="nvm å¸¸è§é—®é¢˜"></a>nvm å¸¸è§é—®é¢˜</h3><p><strong>æŸ¥çœ‹ nvm è·¯å¾„</strong> <code>nvm root</code></p><blockquote><p>å¦‚æœä¸‹è½½ node è¿‡æ…¢ï¼Œè¯·æ›´æ¢å›½å†…é•œåƒæº, åœ¨ nvm çš„å®‰è£…è·¯å¾„ä¸‹ï¼Œæ‰¾åˆ° settings.txtï¼Œè®¾ç½® node_mirro ä¸ npm_mirror ä¸ºå›½å†…é•œåƒåœ°å€ã€‚ä¸‹è½½å°±é£å¿«äº†~~</p></blockquote><pre class="line-numbers language-scala" data-language="scala"><code class="language-scala">root<span class="token operator">:</span> D<span class="token operator">:</span>\nvmpath<span class="token operator">:</span> D<span class="token operator">:</span>\nodejsnode_mirror<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span>mirrors<span class="token operator">/</span>node<span class="token operator">/</span>npm_mirror<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>npm<span class="token punctuation">.</span>taobao<span class="token punctuation">.</span>org<span class="token operator">/</span>mirrors<span class="token operator">/</span>npm<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> å‰ç«¯å·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>umi4å‡çº§</title>
      <link href="/2022/08/09/016-sheng-ji-umi4/"/>
      <url>/2022/08/09/016-sheng-ji-umi4/</url>
      
        <content type="html"><![CDATA[<p> å·¥ç¨‹å·²ç»å‡çº§åˆ°äº† umi4ï¼ˆéœ€è¦å®‰è£…pnpm, ç„¶å pnpm installï¼‰ï¼Œä¸‹é¢ç½—åˆ—äº†ä¸€äº›å˜åŠ¨é¡»çŸ¥ï¼š</p><h3 id="1ã€å…³äºåŒ…ç®¡ç†å™¨"><a href="#1ã€å…³äºåŒ…ç®¡ç†å™¨" class="headerlink" title="1ã€å…³äºåŒ…ç®¡ç†å™¨"></a>1ã€å…³äºåŒ…ç®¡ç†å™¨</h3><ol><li>æ¢æˆäº† pnpm  <a href="https://juejin.cn/post/7077918263954374670">ç†ç”±</a></li><li> å’Œ npm ä½¿ç”¨æ–¹å¼ä¸€è‡´</li></ol><h3 id="2ã€å…³äº-umijs-max"><a href="#2ã€å…³äº-umijs-max" class="headerlink" title="2ã€å…³äº @umijs/max"></a>2ã€å…³äº @umijs/max</h3><ol><li>umi å’Œ @umijs/max éƒ½æ˜¯ umiï¼Œåªä¸è¿‡ @umijs/max å¸¦ä¸šåŠ¡éœ€è¦çš„æ’ä»¶ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ @umijs/max</li></ol><h3 id="3ã€å…³äºè·¯ç”±"><a href="#3ã€å…³äºè·¯ç”±" class="headerlink" title="3ã€å…³äºè·¯ç”±"></a>3ã€å…³äºè·¯ç”±</h3><ol><li>è·¯ç”±ä» react-router-dom@5 å‡çº§åˆ°äº† react-router-dom@6  <a href="https://reactrouter.com/docs/en/v6">é“¾æ¥</a></li></ol><h3 id="4ã€å…³äº-history-å’Œ-pathname-é“¾æ¥"><a href="#4ã€å…³äº-history-å’Œ-pathname-é“¾æ¥" class="headerlink" title="4ã€å…³äº history å’Œ pathname  é“¾æ¥"></a>4ã€å…³äº history å’Œ pathname  <a href="https://umijs.org/docs/api/api#history">é“¾æ¥</a></h3><ol><li>umi ä¸­çš„ history æ˜¯é™æ€çš„ï¼Œæ‰€ä»¥è·å–åˆ°çš„å‚æ•°æœ‰é—®é¢˜ã€‚</li><li>pathname/search/hash é€šè¿‡ window æ¥å–å€¼</li><li>é‡‡ç”¨ const navigate = useNavigate();  <a href="https://umijs.org/docs/api/api#usenavigate">é“¾æ¥</a></li></ol><h3 id="5ã€å…³äº-query-å‚æ•°ï¼ˆsearchï¼‰"><a href="#5ã€å…³äº-query-å‚æ•°ï¼ˆsearchï¼‰" class="headerlink" title="5ã€å…³äº query å‚æ•°ï¼ˆsearchï¼‰"></a>5ã€å…³äº query å‚æ•°ï¼ˆsearchï¼‰</h3><ol><li>const params = useParams();  <a href="https://umijs.org/docs/api/api#useparams">é“¾æ¥</a></li><li>createSearchParams(location.search)  <a href="https://umijs.org/docs/api/api#createsearchparams">é“¾æ¥</a></li></ol><p><strong>UmiJS çš„æ–‡æ¡£ï¼Œé™¤äº†ã€Œå¼€å‘ä¸€ä¸ª Blogã€ä¸çœ‹ï¼Œå‰©ä¸‹çš„éƒ½éœ€è¦è¿‡ä¸€é  <a href="https://umijs.org/docs/tutorials/getting-started">é“¾æ¥</a></strong></p>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯æ¡†æ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> umi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weekly 004</title>
      <link href="/2022/08/08/004weekly/"/>
      <url>/2022/08/08/004weekly/</url>
      
        <content type="html"><![CDATA[<h2 id="æœ¬æœŸæ–‡ç« "><a href="#æœ¬æœŸæ–‡ç« " class="headerlink" title="æœ¬æœŸæ–‡ç« "></a>æœ¬æœŸæ–‡ç« </h2><h3 id="ä¸ƒå¤•åˆ°äº†ï¼Œè¿˜ä¸å¿«ç»™ä½ å¥³æœ‹å‹åšä¸€ä¸ªä¸“å±-chrome-æ’ä»¶"><a href="#ä¸ƒå¤•åˆ°äº†ï¼Œè¿˜ä¸å¿«ç»™ä½ å¥³æœ‹å‹åšä¸€ä¸ªä¸“å±-chrome-æ’ä»¶" class="headerlink" title="ä¸ƒå¤•åˆ°äº†ï¼Œè¿˜ä¸å¿«ç»™ä½ å¥³æœ‹å‹åšä¸€ä¸ªä¸“å± chrome æ’ä»¶"></a><a href="https://juejin.cn/post/7122332008252080142">ä¸ƒå¤•åˆ°äº†ï¼Œè¿˜ä¸å¿«ç»™ä½ å¥³æœ‹å‹åšä¸€ä¸ªä¸“å± chrome æ’ä»¶</a></h3><p>ä¸ƒå¤•èŠ‚é©¬ä¸Šå°±è¦åˆ°äº†ï¼Œä½œä¸ºæ‹¥æœ‰å¯¹è±¡ï¼ˆæ²¡æœ‰çš„è¯ï¼Œå¯ä»¥é€‰æ‹© new ä¸€ä¸ªå‡ºæ¥ï¼‰çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œè‚¯å®šæ˜¯éœ€è¦æœ‰ä¸€ç‚¹è¡¨ç¤ºæ‰è¡Œçš„ã€‚ç”¨é’±èƒ½ä¹°åˆ°çš„ä¸œè¥¿ä¸ä¸€å®šèƒ½è¡¨è¾¾å’±ä»¬çš„å¿ƒæ„ï¼Œä½†æ˜¯ç”¨å¿ƒå»å†™çš„ä»£ç ï¼Œè¿˜èƒ½è®©å¯¹è±¡æ¯å¤©çœ‹åˆ°é‚£æ‰æ˜¯æœ€æ­£ç¡®çš„é€‰æ‹©ã€‚</p><p>é™¤äº†æ‰‹æœºä¹‹å¤–ï¼Œåœ¨ç”µè„‘ä¸Šä½¿ç”¨æµè§ˆå™¨æœç´¢æƒ³è¦çš„ä¸œè¥¿æ˜¯æœ€å¸¸ç”¨çš„åŠŸèƒ½äº†ï¼Œæ‰€ä»¥å°±éœ€è¦ä¸€ä¸ªæ‰“å¼€å³ç”¨çš„æœç´¢æ¡†ï¼Œè€Œä¸”è¿˜èƒ½è¡¨è¾¾å¿ƒæ„çš„ chrome æ ‡ç­¾é¡µæ¥è®© TA éšæ—¶å¯ç”¨ã€‚</p><h3 id="å†™ç»™å‰ç«¯çš„è·¨å¹³å°æ–¹æ¡ˆã€è·¨ç«¯å¼•æ“çš„æœ¬è´¨"><a href="#å†™ç»™å‰ç«¯çš„è·¨å¹³å°æ–¹æ¡ˆã€è·¨ç«¯å¼•æ“çš„æœ¬è´¨" class="headerlink" title="å†™ç»™å‰ç«¯çš„è·¨å¹³å°æ–¹æ¡ˆã€è·¨ç«¯å¼•æ“çš„æœ¬è´¨"></a><a href="https://juejin.cn/post/6966626823912308772">å†™ç»™å‰ç«¯çš„è·¨å¹³å°æ–¹æ¡ˆã€è·¨ç«¯å¼•æ“çš„æœ¬è´¨</a></h3><p>è¿‘äº›å¹´æ¥ï¼Œå‰ç«¯é¢†åŸŸçš„è·¨ç«¯æŠ€æœ¯è¶Šæ¥è¶Šå¤šäº†ï¼šreact nativeã€weexã€flutterã€electronã€kraken ç­‰ç­‰ã€‚é‚£ä¹ˆå¤šè·¨ç«¯æ–¹æ¡ˆï¼Œä»–ä»¬æœ‰æ²¡æœ‰é€šç”¨çš„æ€è·¯ï¼Ÿæˆ‘ä»¬èƒ½ä¸èƒ½ä»è¿™ä¹ˆå¤šæ–¹æ¡ˆä¸­æ‰¾å‡ºæœ¬è´¨çš„åŸç†ï¼Ÿ</p><p>æœ¬æ–‡ä¼šå°è¯•æ¢ç©¶æ¢ç©¶ä»¥ä¸‹é—®é¢˜ï¼š<br>ä»€ä¹ˆæ˜¯è·¨å¹³å°<br>æœ‰å“ªäº›æ–¹æ¡ˆæ˜¯è·¨å¹³å°çš„<br>è·¨ç«¯å’Œè·¨å¹³å°çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ<br>å‰ç«¯é¢†åŸŸæœ‰å“ªäº›è·¨ç«¯æ–¹æ¡ˆ<br>è·¨å¹³å°ã€è·¨ç«¯çš„é€šç”¨åŸç†æ˜¯ä»€ä¹ˆ</p><p>æœ¬æ–‡ä¸»è¦è®²è¿°äº†è·¨å¹³å°çš„æ¦‚å¿µã€æ–¹æ¡ˆã€ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠå‰ç«¯è·¨ç«¯çš„å¸¸è§æ–¹æ¡ˆå’ŒåŸç†ï¼Œé€šè¿‡è¿™ç¯‡æ–‡ç« å¯ä»¥ç†è§£è·¨ç«¯å’Œè·¨å¹³å°å®¹å™¨çš„æ€è·¯</p><h3 id="lerna-ä¸­æ–‡æ•™ç¨‹"><a href="#lerna-ä¸­æ–‡æ•™ç¨‹" class="headerlink" title="lerna ä¸­æ–‡æ•™ç¨‹"></a><a href="https://juejin.cn/post/6844903856153821198?share_token=52703fb9-a8a2-4301-956a-31bb3fb19b43">lerna ä¸­æ–‡æ•™ç¨‹</a></h3><p>Lerna æ˜¯ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä¼˜åŒ–äº†ä½¿ç”¨ git å’Œ npm ç®¡ç†å¤šåŒ…å­˜å‚¨åº“çš„å·¥ä½œæµã€‚æœ¬æ–‡è®²è§£äº†å·¥ä½œçš„ä¸¤ç§æ¨¡å¼ï¼šFixed/Locked mode (default)å’Œ Independent modeï¼›yarn çš„ workspaces æ¨¡å¼ï¼›ä»¥åŠå„ç§å‘½ä»¤</p><p>è®©æˆ‘ä»¬ç®€å•äº†è§£ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ lerna æ¥ç®¡ç†ä¸€ä¸ªå¤šåŒ…ï¼Œä»¥åŠ lerna çš„ä¸»è¦é…ç½®å’Œå‘½ä»¤ã€‚</p><h3 id="Git-åŸºç¡€æ•™ç¨‹-å¿…å­¦"><a href="#Git-åŸºç¡€æ•™ç¨‹-å¿…å­¦" class="headerlink" title="Git åŸºç¡€æ•™ç¨‹(å¿…å­¦)"></a><a href="https://mp.weixin.qq.com/s/0mGBRiG-kOa9rNL3qn9vVQ">Git åŸºç¡€æ•™ç¨‹(å¿…å­¦)</a></h3><p>åœ¨å·¥ä½œä¸­ï¼Œå‘ç°ä¸å°‘åŒå­¦å¯¹ Git çš„æŒæ¡éå¸¸åŸºç¡€ï¼ŒåŒæ ·ä½œä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨å¥½ Git æ¯” SVN è¦æ›´æœ‰æŒ‘æˆ˜ï¼Œéœ€è¦å¯¹ Git æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ‰èƒ½åœ¨å·¥ä½œä¸­ï¼Œé©¾é©­å¥½ Gitã€‚</p><p>æœ¬æ–‡ä»æœ€ç®€å•çš„åŸºç¡€å…¥é—¨ï¼Œè®²è§£å·¥ä½œä¸­å¸¸ç”¨çš„ Git åŸºç¡€ï¼ŒæŒæ¡è¿™äº›æ˜¯ Git è¿›é˜¶çš„åŸºç¡€ï¼Œè¶³å¤Ÿæ—¥å¸¸å·¥ä½œåœºæ™¯ã€‚</p><h3 id="ç‰›é€¼ï¼Œä¸€æ¬¾-996-ä»£ç åˆ†æå·¥å…·"><a href="#ç‰›é€¼ï¼Œä¸€æ¬¾-996-ä»£ç åˆ†æå·¥å…·" class="headerlink" title="ç‰›é€¼ï¼Œä¸€æ¬¾ 996 ä»£ç åˆ†æå·¥å…·"></a><a href="https://mp.weixin.qq.com/s?__biz=MzA3MzE4ODY0Mg==&mid=2455993889&idx=1&sn=7233d57b655d882a3e73386abba5e8ac&chksm=88850a6cbff2837a0eee062726b62415836b92c0ee5527a6c8a72993f255fa6bc1095600a5dd#rd">ç‰›é€¼ï¼Œä¸€æ¬¾ 996 ä»£ç åˆ†æå·¥å…·</a></h3><p>ä¸€ä¸ªä»£ç åˆ†æå·¥å…· code996ï¼Œå®ƒå¯ä»¥ç»Ÿè®¡ Git é¡¹ç›®çš„ commit æ—¶é—´åˆ†å¸ƒï¼Œè¿›è€Œæ¨å¯¼å‡ºè¿™ä¸ªé¡¹ç›®çš„ç¼–ç å·¥ä½œå¼ºåº¦ã€‚è¿™ç®—æ˜¯ä¸€ç§å¯¹é¡¹ç›®æ›´äº†è§£çš„æ–¹å¼ï¼Œæœç» 996 ä»äº†è§£æ•°æ®å¼€å§‹ã€‚</p><p>code996 é™¤äº†èƒ½å¤Ÿåˆ†æé¡¹ç›®çš„å®é™…å·¥ä½œå¼ºåº¦ï¼Œä¹Ÿèƒ½ç”¨æ¥åˆ†ææˆ‘ä»¬ä»£ç ç¼–å†™çš„æƒ…å†µï¼Œå¯¹è‡ªèº«äº†è§£è‡ªå·±ä»£ç ç¼–å†™æ•ˆç‡çš„æ—¶æ®µã€æœ€è¿‘çš„å·¥ä½œå¼ºåº¦ç­‰éƒ½æ˜¯éå¸¸å¥½çš„ä¸€ä¸ªè¾“å…¥</p><h3 id="å¦‚ä½•ä¼˜é›…åœ°åœ¨-React-ä¸­ä½¿ç”¨-TypeScriptï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼"><a href="#å¦‚ä½•ä¼˜é›…åœ°åœ¨-React-ä¸­ä½¿ç”¨-TypeScriptï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼" class="headerlink" title="å¦‚ä½•ä¼˜é›…åœ°åœ¨ React ä¸­ä½¿ç”¨ TypeScriptï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼"></a><a href="https://juejin.cn/post/7021674818621669389">å¦‚ä½•ä¼˜é›…åœ°åœ¨ React ä¸­ä½¿ç”¨ TypeScriptï¼Œçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†ï¼</a></h3><p>æœ¬æ–‡è®²è§£äº† ypeScript ä¸ React ä¸€èµ·ä½¿ç”¨æ—¶ç»å¸¸é‡åˆ°çš„ä¸€äº›ç±»å‹å®šä¹‰çš„é—®é¢˜ã€‚é˜…è¯»æœ¬æ–‡å‰ï¼Œå¸Œæœ›ä½ èƒ½æœ‰ä¸€å®šçš„ React å’Œ TypeScript åŸºç¡€ã€‚</p><p>ä½ å¹³æ—¶å¦‚ä½•ä½¿ç”¨ ts, é¼ æ ‡ç‚¹å‡»äº‹ä»¶å¯¹è±¡ç±»å‹æ˜¯ä»€ä¹ˆ? æ˜¯ä¸æ˜¯ç”¨çš„æœ€å¤šçš„æ˜¯ any ç±»å‹,æœ€å typescript ç”¨æˆäº† anyscript,typescript ä¹Ÿå°±å¤±å»äº†å®ƒå­˜åœ¨çš„æ„ä¹‰,æœ¬æ–‡å°†ä¸ºä½ è®²è§£å¦‚ä½•åœ¨ react ä¸­ä¼˜é›…çš„ä½¿ç”¨ typescript</p><h3 id="React-State-Hooks-useReducer-useState-useContext"><a href="#React-State-Hooks-useReducer-useState-useContext" class="headerlink" title="React State Hooks: useReducer, useState, useContext"></a><a href="https://www.robinwieruch.de/react-state-usereducer-usestate-usecontext/">React State Hooks: useReducer, useState, useContext</a></h3><p>ä½œä¸º react åˆå­¦è€…ï¼Œç¬¬ä¸€æ¬¡å¼„æ‡‚äº† useReducer, useState, useContext çš„ç”¨æ³•ï¼Œåœ¨ä»€ä¹ˆæ—¶å€™ç”¨ï¼Œä»¥åŠä¸‰è€…ä¹‹é—´çš„åŒºåˆ«ã€‚</p><h2 id="å‹æƒ…é“¾æ¥"><a href="#å‹æƒ…é“¾æ¥" class="headerlink" title="å‹æƒ…é“¾æ¥"></a>å‹æƒ…é“¾æ¥</h2><ul><li><a href="https://github.com/aliyunfe/weekly">é˜¿é‡Œäº‘ TXD å‰ç«¯å‘¨åˆŠ</a></li><li><a href="https://github.com/ascoders/weekly">å‰ç«¯ç²¾åº¦å‘¨åˆŠ</a></li><li><a href="">o2team/tech-weekly</a></li><li><a href="https://github.com/tnfe/TNT-Weekly/">tnfe/TNT-Weekly</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> weekly </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weekly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weekly 003</title>
      <link href="/2022/08/01/003weekly/"/>
      <url>/2022/08/01/003weekly/</url>
      
        <content type="html"><![CDATA[<h2 id="æœ¬æœŸæ–‡ç« "><a href="#æœ¬æœŸæ–‡ç« " class="headerlink" title="æœ¬æœŸæ–‡ç« "></a>æœ¬æœŸæ–‡ç« </h2><h3 id="æˆä¸ºä¼˜ç§€çš„-TS-ä½“æ“é«˜æ‰‹-ä¹‹-TS-ç±»å‹ä½“æ“å‰ç½®çŸ¥è¯†å‚¨å¤‡"><a href="#æˆä¸ºä¼˜ç§€çš„-TS-ä½“æ“é«˜æ‰‹-ä¹‹-TS-ç±»å‹ä½“æ“å‰ç½®çŸ¥è¯†å‚¨å¤‡" class="headerlink" title="æˆä¸ºä¼˜ç§€çš„ TS ä½“æ“é«˜æ‰‹ ä¹‹ TS ç±»å‹ä½“æ“å‰ç½®çŸ¥è¯†å‚¨å¤‡"></a><a href="https://mp.weixin.qq.com/s/AOzZVxftMYEOfvhSFMV_fQ">æˆä¸ºä¼˜ç§€çš„ TS ä½“æ“é«˜æ‰‹ ä¹‹ TS ç±»å‹ä½“æ“å‰ç½®çŸ¥è¯†å‚¨å¤‡</a></h3><p>TS ç±»å‹ä½“æ“å‰ç½®çŸ¥è¯†å‚¨å¤‡å¤§æ¦‚å°±ä»‹ç»äº† extends,infer,typeof,keyof å’Œ in,æ•°ç»„çš„ä½¿ç”¨,as å…³é”®å­—</p><p>äº†è§£äº†è¿™éƒ¨åˆ†å…³é”®å­—ä½œç”¨ä¹‹åï¼Œå®Œæˆ TS ä½“æ“ç»ƒä¹ çš„ä¸­ç­‰éš¾åº¦çš„é¢˜ç›®ä¸åœ¨è¯ä¸‹ï¼ï¼ˆèµ·ç å®Œæˆ 80%çš„é¢˜ç›®æ²¡å¾—é—®é¢˜ï¼‰ï¼Œå‰©ä¸‹çš„ 20% è¿˜éœ€è¦å­¦ä¹ æ›´å¤šçš„ TS ä½“æ“æŠ€å·§</p><h3 id="å°¤é›¨æºªä¸»é¢˜æ¼”è®²ã€Š2022-å‰ç«¯ç”Ÿæ€è¶‹åŠ¿ã€‹å…¨è®°å½•"><a href="#å°¤é›¨æºªä¸»é¢˜æ¼”è®²ã€Š2022-å‰ç«¯ç”Ÿæ€è¶‹åŠ¿ã€‹å…¨è®°å½•" class="headerlink" title="å°¤é›¨æºªä¸»é¢˜æ¼”è®²ã€Š2022 å‰ç«¯ç”Ÿæ€è¶‹åŠ¿ã€‹å…¨è®°å½•"></a><a href="https://juejin.cn/post/7123126028838862862">å°¤é›¨æºªä¸»é¢˜æ¼”è®²ã€Š2022 å‰ç«¯ç”Ÿæ€è¶‹åŠ¿ã€‹å…¨è®°å½•</a></h3><p>æœ¬æ–‡æ˜¯<a href="https://conf.juejin.cn/xdc2022">ç¬¬äºŒå±Šç¨€åœŸå¼€å‘è€…å¤§ä¼š</a> å°¤å¤§å…³äº ã€Š2022 Web å‰ç«¯ç”Ÿæ€è¶‹åŠ¿ã€‹ çš„ä¸»é¢˜åˆ†äº«æ•´ç†ã€‚</p><p>React Hooks çš„æ¨å‡ºå¯å‘äº†å¾ˆå¤šç»„ä»¶é€»è¾‘è¡¨è¾¾å’Œé€»è¾‘é™„ç”¨çš„æ–°èŒƒå¼ï¼›ä½†æ˜¯åŒæ—¶æåˆ°äº† React Hooks å¯¹å¼€å‘è€…å­˜åœ¨çš„å¿ƒæ™ºè´Ÿæ‹…é—®é¢˜ï¼›è€Œç±» Vue3 çš„åŸºäºä¾èµ–è¿½è¸ªçš„èŒƒå¼é‡æ–°å¾—åˆ°äº†é‡è§†ï¼›åŸºäºç¼–è¯‘çš„å“åº”å¼ç³»ç»Ÿå’ŒåŸºäºç¼–è¯‘çš„è¿è¡Œæ—¶ä¼˜åŒ–æ‰æ˜¯æœªæ¥ã€‚</p><p>rustã€goã€zig å’Œ JavaScript çš„æ··åˆå·¥å…·é“¾ä¼šæˆä¸ºå‰ç«¯æ„å»ºå·¥å…·çš„æœªæ¥ã€‚</p><p>æœ‰æ—¶é—´çš„åŒå­¦å¯ä»¥çœ‹çœ‹<a href="https://juejin.cn/live/xdc202201">å›æ”¾</a></p><p>äº†è§£ 2022 å‰ç«¯ç”Ÿæ€è¶‹åŠ¿ï¼›å…³æ³¨æœªæ¥ï¼Œé€‚å½“çš„è°ƒæ•´è‡ªå·±çš„å­¦ä¹ è·¯çº¿ã€çŸ¥è¯†ä½“ç³»</p><h3 id="type-ä¸-interface-çš„åŒºåˆ«ï¼Œä½ çœŸçš„æ‡‚äº†å—ï¼Ÿ"><a href="#type-ä¸-interface-çš„åŒºåˆ«ï¼Œä½ çœŸçš„æ‡‚äº†å—ï¼Ÿ" class="headerlink" title="type ä¸ interface çš„åŒºåˆ«ï¼Œä½ çœŸçš„æ‡‚äº†å—ï¼Ÿ"></a><a href="https://mp.weixin.qq.com/s/mOB95li-tuaswWliGiYZyw">type ä¸ interface çš„åŒºåˆ«ï¼Œä½ çœŸçš„æ‡‚äº†å—ï¼Ÿ</a></h3><p>åœ¨å†™ ts ç›¸å…³ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæ€»èƒ½çœ‹åˆ° interface å’Œ type çš„èº«å½±ã€‚å®ƒä»¬çš„ä½œç”¨å¥½åƒéƒ½ä¸€æ ·çš„ï¼Œç›¸åŒçš„åŠŸèƒ½ç”¨å“ªä¸€ä¸ªéƒ½å¯ä»¥å®ç°ï¼Œä¹Ÿéƒ½å¾ˆå¥½ç”¨ï¼Œæ‰€ä»¥ä¹Ÿå¾ˆå°‘å»çœŸæ­£çš„ç†è§£å®ƒä»¬ä¹‹é—´åˆ°åº•æœ‰å•¥åŒºåˆ«ï¼Œ åˆ†åˆ«åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Œæœ¬æ–‡ä½œè€…å°†å¸¦é¢†å¤§å®¶ä¸€èµ·æ¢ç´¢ TS ä¸­çš„ interface å’Œ typeã€‚</p><p>interface å’Œ type ä¹‹é—´çš„å·®å¼‚ä¸ä»…ä»…æ˜¯æ¬¡è¦è¯­æ³•å£°æ˜ã€‚é‚£ä¹ˆï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥çœ‹çœ‹è¿™ä¸¤å®¶ä¼™ä¹‹é—´å­˜åœ¨å•¥ä¸å¯å‘Šäººçš„ç§˜å¯†ã€‚</p><h3 id="æ·±å…¥ç†è§£-Typescript-ç³»åˆ—-æ³›å‹"><a href="#æ·±å…¥ç†è§£-Typescript-ç³»åˆ—-æ³›å‹" class="headerlink" title="æ·±å…¥ç†è§£ Typescript ç³»åˆ—-æ³›å‹"></a><a href="https://juejin.cn/post/6996479857559339038">æ·±å…¥ç†è§£ Typescript ç³»åˆ—-æ³›å‹</a></h3><p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ—¶é•¿ä¼šè€ƒè™‘åˆ°æ–¹æ³•çš„å¤ç”¨æ€§ï¼Œæ¯•ç«Ÿå¯¹äºç›¸ä¼¼çš„åœºæ™¯æ‹·è´ä¸€ä»½ä»£ç æ—¢å¢åŠ äº†ä»£ç é‡è¿˜å¢åŠ äº†é¢å¤–çš„ç»´æŠ¤æˆæœ¬ï¼Œè¦æ˜¯é‡æ„çš„æ—¶å€™å¿˜äº†ï¼Œè¿˜ä¼šå¯¼è‡´ä¸å¯æè¿°çš„ bugã€‚</p><p>æé«˜æ–¹æ³•çš„å¤ç”¨æ€§ï¼Œå‡å°‘ä»£ç ç»´æŠ¤æˆæœ¬ã€‚</p><h3 id="Git-åŸºç¡€æ•™ç¨‹-å¿…å­¦"><a href="#Git-åŸºç¡€æ•™ç¨‹-å¿…å­¦" class="headerlink" title="Git åŸºç¡€æ•™ç¨‹(å¿…å­¦)"></a><a href="https://mp.weixin.qq.com/s/0mGBRiG-kOa9rNL3qn9vVQ">Git åŸºç¡€æ•™ç¨‹(å¿…å­¦)</a></h3><p>åœ¨å·¥ä½œä¸­ï¼Œå‘ç°ä¸å°‘åŒå­¦å¯¹ Git çš„æŒæ¡éå¸¸åŸºç¡€ï¼ŒåŒæ ·ä½œä¸ºç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨å¥½ Git æ¯” SVN è¦æ›´æœ‰æŒ‘æˆ˜ï¼Œéœ€è¦å¯¹ Git æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ‰èƒ½åœ¨å·¥ä½œä¸­ï¼Œé©¾é©­å¥½ Gitã€‚</p><p>æœ¬æ–‡ä»æœ€ç®€å•çš„åŸºç¡€å…¥é—¨ï¼Œè®²è§£å·¥ä½œä¸­å¸¸ç”¨çš„ Git åŸºç¡€ï¼ŒæŒæ¡è¿™äº›æ˜¯ Git è¿›é˜¶çš„åŸºç¡€ï¼Œè¶³å¤Ÿæ—¥å¸¸å·¥ä½œåœºæ™¯ã€‚</p><h2 id="å‹æƒ…é“¾æ¥"><a href="#å‹æƒ…é“¾æ¥" class="headerlink" title="å‹æƒ…é“¾æ¥"></a>å‹æƒ…é“¾æ¥</h2><ul><li><a href="https://github.com/aliyunfe/weekly">é˜¿é‡Œäº‘ TXD å‰ç«¯å‘¨åˆŠ</a></li><li><a href="https://github.com/ascoders/weekly">å‰ç«¯ç²¾åº¦å‘¨åˆŠ</a></li><li><a href="">o2team/tech-weekly</a></li><li><a href="https://github.com/tnfe/TNT-Weekly/">tnfe/TNT-Weekly</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> weekly </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weekly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weekly 002</title>
      <link href="/2022/07/25/002weekly/"/>
      <url>/2022/07/25/002weekly/</url>
      
        <content type="html"><![CDATA[<h2 id="æœ¬æœŸæ–‡ç« "><a href="#æœ¬æœŸæ–‡ç« " class="headerlink" title="æœ¬æœŸæ–‡ç« "></a>æœ¬æœŸæ–‡ç« </h2><h3 id="å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿ"><a href="#å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿ" class="headerlink" title="å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿ"></a><a href="https://juejin.cn/post/7100874690884796447">å‡½æ•°å¼ç»„ä»¶ä¸ç±»ç»„ä»¶æœ‰ä½•ä¸åŒï¼Ÿ</a></h3><p>è¯¦ç»†ä»‹ç»äº†å‡½æ•°ç»„ä»¶ä¸ç±»ç»„ä»¶é‡Œ props çš„ç”¨æ³•ï¼Œè¯¦ç»†ä»‹ç»äº†å‡½æ•°ç»„ä»¶åœ¨ä¸€æ¬¡ç‰¹å®šçš„æ¸²æŸ“ä¸­æ•è·é‚£ä¸€æ¬¡æ¸²æŸ“æ‰€ç”¨çš„ props æˆ–è€… stateï¼Œä»–ä»¬æ€»æ˜¯ä¼šä¿æŒä¸€è‡´ã€‚åœ¨ç±»ç»„ä»¶ä¸­å¦‚æœå¯¹ this.props ç›´æ¥å¼•ç”¨å®¹æ˜“ç»™è‡ªå·±åŸ‹å‘ã€‚</p><p>å½“æˆ‘ä»¬ç”¨å‡½æ•°æ¥ç¼–å†™å¤§éƒ¨åˆ†çš„ React ä»£ç æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´å…³äºä¼˜åŒ–ä»£ç å’Œä»€ä¹ˆå˜é‡ä¼šéšç€æ—¶é—´æ”¹å˜çš„è®¤çŸ¥ä¸ç›´è§‰ã€‚</p><h3 id="ä¸€è¡Œ-CSS-ä»£ç æå®šå“åº”å¼å¸ƒå±€"><a href="#ä¸€è¡Œ-CSS-ä»£ç æå®šå“åº”å¼å¸ƒå±€" class="headerlink" title="ä¸€è¡Œ CSS ä»£ç æå®šå“åº”å¼å¸ƒå±€"></a><a href="https://mp.weixin.qq.com/s/tGm77W7t2fbLTNNxwlo_EQ">ä¸€è¡Œ CSS ä»£ç æå®šå“åº”å¼å¸ƒå±€</a></h3><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†æ•™ä½ å¦‚ä½•ä½¿ç”¨ CSS Grid æ¥åˆ›å»ºä¸€ä¸ªè¶…é…·çš„å›¾åƒç½‘æ ¼å›¾ï¼Œå®ƒå°†æ ¹æ®å±å¹•çš„å®½åº¦æ¥æ”¹å˜åˆ—çš„æ•°é‡ã€‚æœ€ç²¾å½©çš„åœ°æ–¹åœ¨äºï¼šæ‰€æœ‰çš„å“åº”ç‰¹æ€§è¢«æ·»åŠ åˆ°äº†ä¸€è¡Œ css ä»£ç ä¸­ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸å¿…å°† HTML ä¸ä¸‘é™‹çš„ç±»å(å¦‚ col-sm-4, col-md-8)æ··æ‚åœ¨ä¸€èµ·ï¼Œä¹Ÿä¸å¿…ä¸ºæ¯ä¸ªå±å¹•åˆ›å»ºåª’ä½“æŸ¥è¯¢ã€‚</p><h3 id="é«˜æ€§èƒ½æ·±æ‹·è´"><a href="#é«˜æ€§èƒ½æ·±æ‹·è´" class="headerlink" title="é«˜æ€§èƒ½æ·±æ‹·è´"></a><a href="https://juejin.cn/post/7122034570043588622">é«˜æ€§èƒ½æ·±æ‹·è´</a></h3><p>â€œè¯´ä¸€ä¸‹æ·±æ‹·è´çš„å®ç°æ–¹å¼â€, ç­”: â€œJSON.parse(JSON.stringify())ã€lodash çš„ cloneDeep, é€’å½’éå†â€¦â€, ç›¸ä¿¡æˆ‘ä»¬å¤§å¤šæ•°äººåœ¨é¢è¯•çš„è¿‡ç¨‹ä¸­è¢«é—®åˆ°è¿‡è¿™ä¸ªé—®é¢˜, ä½ æ˜¯æ€ä¹ˆå›ç­”çš„? é€’å½’æ˜¯ä¸æ˜¯ä½ çš„æœ€ä¼˜è§£? æœ¬æ–‡å°†ä¸ºä½ ä»‹ç»ä¸€ç§æ›´é«˜æ€§èƒ½çš„æ·±æ‹·è´, ç›¸ä¿¡å­¦å®Œæœ¬æ–‡, ä½ ä¸€å®šèƒ½å¤Ÿæ‰“åŠ¨é¢è¯•å®˜, è®©ä½ æ›´è½»æ¾çš„æ–©è· offer</p><h3 id="å‰ç«¯å¦‚ä½•å­¦ä¹ æ›´æœ‰è®¡åˆ’æ€§ã€æå‡æ›´ç¨³æ›´å¿«ï¼Ÿ"><a href="#å‰ç«¯å¦‚ä½•å­¦ä¹ æ›´æœ‰è®¡åˆ’æ€§ã€æå‡æ›´ç¨³æ›´å¿«ï¼Ÿ" class="headerlink" title="å‰ç«¯å¦‚ä½•å­¦ä¹ æ›´æœ‰è®¡åˆ’æ€§ã€æå‡æ›´ç¨³æ›´å¿«ï¼Ÿ"></a><a href="https://mp.weixin.qq.com/s?__biz=MzI2MjYzMjYwNg==&mid=2247487730&idx=1&sn=4dadced98833aa8b2f04747359dc484f&chksm=ea497503dd3efc153bd9feca2b1db4967a8ac9866335de8a8979568faeeb0ea45849367c9b68#rd">å‰ç«¯å¦‚ä½•å­¦ä¹ æ›´æœ‰è®¡åˆ’æ€§ã€æå‡æ›´ç¨³æ›´å¿«ï¼Ÿ</a></h3><p>æˆ‘ä»¬å­¦ä¹ æ˜¯ä¸ºäº†è‡ªå·±ï¼Œæ˜¯ä¸ºäº†çœŸæ­£çš„è§£å†³é—®é¢˜ï¼Œåˆ‡å¿Œâ€œå‡è£…å­¦ä¹ â€ã€‚è™½ç„¶ç³»ç»Ÿå­¦ä¹ çœ‹èµ·æ¥å¾ˆä¸é”™ï¼Œä½†ä»è‡ªå·±çš„å…´è¶£å’Œå·¥ä½œå‡ºå‘ï¼Œæ˜¯æ›´å¥½çš„å­¦ä¹ æ–¹å‘ã€‚åœ¨å…·ä½“çš„å­¦ä¹ ä¸­ï¼Œåº”å¼ºè°ƒè¾“å‡ºï¼Œä»¥æ•™ä¸ºå­¦ï¼Œæ¯ä¸€ä¸ªå›°éš¾çš„åœ°æ–¹éƒ½æ˜¯è¶…è½¦çš„æœºä¼šï¼Œä»¥æ…¢ä¸ºå¿«ï¼Œè¸å®çš„æ‰“ç‰¢åŸºç¡€çŸ¥è¯†ç‚¹ã€‚</p><p>å­¦ä¹ æ˜¯ä¸€ä¸ªç³»ç»Ÿï¼Œæˆ‘ä»¬ä¸èƒ½æ€»æ˜¯ä¾èµ–æ„å¿—åŠ›ï¼Œè¦è®²ç©¶æ–¹æ³•ã€æŠ€å·§ã€ç¯å¢ƒç­‰ï¼Œå¼•å¯¼è‡ªå·±åšäº‹çš„å…´è¶£ã€çƒ­æƒ…å’Œæˆå°±æ„Ÿï¼Œè¿™æ ·ä½ æ‰ä¼šè¶Šåšè¶Šèµ·åŠ²ï¼Œæœ€åä¸æ–­åœ°è¿è½¬ä¸‹å»ã€‚</p><ul><li>ä»¥æ•™ä¿ƒå­¦</li><li>å›°éš¾çš„åœ°æ–¹å°±æ˜¯ä½ å¼¯é“è¶…è½¦çš„åœ°æ–¹</li><li>ä»¥æ…¢ä¸ºå¿«</li><li>åšå®šçš„ä¿¡å¿µ</li><li>å­¦ä¹ çš„â€œåäººæ€§â€é—®é¢˜</li><li>å³æ—¶åé¦ˆ</li><li>åˆé€‚çš„ç¯å¢ƒå’Œæ°›å›´</li></ul><h3 id="es2022-æ–°ç‰¹æ€§æå‰äº†è§£"><a href="#es2022-æ–°ç‰¹æ€§æå‰äº†è§£" class="headerlink" title="es2022 æ–°ç‰¹æ€§æå‰äº†è§£"></a><a href="https://juejin.cn/post/7073285958791069704">es2022 æ–°ç‰¹æ€§æå‰äº†è§£</a></h3><p>æ–°ç‰ˆæœ¬çš„ ECMA Script å°†åœ¨ä»Šå¹´å…­æœˆæˆä¸ºæ ‡å‡†ã€‚æœ¬æ–‡å¸¦æˆ‘ä»¬çœ‹ ES2022 æœ‰ä»€ä¹ˆæ–°ç‰¹æ€§ã€‚</p><p>è®¸å¤šäººæœŸå¾… ES2022ï¼ˆES13ï¼‰ ä¼šå¸¦æ¥å“ªäº›æ–°çš„ç‰¹æ€§ã€‚è¿™ç¯‡æ–‡ç« è®²è§£äº† es2022 æ–°å¢çš„å‡ ä¸ªç‰¹æ€§ï¼Œä¸€ç›®äº†ç„¶ï¼Œè·Ÿä»¥å‰çš„ç”¨æ³•æœ‰çš„æœ‰äº›ä¸åŒï¼Œä½†æ˜¯ç”¨èµ·æ¥æ›´æ–¹ä¾¿äº†ã€‚</p><h2 id="å‹æƒ…é“¾æ¥"><a href="#å‹æƒ…é“¾æ¥" class="headerlink" title="å‹æƒ…é“¾æ¥"></a>å‹æƒ…é“¾æ¥</h2><ul><li><a href="https://github.com/aliyunfe/weekly">é˜¿é‡Œäº‘ TXD å‰ç«¯å‘¨åˆŠ</a></li><li><a href="https://github.com/ascoders/weekly">å‰ç«¯ç²¾åº¦å‘¨åˆŠ</a></li><li><a href="">o2team/tech-weekly</a></li><li><a href="https://github.com/tnfe/TNT-Weekly/">tnfe/TNT-Weekly</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> weekly </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weekly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>weekly 001111</title>
      <link href="/2022/07/18/001weekly/"/>
      <url>/2022/07/18/001weekly/</url>
      
        <content type="html"><![CDATA[<h2 id="æœ¬æœŸæ–‡ç« "><a href="#æœ¬æœŸæ–‡ç« " class="headerlink" title="æœ¬æœŸæ–‡ç« "></a>æœ¬æœŸæ–‡ç« </h2><h3 id="å…³äºä»£ç è¯„å®¡-CodeReview-é‚£äº›ä¸å¾—ä¸è¯´çš„äº‹å„¿"><a href="#å…³äºä»£ç è¯„å®¡-CodeReview-é‚£äº›ä¸å¾—ä¸è¯´çš„äº‹å„¿" class="headerlink" title="å…³äºä»£ç è¯„å®¡(CodeReview)é‚£äº›ä¸å¾—ä¸è¯´çš„äº‹å„¿"></a><a href="https://juejin.cn/post/7100874690884796447">å…³äºä»£ç è¯„å®¡(CodeReview)é‚£äº›ä¸å¾—ä¸è¯´çš„äº‹å„¿</a></h3><p>æœ¬æ–‡ä½œè€…åœ¨å­¦ä¹ äº†<a href="https://eng-practices-cn.xindoo.xyz/review/index">Google Code Review æŒ‡å—</a>çš„åŸºç¡€ä¸Šï¼›æ€»ç»“äº†é•¿æœŸåš CodeReview çš„å¥½å¤„ï¼šæå£°ä»£ç è´¨é‡ã€æå‰å‘ç°é—®é¢˜ã€ç»éªŒå’ŒçŸ¥è¯†çš„ä¼ é€’ï¼›CodeReview çš„å…³æ³¨ç‚¹ï¼šåŠŸèƒ½æ€§ã€å¤æ‚æ€§ã€ä»£ç é£æ ¼ã€æ–‡æ¡£&amp;æ³¨é‡Šã€ä»£ç äº®ç‚¹ï¼›è¿˜æŒ‡å‡ºäº† CodeReview åº”è¯¥åŠæ—¶ï¼›ä»¥åŠæ³¨æ„çš„ç¤¼èŠ‚ï¼Œreviewer å†™å¾—å¥½çš„åœ°æ–¹ä¹Ÿåº”è¯¥ç‚¹èµï¼›</p><p>æœ¬æ–‡è¿˜æŒ‡å¯¼å¤§å®¶å¦‚ä½•æ‰èƒ½å†™å‡ºå¯¹ CodeReview å‹å¥½çš„ä»£ç ï¼šæäº¤å‰å…ˆåšå¥½è‡ªå®¡ã€å†™æ¸…æ¥šå˜æ›´æè¿°ã€å•ä¸ªå˜æ›´ç«Ÿå¯èƒ½çŸ­ï¼›</p><p>å…³äº CodeReview çš„è¯¯åŒºè¯¥æ–‡ä¹Ÿåšäº†åˆç†çš„åé©³ï¼Œä¾‹å¦‚ CodeReview æ˜¯çº¯æµªè´¹æ—¶é—´ï¼Ÿå·¥æœŸå¾ˆç´§æ²¡æ—¶é—´å»åš CodeReivew;åªæœ‰é«˜çº§å·¥ç¨‹å¸ˆæ‰æœ‰èµ„æ ¼ Reivewe åˆ«äººçš„ä»£ç ï¼Ÿéƒ½æœ‰æµ‹è¯•æµç¨‹äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦åš CodeReviewï¼Ÿæœ‰äº† CodeReview å°±ä¸éœ€è¦æµ‹è¯•äº†ï¼Ÿåªè¦æˆ‘åœ¨å›¢é˜Ÿæ¨è¡Œäº† CodeReview æµç¨‹ï¼Œä»£ç è´¨é‡å°±ä¼šè¿…é€Ÿæé«˜ï¼Ÿ</p><h3 id="è¯¦è§£-js-ç»§æ‰¿çš„é‚£äº›äº‹å„¿"><a href="#è¯¦è§£-js-ç»§æ‰¿çš„é‚£äº›äº‹å„¿" class="headerlink" title="è¯¦è§£ js ç»§æ‰¿çš„é‚£äº›äº‹å„¿"></a><a href="https://blog.csdn.net/qq_34574204/article/details/120716964">è¯¦è§£ js ç»§æ‰¿çš„é‚£äº›äº‹å„¿</a></h3><p>æœ¬æ–‡ä½œè€…å¸¦ä½ å­¦ä¹  js çš„ç»§æ‰¿ï¼ŒåŸå‹ï¼ŒåŸå‹é“¾çš„åº•å±‚çŸ¥è¯†å’ŒåŸç†ï¼›ä½ ä¼šäº†è§£åˆ°ä»¥ä¸‹çŸ¥è¯†ä»€ä¹ˆæ˜¯ç»§æ‰¿ï¼›ä¸ºä»€ä¹ˆè¦æœ‰ç»§æ‰¿ï¼›ç»§æ‰¿çš„ç›¸å…³ 6 ç§å®ç°æ–¹å¼åŠä¼˜ç¼ºç‚¹ã€‚</p><h3 id="è´ªåƒè›‡å°æ¸¸æˆå¼€å‘æ€è·¯åˆ†äº«"><a href="#è´ªåƒè›‡å°æ¸¸æˆå¼€å‘æ€è·¯åˆ†äº«" class="headerlink" title="è´ªåƒè›‡å°æ¸¸æˆå¼€å‘æ€è·¯åˆ†äº«"></a><a href="https://juejin.cn/post/7051411538577457183">è´ªåƒè›‡å°æ¸¸æˆå¼€å‘æ€è·¯åˆ†äº«</a></h3><p>å¦‚ä½•ç”¨æ•°ç»„è¡¨ç¤ºæ¸¸æˆåœ°å›¾ï¼Œæ•°ç»„çš„å‘¨è¾¹å—…æ¢ï¼Œæ•°ç»„è¾¹ç•Œæ£€æµ‹ï¼›è¿˜æœ‰ç¢°æ’æ£€æµ‹ã€‚çœ‹å®Œä¹‹åï¼ŒæŠ–éŸ³æœ€ç«çš„æ¸¸æˆåƒæ‰é‚£ä¸ªè‹¹æœå°±å¯ä»¥è‡ªå·±å†™äº†ã€‚</p><h3 id="TypeScript-æ³›å‹ä¸­çš„-Kã€Tã€V-ç­‰åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ"><a href="#TypeScript-æ³›å‹ä¸­çš„-Kã€Tã€V-ç­‰åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ" class="headerlink" title="TypeScript æ³›å‹ä¸­çš„ Kã€Tã€V ç­‰åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ"></a><a href="https://juejin.cn/post/7084410879223005215">TypeScript æ³›å‹ä¸­çš„ Kã€Tã€V ç­‰åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ</a></h3><p>å½“ä½ é¦–æ¬¡çœ‹åˆ° TypeScript æ³›å‹ä¸­çš„ T ä¼šæ„Ÿåˆ°é™Œç”Ÿä¹ˆï¼Ÿ<br>é‚£ä¹ˆ T æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå›¾ä¸­çš„æ³›å‹å˜é‡ T è¡¨ç¤º Typeï¼Œå®é™…ä¸Š T å¯ä»¥ç”¨ä»»ä½•æœ‰æ•ˆçš„åç§°ä»£æ›¿ã€‚é™¤äº† T ä¹‹å¤–ï¼Œå¸¸è§çš„æ³›å‹å˜é‡è¿˜æœ‰ Kã€V å’Œ E ç­‰ã€‚</p><ul><li>K å…¨ç§° Key è¡¨ç¤ºå¯¹è±¡ä¸­é”®çš„ç±»å‹ï¼›</li><li>V å…¨ç§° Value è¡¨ç¤ºå¯¹è±¡ä¸­å€¼çš„ç±»å‹ï¼›</li><li>E å…¨ç§° Element è¡¨ç¤ºå…ƒç´ ç±»å‹ã€‚</li></ul><h3 id="45-ä¸ª-GIT-ç»å…¸æ“ä½œåœºæ™¯ï¼Œä¸“æ²»ä¸ä¼šåˆä»£ç "><a href="#45-ä¸ª-GIT-ç»å…¸æ“ä½œåœºæ™¯ï¼Œä¸“æ²»ä¸ä¼šåˆä»£ç " class="headerlink" title="45 ä¸ª GIT ç»å…¸æ“ä½œåœºæ™¯ï¼Œä¸“æ²»ä¸ä¼šåˆä»£ç "></a><a href="https://mp.weixin.qq.com/s/2p4m63JdsCjBpVku-WaZyA">45 ä¸ª GIT ç»å…¸æ“ä½œåœºæ™¯ï¼Œä¸“æ²»ä¸ä¼šåˆä»£ç </a></h3><p>æœ¬æ–‡ä½œè€…æ•´ç†äº† 45 ä¸ªæ—¥å¸¸ç”¨ git åˆä»£ç çš„ç»å…¸æ“ä½œåœºæ™¯ï¼ŒåŸºæœ¬è¦†ç›–äº†å·¥ä½œä¸­çš„éœ€æ±‚ã€‚</p><ul><li>è¯»å®Œæœ¬ç¯‡æ–‡ç« ä½ ä¼šäº†è§£åˆ°ä»¥ä¸‹çŸ¥è¯†ï¼š</li><li>æäº¤ï¼ˆCommittingï¼‰ å¤„ç†ï¼Œå¦‚ï¼šcommit message å†™é”™äº†ï¼Œåˆ é™¤ä»»æ„ commit ç­‰ç­‰ï¼›</li><li>æš‚å­˜ï¼ˆStagingï¼‰å¤„ç†ï¼Œå¦‚ï¼šæˆ‘éœ€è¦æŠŠæš‚å­˜çš„å†…å®¹æ·»åŠ åˆ°ä¸Šä¸€æ¬¡çš„æäº¤ï¼ˆcommitï¼‰ç­‰ç­‰ï¼›</li><li>åˆ†æ”¯ï¼ˆbranchesï¼‰å¤„ç†ï¼šå¦‚ï¼šæˆ‘æƒ³æäº¤åˆ°ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œä½†é”™è¯¯æäº¤åˆ°äº† main ç­‰ç­‰;</li><li>å˜åŸºï¼ˆRebasingï¼‰å’Œåˆå¹¶ï¼ˆMergingï¼‰å¤„ç†ï¼Œå¦‚ï¼šæ’¤é”€ rebase/mergeï¼Œæœ‰å†²çªçš„æƒ…å†µç­‰å¾…ã€‚</li></ul><h3 id="Vite-3-0-å‘å¸ƒï¼Œä¸‹ä¸€ä»£çš„å‰ç«¯å·¥å…·é“¾"><a href="#Vite-3-0-å‘å¸ƒï¼Œä¸‹ä¸€ä»£çš„å‰ç«¯å·¥å…·é“¾" class="headerlink" title="Vite 3.0 å‘å¸ƒï¼Œä¸‹ä¸€ä»£çš„å‰ç«¯å·¥å…·é“¾"></a><a href="https://www.oschina.net/news/202953/vite-3-0-released">Vite 3.0 å‘å¸ƒï¼Œä¸‹ä¸€ä»£çš„å‰ç«¯å·¥å…·é“¾</a></h3><p>Vite 3.0 ç°å·²äº 2022 å¹´ 7 æœˆ 15 æ­£å¼å‘å¸ƒï¼›Vite3.0 æ–°ç‰¹æ€§ä¸€è§ˆï¼›ä¹‹å vite å‡†å¤‡æ¯å¹´ä¼šå‘ä¸€ä¸ªå¤§ç‰ˆæœ¬ã€‚</p><h3 id="ä»–æ¥äº†ï¼æ€§èƒ½åŠæ‰“-Node-js-å’Œ-Deno-çš„æ–°ä¸€ä»£-javaScript-è¿è¡Œæ—¶ï¼"><a href="#ä»–æ¥äº†ï¼æ€§èƒ½åŠæ‰“-Node-js-å’Œ-Deno-çš„æ–°ä¸€ä»£-javaScript-è¿è¡Œæ—¶ï¼" class="headerlink" title="ä»–æ¥äº†ï¼æ€§èƒ½åŠæ‰“ Node.js å’Œ Deno çš„æ–°ä¸€ä»£ javaScript è¿è¡Œæ—¶ï¼"></a><a href="https://mp.weixin.qq.com/s?__biz=Mzg5NDEyMzA2NQ==&mid=2247488883&idx=1&sn=1ec39e6e52849ea2deb2dbbed26cc2df&chksm=c0253825f752b13303aa204bdfa93eb5979999cf5c61224726673f552ab5406ce9a506a6e7b5#rd">ä»–æ¥äº†ï¼æ€§èƒ½åŠæ‰“ Node.js å’Œ Deno çš„æ–°ä¸€ä»£ javaScript è¿è¡Œæ—¶ï¼</a></h3><p>åˆšå¼€æºä¸åˆ°ä¸€ä¸ªæœˆå°±è·å¾—äº† 19.5k starï¼çœ‹èµ·æ¥é©¬ä¸Šå°±ä¼šæˆä¸º Node.js å’Œ Deno çš„ä¸€å¤§ç«äº‰å¯¹æ‰‹äº†ï¼</p><p>å’Œä¼ ç»Ÿçš„ Node.js è¿™ç§ä¼ ç»Ÿçš„ javaScript è¿è¡Œæ—¶ä¸åŒï¼ŒBun.js ç›´æ¥å†…ç½®äº†æ‰“åŒ…å™¨ã€è½¬è¯‘å™¨ã€ä»»åŠ¡è¿è¡Œå™¨å’Œ npm å®¢æˆ·ç«¯ï¼Œè¿™æ„å‘³ç€ä½ ä¸å†éœ€è¦ Webpack/Rollup/esbuild/Snowpack/Parcel/Rome/swc/babel å°±å¯ä»¥ç›´æ¥è¿è¡Œ TypeScriptã€JSXï¼</p><p>å¦å¤–ï¼ŒBun.js åŸç”Ÿæ”¯æŒäº†æ•°ç™¾ä¸ª Node.js å’Œ Web APIï¼ŒåŒ…æ‹¬çº¦ 90% çš„ Node-API å‡½æ•°(fsã€pathã€Buffer ç­‰)ã€‚</p><p>Bun.js çš„ç›®æ ‡æ˜¯å¯ä»¥åœ¨æµè§ˆå™¨ä¹‹å¤–çš„å…¶ä»–åœ°æ–¹è¿è¡Œä¸–ç•Œä¸Šå¤§å¤šæ•° JavaScriptï¼Œä¸ºä½ æœªæ¥çš„åŸºç¡€æ¶æ„å¸¦æ¥æ€§èƒ½å’Œå¤æ‚æ€§çš„å¢å¼ºï¼Œå¹¶é€šè¿‡æ›´å¥½ã€æ›´ç®€å•çš„å·¥å…·æé«˜å¼€å‘è€…çš„ç”Ÿäº§åŠ›ï¼</p><h2 id="å‹æƒ…é“¾æ¥"><a href="#å‹æƒ…é“¾æ¥" class="headerlink" title="å‹æƒ…é“¾æ¥"></a>å‹æƒ…é“¾æ¥</h2><ul><li><a href="https://github.com/aliyunfe/weekly">é˜¿é‡Œäº‘ TXD å‰ç«¯å‘¨åˆŠ</a></li><li><a href="https://github.com/ascoders/weekly">å‰ç«¯ç²¾åº¦å‘¨åˆŠ</a></li><li><a href="">o2team/tech-weekly</a></li><li><a href="https://github.com/tnfe/TNT-Weekly/">tnfe/TNT-Weekly</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> weekly </category>
          
      </categories>
      
      
        <tags>
            
            <tag> weekly </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Object.prototype.hasOwnProperty()å’Œ Object.hasOwn()</title>
      <link href="/2022/07/09/023-object-prototype-hasownproperty-andobject-hasown/"/>
      <url>/2022/07/09/023-object-prototype-hasownproperty-andobject-hasown/</url>
      
        <content type="html"><![CDATA[<h1 id="Object-prototype-hasOwnProperty-å’Œ-Object-hasOwn"><a href="#Object-prototype-hasOwnProperty-å’Œ-Object-hasOwn" class="headerlink" title="Object.prototype.hasOwnProperty()å’Œ Object.hasOwn()"></a>Object.prototype.hasOwnProperty()å’Œ Object.hasOwn()</h1><h3 id="Object-prototype-hasOwnProperty"><a href="#Object-prototype-hasOwnProperty" class="headerlink" title="Object.prototype.hasOwnProperty()"></a><code>Object.prototype.hasOwnProperty()</code></h3><p><code>hasOwnProperty()</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºå¯¹è±¡è‡ªèº«å±æ€§ä¸­æ˜¯å¦å…·æœ‰æŒ‡å®šçš„å±æ€§ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ˜¯å¦æœ‰æŒ‡å®šçš„é”®ï¼‰ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> object1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>object1<span class="token punctuation">.</span>property1 <span class="token operator">=</span> <span class="token number">42</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">"property1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// expected output: true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">"toString"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// expected output: false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>object1<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">"hasOwnProperty"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// expected output: false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Object-hasOwn"><a href="#Object-hasOwn" class="headerlink" title="Object.hasOwn()"></a><code>Object.hasOwn()</code></h3><blockquote><p><strong>æ³¨æ„ï¼š</strong> <code>Object.hasOwn()</code>æ—¨åœ¨æ›¿ä»£<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/hasOwnProperty"><code>Object.hasOwnProperty()</code></a>.</p></blockquote><h4 id="ç”¨æ³•"><a href="#ç”¨æ³•" class="headerlink" title="ç”¨æ³•"></a>ç”¨æ³•</h4><p><code>hasOwn(instance, prop)</code></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> object1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token string">"exists"</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>object1<span class="token punctuation">,</span> <span class="token string">"prop"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// expected output: true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>object1<span class="token punctuation">,</span> <span class="token string">"toString"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// expected output: false</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>object1<span class="token punctuation">,</span> <span class="token string">"undeclaredPropertyValue"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">// expected output: false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="hasOwnå’Œ-in-çš„åŒºåˆ«"><a href="#hasOwnå’Œ-in-çš„åŒºåˆ«" class="headerlink" title="hasOwnå’Œ in çš„åŒºåˆ«"></a><code>hasOwn</code>å’Œ in çš„åŒºåˆ«</h4><blockquote><p>ä»¥ä¸‹ç¤ºä¾‹åŒºåˆ†ç›´æ¥å±æ€§å’Œé€šè¿‡åŸå‹é“¾ç»§æ‰¿çš„å±æ€§ï¼š</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> example <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>example<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token string">"exists"</span><span class="token comment">// `hasOwn` will only return true for direct properties:</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>example<span class="token punctuation">,</span> <span class="token string">"prop"</span><span class="token punctuation">)</span> <span class="token comment">// returns true</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>example<span class="token punctuation">,</span> <span class="token string">"toString"</span><span class="token punctuation">)</span> <span class="token comment">// returns false</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>example<span class="token punctuation">,</span> <span class="token string">"hasOwnProperty"</span><span class="token punctuation">)</span> <span class="token comment">// returns false</span><span class="token comment">// The `in` operator will return true for direct or inherited properties:</span><span class="token string">"prop"</span> <span class="token keyword">in</span> example <span class="token comment">// returns true</span><span class="token string">"toString"</span> <span class="token keyword">in</span> example <span class="token comment">// returns true</span><span class="token string">"hasOwnProperty"</span> <span class="token keyword">in</span> example <span class="token comment">// returns true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="hasOwnProperty-å­˜åœ¨çš„é—®é¢˜"><a href="#hasOwnProperty-å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="hasOwnProperty å­˜åœ¨çš„é—®é¢˜"></a><code>hasOwnProperty</code> å­˜åœ¨çš„é—®é¢˜</h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> foo <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>foo<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token string">'exists'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">hasOwn</span><span class="token punctuation">(</span>foo<span class="token punctuation">,</span> <span class="token string">'prop'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true - ä¸è¯¥å¯¹è±¡æ€ä¹ˆåˆ›å»ºçš„æ²¡å…³ç³»</span><span class="token keyword">if</span> <span class="token punctuation">(</span>foo<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'prop'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//  TypeError: foo.hasOwnProperty is not a function</span>   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>prop<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/create"><code>Object.create(null)</code></a>. è¿™äº›ä¸ç»§æ‰¿è‡ª<code>Object.prototype</code>ï¼Œå› æ­¤<code>hasOwnProperty()</code>æ— æ³•è®¿é—®ã€‚</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> javaScript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>for...ofå¾ªç¯å’Œfor...inå¾ªç¯åŒºåˆ«</title>
      <link href="/2022/07/09/020-for-of-xun-huan-he-for-in-xun-huan-qu-bie/"/>
      <url>/2022/07/09/020-for-of-xun-huan-he-for-in-xun-huan-qu-bie/</url>
      
        <content type="html"><![CDATA[<h1 id="forâ€¦of-å¾ªç¯å’Œ-forâ€¦in-å¾ªç¯åŒºåˆ«"><a href="#forâ€¦of-å¾ªç¯å’Œ-forâ€¦in-å¾ªç¯åŒºåˆ«" class="headerlink" title="forâ€¦of å¾ªç¯å’Œ forâ€¦in å¾ªç¯åŒºåˆ«"></a>forâ€¦of å¾ªç¯å’Œ forâ€¦in å¾ªç¯åŒºåˆ«</h1><h3 id="forâ€¦of-å¾ªç¯"><a href="#forâ€¦of-å¾ªç¯" class="headerlink" title="forâ€¦of å¾ªç¯"></a>forâ€¦of å¾ªç¯</h3><h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p>ä¸€ä¸ªæ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº†<code>Symbol.iterator</code>å±æ€§ï¼Œå°±è¢«è§†ä¸ºå…·æœ‰ iterator æ¥å£ï¼Œå°±å¯ä»¥ç”¨<code>for...of</code>å¾ªç¯éå†å®ƒçš„æˆå‘˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>for...of</code>å¾ªç¯å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„<code>Symbol.iterator</code>æ–¹æ³•ã€‚</p><p><code>for...of</code>å¾ªç¯å¯ä»¥ä½¿ç”¨çš„èŒƒå›´åŒ…æ‹¬æ•°ç»„ã€Set å’Œ Map ç»“æ„ã€æŸäº›ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆæ¯”å¦‚<code>arguments</code>å¯¹è±¡ã€<code>DOM NodeList</code> å¯¹è±¡ã€Generator å¯¹è±¡ï¼Œä»¥åŠå­—ç¬¦ä¸²ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"red"</span><span class="token punctuation">,</span> <span class="token string">"green"</span><span class="token punctuation">,</span> <span class="token string">"blue"</span><span class="token punctuation">]</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// åŸå‹é“¾ä¸Š  Symbol(Symbol.iterator): Æ’ values()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><p><code>for...of</code>å¾ªç¯è°ƒç”¨éå†å™¨æ¥å£ï¼Œæ•°ç»„çš„éå†å™¨æ¥å£åªè¿”å›å…·æœ‰æ•°å­—ç´¢å¼•çš„å±æ€§ã€‚è¿™ä¸€ç‚¹è·Ÿ<code>for...in</code>å¾ªç¯ä¹Ÿä¸ä¸€æ ·ã€‚</p><pre class="line-numbers language-none"><code class="language-none">let arr &#x3D; [3, 5, 7];arr.foo &#x3D; &#39;hello&#39;;for (let i in arr) &#123;  console.log(i); &#x2F;&#x2F; &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;foo&quot;&#125;for (let i of arr) &#123;  console.log(i); &#x2F;&#x2F;  &quot;3&quot;, &quot;5&quot;, &quot;7&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="forâ€¦in-å¾ªç¯"><a href="#forâ€¦in-å¾ªç¯" class="headerlink" title="forâ€¦in å¾ªç¯"></a>forâ€¦in å¾ªç¯</h3><h4 id="æ¦‚å¿µ-1"><a href="#æ¦‚å¿µ-1" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><p><code>for...in</code> è¯­å¥ä»¥ä»»æ„é¡ºåºè¿­ä»£å¯¹è±¡çš„å¯æšä¸¾å±æ€§ï¼Œä¼šéå†æ‰‹åŠ¨æ·»åŠ çš„å…¶ä»–é”®ï¼Œç”šè‡³åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„é”®ï¼Œåªèƒ½è·å¾—å¯¹è±¡çš„é”®åï¼Œä¸èƒ½ç›´æ¥è·å–é”®ï¼Œä¸ºéå†å¯¹è±¡è€Œè®¾è®¡ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">objCustom</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">arrCustom</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">let</span> iterable <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span>iterable<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> iterable<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// "0"ã€"1"ã€"2", "foo", "arrCustom", "objCustom"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><code>for...in</code>å¾ªç¯æœ‰å‡ ä¸ªç¼ºç‚¹ã€‚</p><ul><li>æ•°ç»„çš„é”®åæ˜¯æ•°å­—ï¼Œä½†æ˜¯<code>for...in</code>å¾ªç¯æ˜¯ä»¥å­—ç¬¦ä¸²ä½œä¸ºé”®åâ€œ0â€ã€â€œ1â€ã€â€œ2â€ç­‰ç­‰ã€‚</li><li><code>for...in</code>å¾ªç¯ä¸ä»…éå†æ•°å­—é”®åï¼Œè¿˜ä¼šéå†æ‰‹åŠ¨æ·»åŠ çš„å…¶ä»–é”®ï¼Œç”šè‡³åŒ…æ‹¬åŸå‹é“¾ä¸Šçš„é”®ã€‚</li><li>æŸäº›æƒ…å†µä¸‹ï¼Œ<code>for...in</code>å¾ªç¯ä¼šä»¥ä»»æ„é¡ºåºéå†é”®åã€‚</li></ul><p>æ€»ä¹‹ï¼Œ<code>for...in</code>å¾ªç¯ä¸»è¦æ˜¯ä¸ºéå†å¯¹è±¡è€Œè®¾è®¡çš„ï¼Œä¸é€‚ç”¨äºéå†æ•°ç»„ã€‚</p><p><code>for...of</code>å¾ªç¯ç›¸æ¯”ä¸Šé¢å‡ ç§åšæ³•ï¼Œæœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜ç‚¹ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> value <span class="token keyword">of</span> myArray<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>æœ‰ç€åŒ<code>for...in</code>ä¸€æ ·çš„ç®€æ´è¯­æ³•ï¼Œä½†æ˜¯æ²¡æœ‰<code>for...in</code>é‚£äº›ç¼ºç‚¹ã€‚</li><li>ä¸åŒäº<code>forEach</code>æ–¹æ³•ï¼Œå®ƒå¯ä»¥ä¸<code>break</code>ã€<code>continue</code>å’Œ<code>return</code>é…åˆä½¿ç”¨ã€‚</li><li>æä¾›äº†éå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ“ä½œæ¥å£ã€‚</li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ break è¯­å¥ï¼Œè·³å‡º<code>for...of</code>å¾ªç¯çš„ä¾‹å­ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">of</span> fibonacci<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">break</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šé¢çš„ä¾‹å­ï¼Œä¼šè¾“å‡ºæ–æ³¢çº³å¥‘æ•°åˆ—å°äºç­‰äº 1000 çš„é¡¹ã€‚å¦‚æœå½“å‰é¡¹å¤§äº 1000ï¼Œå°±ä¼šä½¿ç”¨<code>break</code>è¯­å¥è·³å‡º<code>for...of</code>å¾ªç¯ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> ES6 </tag>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitå¸¸è§å‘½ä»¤ä½¿ç”¨</title>
      <link href="/2022/07/09/021-git/"/>
      <url>/2022/07/09/021-git/</url>
      
        <content type="html"><![CDATA[<h1 id="git-å¸¸è§å‘½ä»¤ä½¿ç”¨"><a href="#git-å¸¸è§å‘½ä»¤ä½¿ç”¨" class="headerlink" title="git å¸¸è§å‘½ä»¤ä½¿ç”¨"></a>git å¸¸è§å‘½ä»¤ä½¿ç”¨</h1><h2 id="git-ä»“åº“åˆå§‹åŒ–"><a href="#git-ä»“åº“åˆå§‹åŒ–" class="headerlink" title="git ä»“åº“åˆå§‹åŒ–"></a>git ä»“åº“åˆå§‹åŒ–</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">echo <span class="token string">"# test"</span> <span class="token operator">>></span> <span class="token constant">README</span><span class="token punctuation">.</span>mdgit initgit add <span class="token constant">README</span><span class="token punctuation">.</span>mdgit commit <span class="token operator">-</span>m <span class="token string">"first commit"</span>git branch <span class="token operator">-</span><span class="token constant">M</span> maingit remote add origin git@github<span class="token punctuation">.</span>com<span class="token operator">:</span>xxx<span class="token punctuation">.</span>gitgit push <span class="token operator">-</span>u origin main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="git-reset"><a href="#git-reset" class="headerlink" title="git reset"></a>git reset</h2><p><code>git reset</code>å‘½ä»¤ç”¨äºå°†å½“å‰åˆ†æ”¯æŒ‡å‘å¦ä¸€ä¸ªä½ç½®ã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># å°†å½“æœŸåˆ†æ”¯çš„æŒ‡é’ˆå€’é€€ä¸‰ä¸ª commitï¼Œ</span><span class="token comment"># å¹¶ä¸”ä¼šæ”¹å˜æš‚å­˜åŒº</span>$ git reset HEAD~3<span class="token comment"># å€’é€€æŒ‡é’ˆçš„åŒæ—¶ï¼Œä¸æ”¹å˜æš‚å­˜åŒº</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span>soft HEAD~3<span class="token comment"># å€’é€€æŒ‡é’ˆçš„åŒæ—¶ï¼Œæ”¹å˜å·¥ä½œåŒº</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span>hard HEAD~3<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸æŒ‡å®šå›æ»šçš„ä½ç½®ï¼Œé‚£ä¹ˆç­‰åŒäºæ’¤é”€ä¿®æ”¹ã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># æ’¤é”€ä¸Šä¸€æ¬¡å‘æš‚å­˜åŒºæ·»åŠ çš„æ‰€æœ‰æ–‡ä»¶</span>$ git reset<span class="token comment"># æ— ä»»ä½•æ•ˆæœ</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span>soft<span class="token comment"># åŒæ—¶æ’¤é”€æš‚å­˜åŒºå’Œå·¥ä½œåŒºçš„ä¿®æ”¹ï¼Œ</span><span class="token comment"># å›å¤åˆ°ä¸Šä¸€æ¬¡æäº¤çš„çŠ¶æ€</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span>hard<span class="token comment"># æ’¤é”€ä¸Šä¸€æ¬¡å‘æš‚å­˜åŒºæ·»åŠ çš„æŸä¸ªæŒ‡å®šæ–‡ä»¶ï¼Œ</span><span class="token comment"># ä¸å½±å“å·¥ä½œåŒºä¸­çš„è¯¥æ–‡ä»¶</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span> &lt;filename<span class="token punctuation">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h2><ul><li>soft: ä¸æ”¹å˜å·¥ä½œåŒºå’Œç¼“å­˜åŒºï¼Œåªç§»åŠ¨ HEAD åˆ°æŒ‡å®š commitã€‚</li><li>mixed: åªæ”¹å˜ç¼“å­˜åŒºï¼Œä¸æ”¹å˜å·¥ä½œåŒºã€‚è¿™æ˜¯é»˜è®¤å‚æ•°ï¼Œé€šå¸¸ç”¨äºæ’¤é”€<code>git add</code>ã€‚</li><li>hardï¼šæ”¹å˜å·¥ä½œåŒºå’Œæš‚å­˜åŒºåˆ°æŒ‡å®š commitã€‚è¯¥å‚æ•°ç­‰åŒäºé‡ç½®ï¼Œå¯èƒ½ä¼šå¼•èµ·æ•°æ®æŸå¤±ã€‚<code>git reset --hard</code>ç­‰åŒäº<code>git reset --hard HEAD</code>ã€‚</li><li><code>-p</code>è¡¨ç¤ºé”®å…¥äº¤äº’æ¨¡å¼ï¼ŒæŒ‡å®šæš‚å­˜åŒºçš„å“ªäº›éƒ¨åˆ†éœ€è¦æ’¤é”€ã€‚</li></ul><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token comment"># Undo add</span>$ git reset<span class="token comment"># Undo a commitï¼Œä¸é‡ç½®å·¥ä½œåŒºå’Œç¼“å­˜åŒº</span><span class="token comment"># å›åˆ° HEAD ä¹‹å‰çš„é‚£ä¸ª commit</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span>soft HEAD^<span class="token comment"># Undo a commitï¼Œé‡ç½®å·¥ä½œåŒºå’Œç¼“å­˜åŒº</span><span class="token comment"># è¿ç»­æ’¤é”€ä¸‰ä¸ª commitï¼šHEAD, HEAD^, and HEAD~2</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span>hard HEAD~3<span class="token comment"># ä»æš‚å­˜åŒºç§»é™¤æŒ‡å®šæ–‡ä»¶ï¼Œä½†ä¸æ”¹å˜å·¥ä½œåŒºä¸­çš„è¯¥æ–‡ä»¶</span>$ git reset <span class="token punctuation">-</span><span class="token punctuation">-</span> frotz.c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å¼€å‘å·¥å…· </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ahookså­¦ä¹ </title>
      <link href="/2022/06/01/019-ahooks/"/>
      <url>/2022/06/01/019-ahooks/</url>
      
        <content type="html"><![CDATA[<h2 id="aHooks"><a href="#aHooks" class="headerlink" title="aHooks"></a>aHooks</h2><h3 id="useRequest"><a href="#useRequest" class="headerlink" title="useRequest"></a>useRequest</h3><ul><li><p>å…¬å¸</p><ul><li><p>ç»„å»ºå†…</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> xxx <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"@/services/xxx"</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">data</span><span class="token operator">:</span> xxx<span class="token punctuation">,</span>  error<span class="token punctuation">,</span>  loading<span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">APIxxx</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> merchantId <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>@/services/xxx</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> request <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"umi"</span><span class="token comment">// åˆ¤æ–­æ˜¯å¦åˆ›å»ºè¿‡loyalty</span><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">APIxxx</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">params</span><span class="token operator">:</span> xxx</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/xxx/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    params<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ä»£ç†ä½ç½®/config/proxy</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token string-property property">'/api-xxx/'</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'http://xxx'</span><span class="token punctuation">,</span>          <span class="token literal-property property">changeOrigin</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          <span class="token literal-property property">pathRewrite</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span> <span class="token string-property property">'^/api-xxx/'</span><span class="token operator">:</span> <span class="token string">'/'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>é»˜è®¤ç”¨æ³•/è‡ªåŠ¨è§¦å‘</p></li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useRequest <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"ahooks"</span><span class="token keyword">import</span> Mock <span class="token keyword">from</span> <span class="token string">"mockjs"</span><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">function</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>Mock<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">"@name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">export default () => </span><span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> error<span class="token punctuation">,</span> loading <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">failed to load</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>loading<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">loading...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Username: </span><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>æ‰‹åŠ¨è§¦å‘<ul><li>run</li><li>runAsync</li></ul></li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> loading<span class="token punctuation">,</span> runAsync <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>editUsername<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">await</span> <span class="token function">runAsync</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span>    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>    message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The username was changed to "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>state<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>ç”Ÿå‘½å‘¨æœŸ<ul><li><code>onBefore</code>ï¼šè¯·æ±‚ä¹‹å‰è§¦å‘</li><li><code>onSuccess</code>ï¼šè¯·æ±‚æˆåŠŸè§¦å‘</li><li><code>onError</code>ï¼šè¯·æ±‚å¤±è´¥è§¦å‘</li><li><code>onFinally</code>ï¼šè¯·æ±‚å®Œæˆè§¦å‘</li></ul></li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useRequest <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"ahooks"</span><span class="token keyword">function</span> <span class="token function">editUsername</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">username</span><span class="token operator">:</span> string</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Failed to modify username"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">export default () => </span><span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> loading<span class="token punctuation">,</span> run <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>editUsername<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token function-variable function">onBefore</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">params</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Start Request: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">onSuccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>      message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The username was changed to "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function-variable function">onFinally</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> result<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      message<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Request finish</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">disabled</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>loading<span class="token punctuation">&#125;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">run</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token punctuation">&#123;</span>loading <span class="token operator">?</span> <span class="token string">"Loading"</span> <span class="token operator">:</span> <span class="token string">"Edit"</span><span class="token punctuation">&#125;</span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>åˆ·æ–°é‡å¤è¯·æ±‚</p><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> data<span class="token punctuation">,</span> loading<span class="token punctuation">,</span> run<span class="token punctuation">,</span> refresh <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">id</span><span class="token operator">:</span> number</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">getUsername</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token function">run</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>refresh<span class="token punctuation">&#125;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">  Refresh</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ç«‹å³å˜æ›´æ•°æ®</p></li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> message <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'antd'</span><span class="token punctuation">;</span><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> useState<span class="token punctuation">,</span> useRef <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useRequest <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'ahooks'</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>Mock<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'@name'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token plain-text">function editUsername(username: string): Promise</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>void</span><span class="token punctuation">></span></span><span class="token plain-text"> </span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token plain-text">export default () => </span><span class="token punctuation">&#123;</span>  <span class="token comment">// store last username</span>  <span class="token keyword">const</span> lastRef <span class="token operator">=</span> useRef<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span><span class="token punctuation">></span></span><span class="token plain-text">();  const [state, setState] = useState('');  // get username  const </span><span class="token punctuation">&#123;</span> <span class="token literal-property property">data</span><span class="token operator">:</span> username<span class="token punctuation">,</span> mutate <span class="token punctuation">&#125;</span><span class="token plain-text"> = useRequest(getUsername);  // edit username  const </span><span class="token punctuation">&#123;</span> <span class="token literal-property property">run</span><span class="token operator">:</span> edit <span class="token punctuation">&#125;</span><span class="token plain-text"> = useRequest(editUsername, </span><span class="token punctuation">&#123;</span>    <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>    <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">mutate</span><span class="token punctuation">(</span>lastRef<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token plain-text">);  const onChange = () => </span><span class="token punctuation">&#123;</span>    lastRef<span class="token punctuation">.</span>current <span class="token operator">=</span> username<span class="token punctuation">;</span>    <span class="token function">mutate</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">edit</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token plain-text">;  return (    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Username: </span><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>state<span class="token punctuation">&#125;</span></span>        <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Please enter username<span class="token punctuation">"</span></span>        <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">240</span><span class="token punctuation">,</span> <span class="token literal-property property">marginRight</span><span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>      <span class="token punctuation">/></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>onChange<span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">        Edit      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">  );&#125;;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å–æ¶ˆè¯·æ±‚</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span> loading<span class="token punctuation">,</span> run<span class="token punctuation">,</span> cancel <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>editUsername<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">manual</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token function-variable function">onSuccess</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">result<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>    message<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The username was changed to "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">" !</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function-variable function">onError</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>cancel<span class="token punctuation">&#125;</span></span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">marginLeft</span><span class="token operator">:</span> <span class="token number">16</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">  Cancel</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>å‚æ•°ç®¡ç†</li></ul><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">data</span><span class="token operator">:</span> username<span class="token punctuation">,</span>  run<span class="token punctuation">,</span>  params<span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">useRequest</span><span class="token punctuation">(</span>getUsername<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">defaultParams</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"1"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">marginTop</span><span class="token operator">:</span> <span class="token number">8</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">UserId: </span><span class="token punctuation">&#123;</span>params<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Api"><a href="#Api" class="headerlink" title="Api"></a>Api</h4><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token keyword">const</span> <span class="token punctuation">&#123;</span>  loading<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>  data<span class="token operator">?</span><span class="token operator">:</span> TData<span class="token punctuation">,</span>  error<span class="token operator">?</span><span class="token operator">:</span> Error<span class="token punctuation">,</span>  params<span class="token operator">:</span> TParams <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token function-variable function">run</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token operator">:</span> TParams<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>  <span class="token function-variable function">runAsync</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>params<span class="token operator">:</span> TParams<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TData<span class="token operator">></span><span class="token punctuation">,</span>  <span class="token function-variable function">refresh</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>  <span class="token function-variable function">refreshAsync</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TData<span class="token operator">></span><span class="token punctuation">,</span>  mutate<span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">?</span><span class="token operator">:</span> TData <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>oldData<span class="token operator">?</span><span class="token operator">:</span> TData<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>TData <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>  <span class="token function-variable function">cancel</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useRequest</span><span class="token generic class-name"><span class="token operator">&lt;</span>TData<span class="token punctuation">,</span> TParams<span class="token operator">></span></span></span><span class="token punctuation">(</span>  <span class="token function-variable function">service</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> TParams<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>TData<span class="token operator">></span><span class="token punctuation">,</span>  <span class="token punctuation">&#123;</span>    manual<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">,</span>    defaultParams<span class="token operator">?</span><span class="token operator">:</span> TParams<span class="token punctuation">,</span>    onBefore<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> TParams<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>    onSuccess<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token operator">:</span> TData<span class="token punctuation">,</span> params<span class="token operator">:</span> TParams<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>    onError<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> Error<span class="token punctuation">,</span> params<span class="token operator">:</span> TParams<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>    onFinally<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>params<span class="token operator">:</span> TParams<span class="token punctuation">,</span> data<span class="token operator">?</span><span class="token operator">:</span> TData<span class="token punctuation">,</span> e<span class="token operator">?</span><span class="token operator">:</span> Error<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">,</span>    loadingDelay<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token comment">//è®¾ç½® loading å˜æˆ true çš„å»¶è¿Ÿæ—¶é—´</span>    pollingInterval<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token comment">//è½®è¯¢é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚å¦‚æœå€¼å¤§äº 0ï¼Œåˆ™å¯åŠ¨è½®è¯¢æ¨¡å¼ã€‚é€šè¿‡ cancel æ¥åœæ­¢è½®è¯¢ï¼Œé€šè¿‡ run/runAsync æ¥å¯åŠ¨è½®è¯¢ã€‚</span>    pollingWhenHidden<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span><span class="token comment">//åœ¨é¡µé¢éšè—æ—¶ï¼Œæ˜¯å¦ç»§ç»­è½®è¯¢ã€‚å¦‚æœè®¾ç½®ä¸º falseï¼Œåœ¨é¡µé¢éšè—æ—¶ä¼šæš‚æ—¶åœæ­¢è½®è¯¢ï¼Œé¡µé¢é‡æ–°æ˜¾ç¤ºæ—¶ç»§ç»­ä¸Šæ¬¡è½®è¯¢ã€‚</span>    ready<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span><span class="token comment">//å½“å‰è¯·æ±‚æ˜¯å¦å‡†å¤‡å¥½äº†</span>    refreshDeps<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment">//ä¾èµ–æ•°ç»„ï¼Œå½“æ•°ç»„å†…å®¹å˜åŒ–åï¼Œå‘èµ·è¯·æ±‚ã€‚åŒ useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚</span>refreshOnWindowFocus<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">boolean</span><span class="token comment">//åœ¨å±å¹•é‡æ–°è·å–ç„¦ç‚¹æˆ–é‡æ–°æ˜¾ç¤ºæ—¶ï¼Œé‡æ–°å‘èµ·è¯·æ±‚booleanfalse</span>focusTimespan<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span>debounceWait<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token comment">//é˜²æŠ–</span>    throttleWait<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token comment">//èŠ‚æµ</span>  retryCount<span class="token operator">?</span><span class="token operator">:</span><span class="token builtin">number</span><span class="token comment">//é”™è¯¯é‡è¯•</span>    cacheKey<span class="token operator">?</span><span class="token builtin">string</span><span class="token comment">//ç¼“å­˜</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="useSetState"><a href="#useSetState" class="headerlink" title="useSetState"></a>useSetState</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> useSetState <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">"ahooks"</span><span class="token keyword">interface</span> <span class="token class-name">State</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">hello</span><span class="token operator">:</span> string<span class="token punctuation">;</span>  <span class="token literal-property property">count</span><span class="token operator">:</span> number<span class="token punctuation">;</span>  <span class="token punctuation">[</span>key<span class="token operator">:</span> string<span class="token punctuation">]</span><span class="token operator">:</span> any<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> setState<span class="token punctuation">]</span> <span class="token operator">=</span>    useSetState <span class="token operator">&lt;</span>    State <span class="token operator">></span>    <span class="token punctuation">&#123;</span>      <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>      <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>    <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">hello</span><span class="token operator">:</span> <span class="token string">"world"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">          set hello        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">"bar"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>          <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">margin</span><span class="token operator">:</span> <span class="token string">"0 8px"</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span>        <span class="token punctuation">></span></span><span class="token plain-text">          set foo        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span>          <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prev</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">count</span><span class="token operator">:</span> prev<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span>        <span class="token punctuation">></span></span><span class="token plain-text">          count + 1        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="useBoolean"><a href="#useBoolean" class="headerlink" title="useBoolean"></a>useBoolean</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> toggle<span class="token punctuation">,</span> set<span class="token punctuation">,</span> setLeft<span class="token punctuation">,</span> setRight <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//false</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="useToggle"><a href="#useToggle" class="headerlink" title="useToggle"></a>useToggle</h3><pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> toggle<span class="token punctuation">,</span> set<span class="token punctuation">,</span> setLeft<span class="token punctuation">,</span> setRight <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//false</span><span class="token keyword">const</span> <span class="token punctuation">[</span>state<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> toggle<span class="token punctuation">,</span> set<span class="token punctuation">,</span> setLeft<span class="token punctuation">,</span> setRight <span class="token punctuation">&#125;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToggle</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token string">"World"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="LifeCycle"><a href="#LifeCycle" class="headerlink" title="LifeCycle"></a>LifeCycle</h3><ul><li>useMount(fn: () =&gt; void );</li><li>useUnmount(fn: () =&gt; void);</li><li>useUnmount(fn: () =&gt; void);</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> ahooks </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¼˜é€‰æ–‡ç« </title>
      <link href="/2022/03/01/024-you-xuan-wen-zhang/"/>
      <url>/2022/03/01/024-you-xuan-wen-zhang/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰ç«¯æ¡†æ¶"><a href="#å‰ç«¯æ¡†æ¶" class="headerlink" title="å‰ç«¯æ¡†æ¶"></a>å‰ç«¯æ¡†æ¶</h2><h3 id="git-ä½¿ç”¨"><a href="#git-ä½¿ç”¨" class="headerlink" title="git ä½¿ç”¨"></a>git ä½¿ç”¨</h3><ul><li><a href="https://www.bookstack.cn/read/git-tutorial/docs-commands-git-reset.md">é˜®ä¸€å³° Git æ•™ç¨‹</a></li><li><a href="https://mp.weixin.qq.com/s/2p4m63JdsCjBpVku-WaZyA">45 ä¸ª GIT ç»å…¸æ“ä½œåœºæ™¯ï¼Œä¸“æ²»ä¸ä¼šåˆä»£ç </a></li><li></li></ul><h3 id="ES6-ä½¿ç”¨"><a href="#ES6-ä½¿ç”¨" class="headerlink" title="ES6 ä½¿ç”¨"></a>ES6 ä½¿ç”¨</h3><ul><li><a href="https://es6.ruanyifeng.com/">ES6 å…¥é—¨æ•™ç¨‹</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•+æ‰‹æ’•</title>
      <link href="/2022/03/01/017-suan-fa-shou-si/"/>
      <url>/2022/03/01/017-suan-fa-shou-si/</url>
      
        <content type="html"><![CDATA[<h2 id="æ‰‹æ’•"><a href="#æ‰‹æ’•" class="headerlink" title="æ‰‹æ’•"></a>æ‰‹æ’•</h2><h3 id="èŠ‚æµ-é˜²æŠ–"><a href="#èŠ‚æµ-é˜²æŠ–" class="headerlink" title="èŠ‚æµ-é˜²æŠ–"></a><strong>èŠ‚æµ-é˜²æŠ–</strong></h3><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">const throttle1 &#x3D; (fn,wait &#x3D; 500) &#x3D;&gt; &#123; &#x2F;&#x2F;å¿…é¡»è¿”å›å‡½æ•°å¦åˆ™æ˜¯å‡½æ•°çš„ç›´æ¥è°ƒç”¨        return function(...args) &#123;  &#x2F;&#x2F; ä¸èƒ½æ˜¯ç®­å¤´å‡½æ•°ï¼Œè®©thisæŒ‡å‘è¯¥æ ‡ç­¾ï¼Œå¦åˆ™thisæŒ‡å‘windiw          if(!this.timer)&#123;&#x2F;&#x2F;æ£€æµ‹æ˜¯å¦å¼€å¯äº†å®šæ—¶å™¨            this.timer &#x3D;  setTimeout(() &#x3D;&gt; &#123;&#x2F;&#x2F;æ²¡æœ‰å¼€å¯åˆ™å¼€å¯æ–°çš„å®šæ—¶å™¨ï¼Œå¿…é¡»æ˜¯ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™thisæŒ‡å‘windiw              fn.apply(this,args) &#x2F;&#x2F;fnå¿…é¡»æ˜¯æ™®é€šå‡½æ•°ï¼Œå¦åˆ™æ²¡æ³•æ”¹å˜thisæŒ‡å‘              this.timer &#x3D; null&#x2F;&#x2F;æ¸…é™¤å®šæ—¶å™¨            &#125;,wait)          &#125;        &#125;     &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-JS" data-language="JS"><code class="language-JS">const debounce &#x3D; (func, wait &#x3D; 50) &#x3D;&gt; &#123;  &#x2F;&#x2F; ç¼“å­˜ä¸€ä¸ªå®šæ—¶å™¨id  &#x2F;&#x2F; è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡ç”¨æˆ·å®é™…è°ƒç”¨çš„é˜²æŠ–å‡½æ•°  &#x2F;&#x2F; å¦‚æœå·²ç»è®¾å®šè¿‡å®šæ—¶å™¨äº†å°±æ¸…ç©ºä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨  &#x2F;&#x2F; å¼€å§‹ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„æ–¹æ³•  return function(...args) &#123;    if (this.timer) clearTimeout(timer)    this.timer &#x3D; setTimeout(() &#x3D;&gt; &#123;      func.apply(this, args)    &#125;, wait)  &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="call-apply-bind"><a href="#call-apply-bind" class="headerlink" title="call-apply-bind"></a>call-apply-bind</h3><p>1.call</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myCall</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context <span class="token operator">=</span> window<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// this-->func  context--> obj  args--> ä¼ é€’è¿‡æ¥çš„å‚æ•°</span>  <span class="token comment">// åœ¨contextä¸ŠåŠ ä¸€ä¸ªå”¯ä¸€å€¼ä¸å½±å“contextä¸Šçš„å±æ€§</span>  <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span>  context<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">// contextä¸ºè°ƒç”¨çš„ä¸Šä¸‹æ–‡,thisæ­¤å¤„ä¸ºå‡½æ•°ï¼Œå°†è¿™ä¸ªå‡½æ•°ä½œä¸ºcontextçš„æ–¹æ³•</span>  <span class="token comment">// let args = [...arguments].slice(1)   //ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºobjæ‰€ä»¥åˆ é™¤,ä¼ªæ•°ç»„è½¬ä¸ºæ•°ç»„</span>  <span class="token keyword">let</span> result <span class="token operator">=</span> context<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>  <span class="token keyword">delete</span> context<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// ä¸åˆ é™¤ä¼šå¯¼è‡´contextå±æ€§è¶Šæ¥è¶Šå¤š</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2.apply</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myApply</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context <span class="token operator">=</span> window<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// this-->func  context--> obj  args--> ä¼ é€’è¿‡æ¥çš„å‚æ•°</span>  <span class="token comment">// åœ¨contextä¸ŠåŠ ä¸€ä¸ªå”¯ä¸€å€¼ä¸å½±å“contextä¸Šçš„å±æ€§</span>  <span class="token keyword">let</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span>  context<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span> <span class="token comment">// contextä¸ºè°ƒç”¨çš„ä¸Šä¸‹æ–‡,thisæ­¤å¤„ä¸ºå‡½æ•°ï¼Œå°†è¿™ä¸ªå‡½æ•°ä½œä¸ºcontextçš„æ–¹æ³•</span>  <span class="token keyword">let</span> result <span class="token operator">=</span> context<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token comment">// è¿™é‡Œå’Œcallä¼ å‚ä¸ä¸€æ ·</span>  <span class="token keyword">delete</span> context<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token comment">// ä¸åˆ é™¤ä¼šå¯¼è‡´contextå±æ€§è¶Šæ¥è¶Šå¤š</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>3.bind</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myBind</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context <span class="token operator">=</span> window<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> temp <span class="token operator">=</span> <span class="token keyword">this</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">temp</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">,</span> args2<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    temp<span class="token punctuation">.</span><span class="token function">myCall</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token punctuation">,</span> <span class="token operator">...</span>args2<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a>Promise</h3><h4 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>rejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">"PENDING"</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span>    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">"PENDING"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">"RESOLVED"</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value      <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">"PENDING"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">"REJECTED"</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value      <span class="token keyword">this</span><span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">cb</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">"PENDING"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>resolvedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onFulfilled<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>rejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">"RESOLVED"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">onFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">===</span> <span class="token string">"REJECTED"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¼‚æ­¥å‡½æ•°</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">time</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">timer</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> timer<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> <span class="token function-variable function">ajax1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token number">1</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">ajax2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token number">2</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">ajax3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token number">3</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Promise-all"><a href="#Promise-all" class="headerlink" title="Promise.all"></a>Promise.all</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">Promise<span class="token punctuation">.</span><span class="token function-variable function">all</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">let</span> len <span class="token operator">=</span> promises<span class="token punctuation">.</span>length    <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ä¸ºä»€ä¹ˆä¸ç›´æ¥ promise[i].then, å› ä¸ºpromise[i]å¯èƒ½ä¸æ˜¯ä¸€ä¸ªpromise</span>      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promise<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          result<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> data          index<span class="token operator">++</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>Promise<span class="token punctuation">.</span><span class="token function">all1</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">ajax1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ajax2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ajax3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ‰é¡ºåºçš„æ‰§è¡Œ-promose"><a href="#æœ‰é¡ºåºçš„æ‰§è¡Œ-promose" class="headerlink" title="æœ‰é¡ºåºçš„æ‰§è¡Œ promose"></a>æœ‰é¡ºåºçš„æ‰§è¡Œ promose</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergePromise</span><span class="token punctuation">(</span><span class="token parameter">ajaxArr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">//å­˜æ”¾è¿”å›ç»“æœ</span>  <span class="token keyword">let</span> promise <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  ajaxArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ajax</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    promise <span class="token operator">=</span> promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>ajax<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>      <span class="token keyword">return</span> data    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> promise<span class="token punctuation">&#125;</span><span class="token function">mergePromise</span><span class="token punctuation">(</span><span class="token punctuation">[</span>ajax1<span class="token punctuation">,</span> ajax2<span class="token punctuation">,</span> ajax3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é™åˆ¶å¹¶å‘"><a href="#é™åˆ¶å¹¶å‘" class="headerlink" title="é™åˆ¶å¹¶å‘"></a><strong>é™åˆ¶å¹¶å‘</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">limitLoad</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> handler<span class="token punctuation">,</span> limit</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>url<span class="token punctuation">]</span>  <span class="token comment">//åˆå§‹åŒ–promiseå®¹å™¨</span>  <span class="token keyword">let</span> promises <span class="token operator">=</span> sequence<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> limit<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">handler</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> index    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> sequence    <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pCollect<span class="token punctuation">,</span> url</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> pCollect        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span> <span class="token comment">//è¿”å›å·²ç»å®Œæˆçš„ä¸‹æ ‡</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">fastestIndex</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          promises<span class="token punctuation">[</span>fastestIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">handler</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> fastestIndex          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ¨¡æ‹Ÿçº¢ç»¿çš„ç¯"><a href="#æ¨¡æ‹Ÿçº¢ç»¿çš„ç¯" class="headerlink" title="æ¨¡æ‹Ÿçº¢ç»¿çš„ç¯"></a><strong>æ¨¡æ‹Ÿçº¢ç»¿çš„ç¯</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">await</span> <span class="token function">ajax1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">await</span> <span class="token function">ajax2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">await</span> <span class="token function">ajax3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">await</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>ajax1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>ajax2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>ajax3<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="eventBus"><a href="#eventBus" class="headerlink" title="eventBus"></a><strong>eventBus</strong></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">class</span> <span class="token class-name">EventBus</span> <span class="token punctuation">&#123;</span>  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token punctuation">[</span>fn<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      handler<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> fn <span class="token keyword">of</span> handler<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>    <span class="token keyword">const</span> index <span class="token operator">=</span> handler<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=></span> e <span class="token operator">===</span> fn<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      handler<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>handler<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">this</span>    <span class="token keyword">function</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>      _self<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> handler<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">// ä¸‹é¢æ˜¯ æµ‹è¯•ä»£ç </span><span class="token keyword">function</span> <span class="token function">test1</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">test2</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">22</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">test3</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">test4</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>params</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">//æµ‹è¯•ç”¨ä¾‹</span><span class="token keyword">let</span> eb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventBus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"event1"</span><span class="token punctuation">,</span> test1<span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"event1"</span><span class="token punctuation">,</span> test2<span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"event1"</span><span class="token punctuation">,</span> test3<span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"event1"</span><span class="token punctuation">,</span> <span class="token string">"ç¬¬ä¸€æ¬¡"</span><span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">"event1"</span><span class="token punctuation">,</span> test1<span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"event1"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"ç¬¬äºŒæ¬¡1"</span><span class="token punctuation">,</span> <span class="token string">"ç¬¬äºŒæ¬¡2"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">"once"</span><span class="token punctuation">,</span> test4<span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"once"</span><span class="token punctuation">,</span> <span class="token string">"æ‰§è¡Œä¸€æ¬¡"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>eb<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">"once"</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç®—æ³•"><a href="#ç®—æ³•" class="headerlink" title="ç®—æ³•"></a>ç®—æ³•</h2><h3 id="ä¼ªæ•°ç»„è½¬æ¢"><a href="#ä¼ªæ•°ç»„è½¬æ¢" class="headerlink" title="ä¼ªæ•°ç»„è½¬æ¢"></a><strong>ä¼ªæ•°ç»„è½¬æ¢</strong></h3><blockquote><p><strong>ä»€ä¹ˆæ˜¯ä¼ªæ•°ç»„</strong></p></blockquote><p>æœ¬èº«å¹¶ä¸èƒ½è°ƒç”¨æ•°ç»„æ–¹æ³•ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¦å¤–ä¸€ç§å¯¹è±¡ç±»å‹ï¼Œåªä¸è¿‡å±æ€§ä» 0 å¼€å§‹æ’ï¼Œä¾æ¬¡ä¸º 0ï¼Œ1ï¼Œ2â€¦æœ€åè¿˜<strong>æœ‰ callee å’Œ length å±æ€§</strong>ã€‚æˆ‘ä»¬ä¹ŸæŠŠè¿™æ ·çš„å¯¹è±¡ç§°ä¸ºç±»æ•°ç»„</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span>arguments<span class="token punctuation">]</span><span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//(start,end)</span><span class="token keyword">let</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">let</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°ç»„æ‰å¹³åŒ–"><a href="#æ•°ç»„æ‰å¹³åŒ–" class="headerlink" title="æ•°ç»„æ‰å¹³åŒ–"></a>æ•°ç»„æ‰å¹³åŒ–</h3><ol><li>for å¾ªç¯éå†åˆ¤æ–­æ˜¯å¦æ•°ç»„ æ˜¯çš„é€’å½’è°ƒç”¨ <strong>concat é€’å½’è°ƒç”¨</strong>è¯¥æ•°ç»„ å¦åˆ™ push æ–°æ•°ç»„</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      result <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span class="token function">flatten</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment">//  [1, 2, 3, 4ï¼Œ5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>åˆ©ç”¨ reduce æ–¹æ³• +concat</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ–¹æ³•2</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">prev<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> prev<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">flatten</span><span class="token punctuation">(</span>next<span class="token punctuation">)</span> <span class="token operator">:</span> next<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//  [1, 2, 3, 4ï¼Œ5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>some+[â€¦]</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ–¹æ³•3</span><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//  [1, 2, 3, 4ï¼Œ5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li><p>arr.toString().split(â€˜,â€™);</p></li><li><p>arr.flat([depth])</p></li><li><p>æ­£åˆ™</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// æ–¹æ³• 6</span><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">//[1,["2",[3,[4,5]]],6]</span>  str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\[|\])</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>  str <span class="token operator">=</span> <span class="token string">"["</span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token string">"]"</span>  <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//  [1, 2, 3, 4ï¼Œ5]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol></li></ol><h3 id="æ·±æ‹·è´"><a href="#æ·±æ‹·è´" class="headerlink" title="æ·±æ‹·è´"></a>æ·±æ‹·è´</h3><ol><li><p><strong>JSON.parse</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> newObj <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>oldObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>å±€é™æ€§ï¼š</strong></p><ul><li><p>ä¼šå¿½ç•¥ undefined</p></li><li><p>ä¸èƒ½åºåˆ—åŒ–å‡½æ•°</p></li><li><p>ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡</p></li><li><p>ä»–æ— æ³•å®ç°å¯¹å‡½æ•° ã€RegExp ç­‰ç‰¹æ®Šå¯¹è±¡çš„å…‹éš†</p></li><li><p>ä¼šæŠ›å¼ƒå¯¹è±¡çš„ constructor,æ‰€æœ‰çš„æ„é€ å‡½æ•°ä¼šæŒ‡å‘ Object</p></li><li><p>å¯¹è±¡æœ‰å¾ªç¯å¼•ç”¨,ä¼šæŠ¥é”™</p></li></ul></li><li><p><strong>ï¼ˆé€’å½’ï¼‰</strong></p></li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">deepClone</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å¦‚æœæ˜¯ å€¼ç±»å‹ æˆ– nullï¼Œåˆ™ç›´æ¥return</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> obj <span class="token operator">!==</span> <span class="token string">"object"</span> <span class="token operator">||</span> obj <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> obj  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> copy <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Array<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    copy <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// éå†å¯¹è±¡çš„key</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœkeyæ˜¯å¯¹è±¡çš„è‡ªæœ‰å±æ€§</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// é€’å½’è°ƒç”¨æ·±æ‹·è´æ–¹æ³•</span>      copy<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">deepClone</span><span class="token punctuation">(</span>obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> copy<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°ç»„å»é‡"><a href="#æ•°ç»„å»é‡" class="headerlink" title="æ•°ç»„å»é‡"></a>æ•°ç»„å»é‡</h3><ol><li><p>new Setï¼ˆï¼‰</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">]</span>Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><blockquote><p><strong>å¯¹è±¡æ•°ç»„ä¸èƒ½å»é‡</strong></p></blockquote><ol start="2"><li><p><strong>indexOf</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      array<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> array<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>å¯¹è±¡æ•°ç»„ NaN ä¸èƒ½å»é‡</strong></p></blockquote></li><li><p>new Map()</p></li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>map<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>      map<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li><strong>hasOwnProperty</strong></li></ol><p>ç®€å•ç‰ˆæœ¬</p><blockquote><p>åªä¿ç•™ä¸€ä¸ªå¯¹è±¡</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"> <span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  object1  <span class="token keyword">typeof</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token operator">+</span><span class="token punctuation">&#123;</span><span class="token literal-property property">a</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">&#125;</span>  object<span class="token punctuation">[</span>object Object<span class="token punctuation">]</span><span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>          <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> item<span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>            obj<span class="token punctuation">[</span><span class="token keyword">typeof</span> item<span class="token operator">+</span>item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>          <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>å®Œæ•´ç‰ˆæœ¬</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">"[object Object]"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// console.log(item);</span>      <span class="token comment">// console.log(JSON.stringify(item));</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>        result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>        obj<span class="token punctuation">[</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>      <span class="token operator">!</span>obj<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> item <span class="token operator">+</span> item<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>      <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">"[object Object]"</span>    <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span>      result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>      obj<span class="token punctuation">[</span><span class="token keyword">typeof</span> item <span class="token operator">+</span> item<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a><strong>æ’åº</strong></h3><ol><li><p>å†’æ³¡</p><blockquote><p>æ¯ä¸€è½®æ“ä½œï¼Œéƒ½ä¼šå°†è¿™ä¸€è½®ä¸­æœ€å¤§çš„å…ƒç´ æ”¾ç½®åˆ°æ•°ç»„çš„æœ«å°¾</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token comment">// å¤–å±‚å¾ªç¯ç”¨äºæ§åˆ¶ä»å¤´åˆ°å°¾çš„æ¯”è¾ƒ+äº¤æ¢åˆ°åº•æœ‰å¤šå°‘è½®</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åŒºåˆ«åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åŠ äº†ä¸€ä¸ªæ ‡å¿—ä½</span>    <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token comment">// å†…å±‚å¾ªç¯ç”¨äºå®Œæˆæ¯ä¸€è½®éå†è¿‡ç¨‹ä¸­çš„é‡å¤æ¯”è¾ƒ+äº¤æ¢</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥ç›¸é‚»å…ƒç´ å‰é¢çš„æ•°æ¯”åé¢çš„å¤§</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// äº¤æ¢ä¸¤è€…</span>        <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span>        flag <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è‹¥ä¸€æ¬¡äº¤æ¢ä¹Ÿæ²¡å‘ç”Ÿï¼Œåˆ™è¯´æ˜æ•°ç»„æœ‰åºï¼Œç›´æ¥æ”¾è¿‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> arr  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›æ•°ç»„</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>é€‰æ‹©æ’åº</strong></p><blockquote><p>æ¯æ¬¡éƒ½æ‰¾å‡ºå½“å‰èŒƒå›´å†…çš„æœ€å°å€¼ï¼ŒæŠŠå®ƒæ”¾åœ¨å½“å‰èŒƒå›´çš„å¤´éƒ¨</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">selectSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token comment">// å®šä¹‰ minIndexï¼Œç¼“å­˜å½“å‰åŒºé—´æœ€å°å€¼çš„ç´¢å¼•ï¼Œæ³¨æ„æ˜¯ç´¢å¼•</span>  <span class="token keyword">let</span> minIndex  <span class="token comment">// i æ˜¯å½“å‰æ’åºåŒºé—´çš„èµ·ç‚¹</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆå§‹åŒ– minIndex ä¸ºå½“å‰åŒºé—´ç¬¬ä¸€ä¸ªå…ƒç´ </span>    minIndex <span class="token operator">=</span> i    <span class="token comment">// iã€jåˆ†åˆ«å®šä¹‰å½“å‰åŒºé—´çš„ä¸Šä¸‹ç•Œï¼Œiæ˜¯å·¦è¾¹ç•Œï¼Œjæ˜¯å³è¾¹ç•Œ</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥ j å¤„çš„æ•°æ®é¡¹æ¯”å½“å‰æœ€å°å€¼è¿˜è¦å°ï¼Œåˆ™æ›´æ–°æœ€å°å€¼ç´¢å¼•ä¸º j</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        minIndex <span class="token operator">=</span> j      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœ minIndex å¯¹åº”å…ƒç´ ä¸æ˜¯ç›®å‰çš„å¤´éƒ¨å…ƒç´ ï¼Œåˆ™äº¤æ¢ä¸¤è€…</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>minIndex <span class="token operator">!==</span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>minIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>æ’å…¥æ’åº</strong></p><blockquote><p>æ‰¾åˆ°å…ƒç´ åœ¨å®ƒå‰é¢é‚£ä¸ªåºåˆ—ä¸­çš„æ­£ç¡®ä½ç½®</p></blockquote></li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">insertSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token comment">// temp ç”¨æ¥ä¿å­˜å½“å‰éœ€è¦æ’å…¥çš„å…ƒç´ </span>  <span class="token keyword">let</span> temp  <span class="token comment">// iç”¨äºæ ‡è¯†æ¯æ¬¡è¢«æ’å…¥çš„å…ƒç´ çš„ç´¢å¼•</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// jç”¨äºå¸®åŠ© temp å¯»æ‰¾è‡ªå·±åº”è¯¥æœ‰çš„å®šä½</span>    <span class="token keyword">let</span> j <span class="token operator">=</span> i    temp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token comment">// åˆ¤æ–­ j å‰é¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦æ¯” temp å¤§</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">></span> temp<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¦‚æœæ˜¯ï¼Œåˆ™å°† j å‰é¢çš„ä¸€ä¸ªå…ƒç´ åç§»ä¸€ä½ï¼Œä¸º temp è®©å‡ºä½ç½®</span>      arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>      j<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¾ªç¯è®©ä½ï¼Œæœ€åå¾—åˆ°çš„ j å°±æ˜¯ temp çš„æ­£ç¡®ç´¢å¼•</span>    arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å½’å¹¶æ’åº"><a href="#å½’å¹¶æ’åº" class="headerlink" title="å½’å¹¶æ’åº"></a>å½’å¹¶æ’åº</h4><blockquote><p>å½’å¹¶æ’åºæ˜¯å¯¹åˆ†æ²»æ€æƒ³çš„å…¸å‹åº”ç”¨ï¼Œå®ƒæŒ‰ç…§å¦‚ä¸‹çš„æ€è·¯å¯¹åˆ†æ²»æ€æƒ³â€œä¸‰æ­¥èµ°â€çš„æ¡†æ¶è¿›è¡Œäº†å¡«å……ï¼š</p></blockquote><ul><li>åˆ†è§£å­é—®é¢˜ï¼šå°†éœ€è¦è¢«æ’åºçš„æ•°ç»„ä»ä¸­é—´åˆ†å‰²ä¸ºä¸¤åŠï¼Œç„¶åå†å°†åˆ†å‰²å‡ºæ¥çš„æ¯ä¸ªå­æ•°ç»„å„åˆ†å‰²ä¸ºä¸¤åŠï¼Œé‡å¤ä»¥ä¸Šæ“ä½œï¼Œç›´åˆ°å•ä¸ªå­æ•°ç»„åªæœ‰ä¸€ä¸ªå…ƒç´ ä¸ºæ­¢ã€‚</li><li>æ±‚è§£æ¯ä¸ªå­é—®é¢˜ï¼šä»ç²’åº¦æœ€å°çš„å­æ•°ç»„å¼€å§‹ï¼Œä¸¤ä¸¤åˆå¹¶ã€ç¡®ä¿æ¯æ¬¡åˆå¹¶å‡ºæ¥çš„æ•°ç»„éƒ½æ˜¯æœ‰åºçš„ã€‚ï¼ˆè¿™é‡Œçš„â€œå­é—®é¢˜â€æŒ‡çš„å°±æ˜¯å¯¹æ¯ä¸ªå­æ•°ç»„è¿›è¡Œæ’åºï¼‰ã€‚ åˆå¹¶å­é—®é¢˜çš„è§£ï¼Œå¾—å‡ºå¤§é—®é¢˜çš„è§£ï¼šå½“æ•°ç»„è¢«åˆå¹¶è‡³åŸæœ‰çš„è§„æ¨¡æ—¶ï¼Œå°±å¾—åˆ°äº†ä¸€ä¸ªå®Œå…¨æ’åºçš„æ•°ç»„</li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> arr<span class="token punctuation">.</span>length  <span class="token comment">// å¤„ç†è¾¹ç•Œæƒ…å†µ</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arr  <span class="token punctuation">&#125;</span>  <span class="token comment">// è®¡ç®—åˆ†å‰²ç‚¹</span>  <span class="token keyword">const</span> mid <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>len <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// é€’å½’åˆ†å‰²å·¦å­æ•°ç»„ï¼Œç„¶ååˆå¹¶ä¸ºæœ‰åºæ•°ç»„</span>  <span class="token keyword">const</span> leftArr <span class="token operator">=</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// é€’å½’åˆ†å‰²å³å­æ•°ç»„ï¼Œç„¶ååˆå¹¶ä¸ºæœ‰åºæ•°ç»„</span>  <span class="token keyword">const</span> rightArr <span class="token operator">=</span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>mid<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// åˆå¹¶å·¦å³ä¸¤ä¸ªæœ‰åºæ•°ç»„</span>  arr <span class="token operator">=</span> <span class="token function">mergeArr</span><span class="token punctuation">(</span>leftArr<span class="token punctuation">,</span> rightArr<span class="token punctuation">)</span>  <span class="token comment">// è¿”å›åˆå¹¶åçš„ç»“æœ</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">mergeArr</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ arr1 å’Œ arr2</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// åˆå§‹åŒ–ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ç¼“å­˜arr1çš„é•¿åº¦</span>  <span class="token keyword">const</span> len1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span>length  <span class="token comment">// ç¼“å­˜arr2çš„é•¿åº¦</span>  <span class="token keyword">const</span> len2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span>length  <span class="token comment">// åˆå¹¶ä¸¤ä¸ªå­æ•°ç»„</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1 <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>      j<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„é¦–å…ˆè¢«åˆå¹¶å®Œå…¨ï¼Œåˆ™ç›´æ¥æ‹¼æ¥å¦ä¸€ä¸ªå­æ•°ç»„çš„å‰©ä½™éƒ¨åˆ†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¿«æ’"><a href="#å¿«æ’" class="headerlink" title="å¿«æ’"></a>å¿«æ’</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> right <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> arr  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">></span> right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> value <span class="token operator">=</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> left<span class="token punctuation">,</span>    j <span class="token operator">=</span> right  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">!==</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">>=</span> value <span class="token operator">&amp;&amp;</span> j <span class="token operator">></span> i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      j<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> value <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">;</span><span class="token punctuation">[</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>arr<span class="token punctuation">[</span>left<span class="token punctuation">]</span><span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> left<span class="token punctuation">,</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token function">partition</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> right<span class="token punctuation">)</span>  <span class="token keyword">return</span> arr<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å †æ’åº"><a href="#å †æ’åº" class="headerlink" title="å †æ’åº"></a>å †æ’åº</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><h4 id="è½¬åŒ–ä¸ºé©¼å³°å‘½å"><a href="#è½¬åŒ–ä¸ºé©¼å³°å‘½å" class="headerlink" title="è½¬åŒ–ä¸ºé©¼å³°å‘½å"></a><strong>è½¬åŒ–ä¸ºé©¼å³°å‘½å</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token string">"get-element-by-id"</span><span class="token comment">// è½¬åŒ–ä¸º getElementById</span><span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-\w</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ¤æ–­æ˜¯å¦æ˜¯å›æ–‡ä¸²"><a href="#åˆ¤æ–­æ˜¯å¦æ˜¯å›æ–‡ä¸²" class="headerlink" title="åˆ¤æ–­æ˜¯å¦æ˜¯å›æ–‡ä¸²"></a>åˆ¤æ–­æ˜¯å¦æ˜¯å›æ–‡ä¸²</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">str <span class="token operator">===</span><span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token keyword">function</span> <span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// ç¼“å­˜å­—ç¬¦ä¸²çš„é•¿åº¦</span>    <span class="token keyword">const</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span>length    <span class="token comment">// éå†å‰åŠéƒ¨åˆ†ï¼Œåˆ¤æ–­å’ŒååŠéƒ¨åˆ†æ˜¯å¦å¯¹ç§°</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>len<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">!==</span>str<span class="token punctuation">[</span>len<span class="token operator">-</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span> <span class="token comment">// å·¥å…·æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å›æ–‡</span>    <span class="token keyword">function</span> <span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token parameter">st<span class="token punctuation">,</span> ed</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span>st<span class="token operator">&lt;</span>ed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>st<span class="token punctuation">]</span> <span class="token operator">!==</span> s<span class="token punctuation">[</span>ed<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span>            <span class="token punctuation">&#125;</span>            st<span class="token operator">++</span>            ed<span class="token operator">--</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ é™¤ä¸€ä¸ªæ˜¯å¦å›æ–‡"><a href="#åˆ é™¤ä¸€ä¸ªæ˜¯å¦å›æ–‡" class="headerlink" title="åˆ é™¤ä¸€ä¸ªæ˜¯å¦å›æ–‡"></a>åˆ é™¤ä¸€ä¸ªæ˜¯å¦å›æ–‡</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">validPalindrome</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜å­—ç¬¦ä¸²çš„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> s<span class="token punctuation">.</span>length  <span class="token comment">// iã€jåˆ†åˆ«ä¸ºå·¦å³æŒ‡é’ˆ</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment">// å½“å·¦å³æŒ‡é’ˆå‡æ»¡è¶³å¯¹ç§°æ—¶ï¼Œä¸€èµ·å‘ä¸­é—´å‰è¿›</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> j <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    i<span class="token operator">++</span>    j<span class="token operator">--</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å°è¯•åˆ¤æ–­è·³è¿‡å·¦æŒ‡é’ˆå…ƒç´ åå­—ç¬¦ä¸²æ˜¯å¦å›æ–‡</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPalindrome</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å°è¯•åˆ¤æ–­è·³è¿‡å³æŒ‡é’ˆå…ƒç´ åå­—ç¬¦ä¸²æ˜¯å¦å›æ–‡</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPalindrome</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å·¥å…·æ–¹æ³•ï¼Œç”¨äºåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦å›æ–‡</span>  <span class="token keyword">function</span> <span class="token function">isPalindrome</span><span class="token punctuation">(</span><span class="token parameter">st<span class="token punctuation">,</span> ed</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>st <span class="token operator">&lt;</span> ed<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">[</span>st<span class="token punctuation">]</span> <span class="token operator">!==</span> s<span class="token punctuation">[</span>ed<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span>      <span class="token punctuation">&#125;</span>      st<span class="token operator">++</span>      ed<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// é»˜è®¤è¿”å› false</span>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a><strong>æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">lengthOfLongestSubstring</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> set <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//åˆ¤æ–­æ»‘åŠ¨çª—å£å†…æ˜¯å¦æœ‰é‡å¤å…ƒç´ </span>  <span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//æ»‘åŠ¨çª—å£å·¦è¾¹ç•Œ</span>    maxLength <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æç«¯æƒ…å†µ</span>    <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//æ»‘åŠ¨çª—å£å³è¾¹ç•Œ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//å½“å‰å…ƒç´ ä¸åœ¨setä¸­ å°±åŠ å…¥set ç„¶åæ›´æ–°æœ€å¤§é•¿åº¦ï¼Œi++ç»§ç»­ä¸‹ä¸€è½®å¾ªç¯</span>      set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      maxLength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>maxLength<span class="token punctuation">,</span> set<span class="token punctuation">.</span>size<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//setä¸­æœ‰é‡å¤å…ƒç´ ä¸æ–­è®©j++ å¹¶åˆ é™¤çª—å£ä¹‹å¤–çš„å…ƒç´  ç›´åˆ°æ»‘åŠ¨çª—å£å†…æ²¡æœ‰é‡å¤çš„å…ƒç´ </span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>set<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        set<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>        j<span class="token operator">++</span>      <span class="token punctuation">&#125;</span>      set<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//æ”¾å¿ƒå°†s[i]åŠ å…¥setä¸­</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> maxLength<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ€é•¿å›æ–‡å­ä¸²"><a href="#æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="æœ€é•¿å›æ–‡å­ä¸²"></a><strong>æœ€é•¿å›æ–‡å­ä¸²</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">longestPalindrome</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>s<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> s  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å›æ–‡å­ä¸²é•¿åº¦æ˜¯å¥‡æ•°</span>    <span class="token function">helper</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i<span class="token punctuation">)</span>    <span class="token comment">// å›æ–‡å­ä¸²é•¿åº¦æ˜¯å¶æ•°</span>    <span class="token function">helper</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">function</span> <span class="token function">helper</span><span class="token punctuation">(</span><span class="token parameter">m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>m <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> n <span class="token operator">&lt;</span> s<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> s<span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">==</span> s<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      m<span class="token operator">--</span>      n<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// æ³¨æ„æ­¤å¤„m,nçš„å€¼å¾ªç¯å®Œå  æ˜¯æ°å¥½ä¸æ»¡è¶³å¾ªç¯æ¡ä»¶çš„æ—¶åˆ» å¦‚æœæ­¤è½®è¯¢å¾—åˆ°å›æ–‡ä¸²é•¿åº¦å¤§äºä¹‹å‰è®°å½•ï¼Œ è®°å½•æ­¤è½®å¾ªè¾¹ç•Œ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">-</span> m <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">></span> r <span class="token operator">-</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      r <span class="token operator">=</span> n      l <span class="token operator">=</span> m    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> s<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹"><a href="#æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹" class="headerlink" title="æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹"></a><strong>æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å…¥å‚æ˜¯ä¸€ä¸ªæ•°å­—åºåˆ—</span><span class="token keyword">const</span> <span class="token function-variable function">lengthOfLIS</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜åºåˆ—çš„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token comment">// å¤„ç†è¾¹ç•Œæ¡ä»¶</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆå§‹åŒ–æ•°ç»„é‡Œé¢æ¯ä¸€ä¸ªç´¢å¼•ä½çš„çŠ¶æ€å€¼</span>  <span class="token keyword">const</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// åˆå§‹åŒ–æœ€å¤§ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ä¸º1</span>  <span class="token keyword">let</span> maxLen <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">// ä»ç¬¬2ä¸ªå…ƒç´ å¼€å§‹ï¼Œéå†æ•´ä¸ªæ•°ç»„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ¯éå†ä¸€ä¸ªæ–°å…ƒç´ ï¼Œéƒ½è¦â€œå›å¤´çœ‹â€ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å»¶é•¿åŸæœ‰çš„ä¸Šå‡å­åºåˆ—</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥é‡åˆ°äº†ä¸€ä¸ªæ¯”å½“å‰å…ƒç´ å°çš„å€¼ï¼Œåˆ™æ„å‘³ç€é‡åˆ°äº†ä¸€ä¸ªå¯ä»¥å»¶é•¿çš„ä¸Šå‡å­åºåˆ—ï¼Œæ•…æ›´æ–°å½“å‰å…ƒç´ ç´¢å¼•ä½å¯¹åº”çš„çŠ¶æ€</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åŠæ—¶æ›´æ–°ä¸Šå‡å­åºåˆ—é•¿åº¦çš„æœ€å¤§å€¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> maxLen<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      maxLen <span class="token operator">=</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// éå†å®Œæ¯•ï¼Œæœ€ååˆ°æ‰‹çš„å°±æ˜¯æœ€å¤§ä¸Šå‡å­åºåˆ—çš„é•¿åº¦</span>  <span class="token keyword">return</span> maxLen<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><blockquote><p>åˆ›å»º</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>æ³¨æ„</strong>ï¼šfill([])åé¢ä¼ é€’çš„æ˜¯å¼•ç”¨æ•°æ®ç±»å‹</p><h4 id="ä¸¤æ•°æ±‚å’Œé—®é¢˜"><a href="#ä¸¤æ•°æ±‚å’Œé—®é¢˜" class="headerlink" title="ä¸¤æ•°æ±‚å’Œé—®é¢˜"></a><strong>ä¸¤æ•°æ±‚å’Œé—®é¢˜</strong></h4><p>å“ˆå¸Œè¡¨ map</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">twoSum</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¿™é‡Œæˆ‘ç”¨å¯¹è±¡æ¥æ¨¡æ‹Ÿ map çš„èƒ½åŠ›</span>  <span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token comment">// éå†æ•°ç»„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆ¤æ–­å½“å‰å€¼å¯¹åº”çš„ target å·®å€¼æ˜¯å¦å­˜åœ¨ï¼ˆæ˜¯å¦å·²éå†è¿‡ï¼‰</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">[</span>target <span class="token operator">-</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥æœ‰å¯¹åº”å·®å€¼ï¼Œé‚£ä¹ˆç­”æ¡ˆgetï¼</span>      <span class="token keyword">return</span> <span class="token punctuation">[</span>map<span class="token punctuation">[</span>target <span class="token operator">-</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è‹¥æ²¡æœ‰å¯¹åº”å·®å€¼ï¼Œåˆ™è®°å½•å½“å‰å€¼</span>    map<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> i  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆå¹¶å‡åºæ•°ç»„"><a href="#åˆå¹¶å‡åºæ•°ç»„" class="headerlink" title="åˆå¹¶å‡åºæ•°ç»„"></a>åˆå¹¶å‡åºæ•°ç»„</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">merge</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums1<span class="token punctuation">,</span> m<span class="token punctuation">,</span> nums2<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆçš„æŒ‡å‘ï¼Œåˆå§‹åŒ– nums1 å°¾éƒ¨ç´¢å¼•k</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span>    k <span class="token operator">=</span> m <span class="token operator">+</span> n <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment">// å½“ä¸¤ä¸ªæ•°ç»„éƒ½æ²¡éå†å®Œæ—¶ï¼ŒæŒ‡é’ˆåŒæ­¥ç§»åŠ¨</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> j <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å–è¾ƒå¤§çš„å€¼ï¼Œä»æœ«å°¾å¾€å‰å¡«è¡¥</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>=</span> nums2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      nums1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> nums1<span class="token punctuation">[</span>i<span class="token punctuation">]</span>      i<span class="token operator">--</span>      k<span class="token operator">--</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      nums1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> nums2<span class="token punctuation">[</span>j<span class="token punctuation">]</span>      j<span class="token operator">--</span>      k<span class="token operator">--</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// nums2 ç•™ä¸‹çš„æƒ…å†µï¼Œç‰¹æ®Šå¤„ç†ä¸€ä¸‹</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    nums1<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> nums2<span class="token punctuation">[</span>j<span class="token punctuation">]</span>    k<span class="token operator">--</span>    j<span class="token operator">--</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">mergeArr</span><span class="token punctuation">(</span><span class="token parameter">arr1<span class="token punctuation">,</span> arr2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–ä¸¤ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘ arr1 å’Œ arr2</span>  <span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>    j <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// åˆå§‹åŒ–ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ç¼“å­˜arr1çš„é•¿åº¦</span>  <span class="token keyword">const</span> len1 <span class="token operator">=</span> arr1<span class="token punctuation">.</span>length  <span class="token comment">// ç¼“å­˜arr2çš„é•¿åº¦</span>  <span class="token keyword">const</span> len2 <span class="token operator">=</span> arr2<span class="token punctuation">.</span>length  <span class="token comment">// åˆå¹¶ä¸¤ä¸ªå­æ•°ç»„</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1 <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;</span> len2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      i<span class="token operator">++</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr2<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>      j<span class="token operator">++</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥å…¶ä¸­ä¸€ä¸ªå­æ•°ç»„é¦–å…ˆè¢«åˆå¹¶å®Œå…¨ï¼Œåˆ™ç›´æ¥æ‹¼æ¥å¦ä¸€ä¸ªå­æ•°ç»„çš„å‰©ä½™éƒ¨åˆ†</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> len1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä¸‰æ•°æ±‚å’Œ"><a href="#ä¸‰æ•°æ±‚å’Œ" class="headerlink" title="ä¸‰æ•°æ±‚å’Œ"></a>ä¸‰æ•°æ±‚å’Œ</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums * @return &#123;number[][]&#125; */</span><span class="token keyword">const</span> <span class="token function-variable function">threeSum</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç”¨äºå­˜æ”¾ç»“æœæ•°ç»„</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ç»™ nums æ’åº</span>  nums <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token comment">// æ³¨æ„æˆ‘ä»¬éå†åˆ°å€’æ•°ç¬¬ä¸‰ä¸ªæ•°å°±è¶³å¤Ÿäº†ï¼Œå› ä¸ºå·¦å³æŒ‡é’ˆä¼šéå†åé¢ä¸¤ä¸ªæ•°</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å·¦æŒ‡é’ˆ j</span>    <span class="token keyword">let</span> j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token comment">// å³æŒ‡é’ˆk</span>    <span class="token keyword">let</span> k <span class="token operator">=</span> len <span class="token operator">-</span> <span class="token number">1</span>    <span class="token comment">// å¦‚æœé‡åˆ°é‡å¤çš„æ•°å­—ï¼Œåˆ™è·³è¿‡</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> nums<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">continue</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ä¸‰æ•°ä¹‹å’Œå°äº0ï¼Œå·¦æŒ‡é’ˆå‰è¿›</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        j<span class="token operator">++</span>        <span class="token comment">// å¤„ç†å·¦æŒ‡é’ˆå…ƒç´ é‡å¤çš„æƒ…å†µ</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> k <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">===</span> nums<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          j<span class="token operator">++</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ä¸‰æ•°ä¹‹å’Œå¤§äº0ï¼Œå³æŒ‡é’ˆåé€€</span>        k<span class="token operator">--</span>        <span class="token comment">// å¤„ç†å³æŒ‡é’ˆå…ƒç´ é‡å¤çš„æƒ…å†µ</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> k <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">===</span> nums<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          k<span class="token operator">--</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// å¾—åˆ°ç›®æ ‡æ•°å­—ç»„åˆï¼Œæ¨å…¥ç»“æœæ•°ç»„</span>        res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment">// å·¦å³æŒ‡é’ˆä¸€èµ·å‰è¿›</span>        j<span class="token operator">++</span>        k<span class="token operator">--</span>        <span class="token comment">// è‹¥å·¦æŒ‡é’ˆå…ƒç´ é‡å¤ï¼Œè·³è¿‡</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> k <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">===</span> nums<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          j<span class="token operator">++</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">// è‹¥å³æŒ‡é’ˆå…ƒç´ é‡å¤ï¼Œè·³è¿‡</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;</span> k <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">===</span> nums<span class="token punctuation">[</span>k <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          k<span class="token operator">--</span>        <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›ç»“æœæ•°ç»„</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ¯”è¾ƒç‰ˆæœ¬å·"><a href="#æ¯”è¾ƒç‰ˆæœ¬å·" class="headerlink" title="æ¯”è¾ƒç‰ˆæœ¬å·"></a>æ¯”è¾ƒç‰ˆæœ¬å·</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">compareVersion</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">version1<span class="token punctuation">,</span> version2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> arr1 <span class="token operator">=</span> version1<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> arr2 <span class="token operator">=</span> version2<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> arr2<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> n1 <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>arr1<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> n2 <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>arr2<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">></span> n2<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n1 <span class="token operator">&lt;</span> n2<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr1<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// arr2 æ•°ç»„å·²ç»ä¸ºç©º</span>    <span class="token keyword">return</span> arr1<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token number">1</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">//if (temp2.length === 0) &#123;</span>  <span class="token comment">//    for (const value of temp1) &#123;</span>  <span class="token comment">//    if (Number(value) !== 0) return 1</span>  <span class="token comment">//   &#125;</span>  <span class="token comment">//&#125;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>arr2<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// arr1 æ•°ç»„å·²ç»ä¸ºç©º</span>    <span class="token keyword">return</span> arr2<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">Number</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åƒä½åˆ†éš”ç¬¦"><a href="#åƒä½åˆ†éš”ç¬¦" class="headerlink" title="åƒä½åˆ†éš”ç¬¦"></a><strong>åƒä½åˆ†éš”ç¬¦</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">thousandSeparator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> str <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\d&#123;1,3&#125;(?=(\d&#123;3&#125;)+$)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>s<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">thousandSeparator</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> arr <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> arr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">-=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\.</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‹†è§£-URL-å‚æ•°ä¸­-queryString"><a href="#æ‹†è§£-URL-å‚æ•°ä¸­-queryString" class="headerlink" title="æ‹†è§£ URL å‚æ•°ä¸­ queryString"></a><strong>æ‹†è§£ URL å‚æ•°ä¸­ queryString</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">querySearch</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> query <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  query<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span>key<span class="token punctuation">,</span> val<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span>    res<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> val  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"www.alipay.com/index.html?user=anyone&amp;tip=haha#first"</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">querySearch</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¿”å›æœ€æ¥è¿‘è¾“å…¥å€¼çš„æ•°å­—"><a href="#è¿”å›æœ€æ¥è¿‘è¾“å…¥å€¼çš„æ•°å­—" class="headerlink" title="è¿”å›æœ€æ¥è¿‘è¾“å…¥å€¼çš„æ•°å­—"></a><strong>è¿”å›æœ€æ¥è¿‘è¾“å…¥å€¼çš„æ•°å­—</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">findNext</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> arr</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> tempArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span>arr<span class="token punctuation">]</span>  tempArr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  tempArr<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> index <span class="token operator">=</span> tempArr<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> tempArr<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">===</span> tempArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> tempArr<span class="token punctuation">[</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> tempArr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">-</span> tempArr<span class="token punctuation">[</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span>    tempArr<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> tempArr<span class="token punctuation">[</span>index<span class="token punctuation">]</span>    <span class="token operator">?</span> tempArr<span class="token punctuation">[</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>    <span class="token operator">:</span> tempArr<span class="token punctuation">[</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"><a href="#è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ" class="headerlink" title="è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ"></a><strong>è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ</strong></h4><ol><li>è´ªå¿ƒç®—æ³•</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">maxSubArray</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> ans <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> num <span class="token keyword">of</span> nums<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// ç»§ç»­åŠ å½“å‰å…ƒç´ </span>      sum <span class="token operator">+=</span> num    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// åŠ ä¸Šå½“å‰å…ƒç´ åªä¼šå¯¹æœ€ç»ˆæ•°ç»„å’Œèµ·å‡å°‘çš„ä½œç”¨ï¼Œè€Œä¸æ˜¯å¢å¤§æ•°ç»„å’Œï¼Œæ‰€ä»¥å°±ç›´æ¥ä»¥å½“å‰å…ƒç´ ä¸ºèµ·ç‚¹æ–°èµ·æ•°ç»„æ±‚æœ€å¤§æ•°ç»„å’Œ</span>      sum <span class="token operator">=</span> num    <span class="token punctuation">&#125;</span>    ans <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>ans<span class="token punctuation">,</span> sum<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> ans<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>åŠ¨æ€è§„åˆ’</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums * @return &#123;number&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">maxSubArray</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token keyword">let</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// base case ç¬¬ä¸€ä¸ªå…ƒç´ å‰é¢æ²¡æœ‰å­æ•°ç»„</span>  dp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">// çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>      <span class="token comment">// è‡ªæˆä¸€æ´¾</span>      nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token comment">// ä¸å‰é¢çš„å­æ•°ç»„åˆå¹¶</span>      nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> dp<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>    <span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>dp<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;number[]&#125; nums * @return &#123;number&#125; */</span><span class="token keyword">var</span> <span class="token function-variable function">maxSubArray</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token keyword">let</span> cur <span class="token operator">=</span> nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">//ä¿å­˜ä¸Šä¸€æ¬¡çš„æœ€å¤§å€¼</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> cur <span class="token comment">//ä¿å­˜ç»“æœ</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    cur <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> cur<span class="token punctuation">)</span>    res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> cur<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å…¨æ’åˆ—"><a href="#å…¨æ’åˆ—" class="headerlink" title="å…¨æ’åˆ—"></a>å…¨æ’åˆ—</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å…¥å‚æ˜¯ä¸€ä¸ªæ•°ç»„</span><span class="token keyword">const</span> <span class="token function-variable function">permute</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„çš„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token comment">// curr å˜é‡ç”¨æ¥è®°å½•å½“å‰çš„æ’åˆ—å†…å®¹</span>  <span class="token keyword">const</span> curr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// res ç”¨æ¥è®°å½•æ‰€æœ‰çš„æ’åˆ—é¡ºåº</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// visited ç”¨æ¥é¿å…é‡å¤ä½¿ç”¨åŒä¸€ä¸ªæ•°å­—</span>  <span class="token keyword">const</span> visited <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>  <span class="token comment">// å®šä¹‰ dfs å‡½æ•°ï¼Œå…¥å‚æ˜¯å‘ä½çš„ç´¢å¼•ï¼ˆä» 0 è®¡æ•°ï¼‰</span>  <span class="token keyword">function</span> <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token parameter">nth</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è‹¥éå†åˆ°äº†ä¸å­˜åœ¨çš„å‘ä½ï¼ˆç¬¬ len+1 ä¸ªï¼‰ï¼Œåˆ™è§¦ç¢°é€’å½’è¾¹ç•Œè¿”å›</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>nth <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// æ­¤æ—¶å‰ len ä¸ªå‘ä½å·²ç»å¡«æ»¡ï¼Œå°†å¯¹åº”çš„æ’åˆ—è®°å½•ä¸‹æ¥</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>curr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">return</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// æ£€æŸ¥æ‰‹é‡Œå‰©ä¸‹çš„æ•°å­—æœ‰å“ªäº›</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥ nums[i] ä¹‹å‰æ²¡è¢«å…¶å®ƒå‘ä½ç”¨è¿‡ï¼Œåˆ™å¯ä»¥ç†è§£ä¸ºâ€œè¿™ä¸ªæ•°å­—å‰©ä¸‹äº†â€</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>visited<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// ç»™ nums[i] æ‰“ä¸ªâ€œå·²ç”¨è¿‡â€çš„æ ‡</span>        visited<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>        <span class="token comment">// å°†nums[i]æ¨å…¥å½“å‰æ’åˆ—</span>        curr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token comment">// åŸºäºè¿™ä¸ªæ’åˆ—ç»§ç»­å¾€ä¸‹ä¸€ä¸ªå‘èµ°å»</span>        <span class="token function">dfs</span><span class="token punctuation">(</span>nth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token comment">// nums[i]è®©å‡ºå½“å‰å‘ä½</span>        curr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">// ä¸‹æ‰â€œå·²ç”¨è¿‡â€æ ‡è¯†</span>        visited<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ä»ç´¢å¼•ä¸º 0 çš„å‘ä½ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‘ä½ï¼‰å¼€å§‹ dfs</span>  <span class="token function">dfs</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="é˜Ÿåˆ—"><a href="#é˜Ÿåˆ—" class="headerlink" title="é˜Ÿåˆ—"></a>é˜Ÿåˆ—</h3><h4 id="å¦‚ä½•ç”¨æ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ"><a href="#å¦‚ä½•ç”¨æ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ" class="headerlink" title="å¦‚ä½•ç”¨æ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ"></a><strong>å¦‚ä½•ç”¨æ ˆå®ç°ä¸€ä¸ªé˜Ÿåˆ—ï¼Ÿ</strong></h4><ul><li><p>push(x) â€“ å°†ä¸€ä¸ªå…ƒç´ æ”¾å…¥é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚</p></li><li><p>pop() â€“ ä»é˜Ÿåˆ—é¦–éƒ¨ç§»é™¤å…ƒç´ ã€‚</p></li><li><p>peek() â€“ è¿”å›é˜Ÿåˆ—é¦–éƒ¨çš„å…ƒç´ ã€‚</p></li><li><p>empty() â€“ è¿”å›é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * åˆå§‹åŒ–æ„é€ å‡½æ•° */</span><span class="token keyword">const</span> <span class="token function-variable function">MyQueue</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–ä¸¤ä¸ªæ ˆ</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment">/** * Push element x to the back of queue. * @param &#123;number&#125; x * @return &#123;void&#125; */</span><span class="token class-name">MyQueue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">push</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç›´æ¥è°ƒåº¦æ•°ç»„çš„ push æ–¹æ³•</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack1<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** * Removes the element from in front of queue and returns that element. * @return &#123;number&#125; */</span><span class="token class-name">MyQueue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">pop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å‡å¦‚ stack2 ä¸ºç©ºï¼Œéœ€è¦å°† stack1 çš„å…ƒç´ è½¬ç§»è¿›æ¥</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å½“ stack1 ä¸ä¸ºç©ºæ—¶ï¼Œå‡ºæ ˆ</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack1<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°† stack1 å‡ºæ ˆçš„å…ƒç´ æ¨å…¥ stack2</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack1<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ä¸ºäº†è¾¾åˆ°é€†åºçš„ç›®çš„ï¼Œæˆ‘ä»¬åªä» stack2 é‡Œå‡ºæ ˆå…ƒç´ </span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** * Get the front element. * @return &#123;number&#125; * è¿™ä¸ªæ–¹æ³•å’Œ pop å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯æ²¡æœ‰å°†å®šä½åˆ°çš„å€¼å‡ºæ ˆ */</span><span class="token class-name">MyQueue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">peek</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å½“ stack1 ä¸ä¸ºç©ºæ—¶ï¼Œå‡ºæ ˆ</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack1<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°† stack1 å‡ºæ ˆçš„å…ƒç´ æ¨å…¥ stack2</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack1<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç¼“å­˜ stack2 çš„é•¿åº¦</span>  <span class="token keyword">const</span> stack2Len <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length  <span class="token keyword">return</span> stack2Len <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">[</span>stack2Len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment">/** * Returns whether the queue is empty. * @return &#123;boolean&#125; */</span><span class="token class-name">MyQueue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">empty</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è‹¥ stack1 å’Œ stack2 å‡ä¸ºç©ºï¼Œé‚£ä¹ˆé˜Ÿåˆ—ç©º</span>  <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack1<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œçš„æœ€å¤§å€¼ã€‚"><a href="#æ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œçš„æœ€å¤§å€¼ã€‚" class="headerlink" title="æ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œçš„æœ€å¤§å€¼ã€‚"></a>æ‰¾å‡ºæ‰€æœ‰æ»‘åŠ¨çª—å£é‡Œçš„æœ€å¤§å€¼ã€‚</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">maxSlidingWindow</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜æ•°ç»„çš„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token comment">// åˆå§‹åŒ–ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// åˆå§‹åŒ–åŒç«¯é˜Ÿåˆ—</span>  <span class="token keyword">const</span> deque <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// å¼€å§‹éå†æ•°ç»„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å½“é˜Ÿå°¾å…ƒç´ å°äºå½“å‰å…ƒç´ æ—¶</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>deque<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>deque<span class="token punctuation">[</span>deque<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°†é˜Ÿå°¾å…ƒç´ ï¼ˆç´¢å¼•ï¼‰ä¸æ–­å‡ºé˜Ÿï¼Œç›´è‡³é˜Ÿå°¾å…ƒç´ å¤§äºç­‰äºå½“å‰å…ƒç´ </span>      deque<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å…¥é˜Ÿå½“å‰å…ƒç´ ç´¢å¼•ï¼ˆæ³¨æ„æ˜¯ç´¢å¼•ï¼‰</span>    deque<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>    <span class="token comment">// å½“é˜Ÿå¤´å…ƒç´ çš„ç´¢å¼•å·²ç»è¢«æ’é™¤åœ¨æ»‘åŠ¨çª—å£ä¹‹å¤–æ—¶</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>deque<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> deque<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> i <span class="token operator">-</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°†é˜Ÿå¤´å…ƒç´ ç´¢å¼•å‡ºé˜Ÿ</span>      deque<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åˆ¤æ–­æ»‘åŠ¨çª—å£çš„çŠ¶æ€ï¼Œåªæœ‰åœ¨è¢«éå†çš„å…ƒç´ ä¸ªæ•°å¤§äº k çš„æ—¶å€™ï¼Œæ‰æ›´æ–°ç»“æœæ•°ç»„</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">>=</span> k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>deque<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›ç»“æœæ•°ç»„</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h3 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h3><h4 id="æ ˆçš„è®¾è®¡â€”â€”â€œæœ€å°æ ˆâ€é—®é¢˜"><a href="#æ ˆçš„è®¾è®¡â€”â€”â€œæœ€å°æ ˆâ€é—®é¢˜" class="headerlink" title="æ ˆçš„è®¾è®¡â€”â€”â€œæœ€å°æ ˆâ€é—®é¢˜"></a><strong>æ ˆçš„è®¾è®¡â€”â€”â€œæœ€å°æ ˆâ€é—®é¢˜</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">MinStack</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// å®šä¹‰è¾…åŠ©æ ˆ</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment">/** * @param &#123;number&#125; x * @return &#123;void&#125; */</span><span class="token class-name">MinStack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">push</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment">// è‹¥å…¥æ ˆçš„å€¼å°äºå½“å‰æœ€å°å€¼ï¼Œåˆ™æ¨å…¥è¾…åŠ©æ ˆæ ˆé¡¶</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">>=</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * @return &#123;void&#125; */</span><span class="token class-name">MinStack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">pop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è‹¥å‡ºæ ˆçš„å€¼å’Œå½“å‰æœ€å°å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆè¾…åŠ©æ ˆä¹Ÿè¦å¯¹æ ˆé¡¶å…ƒç´ è¿›è¡Œå‡ºæ ˆï¼Œç¡®ä¿æœ€å°å€¼çš„æœ‰æ•ˆæ€§</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">/** * @return &#123;number&#125; */</span><span class="token class-name">MinStack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">top</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token comment">/** * @return &#123;number&#125; */</span><span class="token class-name">MinStack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getMin</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è¾…åŠ©æ ˆçš„æ ˆé¡¶ï¼Œå­˜çš„å°±æ˜¯ç›®æ ‡ä¸­çš„æœ€å°å€¼</span>  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>stack2<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ‰æ•ˆæ‹¬å·"><a href="#æœ‰æ•ˆæ‹¬å·" class="headerlink" title="æœ‰æ•ˆæ‹¬å·"></a>æœ‰æ•ˆæ‹¬å·</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">isValid</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token punctuation">[</span><span class="token string">"("</span><span class="token punctuation">,</span> <span class="token string">")"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"["</span><span class="token punctuation">,</span> <span class="token string">"]"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span><span class="token string">"&#123;"</span><span class="token punctuation">,</span> <span class="token string">"&#125;"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> ch <span class="token keyword">of</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">case</span> <span class="token string">"("</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">"["</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">"&#123;"</span><span class="token operator">:</span>        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span>        i<span class="token operator">++</span>        <span class="token keyword">break</span>      <span class="token keyword">case</span> <span class="token string">")"</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">"]"</span><span class="token operator">:</span>      <span class="token keyword">case</span> <span class="token string">"&#125;"</span><span class="token operator">:</span>        <span class="token comment">// arr.push()</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          arr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          i<span class="token operator">--</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">return</span> <span class="token boolean">false</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> arr<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h3><h4 id="é“¾è¡¨çš„åˆå¹¶"><a href="#é“¾è¡¨çš„åˆå¹¶" class="headerlink" title="é“¾è¡¨çš„åˆå¹¶"></a><strong>é“¾è¡¨çš„åˆå¹¶</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">mergeTwoLists</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">l1<span class="token punctuation">,</span> l2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰å¤´ç»“ç‚¹ï¼Œç¡®ä¿é“¾è¡¨å¯ä»¥è¢«è®¿é—®åˆ°</span>  <span class="token keyword">let</span> head <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// cur è¿™é‡Œå°±æ˜¯å’±ä»¬é‚£æ ¹â€œé’ˆâ€</span>  <span class="token keyword">let</span> cur <span class="token operator">=</span> head  <span class="token comment">// â€œé’ˆâ€å¼€å§‹åœ¨ l1 å’Œ l2 é—´ç©¿æ¢­äº†</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>l1 <span class="token operator">&amp;&amp;</span> l2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœ l1 çš„ç»“ç‚¹å€¼è¾ƒå°</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>l1<span class="token punctuation">.</span>val <span class="token operator">&lt;=</span> l2<span class="token punctuation">.</span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å…ˆä¸²èµ· l1 çš„ç»“ç‚¹</span>      cur<span class="token punctuation">.</span>next <span class="token operator">=</span> l1      <span class="token comment">// l1 æŒ‡é’ˆå‘å‰ä¸€æ­¥</span>      l1 <span class="token operator">=</span> l1<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// l2 è¾ƒå°æ—¶ï¼Œä¸²èµ· l2 ç»“ç‚¹</span>      cur<span class="token punctuation">.</span>next <span class="token operator">=</span> l2      <span class="token comment">// l2 å‘å‰ä¸€æ­¥</span>      l2 <span class="token operator">=</span> l2<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span>    <span class="token comment">// â€œé’ˆâ€åœ¨ä¸²èµ·ä¸€ä¸ªç»“ç‚¹åï¼Œä¹Ÿä¼šå¾€å‰ä¸€æ­¥</span>    cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token comment">// å¤„ç†é“¾è¡¨ä¸ç­‰é•¿çš„æƒ…å†µ</span>  cur<span class="token punctuation">.</span>next <span class="token operator">=</span> l1 <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> l1 <span class="token operator">:</span> l2  <span class="token comment">// è¿”å›èµ·å§‹ç»“ç‚¹</span>  <span class="token keyword">return</span> head<span class="token punctuation">.</span>next<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é“¾è¡¨ç»“ç‚¹çš„åˆ é™¤"><a href="#é“¾è¡¨ç»“ç‚¹çš„åˆ é™¤" class="headerlink" title="é“¾è¡¨ç»“ç‚¹çš„åˆ é™¤"></a><strong>é“¾è¡¨ç»“ç‚¹çš„åˆ é™¤</strong></h4><p>ç»™å®šä¸€ä¸ªæ’åºé“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ï¼Œä½¿å¾—æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">deleteDuplicates</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// è®¾å®š cur æŒ‡é’ˆï¼Œåˆå§‹ä½ç½®ä¸ºé“¾è¡¨ç¬¬ä¸€ä¸ªç»“ç‚¹</span>  <span class="token keyword">let</span> cur <span class="token operator">=</span> head  <span class="token comment">// éå†é“¾è¡¨</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cur<span class="token punctuation">.</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è‹¥å½“å‰ç»“ç‚¹å’Œå®ƒåé¢ä¸€ä¸ªç»“ç‚¹å€¼ç›¸ç­‰ï¼ˆé‡å¤ï¼‰</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val <span class="token operator">===</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// åˆ é™¤é åçš„é‚£ä¸ªç»“ç‚¹ï¼ˆå»é‡ï¼‰</span>      cur<span class="token punctuation">.</span>next <span class="token operator">=</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥ä¸é‡å¤ï¼Œç»§ç»­éå†</span>      cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> head<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç»™å®šä¸€ä¸ªæ’åºé“¾è¡¨ï¼Œåˆ é™¤æ‰€æœ‰å«æœ‰é‡å¤æ•°å­—çš„ç»“ç‚¹ï¼Œåªä¿ç•™åŸå§‹é“¾è¡¨ä¸­ æ²¡æœ‰é‡å¤å‡ºç°çš„æ•°å­—ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">deleteDuplicates</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// æç«¯æƒ…å†µï¼š0ä¸ªæˆ–1ä¸ªç»“ç‚¹ï¼Œåˆ™ä¸ä¼šé‡å¤ï¼Œç›´æ¥è¿”å›</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>head <span class="token operator">||</span> <span class="token operator">!</span>head<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> head  <span class="token punctuation">&#125;</span>  <span class="token comment">// dummy ç™»åœº</span>  <span class="token keyword">let</span> dummy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// dummy æ°¸è¿œæŒ‡å‘å¤´ç»“ç‚¹</span>  dummy<span class="token punctuation">.</span>next <span class="token operator">=</span> head  <span class="token comment">// cur ä» dummy å¼€å§‹éå†</span>  <span class="token keyword">let</span> cur <span class="token operator">=</span> dummy  <span class="token comment">// å½“ cur çš„åé¢æœ‰è‡³å°‘ä¸¤ä¸ªç»“ç‚¹æ—¶</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>next <span class="token operator">&amp;&amp;</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¯¹ cur åé¢çš„ä¸¤ä¸ªç»“ç‚¹è¿›è¡Œæ¯”è¾ƒ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>val <span class="token operator">===</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next<span class="token punctuation">.</span>val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥å€¼é‡å¤ï¼Œåˆ™è®°ä¸‹è¿™ä¸ªå€¼</span>      <span class="token keyword">let</span> val <span class="token operator">=</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>val      <span class="token comment">// åå¤åœ°æ’æŸ¥åé¢çš„å…ƒç´ æ˜¯å¦å­˜åœ¨å¤šæ¬¡é‡å¤è¯¥å€¼çš„æƒ…å†µ</span>      <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>next <span class="token operator">&amp;&amp;</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>val <span class="token operator">===</span> val<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// è‹¥æœ‰ï¼Œåˆ™åˆ é™¤</span>        cur<span class="token punctuation">.</span>next <span class="token operator">=</span> cur<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥ä¸é‡å¤ï¼Œåˆ™æ­£å¸¸éå†</span>      cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›é“¾è¡¨çš„èµ·å§‹ç»“ç‚¹</span>  <span class="token keyword">return</span> dummy<span class="token punctuation">.</span>next<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹"><a href="#åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬-N-ä¸ªç»“ç‚¹" class="headerlink" title="åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹"></a><strong>åˆ é™¤é“¾è¡¨çš„å€’æ•°ç¬¬ N ä¸ªç»“ç‚¹</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">removeNthFromEnd</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ– dummy ç»“ç‚¹</span>  <span class="token keyword">const</span> dummy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// dummyæŒ‡å‘å¤´ç»“ç‚¹</span>  dummy<span class="token punctuation">.</span>next <span class="token operator">=</span> head  <span class="token comment">// åˆå§‹åŒ–å¿«æ…¢æŒ‡é’ˆï¼Œå‡æŒ‡å‘dummy</span>  <span class="token keyword">let</span> fast <span class="token operator">=</span> dummy  <span class="token keyword">let</span> slow <span class="token operator">=</span> dummy  <span class="token comment">// å¿«æŒ‡é’ˆé—·å¤´èµ° n æ­¥</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next    n<span class="token operator">--</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// å¿«æ…¢æŒ‡é’ˆä¸€èµ·èµ°</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>fast<span class="token punctuation">.</span>next<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    fast <span class="token operator">=</span> fast<span class="token punctuation">.</span>next    slow <span class="token operator">=</span> slow<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token comment">// æ…¢æŒ‡é’ˆåˆ é™¤è‡ªå·±çš„åç»§ç»“ç‚¹</span>  slow<span class="token punctuation">.</span>next <span class="token operator">=</span> slow<span class="token punctuation">.</span>next<span class="token punctuation">.</span>next  <span class="token comment">// è¿”å›å¤´ç»“ç‚¹</span>  <span class="token keyword">return</span> dummy<span class="token punctuation">.</span>next<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="é“¾è¡¨çš„åè½¬"><a href="#é“¾è¡¨çš„åè½¬" class="headerlink" title="é“¾è¡¨çš„åè½¬"></a><strong>é“¾è¡¨çš„åè½¬</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">reverseList</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åˆå§‹åŒ–å‰é©±ç»“ç‚¹ä¸º null</span>  <span class="token keyword">let</span> pre <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token comment">// åˆå§‹åŒ–ç›®æ ‡ç»“ç‚¹ä¸ºå¤´ç»“ç‚¹</span>  <span class="token keyword">let</span> cur <span class="token operator">=</span> head  <span class="token comment">// åªè¦ç›®æ ‡ç»“ç‚¹ä¸ä¸º nullï¼Œéå†å°±å¾—ç»§ç»­</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è®°å½•ä¸€ä¸‹ next ç»“ç‚¹</span>    <span class="token keyword">let</span> next <span class="token operator">=</span> cur<span class="token punctuation">.</span>next    <span class="token comment">// åè½¬æŒ‡é’ˆ</span>    cur<span class="token punctuation">.</span>next <span class="token operator">=</span> pre    <span class="token comment">// pre å¾€å‰èµ°ä¸€æ­¥</span>    pre <span class="token operator">=</span> cur    <span class="token comment">// curå¾€å‰èµ°ä¸€æ­¥</span>    cur <span class="token operator">=</span> next  <span class="token punctuation">&#125;</span>  <span class="token comment">// åè½¬ç»“æŸåï¼Œpre å°±ä¼šå˜æˆæ–°é“¾è¡¨çš„å¤´ç»“ç‚¹</span>  <span class="token keyword">return</span> pre<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å±€éƒ¨åè½¬ä¸€ä¸ªé“¾è¡¨"><a href="#å±€éƒ¨åè½¬ä¸€ä¸ªé“¾è¡¨" class="headerlink" title="å±€éƒ¨åè½¬ä¸€ä¸ªé“¾è¡¨"></a>å±€éƒ¨åè½¬ä¸€ä¸ªé“¾è¡¨</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">reverseBetween</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head<span class="token punctuation">,</span> m<span class="token punctuation">,</span> n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰preã€curï¼Œç”¨leftHeadæ¥æ‰¿æ¥æ•´ä¸ªåŒºé—´çš„å‰é©±ç»“ç‚¹</span>  <span class="token keyword">let</span> pre<span class="token punctuation">,</span> cur<span class="token punctuation">,</span> leftHead  <span class="token comment">// åˆ«å¿˜äº†ç”¨ dummy å—·</span>  <span class="token keyword">const</span> dummy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// dummyåç»§ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹</span>  dummy<span class="token punctuation">.</span>next <span class="token operator">=</span> head  <span class="token comment">// pæ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼Œç”¨äºéå†ï¼Œæœ€åˆæŒ‡å‘ dummy</span>  <span class="token keyword">let</span> p <span class="token operator">=</span> dummy  <span class="token comment">// på¾€å‰èµ° m-1 æ­¥ï¼Œèµ°åˆ°æ•´ä¸ªåŒºé—´çš„å‰é©±ç»“ç‚¹å¤„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    p <span class="token operator">=</span> p<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token comment">// ç¼“å­˜è¿™ä¸ªå‰é©±ç»“ç‚¹åˆ° leftHead é‡Œ</span>  leftHead <span class="token operator">=</span> p  <span class="token comment">// start æ˜¯åè½¬åŒºé—´çš„ç¬¬ä¸€ä¸ªç»“ç‚¹</span>  <span class="token keyword">let</span> start <span class="token operator">=</span> leftHead<span class="token punctuation">.</span>next  <span class="token comment">// pre æŒ‡å‘start</span>  pre <span class="token operator">=</span> start  <span class="token comment">// cur æŒ‡å‘ start çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</span>  cur <span class="token operator">=</span> pre<span class="token punctuation">.</span>next  <span class="token comment">// å¼€å§‹é‡å¤åè½¬åŠ¨ä½œ</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> m<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> next <span class="token operator">=</span> cur<span class="token punctuation">.</span>next    cur<span class="token punctuation">.</span>next <span class="token operator">=</span> pre    pre <span class="token operator">=</span> cur    cur <span class="token operator">=</span> next  <span class="token punctuation">&#125;</span>  <span class="token comment">//  leftHead çš„åç»§ç»“ç‚¹æ­¤æ—¶ä¸ºåè½¬åçš„åŒºé—´çš„ç¬¬ä¸€ä¸ªç»“ç‚¹</span>  leftHead<span class="token punctuation">.</span>next <span class="token operator">=</span> pre  <span class="token comment">// å°†åŒºé—´å†…åè½¬åçš„æœ€åä¸€ä¸ªç»“ç‚¹ next æŒ‡å‘ cur</span>  start<span class="token punctuation">.</span>next <span class="token operator">=</span> cur  <span class="token comment">// dummy.next æ°¸è¿œæŒ‡å‘é“¾è¡¨å¤´ç»“ç‚¹</span>  <span class="token keyword">return</span> dummy<span class="token punctuation">.</span>next<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åˆ¤æ–­é“¾è¡¨æ˜¯å¦æˆç¯"><a href="#åˆ¤æ–­é“¾è¡¨æ˜¯å¦æˆç¯" class="headerlink" title="åˆ¤æ–­é“¾è¡¨æ˜¯å¦æˆç¯"></a><strong>åˆ¤æ–­é“¾è¡¨æ˜¯å¦æˆç¯</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">hasCycle</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// åªè¦ç»“ç‚¹å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ç»§ç»­éå†</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>head<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœ flag å·²ç»ç«‹è¿‡äº†ï¼Œé‚£ä¹ˆè¯´æ˜ç¯å­˜åœ¨</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>head<span class="token punctuation">.</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token boolean">true</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å¦‚æœ flag æ²¡ç«‹è¿‡ï¼Œå°±ç«‹ä¸€ä¸ª flag å†å¾€ ä¸‹èµ°</span>      head<span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token boolean">true</span>      head <span class="token operator">=</span> head<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å®šä½ç¯çš„èµ·ç‚¹"><a href="#å®šä½ç¯çš„èµ·ç‚¹" class="headerlink" title="å®šä½ç¯çš„èµ·ç‚¹"></a><strong>å®šä½ç¯çš„èµ·ç‚¹</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">detectCycle</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">head</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>head<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>head<span class="token punctuation">.</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> head    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>      head<span class="token punctuation">.</span>flag <span class="token operator">=</span> <span class="token boolean">true</span>      head <span class="token operator">=</span> head<span class="token punctuation">.</span>next    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç›¸äº¤é“¾è¡¨"><a href="#ç›¸äº¤é“¾è¡¨" class="headerlink" title="ç›¸äº¤é“¾è¡¨"></a>ç›¸äº¤é“¾è¡¨</h4><ol><li>å“ˆå¸Œè¡¨</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">getIntersectionNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">headA<span class="token punctuation">,</span> headB</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>headA <span class="token operator">||</span> <span class="token operator">!</span>headB<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>  <span class="token keyword">const</span> hashmap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">let</span> pA <span class="token operator">=</span> headA  <span class="token keyword">while</span> <span class="token punctuation">(</span>pA<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    hashmap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>pA<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>    pA <span class="token operator">=</span> pA<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token keyword">let</span> pB <span class="token operator">=</span> headB  <span class="token keyword">while</span> <span class="token punctuation">(</span>pB<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>hashmap<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>pB<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> pB    pB <span class="token operator">=</span> pB<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><p>åŒæŒ‡é’ˆ</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">getIntersectionNode</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">headA<span class="token punctuation">,</span> headB</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>headA <span class="token operator">||</span> <span class="token operator">!</span>headB<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>  <span class="token keyword">let</span> pA <span class="token operator">=</span> headA<span class="token punctuation">,</span>    pB <span class="token operator">=</span> headB  <span class="token keyword">while</span> <span class="token punctuation">(</span>pA <span class="token operator">!==</span> pB<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    pA <span class="token operator">=</span> pA <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">?</span> headB <span class="token operator">:</span> pA<span class="token punctuation">.</span>next    pB <span class="token operator">=</span> pB <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token operator">?</span> headA <span class="token operator">:</span> pB<span class="token punctuation">.</span>next  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> pA<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h3><h4 id="é€’å½’éå†"><a href="#é€’å½’éå†" class="headerlink" title="é€’å½’éå†"></a>é€’å½’éå†</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">preorderTraversal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// é¦–å…ˆå£°æ˜ä¸€ä¸ªæ•°ç»„ç”¨æ¥å­˜æ”¾éå†å¾—åˆ°çš„èŠ‚ç‚¹valå€¼</span>  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// é‡‡ç”¨é€’å½’éå†</span>  <span class="token keyword">function</span> <span class="token function">preorder</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¦‚æœèŠ‚ç‚¹ä¸ºç©ºç›´æ¥è¿”å›</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>node<span class="token punctuation">)</span> <span class="token keyword">return</span>    <span class="token comment">// å…ˆåºéå†å°±æ˜¯æŠŠå½“å‰èŠ‚ç‚¹è¾“å‡º æ”¾åœ¨å·¦å³é€’å½’è°ƒç”¨ä¹‹å‰ å°†å…¶æ•°å€¼æ”¾å…¥ç»“æœæ•°ç»„</span>    result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>val<span class="token punctuation">)</span>    <span class="token comment">// ç„¶åé€’å½’éå†å·¦å­©å­</span>    <span class="token function">preorder</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>left<span class="token punctuation">)</span>    <span class="token comment">// æœ€åé€’å½’éå†å³å­©å­</span>    <span class="token function">preorder</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>right<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token function">preorder</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>  <span class="token comment">// è¿”å›ç»“æœ</span>  <span class="token keyword">return</span> result<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="è¿­ä»£éå†ï¼ˆåˆ©ç”¨æ ˆæ€æƒ³ï¼‰"><a href="#è¿­ä»£éå†ï¼ˆåˆ©ç”¨æ ˆæ€æƒ³ï¼‰" class="headerlink" title="è¿­ä»£éå†ï¼ˆåˆ©ç”¨æ ˆæ€æƒ³ï¼‰"></a>è¿­ä»£éå†ï¼ˆåˆ©ç”¨æ ˆæ€æƒ³ï¼‰</h4><ol><li><p>å‰åº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */</span><span class="token keyword">const</span> <span class="token function-variable function">preorderTraversal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// å¤„ç†è¾¹ç•Œæ¡ä»¶</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆå§‹åŒ–æ ˆç»“æ„</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// é¦–å…ˆå°†æ ¹ç»“ç‚¹å…¥æ ˆ</span>  stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>  <span class="token comment">// è‹¥æ ˆä¸ä¸ºç©ºï¼Œåˆ™é‡å¤å‡ºæ ˆã€å…¥æ ˆæ“ä½œ</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°†æ ˆé¡¶ç»“ç‚¹è®°ä¸ºå½“å‰ç»“ç‚¹</span>    <span class="token keyword">const</span> cur <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å½“å‰ç»“ç‚¹å°±æ˜¯å½“å‰å­æ ‘çš„æ ¹ç»“ç‚¹ï¼ŒæŠŠè¿™ä¸ªç»“ç‚¹æ”¾åœ¨ç»“æœæ•°ç»„çš„å°¾éƒ¨</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val<span class="token punctuation">)</span>    <span class="token comment">// è‹¥å½“å‰å­æ ‘æ ¹ç»“ç‚¹æœ‰å³å­©å­ï¼Œåˆ™å°†å³å­©å­å…¥æ ˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>right<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è‹¥å½“å‰å­æ ‘æ ¹ç»“ç‚¹æœ‰å·¦å­©å­ï¼Œåˆ™å°†å·¦å­©å­å…¥æ ˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>left<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›ç»“æœæ•°ç»„</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>ååº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/** * @param &#123;TreeNode&#125; root * @return &#123;number[]&#125; */</span><span class="token keyword">const</span> <span class="token function-variable function">postorderTraversal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// å¤„ç†è¾¹ç•Œæ¡ä»¶</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>root<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆå§‹åŒ–æ ˆç»“æ„</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// é¦–å…ˆå°†æ ¹ç»“ç‚¹å…¥æ ˆ</span>  stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>  <span class="token comment">// è‹¥æ ˆä¸ä¸ºç©ºï¼Œåˆ™é‡å¤å‡ºæ ˆã€å…¥æ ˆæ“ä½œ</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å°†æ ˆé¡¶ç»“ç‚¹è®°ä¸ºå½“å‰ç»“ç‚¹</span>    <span class="token keyword">const</span> cur <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å½“å‰ç»“ç‚¹å°±æ˜¯å½“å‰å­æ ‘çš„æ ¹ç»“ç‚¹ï¼ŒæŠŠè¿™ä¸ªç»“ç‚¹æ”¾åœ¨ç»“æœæ•°ç»„çš„å¤´éƒ¨</span>    res<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val<span class="token punctuation">)</span>    <span class="token comment">// è‹¥å½“å‰å­æ ‘æ ¹ç»“ç‚¹æœ‰å·¦å­©å­ï¼Œåˆ™å°†å·¦å­©å­å…¥æ ˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>left<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è‹¥å½“å‰å­æ ‘æ ¹ç»“ç‚¹æœ‰å³å­©å­ï¼Œåˆ™å°†å³å­©å­å…¥æ ˆ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>right<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›ç»“æœæ•°ç»„</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><p>ä¸­åº</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">inorderTraversal</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// å®šä¹‰ç»“æœæ•°ç»„</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// åˆå§‹åŒ–æ ˆç»“æ„</span>  <span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// ç”¨ä¸€ä¸ª cur ç»“ç‚¹å……å½“æ¸¸æ ‡</span>  <span class="token keyword">let</span> cur <span class="token operator">=</span> root  <span class="token comment">// å½“ cur ä¸ä¸ºç©ºã€æˆ–è€… stack ä¸ä¸ºç©ºæ—¶ï¼Œé‡å¤ä»¥ä¸‹é€»è¾‘</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">||</span> stack<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// è¿™ä¸ª while çš„ä½œç”¨æ˜¯æŠŠå¯»æ‰¾æœ€å·¦å¶å­ç»“ç‚¹çš„è¿‡ç¨‹ä¸­ï¼Œé€”å¾„çš„æ‰€æœ‰ç»“ç‚¹éƒ½è®°å½•ä¸‹æ¥</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å°†é€”å¾„çš„ç»“ç‚¹å…¥æ ˆ</span>      stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span>      <span class="token comment">// ç»§ç»­æœç´¢å½“å‰ç»“ç‚¹çš„å·¦å­©å­</span>      cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>left    <span class="token punctuation">&#125;</span>    <span class="token comment">// å–å‡ºæ ˆé¡¶å…ƒç´ </span>    cur <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// å°†æ ˆé¡¶å…ƒç´ å…¥æ ˆ</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val<span class="token punctuation">)</span>    <span class="token comment">// å°è¯•è¯»å– cur ç»“ç‚¹çš„å³å­©å­</span>    cur <span class="token operator">=</span> cur<span class="token punctuation">.</span>right  <span class="token punctuation">&#125;</span>  <span class="token comment">// è¿”å›ç»“æœæ•°ç»„</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å±‚åºéå†"><a href="#å±‚åºéå†" class="headerlink" title="å±‚åºéå†"></a>å±‚åºéå†</h4><ol><li>è¿”å›æ•°ç»„</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token constant">BFS</span><span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">const</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// åˆå§‹åŒ–é˜Ÿåˆ—queue</span>  <span class="token comment">// æ ¹ç»“ç‚¹é¦–å…ˆå…¥é˜Ÿ</span>  queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>  <span class="token comment">// é˜Ÿåˆ—ä¸ä¸ºç©ºï¼Œè¯´æ˜æ²¡æœ‰éå†å®Œå…¨</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> top <span class="token operator">=</span> queue<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment">// å–å‡ºé˜Ÿå¤´å…ƒç´ </span>    <span class="token comment">// è®¿é—® top</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>top<span class="token punctuation">.</span>val<span class="token punctuation">)</span>    <span class="token comment">// å¦‚æœå·¦å­æ ‘å­˜åœ¨ï¼Œå·¦å­æ ‘å…¥é˜Ÿ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>top<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>top<span class="token punctuation">.</span>left<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// å¦‚æœå³å­æ ‘å­˜åœ¨ï¼Œå³å­æ ‘å…¥é˜Ÿ</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>top<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>top<span class="token punctuation">.</span>right<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è®¿é—®å®Œæ¯•ï¼Œé˜Ÿå¤´å…ƒç´ å‡ºé˜Ÿ</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>è¿”å›äºŒç»´æ•°ç»„</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">levelOrder</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">root</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">/* éé€’å½’çš„å®ç°æ–¹å¼ */</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> res  <span class="token keyword">let</span> queue <span class="token operator">=</span> <span class="token punctuation">[</span>root<span class="token punctuation">]</span>  <span class="token comment">// while å¾ªç¯æ§åˆ¶ä»ä¸Šå‘ä¸‹ä¸€å±‚å±‚éå†</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>queue<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> size <span class="token operator">=</span> queue<span class="token punctuation">.</span>length    <span class="token comment">// è®°å½•è¿™ä¸€å±‚çš„èŠ‚ç‚¹å€¼</span>    <span class="token keyword">let</span> level <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token comment">// for å¾ªç¯æ§åˆ¶æ¯ä¸€å±‚ä»å·¦å‘å³éå†</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">let</span> cur <span class="token operator">=</span> queue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      level<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>val<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>left <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>left<span class="token punctuation">)</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cur<span class="token punctuation">.</span>right <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>right<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>level<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ¨æ€è§„åˆ’"><a href="#åŠ¨æ€è§„åˆ’" class="headerlink" title="åŠ¨æ€è§„åˆ’"></a>åŠ¨æ€è§„åˆ’</h3><h4 id="çˆ¬æ¥¼æ¢¯"><a href="#çˆ¬æ¥¼æ¢¯" class="headerlink" title="çˆ¬æ¥¼æ¢¯"></a><strong>çˆ¬æ¥¼æ¢¯</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">climbStairs</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// å¤„ç†é€’å½’è¾¹ç•Œ</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">1</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>n <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">2</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// é€’å½’è®¡ç®—</span>    <span class="token keyword">return</span> <span class="token function">climbStairs</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">climbStairs</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token comment">// å®šä¹‰è®°å¿†æ•°ç»„ f</span><span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">const</span> <span class="token function-variable function">climbStairs</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token number">1</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>n<span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token number">2</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥f[n]ä¸å­˜åœ¨ï¼Œåˆ™è¿›è¡Œè®¡ç®—</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">===</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>  f<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">climbStairs</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">climbStairs</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// è‹¥f[n]å·²ç»æ±‚è§£è¿‡ï¼Œç›´æ¥è¿”å›</span>  <span class="token keyword">return</span> f<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>  <span class="token keyword">const</span> <span class="token function-variable function">climbStairs</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// åˆå§‹åŒ–çŠ¶æ€æ•°ç»„</span>    <span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// åˆå§‹åŒ–å·²çŸ¥å€¼</span>    f<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    f<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token comment">// åŠ¨æ€æ›´æ–°æ¯ä¸€å±‚æ¥¼æ¢¯å¯¹åº”çš„ç»“æœ</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> f<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> f<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// è¿”å›ç›®æ ‡å€¼</span>    <span class="token keyword">return</span> f<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¦‚ä½•ä¼˜é›…åœ°æ‰¾ç¡¬å¸"><a href="#å¦‚ä½•ä¼˜é›…åœ°æ‰¾ç¡¬å¸" class="headerlink" title="å¦‚ä½•ä¼˜é›…åœ°æ‰¾ç¡¬å¸"></a><strong>å¦‚ä½•ä¼˜é›…åœ°æ‰¾ç¡¬å¸</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> <span class="token function-variable function">coinChange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">coins<span class="token punctuation">,</span> amount</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç”¨äºä¿å­˜æ¯ä¸ªç›®æ ‡æ€»é¢å¯¹åº”çš„æœ€å°ç¡¬å¸ä¸ªæ•°</span>  <span class="token keyword">const</span> f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// æå‰å®šä¹‰å·²çŸ¥æƒ…å†µ</span>  f<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment">// éå† [1, amount] è¿™ä¸ªåŒºé—´çš„ç¡¬å¸æ€»é¢</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> amount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ±‚çš„æ˜¯æœ€å°å€¼ï¼Œå› æ­¤æˆ‘ä»¬é¢„è®¾ä¸ºæ— ç©·å¤§ï¼Œç¡®ä¿å®ƒä¸€å®šä¼šè¢«æ›´å°çš„æ•°æ›´æ–°</span>    f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">Infinity</span>    <span class="token comment">// å¾ªç¯éå†æ¯ä¸ªå¯ç”¨ç¡¬å¸çš„é¢é¢</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> coins<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥ç¡¬å¸é¢é¢å°äºç›®æ ‡æ€»é¢ï¼Œåˆ™é—®é¢˜æˆç«‹</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> coins<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// çŠ¶æ€è½¬ç§»æ–¹ç¨‹</span>        f<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> f<span class="token punctuation">[</span>i <span class="token operator">-</span> coins<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥ç›®æ ‡æ€»é¢å¯¹åº”çš„è§£ä¸ºæ— ç©·å¤§ï¼Œåˆ™æ„å‘³ç€æ²¡æœ‰ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ç¡¬å¸æ€»æ•°æ¥æ›´æ–°å®ƒï¼Œæœ¬é¢˜æ— è§£ï¼Œè¿”å›-1</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>f<span class="token punctuation">[</span>amount<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token number">Infinity</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// è‹¥æœ‰è§£ï¼Œç›´æ¥è¿”å›è§£çš„å†…å®¹</span>  <span class="token keyword">return</span> f<span class="token punctuation">[</span>amount<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="èƒŒåŒ…æ¨¡å‹"><a href="#èƒŒåŒ…æ¨¡å‹" class="headerlink" title="èƒŒåŒ…æ¨¡å‹"></a>èƒŒåŒ…æ¨¡å‹</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">knapsack</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> c<span class="token punctuation">,</span> w<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// dpæ˜¯åŠ¨æ€è§„åˆ’çš„çŠ¶æ€ä¿å­˜æ•°ç»„</span>  <span class="token keyword">const</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>c <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">// res ç”¨æ¥è®°å½•æ‰€æœ‰ç»„åˆæ–¹æ¡ˆä¸­çš„æœ€å¤§å€¼</span>  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">Infinity</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token operator">=</span> c<span class="token punctuation">;</span> v <span class="token operator">>=</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> v<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// å†™å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹</span>      dp<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>v <span class="token operator">-</span> w<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+</span> value<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment">// å³æ—¶æ›´æ–°æœ€å¤§å€¼</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>dp<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">></span> res<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        res <span class="token operator">=</span> dp<span class="token punctuation">[</span>v<span class="token punctuation">]</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> res<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹-1"><a href="#æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹-1" class="headerlink" title="æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹"></a><strong>æœ€é•¿ä¸Šå‡å­åºåˆ—æ¨¡å‹</strong></h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// å…¥å‚æ˜¯ä¸€ä¸ªæ•°å­—åºåˆ—</span><span class="token keyword">const</span> <span class="token function-variable function">lengthOfLIS</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// ç¼“å­˜åºåˆ—çš„é•¿åº¦</span>  <span class="token keyword">const</span> len <span class="token operator">=</span> nums<span class="token punctuation">.</span>length  <span class="token comment">// å¤„ç†è¾¹ç•Œæ¡ä»¶</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token number">0</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// åˆå§‹åŒ–æ•°ç»„é‡Œé¢æ¯ä¸€ä¸ªç´¢å¼•ä½çš„çŠ¶æ€å€¼</span>  <span class="token keyword">const</span> dp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment">// åˆå§‹åŒ–æœ€å¤§ä¸Šå‡å­åºåˆ—çš„é•¿åº¦ä¸º1</span>  <span class="token keyword">let</span> maxLen <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">// ä»ç¬¬2ä¸ªå…ƒç´ å¼€å§‹ï¼Œéå†æ•´ä¸ªæ•°ç»„</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">// æ¯éå†ä¸€ä¸ªæ–°å…ƒç´ ï¼Œéƒ½è¦â€œå›å¤´çœ‹â€ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½å»¶é•¿åŸæœ‰çš„ä¸Šå‡å­åºåˆ—</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> i<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// è‹¥é‡åˆ°äº†ä¸€ä¸ªæ¯”å½“å‰å…ƒç´ å°çš„å€¼ï¼Œåˆ™æ„å‘³ç€é‡åˆ°äº†ä¸€ä¸ªå¯ä»¥å»¶é•¿çš„ä¸Šå‡å­åºåˆ—ï¼Œæ•…æ›´æ–°å½“å‰å…ƒç´ ç´¢å¼•ä½å¯¹åº”çš„çŠ¶æ€</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> dp<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">// åŠæ—¶æ›´æ–°ä¸Šå‡å­åºåˆ—é•¿åº¦çš„æœ€å¤§å€¼</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">></span> maxLen<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      maxLen <span class="token operator">=</span> dp<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span>  <span class="token comment">// éå†å®Œæ¯•ï¼Œæœ€ååˆ°æ‰‹çš„å°±æ˜¯æœ€å¤§ä¸Šå‡å­åºåˆ—çš„é•¿åº¦</span>  <span class="token keyword">return</span> maxLen<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h3><h4 id="å®ç°-add-1-2"><a href="#å®ç°-add-1-2" class="headerlink" title="å®ç° add(1)(2)()"></a>å®ç° add(1)(2)()</h4><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>b<span class="token punctuation">)</span> <span class="token keyword">return</span> a    <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>![image-20220330143049151](/Users/didi/Library/Application Support/typora-user-images/image-20220330143049151.png)</p>]]></content>
      
      
      
        <tags>
            
            <tag> é¢è¯• </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
